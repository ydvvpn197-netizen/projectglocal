var fe=Object.defineProperty,ve=Object.defineProperties;var Ne=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var te=(t,i,d)=>i in t?fe(t,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[i]=d,O=(t,i)=>{for(var d in i||(i={}))ye.call(i,d)&&te(t,d,i[d]);if(se)for(var d of se(i))we.call(i,d)&&te(t,d,i[d]);return t},Y=(t,i)=>ve(t,Ne(i));var y=(t,i,d)=>new Promise((N,h)=>{var C=p=>{try{g(d.next(p))}catch(r){h(r)}},j=p=>{try{g(d.throw(p))}catch(r){h(r)}},g=p=>p.done?N(p.value):Promise.resolve(p.value).then(C,j);g((d=d.apply(t,i)).next())});import{r as o,j as e}from"./chunk-V8Tq47hD.js";import{ResponsiveLayout as Z}from"./ResponsiveLayout.tsx-CBMj4ano.js";import{u as z,e as V,s as c,C as f,b,c as _,a as v,f as U,B as q}from"./main-nj8_qmr1.js";import{B}from"./chunk-BqqQDpKD.js";import{S as ae}from"./chunk-CNC7STIA.js";import{S as Q}from"./chunk-CgjdgoZs.js";import{D as re,e as ie,a as ne,b as ce,c as le,d as oe}from"./chunk-B-6hVeMl.js";import{C as de}from"./chunk-DG7cS-OT.js";import{p as J}from"./chunk-aOfXXddH.js";import{C as M,$ as K,M as W,a5 as D,h as T,z as G,f as F,az as be,X as _e,af as ke,T as Ce,ah as Ee,S as Be,aG as X,j as ee,ab as De,P as Se,U as Ae}from"./chunk-BD2ShIYc.js";import{a as S}from"./chunk-jOF7Mqj2.js";import{n as Pe}from"./chunk-BvELcnIN.js";import{A as qe,a as $e,b as Re}from"./chunk-CJL1E-Mt.js";import{T as Te,a as Ue,b as I,c as H}from"./chunk-Dqojk3_S.js";import{P as Me}from"./chunk-mpNmbJ1v.js";import"./chunk-7Gxbu0Lx.js";import"./chunk-BbVfpXIH.js";import"./chunk-HDUI5Ctd.js";import"./chunk-DkszvQuI.js";import"./chunk-Cv5hKDJv.js";import"./chunk-CHdjBz-i.js";const Le=()=>{const{user:t}=z(),{toast:i}=V(),d=J(),[N,h]=o.useState([]),[C,j]=o.useState(!0),g=o.useCallback(()=>y(null,null,function*(){if(t)try{const{data:s,error:n}=yield c.from("artist_bookings").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(n)throw n;const x=yield Promise.all((s||[]).map(m=>y(null,null,function*(){var A;const{data:l}=yield c.from("artists").select("user_id").eq("id",m.artist_id).single(),{data:u}=yield c.from("profiles").select("display_name, avatar_url, artist_skills").eq("user_id",l==null?void 0:l.user_id).single(),{data:w}=yield c.from("chat_conversations").select("id").eq("client_id",t.id).eq("artist_id",l==null?void 0:l.user_id).single();return Y(O({},m),{artist_name:(u==null?void 0:u.display_name)||"Unknown Artist",artist_avatar:(u==null?void 0:u.avatar_url)||"",artist_specialty:((A=u==null?void 0:u.artist_skills)==null?void 0:A[0])||"Artist",chat_conversation_id:w==null?void 0:w.id})})));h(x)}catch(s){console.error("Error fetching client bookings:",s),i({title:"Error",description:"Failed to load your bookings",variant:"destructive"})}finally{j(!1)}}),[t,i]);o.useEffect(()=>{if(t){g();const s=c.channel("client-bookings").on("postgres_changes",{event:"UPDATE",schema:"public",table:"artist_bookings",filter:`user_id=eq.${t.id}`},()=>{g()}).subscribe();return()=>{c.removeChannel(s)}}},[t,g]);const p=s=>{switch(s){case"pending":return e.jsx(B,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:"Pending"});case"accepted":return e.jsx(B,{variant:"outline",className:"text-green-600 border-green-600",children:"Accepted"});case"declined":return e.jsx(B,{variant:"outline",className:"text-red-600 border-red-600",children:"Declined"});case"completed":return e.jsx(B,{variant:"outline",className:"text-blue-600 border-blue-600",children:"Completed"});default:return e.jsx(B,{variant:"outline",children:s})}},r=s=>{switch(s){case"pending":return e.jsx(G,{className:"h-4 w-4 text-yellow-600"});case"accepted":return e.jsx(F,{className:"h-4 w-4 text-green-600"});case"declined":return e.jsx(be,{className:"h-4 w-4 text-red-600"});case"completed":return e.jsx(F,{className:"h-4 w-4 text-blue-600"});default:return e.jsx(G,{className:"h-4 w-4"})}};return t?C?e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(_,{children:"My Bookings"})}),e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"My Bookings"]}),e.jsx(U,{children:"View and manage your booking requests"})]}),e.jsx(v,{children:N.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No bookings yet"}),e.jsx("p",{className:"text-sm",children:"Your booking requests will appear here"})]}):e.jsx(Q,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:N.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.artist_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.artist_specialty," â€¢ ",S(new Date(s.created_at),"PPp")]})]})]}),p(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:S(new Date(s.event_date),"PPP")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:s.event_location||"Location TBD"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.budget_min&&s.budget_max?`$${s.budget_min} - $${s.budget_max}`:"Budget TBD"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r(s.status),e.jsx("span",{className:"capitalize",children:s.status})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.event_description})}),e.jsx(ae,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(re,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(q,{variant:"outline",size:"sm",children:"View Details"})}),e.jsxs(ne,{children:[e.jsxs(ce,{children:[e.jsx(le,{children:"Booking Details"}),e.jsx(oe,{children:"Full information about this booking"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Artist Information"}),e.jsxs("p",{children:["Name: ",s.artist_name]}),e.jsxs("p",{children:["Specialty: ",s.artist_specialty]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Event Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",S(new Date(s.event_date),"PPP")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," ",s.event_location]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",s.event_description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Budget:"}),s.budget_min&&s.budget_max?` $${s.budget_min} - $${s.budget_max}`:" Not specified"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:"capitalize",children:s.status})]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="accepted"&&e.jsxs(q,{size:"sm",onClick:()=>y(null,null,function*(){try{const n=yield de.getOrCreateConversationForBooking(s.id);n?d(`/chat/${n}`):i({title:"Error",description:"Unable to start chat. Please try again.",variant:"destructive"})}catch(n){console.error("Error starting chat:",n),i({title:"Error",description:"Unable to start chat. Please try again.",variant:"destructive"})}}),children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),"Chat with Artist"]}),s.status==="pending"&&e.jsx(q,{size:"sm",variant:"outline",onClick:()=>{i({title:"Contact Support",description:"Please contact support to cancel this booking"})},children:"Cancel Booking"})]})]})]},s.id))})})})]}):null},Fe=()=>{const{user:t}=z(),{toast:i}=V(),[d,N]=o.useState([]),[h,C]=o.useState(!0),[j,g]=o.useState(null),p=o.useCallback(()=>y(null,null,function*(){if(t)try{const{data:s,error:n}=yield c.from("artists").select("id").eq("user_id",t.id).single();if(n){console.error("Error fetching artist record:",n),N([]);return}const{data:x,error:m}=yield c.from("artist_bookings").select("*").eq("artist_id",s.id).eq("status","pending").order("created_at",{ascending:!1});if(m)throw m;const l=yield Promise.all((x||[]).map(u=>y(null,null,function*(){const{data:w}=yield c.from("profiles").select("display_name, avatar_url").eq("user_id",u.user_id).single();return Y(O({},u),{client_name:(w==null?void 0:w.display_name)||"Unknown User",client_avatar:(w==null?void 0:w.avatar_url)||""})})));N(l)}catch(s){console.error("Error fetching booking requests:",s),i({title:"Error",description:"Failed to load booking requests",variant:"destructive"})}finally{C(!1)}}),[t,i]);o.useEffect(()=>{t&&(p(),y(null,null,function*(){const{data:n,error:x}=yield c.from("artists").select("id").eq("user_id",t.id).single();if(x){console.error("Error fetching artist record for realtime:",x);return}const m=c.channel("booking-requests").on("postgres_changes",{event:"INSERT",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${n.id}`},()=>{p()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${n.id}`},()=>{p()}).subscribe();return()=>{c.removeChannel(m)}}))},[t,p]);const r=(s,n)=>y(null,null,function*(){g(s);try{const x=d.find(l=>l.id===s);if(!x){console.error("Booking request not found:",s);return}console.log("Processing booking action:",{requestId:s,action:n,request:x});const{error:m}=yield c.from("artist_bookings").update({status:n==="accept"?"accepted":"declined",updated_at:new Date().toISOString()}).eq("id",s);if(m)throw console.error("Error updating booking status:",m),m;try{yield Pe.createBookingResponseNotification(s,n)}catch(l){console.error("Error creating booking response notification:",l)}if(n==="accept"){const{data:l,error:u}=yield c.from("artists").select("user_id").eq("id",x.artist_id).single();if(u){console.error("Error fetching artist user ID:",u);return}const{data:w,error:A}=yield c.from("chat_conversations").insert({booking_id:s,client_id:x.user_id,artist_id:l.user_id,status:"active"}).select().single();if(A)console.error("Error creating chat conversation:",A);else try{yield c.from("chat_messages").insert({conversation_id:w.id,sender_id:t.id,message:`Hello! I've accepted your booking request for ${x.event_description}. Let's discuss the details!`,message_type:"text"})}catch(E){console.error("Error creating welcome message:",E)}i({title:"Booking Accepted",description:"You've accepted the booking request. A chat has been started with the client."})}else i({title:"Booking Declined",description:"You've declined the booking request."});N(l=>l.filter(u=>u.id!==s))}catch(x){console.error("Error handling booking action:",x),i({title:"Error",description:"Failed to process booking request",variant:"destructive"})}finally{g(null)}});return t?h?e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(_,{children:"Booking Requests"})}),e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Booking Requests"]}),e.jsx(U,{children:"Manage incoming booking requests from clients"})]}),e.jsx(v,{children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No booking requests yet"}),e.jsx("p",{className:"text-sm",children:"Requests will appear here when clients book your services"})]}):e.jsx(Q,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:d.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.client_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:S(new Date(s.created_at),"PPp")})]})]}),e.jsx(B,{variant:"outline",children:"New Request"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:S(new Date(s.event_date),"PPP")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:s.event_location||"Location TBD"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.budget_min&&s.budget_max?`$${s.budget_min} - $${s.budget_max}`:"Budget TBD"})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.event_description})}),e.jsx(ae,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(re,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(q,{variant:"outline",size:"sm",children:"View Details"})}),e.jsxs(ne,{children:[e.jsxs(ce,{children:[e.jsx(le,{children:"Booking Request Details"}),e.jsx(oe,{children:"Full information about this booking request"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Client Information"}),e.jsxs("p",{children:["Name: ",s.client_name]}),s.contact_info&&e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:s.contact_info})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Event Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",S(new Date(s.event_date),"PPP")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," ",s.event_location]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",s.event_description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Budget:"}),s.budget_min&&s.budget_max?` $${s.budget_min} - $${s.budget_max}`:" Not specified"]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{size:"sm",variant:"destructive",onClick:()=>r(s.id,"reject"),disabled:j===s.id,children:[e.jsx(_e,{className:"h-4 w-4 mr-1"}),"Reject"]}),e.jsxs(q,{size:"sm",onClick:()=>r(s.id,"accept"),disabled:j===s.id,children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),"Accept & Chat"]})]})]})]},s.id))})})})]}):null},ze=()=>{const{user:t}=z(),{toast:i}=V(),d=J(),[N,h]=o.useState([]),[C,j]=o.useState(!0),g=o.useCallback(()=>y(null,null,function*(){if(t)try{const{data:s,error:n}=yield c.from("artists").select("id").eq("user_id",t.id).single();if(n){console.error("Error fetching artist record:",n),console.error("Artist error details:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),h([]);return}console.log("Artist record found:",s);const{data:x,error:m}=yield c.from("artist_bookings").select("*").eq("artist_id",s.id).eq("status","accepted").order("updated_at",{ascending:!1});if(m)throw console.error("Error fetching bookings:",m),m;console.log("Bookings data:",x);const l=yield Promise.all((x||[]).map(u=>y(null,null,function*(){var E,R,P;const[w,A]=yield Promise.all([c.from("profiles").select("display_name, avatar_url").eq("user_id",u.user_id).maybeSingle(),c.from("chat_conversations").select("id").eq("booking_id",u.id).maybeSingle()]);return Y(O({},u),{client_name:((E=w.data)==null?void 0:E.display_name)||"Unknown User",client_avatar:((R=w.data)==null?void 0:R.avatar_url)||"",chat_conversation_id:(P=A.data)==null?void 0:P.id})})));h(l)}catch(s){console.error("Error fetching accepted bookings:",s),console.error("Error details:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),i({title:"Error",description:"Failed to load accepted bookings",variant:"destructive"})}finally{j(!1)}}),[t,i]);o.useEffect(()=>{t&&(g(),y(null,null,function*(){const{data:n,error:x}=yield c.from("artists").select("id").eq("user_id",t.id).single();if(x){console.error("Error fetching artist record for realtime:",x);return}const m=c.channel("accepted-bookings").on("postgres_changes",{event:"UPDATE",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${n.id}`},l=>{l.new.status==="accepted"&&g()}).subscribe();return()=>{c.removeChannel(m)}}))},[t,g]);const p=s=>y(null,null,function*(){try{const n=yield de.getOrCreateConversationForBooking(s);n?d(`/chat/${n}`):i({title:"Error",description:"Unable to start chat. Please try again.",variant:"destructive"})}catch(n){console.error("Error starting chat:",n),i({title:"Error",description:"Unable to start chat. Please try again.",variant:"destructive"})}}),r=s=>{switch(s){case"accepted":return e.jsxs(B,{className:"bg-green-100 text-green-800",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Accepted"]});case"completed":return e.jsxs(B,{className:"bg-blue-100 text-blue-800",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Completed"]});default:return e.jsx(B,{variant:"outline",children:s})}};return t?C?e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(_,{children:"Accepted Bookings"})}),e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Accepted Bookings"]}),e.jsx(U,{children:"Manage your accepted booking requests and communicate with clients"})]}),e.jsx(v,{children:N.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No accepted bookings yet"}),e.jsx("p",{className:"text-sm",children:"Accepted booking requests will appear here"})]}):e.jsx(Q,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:N.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.client_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Accepted ",S(new Date(s.updated_at),"PPp")]})]})]}),r(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:S(new Date(s.event_date),"PPp")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.event_location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["$",s.budget_min," - $",s.budget_max||"No limit"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Created ",S(new Date(s.created_at),"PPp")]})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:"Event Description:"}),e.jsx("p",{className:"text-muted-foreground",children:s.event_description})]}),s.contact_info&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:"Contact Information:"}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-line",children:s.contact_info})]}),e.jsx("div",{className:"flex gap-2 pt-2",children:e.jsxs(q,{onClick:()=>p(s.id),className:"flex items-center gap-2",size:"sm",children:[e.jsx(T,{className:"h-4 w-4"}),s.chat_conversation_id?"Continue Chat":"Start Chat"]})})]},s.id))})})})]}):null},Ve=()=>{const{user:t}=z(),{toast:i}=V(),[d,N]=o.useState([]),[h,C]=o.useState(!0),j=J(),g=o.useCallback(()=>y(null,null,function*(){if(t)try{const{data:r,error:s}=yield c.from("chat_conversations").select("*").eq("artist_id",t.id).eq("status","active").order("updated_at",{ascending:!1});if(s)throw s;const n=yield Promise.all((r||[]).map(x=>y(null,null,function*(){const{data:m}=yield c.from("profiles").select("display_name, avatar_url").eq("user_id",x.client_id).single(),{data:l}=yield c.from("artist_bookings").select("event_date, event_location").eq("id",x.booking_id).single();return Y(O({},x),{client_name:(m==null?void 0:m.display_name)||"Unknown User",client_avatar:(m==null?void 0:m.avatar_url)||"",event_date:(l==null?void 0:l.event_date)||"",event_location:(l==null?void 0:l.event_location)||"",unread_count:0})})));N(n)}catch(r){console.error("Error fetching conversations:",r),i({title:"Error",description:"Failed to load conversations",variant:"destructive"})}finally{C(!1)}}),[t,i]);o.useEffect(()=>{if(t){g();const r=c.channel("active-conversations").on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_conversations",filter:`artist_id=eq.${t.id}`},()=>{g()}).subscribe();return()=>{c.removeChannel(r)}}},[t,g]);const p=r=>{j(`/chat/${r}`)};return t?h?e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(_,{children:"Active Conversations"})}),e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Active Conversations"]}),e.jsx(U,{children:"Chat with clients about accepted bookings"})]}),e.jsx(v,{children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No active conversations"}),e.jsx("p",{className:"text-sm",children:"Conversations will appear here when you accept booking requests"})]}):e.jsx(Q,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:d.map(r=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>p(r.id),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(qe,{className:"h-10 w-10",children:[e.jsx($e,{src:r.client_avatar}),e.jsx(Re,{children:r.client_name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:r.client_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Started ",S(new Date(r.created_at),"PPp")]})]})]}),r.unread_count>0&&e.jsx(B,{variant:"destructive",className:"ml-2",children:r.unread_count})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:r.event_date?S(new Date(r.event_date),"PPP"):"Date TBD"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:r.event_location||"Location TBD"})]})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx(q,{variant:"outline",size:"sm",children:"Open Chat"})})]},r.id))})})})]}):null},Oe=()=>{const{user:t}=z(),{toast:i}=V(),[d,N]=o.useState([]),[h,C]=o.useState({totalEarnings:0,thisMonthEarnings:0,completedBookings:0,averageBookingValue:0}),[j,g]=o.useState(!0),p=o.useCallback(()=>y(null,null,function*(){if(t)try{const{data:r,error:s}=yield c.from("artists").select("id").eq("user_id",t.id).single();if(s){console.error("Artist not found:",s);return}const{data:n,error:x}=yield c.from("artist_bookings").select("*").eq("artist_id",r.id).eq("status","completed").order("updated_at",{ascending:!1});if(x)throw x;const m=[];let l=0,u=0;const w=new Date().getMonth(),A=new Date().getFullYear();for(let E=0;E<5;E++){const R=Math.floor(Math.random()*500)+100,P=new Date;P.setDate(P.getDate()-Math.floor(Math.random()*30)),l+=R,P.getMonth()===w&&P.getFullYear()===A&&(u+=R),m.push({id:`earning_${E}`,booking_id:`booking_${E}`,amount:R,status:"paid",completed_at:P.toISOString(),client_name:`Client ${E+1}`,event_location:`Event Location ${E+1}`})}N(m),C({totalEarnings:l,thisMonthEarnings:u,completedBookings:m.length,averageBookingValue:l>0?l/m.length:0})}catch(r){console.error("Error fetching earnings data:",r),i({title:"Error",description:"Failed to load earnings data",variant:"destructive"})}finally{g(!1)}}),[t,i]);return o.useEffect(()=>{t&&p()},[t,p]),t?j?e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(_,{children:"Earnings Overview"})}),e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(f,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Total Earnings"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",h.totalEarnings.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["From ",h.completedBookings," completed bookings"]})]})]}),e.jsxs(f,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"This Month"}),e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",h.thisMonthEarnings.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:"+12%"})," from last month"]})]})]}),e.jsxs(f,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Completed Bookings"}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:h.completedBookings}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Successful projects delivered"})]})]}),e.jsxs(f,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Average Booking"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",Math.round(h.averageBookingValue).toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Per completed project"})]})]})]}),e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Recent Earnings"]}),e.jsx(U,{children:"Your latest completed bookings and payments"})]}),e.jsx(v,{children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No earnings yet"}),e.jsx("p",{className:"text-sm",children:"Complete bookings to start earning and tracking your income"})]}):e.jsx(Q,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:d.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(D,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:r.client_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.event_location}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(M,{className:"h-3 w-3 inline mr-1"}),S(new Date(r.completed_at),"PPP")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["+$",r.amount]}),e.jsx(B,{variant:r.status==="paid"?"default":"secondary",className:"text-xs",children:r.status})]})]},r.id))})})})]})]}):null},xs=()=>{const{user:t}=z(),i=J();V();const[d,N]=o.useState("overview"),[h,C]=o.useState("user"),[j,g]=o.useState({totalBookings:0,pendingRequests:0,totalEarnings:0,averageRating:0,activeChats:0,completedBookings:0,upcomingBookings:0,totalClients:0,profileViews:0,profileCompletion:0}),[p,r]=o.useState([]),[s,n]=o.useState(!0),[x,m]=o.useState(null);o.useEffect(()=>{y(null,null,function*(){if(t)try{const{data:k}=yield c.from("profiles").select("is_artist").eq("id",t.id).single();k!=null&&k.is_artist&&C("artist")}catch(k){console.error("Error checking user type:",k)}})},[t]),o.useEffect(()=>{y(null,null,function*(){if(t)try{n(!0),h==="artist"?yield l():yield u(),yield w()}catch(k){m("Failed to load dashboard data"),console.error("Error loading dashboard:",k)}finally{n(!1)}})},[t,h,l,u]);const l=o.useCallback(()=>y(null,null,function*(){try{const{data:a}=yield c.from("bookings").select("*").eq("artist_id",t==null?void 0:t.id),{data:k}=yield c.from("payments").select("amount").eq("artist_id",t==null?void 0:t.id).eq("status","completed"),{data:L}=yield c.from("chat_conversations").select("*").eq("artist_id",t==null?void 0:t.id),ue=(k==null?void 0:k.reduce(($,je)=>$+(je.amount||0),0))||0,ge=(a==null?void 0:a.filter($=>$.status==="completed").length)||0,pe=(a==null?void 0:a.filter($=>$.status==="pending").length)||0;g({totalBookings:(a==null?void 0:a.length)||0,pendingRequests:pe,totalEarnings:ue,averageRating:4.8,activeChats:(L==null?void 0:L.length)||0,completedBookings:ge,upcomingBookings:(a==null?void 0:a.filter($=>$.status==="confirmed").length)||0,totalClients:new Set(a==null?void 0:a.map($=>$.client_id)).size||0,profileViews:0,profileCompletion:85})}catch(a){console.error("Error loading artist dashboard:",a)}}),[t]),u=o.useCallback(()=>y(null,null,function*(){try{const{data:a}=yield c.from("bookings").select("*").eq("client_id",t==null?void 0:t.id),{data:k}=yield c.from("chat_conversations").select("*").eq("client_id",t==null?void 0:t.id);g({totalBookings:(a==null?void 0:a.length)||0,pendingRequests:0,totalEarnings:0,averageRating:0,activeChats:(k==null?void 0:k.length)||0,completedBookings:(a==null?void 0:a.filter(L=>L.status==="completed").length)||0,upcomingBookings:(a==null?void 0:a.filter(L=>L.status==="confirmed").length)||0,totalClients:0,profileViews:0,profileCompletion:75})}catch(a){console.error("Error loading user dashboard:",a)}}),[t]),w=()=>y(null,null,function*(){try{const a=[{id:"1",type:"booking",title:"New Booking Request",description:"Someone wants to book your services",timestamp:new Date().toISOString(),status:"pending"},{id:"2",type:"message",title:"New Message",description:"You have a new message from a client",timestamp:new Date(Date.now()-36e5).toISOString(),status:"completed"},{id:"3",type:"rating",title:"New Rating",description:"You received a 5-star rating",timestamp:new Date(Date.now()-72e5).toISOString(),status:"completed",rating:5}];r(a)}catch(a){console.error("Error loading recent activity:",a)}}),A=[{id:"create-post",title:"Create Post",description:"Share something with your community",icon:e.jsx(Se,{className:"w-5 h-5"}),action:()=>i("/create-post"),color:"bg-blue-500"},{id:"create-event",title:"Create Event",description:"Organize a community event",icon:e.jsx(X,{className:"w-5 h-5"}),action:()=>i("/create-event"),color:"bg-green-500"},{id:"join-community",title:"Join Community",description:"Discover local communities",icon:e.jsx(Ae,{className:"w-5 h-5"}),action:()=>i("/communities"),color:"bg-purple-500"},{id:"book-artist",title:"Book Artist",description:"Find and book local artists",icon:e.jsx(ee,{className:"w-5 h-5"}),action:()=>i("/book-artist"),color:"bg-yellow-500"}],E=[{id:"update-profile",title:"Update Profile",description:"Keep your profile fresh",icon:e.jsx(K,{className:"w-5 h-5"}),action:()=>i("/profile"),color:"bg-blue-500"},{id:"manage-bookings",title:"Manage Bookings",description:"View and manage your bookings",icon:e.jsx(X,{className:"w-5 h-5"}),action:()=>N("bookings"),color:"bg-green-500"},{id:"view-earnings",title:"View Earnings",description:"Check your earnings and payments",icon:e.jsx(D,{className:"w-5 h-5"}),action:()=>N("earnings"),color:"bg-purple-500"},{id:"active-chats",title:"Active Chats",description:"Respond to client messages",icon:e.jsx(T,{className:"w-5 h-5"}),action:()=>N("chats"),color:"bg-yellow-500"}],R=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(f,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Bookings"}),e.jsx("p",{className:"text-2xl font-bold",children:j.totalBookings})]}),e.jsx(X,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(f,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Earnings"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",j.totalEarnings.toFixed(2)]})]}),e.jsx(D,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(f,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rating"}),e.jsx("p",{className:"text-2xl font-bold",children:j.averageRating.toFixed(1)})]}),e.jsx(ee,{className:"w-8 h-8 text-yellow-500"})]})})}),e.jsx(f,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Chats"}),e.jsx("p",{className:"text-2xl font-bold",children:j.activeChats})]}),e.jsx(T,{className:"w-8 h-8 text-purple-500"})]})})})]}),e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsx(_,{children:"Quick Actions"}),e.jsx(U,{children:h==="artist"?"Manage your artist profile and bookings":"Explore and engage with your community"})]}),e.jsx(v,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:(h==="artist"?E:A).map(a=>e.jsxs(q,{variant:"outline",className:"h-auto p-4 flex flex-col items-center gap-2",onClick:a.action,children:[e.jsx("div",{className:`w-12 h-12 rounded-full ${a.color} flex items-center justify-center text-white`,children:a.icon}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description})]})]},a.id))})})]}),e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsx(_,{children:"Recent Activity"}),e.jsx(U,{children:"Your latest interactions and updates"})]}),e.jsx(v,{children:e.jsx("div",{className:"space-y-4",children:p.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:[a.type==="booking"&&e.jsx(X,{className:"w-5 h-5 text-blue-500"}),a.type==="message"&&e.jsx(T,{className:"w-5 h-5 text-green-500"}),a.type==="rating"&&e.jsx(ee,{className:"w-5 h-5 text-yellow-500"}),a.type==="payment"&&e.jsx(D,{className:"w-5 h-5 text-purple-500"}),a.type==="profile_view"&&e.jsx(De,{className:"w-5 h-5 text-gray-500"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(a.timestamp).toLocaleDateString()})]}),e.jsx(B,{variant:a.status==="completed"?"default":"secondary",children:a.status})]},a.id))})})]})]}),P=()=>h==="artist"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Fe,{}),e.jsx(ze,{})]}):e.jsx(Le,{}),me=()=>h==="artist"?e.jsx(Oe,{}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Earnings"}),e.jsx("p",{className:"text-gray-600",children:"Earnings are only available for artists"})]}),xe=()=>h==="artist"?e.jsx(Ve,{}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Active Chats"}),e.jsx("p",{className:"text-gray-600",children:"Start a conversation with an artist to see your chats here"})]}),he=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsx(_,{children:"Profile Analytics"}),e.jsx(U,{children:"Your profile performance and engagement"})]}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Profile Completion"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[j.profileCompletion,"%"]})]}),e.jsx(Me,{value:j.profileCompletion,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:j.profileViews}),e.jsx("p",{className:"text-sm text-gray-600",children:"Profile Views"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:j.totalClients}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Clients"})]})]})]})})]})});return s?e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})})}):x?e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(AlertTriangle,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Dashboard"}),e.jsx("p",{className:"text-gray-600",children:x})]})}):e.jsx(Z,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:h==="artist"?"Artist Dashboard":"User Dashboard"}),e.jsx("p",{className:"text-gray-600",children:h==="artist"?"Manage your bookings, earnings, and client interactions":"Explore communities, book artists, and stay connected"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{variant:h==="artist"?"default":"secondary",children:h==="artist"?"Artist":"User"}),e.jsxs(q,{variant:"outline",size:"sm",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Settings"]})]})]}),e.jsxs(Te,{value:d,onValueChange:a=>N(a),children:[e.jsxs(Ue,{className:"grid w-full grid-cols-5",children:[e.jsx(I,{value:"overview",children:"Overview"}),e.jsx(I,{value:"bookings",children:"Bookings"}),e.jsx(I,{value:"earnings",children:"Earnings"}),e.jsx(I,{value:"chats",children:"Chats"}),e.jsx(I,{value:"analytics",children:"Analytics"})]}),e.jsx(H,{value:"overview",className:"space-y-6",children:R()}),e.jsx(H,{value:"bookings",className:"space-y-6",children:P()}),e.jsx(H,{value:"earnings",className:"space-y-6",children:me()}),e.jsx(H,{value:"chats",className:"space-y-6",children:xe()}),e.jsx(H,{value:"analytics",className:"space-y-6",children:he()})]})]})})};export{xs as default};
