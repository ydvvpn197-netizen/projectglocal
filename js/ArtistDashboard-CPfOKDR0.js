var le=Object.defineProperty,de=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var te=(r,i,n)=>i in r?le(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n,M=(r,i)=>{for(var n in i||(i={}))xe.call(i,n)&&te(r,n,i[n]);if(se)for(var n of se(i))he.call(i,n)&&te(r,n,i[n]);return r},L=(r,i)=>de(r,me(i));var y=(r,i,n)=>new Promise((b,c)=>{var E=g=>{try{j(n.next(g))}catch(a){c(a)}},C=g=>{try{j(n.throw(g))}catch(a){c(a)}},j=g=>g.done?b(g.value):Promise.resolve(g.value).then(E,C);j((n=n.apply(r,i)).next())});import{c as ue,u as U,g as H,r as u,s as o,j as e,C as f,p as _,q as w,v,t as J,B,X as ge,f as W,S as pe}from"./main-B2Z1A0fl.js";import{A as X,b as I,c as G,R as re,S as fe}from"./ResponsiveLayout-CYnOsYqc.js";import{B as D}from"./badge-CdNeXDip.js";import{S as je}from"./separator-DjSuCMYj.js";import{S as K}from"./scroll-area-BhRuPQbm.js";import{D as ve,e as Ne,a as _e,b as be,c as we,d as ye}from"./dialog-KM5TFbjt.js";import{n as ke}from"./notificationService-BphN-zZk.js";import{C as Y}from"./calendar-Cawp_lnB.js";import{C as ae}from"./clock-DJLknj0F.js";import{U as ie}from"./user-etsi-1kT.js";import{f as P}from"./index-BccyXWdq.js";import{M as Z}from"./map-pin-CZucSvvB.js";import{D as $}from"./dollar-sign-h3mQyYN-.js";import{C as Ee}from"./check-DuTiAf7C.js";import{C as Ce}from"./chatService-ChjNDZXa.js";import{C as V}from"./check-circle-DcEt0i5B.js";import{M as F}from"./message-circle-_vsuaFG3.js";import{T as De}from"./trending-up-DwHkGYim.js";import{A as Ae}from"./award-psc8XKN2.js";import{X as Re}from"./x-circle-B1e_uF_b.js";import{P as Se}from"./pin-BE8SGceg.js";import{T as Be,a as Pe,b as z,c as O}from"./tabs-WXu0DGF3.js";import{C as qe}from"./calendar-days-CXgPnyk1.js";import"./index-yZSPA8A-.js";import"./index-oNALVX6M.js";import"./index-DJ86sh13.js";import"./databaseUtils-EE95jGy-.js";import"./useNotifications-BC0Dj2vc.js";import"./bell-BrPt3aXG.js";import"./search-DJSs7YT2.js";import"./alert-DX9hSffn.js";import"./zap-BDCYOuKc.js";import"./plus-B4gpjJdq.js";import"./message-square-B_GUjDSs.js";import"./wifi-BixKGM4R.js";import"./log-out-wiSeNNbg.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ue("PinOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h12",key:"13x2n8"}],["path",{d:"M15 9.34V6h1a2 2 0 0 0 0-4H7.89",key:"reo3ki"}]]),$e=()=>{const{user:r}=U(),{toast:i}=H(),[n,b]=u.useState([]),[c,E]=u.useState(!0),[C,j]=u.useState(null),g=u.useCallback(()=>y(void 0,null,function*(){if(r)try{const{data:s,error:d}=yield o.from("artists").select("id").eq("user_id",r.id).single();if(d){console.error("Error fetching artist record:",d),b([]);return}const{data:x,error:m}=yield o.from("artist_bookings").select("*").eq("artist_id",s.id).eq("status","pending").order("created_at",{ascending:!1});if(m)throw m;const t=yield Promise.all((x||[]).map(l=>y(void 0,null,function*(){const{data:h}=yield o.from("profiles").select("display_name, avatar_url").eq("user_id",l.user_id).single();return L(M({},l),{client_name:(h==null?void 0:h.display_name)||"Unknown User",client_avatar:(h==null?void 0:h.avatar_url)||""})})));b(t)}catch(s){console.error("Error fetching booking requests:",s),i({title:"Error",description:"Failed to load booking requests",variant:"destructive"})}finally{E(!1)}}),[r,i]);u.useEffect(()=>{r&&(g(),y(void 0,null,function*(){const{data:d,error:x}=yield o.from("artists").select("id").eq("user_id",r.id).single();if(x){console.error("Error fetching artist record for realtime:",x);return}const m=o.channel("booking-requests").on("postgres_changes",{event:"INSERT",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${d.id}`},()=>{g()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${d.id}`},()=>{g()}).subscribe();return()=>{o.removeChannel(m)}}))},[r,g]);const a=(s,d)=>y(void 0,null,function*(){j(s);try{const x=n.find(t=>t.id===s);if(!x){console.error("Booking request not found:",s);return}console.log("Processing booking action:",{requestId:s,action:d,request:x});const{error:m}=yield o.from("artist_bookings").update({status:d==="accept"?"accepted":"declined",updated_at:new Date().toISOString()}).eq("id",s);if(m)throw console.error("Error updating booking status:",m),m;try{yield ke.createBookingResponseNotification(s,d)}catch(t){console.error("Error creating booking response notification:",t)}if(d==="accept"){const{data:t,error:l}=yield o.from("artists").select("user_id").eq("id",x.artist_id).single();if(l){console.error("Error fetching artist user ID:",l);return}const{data:h,error:N}=yield o.from("chat_conversations").insert({booking_id:s,client_id:x.user_id,artist_id:t.user_id,status:"active"}).select().single();if(N)console.error("Error creating chat conversation:",N);else try{yield o.from("chat_messages").insert({conversation_id:h.id,sender_id:r.id,message:`Hello! I've accepted your booking request for ${x.event_description}. Let's discuss the details!`,message_type:"text"})}catch(p){console.error("Error creating welcome message:",p)}i({title:"Booking Accepted",description:"You've accepted the booking request. A chat has been started with the client."})}else i({title:"Booking Declined",description:"You've declined the booking request."});b(t=>t.filter(l=>l.id!==s))}catch(x){console.error("Error handling booking action:",x),i({title:"Error",description:"Failed to process booking request",variant:"destructive"})}finally{j(null)}});return r?c?e.jsxs(f,{children:[e.jsx(_,{children:e.jsx(w,{children:"Booking Requests"})}),e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(f,{children:[e.jsxs(_,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Booking Requests"]}),e.jsx(J,{children:"Manage incoming booking requests from clients"})]}),e.jsx(v,{children:n.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No booking requests yet"}),e.jsx("p",{className:"text-sm",children:"Requests will appear here when clients book your services"})]}):e.jsx(K,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:n.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.client_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:P(new Date(s.created_at),"PPp")})]})]}),e.jsx(D,{variant:"outline",children:"New Request"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:P(new Date(s.event_date),"PPP")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:s.event_location||"Location TBD"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.budget_min&&s.budget_max?`$${s.budget_min} - $${s.budget_max}`:"Budget TBD"})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.event_description})}),e.jsx(je,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ve,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(B,{variant:"outline",size:"sm",children:"View Details"})}),e.jsxs(_e,{children:[e.jsxs(be,{children:[e.jsx(we,{children:"Booking Request Details"}),e.jsx(ye,{children:"Full information about this booking request"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Client Information"}),e.jsxs("p",{children:["Name: ",s.client_name]}),s.contact_info&&e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:s.contact_info})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Event Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",P(new Date(s.event_date),"PPP")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," ",s.event_location]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",s.event_description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Budget:"}),s.budget_min&&s.budget_max?` $${s.budget_min} - $${s.budget_max}`:" Not specified"]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{size:"sm",variant:"destructive",onClick:()=>a(s.id,"reject"),disabled:C===s.id,children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Reject"]}),e.jsxs(B,{size:"sm",onClick:()=>a(s.id,"accept"),disabled:C===s.id,children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Accept & Chat"]})]})]})]},s.id))})})})]}):null},Me=()=>{const{user:r}=U(),{toast:i}=H(),n=W(),[b,c]=u.useState([]),[E,C]=u.useState(!0),j=u.useCallback(()=>y(void 0,null,function*(){if(r)try{const{data:s,error:d}=yield o.from("artists").select("id").eq("user_id",r.id).single();if(d){console.error("Error fetching artist record:",d),console.error("Artist error details:",{message:d.message,details:d.details,hint:d.hint,code:d.code}),c([]);return}console.log("Artist record found:",s);const{data:x,error:m}=yield o.from("artist_bookings").select("*").eq("artist_id",s.id).eq("status","accepted").order("updated_at",{ascending:!1});if(m)throw console.error("Error fetching bookings:",m),m;console.log("Bookings data:",x);const t=yield Promise.all((x||[]).map(l=>y(void 0,null,function*(){var p,R,A;const[h,N]=yield Promise.all([o.from("profiles").select("display_name, avatar_url").eq("user_id",l.user_id).maybeSingle(),o.from("chat_conversations").select("id").eq("booking_id",l.id).maybeSingle()]);return L(M({},l),{client_name:((p=h.data)==null?void 0:p.display_name)||"Unknown User",client_avatar:((R=h.data)==null?void 0:R.avatar_url)||"",chat_conversation_id:(A=N.data)==null?void 0:A.id})})));c(t)}catch(s){console.error("Error fetching accepted bookings:",s),console.error("Error details:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),i({title:"Error",description:"Failed to load accepted bookings",variant:"destructive"})}finally{C(!1)}}),[r,i]);u.useEffect(()=>{r&&(j(),y(void 0,null,function*(){const{data:d,error:x}=yield o.from("artists").select("id").eq("user_id",r.id).single();if(x){console.error("Error fetching artist record for realtime:",x);return}const m=o.channel("accepted-bookings").on("postgres_changes",{event:"UPDATE",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${d.id}`},t=>{t.new.status==="accepted"&&j()}).subscribe();return()=>{o.removeChannel(m)}}))},[r,j]);const g=s=>y(void 0,null,function*(){try{const d=yield Ce.getOrCreateConversationForBooking(s);d?n(`/chat/${d}`):i({title:"Error",description:"Unable to start chat. Please try again.",variant:"destructive"})}catch(d){console.error("Error starting chat:",d),i({title:"Error",description:"Unable to start chat. Please try again.",variant:"destructive"})}}),a=s=>{switch(s){case"accepted":return e.jsxs(D,{className:"bg-green-100 text-green-800",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Accepted"]});case"completed":return e.jsxs(D,{className:"bg-blue-100 text-blue-800",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Completed"]});default:return e.jsx(D,{variant:"outline",children:s})}};return r?E?e.jsxs(f,{children:[e.jsx(_,{children:e.jsx(w,{children:"Accepted Bookings"})}),e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(f,{children:[e.jsxs(_,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Accepted Bookings"]}),e.jsx(J,{children:"Manage your accepted booking requests and communicate with clients"})]}),e.jsx(v,{children:b.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No accepted bookings yet"}),e.jsx("p",{className:"text-sm",children:"Accepted booking requests will appear here"})]}):e.jsx(K,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:b.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.client_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Accepted ",P(new Date(s.updated_at),"PPp")]})]})]}),a(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:P(new Date(s.event_date),"PPp")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.event_location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["$",s.budget_min," - $",s.budget_max||"No limit"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Created ",P(new Date(s.created_at),"PPp")]})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:"Event Description:"}),e.jsx("p",{className:"text-muted-foreground",children:s.event_description})]}),s.contact_info&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:"Contact Information:"}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-line",children:s.contact_info})]}),e.jsx("div",{className:"flex gap-2 pt-2",children:e.jsxs(B,{onClick:()=>g(s.id),className:"flex items-center gap-2",size:"sm",children:[e.jsx(F,{className:"h-4 w-4"}),s.chat_conversation_id?"Continue Chat":"Start Chat"]})})]},s.id))})})})]}):null},Le=()=>{const{user:r}=U(),{toast:i}=H(),[n,b]=u.useState([]),[c,E]=u.useState(!0),C=W(),j=u.useCallback(()=>y(void 0,null,function*(){if(r)try{const{data:a,error:s}=yield o.from("chat_conversations").select("*").eq("artist_id",r.id).eq("status","active").order("updated_at",{ascending:!1});if(s)throw s;const d=yield Promise.all((a||[]).map(x=>y(void 0,null,function*(){const{data:m}=yield o.from("profiles").select("display_name, avatar_url").eq("user_id",x.client_id).single(),{data:t}=yield o.from("artist_bookings").select("event_date, event_location").eq("id",x.booking_id).single();return L(M({},x),{client_name:(m==null?void 0:m.display_name)||"Unknown User",client_avatar:(m==null?void 0:m.avatar_url)||"",event_date:(t==null?void 0:t.event_date)||"",event_location:(t==null?void 0:t.event_location)||"",unread_count:0})})));b(d)}catch(a){console.error("Error fetching conversations:",a),i({title:"Error",description:"Failed to load conversations",variant:"destructive"})}finally{E(!1)}}),[r,i]);u.useEffect(()=>{if(r){j();const a=o.channel("active-conversations").on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_conversations",filter:`artist_id=eq.${r.id}`},()=>{j()}).subscribe();return()=>{o.removeChannel(a)}}},[r,j]);const g=a=>{C(`/chat/${a}`)};return r?c?e.jsxs(f,{children:[e.jsx(_,{children:e.jsx(w,{children:"Active Conversations"})}),e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(f,{children:[e.jsxs(_,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Active Conversations"]}),e.jsx(J,{children:"Chat with clients about accepted bookings"})]}),e.jsx(v,{children:n.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No active conversations"}),e.jsx("p",{className:"text-sm",children:"Conversations will appear here when you accept booking requests"})]}):e.jsx(K,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:n.map(a=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>g(a.id),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(X,{className:"h-10 w-10",children:[e.jsx(I,{src:a.client_avatar}),e.jsx(G,{children:a.client_name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.client_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Started ",P(new Date(a.created_at),"PPp")]})]})]}),a.unread_count>0&&e.jsx(D,{variant:"destructive",className:"ml-2",children:a.unread_count})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:a.event_date?P(new Date(a.event_date),"PPP"):"Date TBD"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:a.event_location||"Location TBD"})]})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx(B,{variant:"outline",size:"sm",children:"Open Chat"})})]},a.id))})})})]}):null},Fe=()=>{const{user:r}=U(),{toast:i}=H(),[n,b]=u.useState([]),[c,E]=u.useState({totalEarnings:0,thisMonthEarnings:0,completedBookings:0,averageBookingValue:0}),[C,j]=u.useState(!0),g=u.useCallback(()=>y(void 0,null,function*(){if(r)try{const{data:a,error:s}=yield o.from("artists").select("id").eq("user_id",r.id).single();if(s){console.error("Artist not found:",s);return}const{data:d,error:x}=yield o.from("artist_bookings").select("*").eq("artist_id",a.id).eq("status","completed").order("updated_at",{ascending:!1});if(x)throw x;const m=[];let t=0,l=0;const h=new Date().getMonth(),N=new Date().getFullYear();for(let p=0;p<5;p++){const R=Math.floor(Math.random()*500)+100,A=new Date;A.setDate(A.getDate()-Math.floor(Math.random()*30)),t+=R,A.getMonth()===h&&A.getFullYear()===N&&(l+=R),m.push({id:`earning_${p}`,booking_id:`booking_${p}`,amount:R,status:"paid",completed_at:A.toISOString(),client_name:`Client ${p+1}`,event_location:`Event Location ${p+1}`})}b(m),E({totalEarnings:t,thisMonthEarnings:l,completedBookings:m.length,averageBookingValue:t>0?t/m.length:0})}catch(a){console.error("Error fetching earnings data:",a),i({title:"Error",description:"Failed to load earnings data",variant:"destructive"})}finally{j(!1)}}),[r,i]);return u.useEffect(()=>{r&&g()},[r,g]),r?C?e.jsxs(f,{children:[e.jsx(_,{children:e.jsx(w,{children:"Earnings Overview"})}),e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(f,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Total Earnings"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",c.totalEarnings.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["From ",c.completedBookings," completed bookings"]})]})]}),e.jsxs(f,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"This Month"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",c.thisMonthEarnings.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:"+12%"})," from last month"]})]})]}),e.jsxs(f,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Completed Bookings"}),e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c.completedBookings}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Successful projects delivered"})]})]}),e.jsxs(f,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Average Booking"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",Math.round(c.averageBookingValue).toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Per completed project"})]})]})]}),e.jsxs(f,{children:[e.jsxs(_,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Recent Earnings"]}),e.jsx(J,{children:"Your latest completed bookings and payments"})]}),e.jsx(v,{children:n.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx($,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No earnings yet"}),e.jsx("p",{className:"text-sm",children:"Complete bookings to start earning and tracking your income"})]}):e.jsx(K,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:n.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx($,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.client_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.event_location}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(Y,{className:"h-3 w-3 inline mr-1"}),P(new Date(a.completed_at),"PPP")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["+$",a.amount]}),e.jsx(D,{variant:a.status==="paid"?"default":"secondary",className:"text-xs",children:a.status})]})]},a.id))})})})]})]}):null},Ue=()=>{const{user:r}=U(),{toast:i}=H(),[n,b]=u.useState([]),[c,E]=u.useState([]),[C,j]=u.useState(!0),[g,a]=u.useState("pending"),s=u.useCallback(()=>y(void 0,null,function*(){if(r)try{const{data:t,error:l}=yield o.from("artists").select("id").eq("user_id",r.id).single();if(l){console.error("Error fetching artist record:",l),b([]),E([]);return}const{data:h,error:N}=yield o.from("artist_discussions").select("*").eq("artist_id",t.id).eq("status","pending").order("created_at",{ascending:!1});if(N)throw N;const{data:p,error:R}=yield o.from("artist_discussions").select("*").eq("artist_id",t.id).eq("status","approved").order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1});if(R)throw R;const A=[...(h==null?void 0:h.map(k=>k.user_id))||[],...(p==null?void 0:p.map(k=>k.user_id))||[]];let q={};if(A.length>0){const{data:k}=yield o.from("profiles").select("user_id, display_name, avatar_url").in("user_id",A);q=Object.fromEntries((k||[]).map(S=>[S.user_id,S]))}b((h||[]).map(k=>{var S,T;return L(M({},k),{user_display_name:((S=q[k.user_id])==null?void 0:S.display_name)||"Anonymous",user_avatar_url:((T=q[k.user_id])==null?void 0:T.avatar_url)||""})})),E((p||[]).map(k=>{var S,T;return L(M({},k),{user_display_name:((S=q[k.user_id])==null?void 0:S.display_name)||"Anonymous",user_avatar_url:((T=q[k.user_id])==null?void 0:T.avatar_url)||""})}))}catch(t){console.error("Error fetching moderation data:",t),i({title:"Error",description:"Failed to load moderation data",variant:"destructive"})}finally{j(!1)}}),[r,i]);u.useEffect(()=>{r&&s()},[r,s]);const d=t=>y(void 0,null,function*(){try{const{data:l,error:h}=yield o.from("artists").select("id").eq("user_id",r==null?void 0:r.id).single();if(h)throw new Error("Artist profile not found");const{error:N}=yield o.from("artist_discussions").update({status:"approved"}).eq("id",t);if(N)throw N;const{error:p}=yield o.from("artist_discussion_moderation_notifications").insert({artist_id:l.id,discussion_id:t,type:"discussion_approved"});p&&console.warn("Failed to create notification:",p),i({title:"Discussion approved",description:"The discussion is now visible to your followers"}),s()}catch(l){console.error("Error approving discussion:",l),i({title:"Error",description:"Failed to approve discussion",variant:"destructive"})}}),x=t=>y(void 0,null,function*(){try{const{data:l,error:h}=yield o.from("artists").select("id").eq("user_id",r==null?void 0:r.id).single();if(h)throw new Error("Artist profile not found");const{error:N}=yield o.from("artist_discussions").update({status:"rejected"}).eq("id",t);if(N)throw N;const{error:p}=yield o.from("artist_discussion_moderation_notifications").insert({artist_id:l.id,discussion_id:t,type:"discussion_rejected"});p&&console.warn("Failed to create notification:",p),i({title:"Discussion rejected",description:"The discussion request has been rejected"}),s()}catch(l){console.error("Error rejecting discussion:",l),i({title:"Error",description:"Failed to reject discussion",variant:"destructive"})}}),m=(t,l)=>y(void 0,null,function*(){try{const{error:h}=yield o.from("artist_discussions").update({is_pinned:!l}).eq("id",t);if(h)throw h;i({title:l?"Discussion unpinned":"Discussion pinned",description:l?"The discussion is no longer pinned":"The discussion is now pinned to the top"}),s()}catch(h){console.error("Error toggling pin:",h),i({title:"Error",description:"Failed to update pin status",variant:"destructive"})}});return C?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex space-x-1 bg-muted p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>a("pending"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${g==="pending"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:["Pending Requests",n.length>0&&e.jsx(D,{variant:"destructive",className:"ml-2 h-5 w-5 rounded-full p-0 text-xs",children:n.length})]}),e.jsxs("button",{onClick:()=>a("approved"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${g==="approved"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:["Approved Discussions (",c.length,")"]})]}),g==="pending"&&e.jsx("div",{className:"space-y-4",children:n.length>0?n.map(t=>e.jsxs(f,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(X,{className:"h-10 w-10",children:[e.jsx(I,{src:t.user_avatar_url}),e.jsx(G,{children:t.user_display_name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx(w,{className:"text-lg",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",t.user_display_name," • ",new Date(t.created_at).toLocaleDateString()]})]})]}),e.jsx(D,{variant:"outline",children:"Pending"})]})}),e.jsxs(v,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:t.content}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{size:"sm",onClick:()=>d(t.id),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Approve"]}),e.jsxs(B,{size:"sm",variant:"outline",onClick:()=>x(t.id),children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})]},t.id)):e.jsx(f,{children:e.jsx(v,{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No pending discussion requests"})})})}),g==="approved"&&e.jsx("div",{className:"space-y-4",children:c.length>0?c.map(t=>e.jsxs(f,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(X,{className:"h-10 w-10",children:[e.jsx(I,{src:t.user_avatar_url}),e.jsx(G,{children:t.user_display_name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx(w,{className:"text-lg",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",t.user_display_name," • ",new Date(t.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.is_pinned&&e.jsx(D,{variant:"secondary",children:"Pinned"}),e.jsx(D,{variant:"outline",className:"text-green-600 border-green-600",children:"Approved"})]})]})}),e.jsxs(v,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:t.content}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.likes_count," likes"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.replies_count," replies"]})]})]}),e.jsx(B,{size:"sm",variant:"outline",onClick:()=>m(t.id,t.is_pinned),children:t.is_pinned?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Unpin"]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Pin"]})})]})]})]},t.id)):e.jsx(f,{children:e.jsx(v,{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No approved discussions yet"})})})})]})},ks=()=>{var d,x,m;const{user:r}=U(),i=W(),[n,b]=u.useState({totalBookings:0,pendingRequests:0,totalEarnings:0,averageRating:0}),[c,E]=u.useState(null),[C,j]=u.useState(!0),[g,a]=u.useState("bookings"),s=u.useCallback(()=>y(void 0,null,function*(){var t,l,h;if(r)try{const{data:N,error:p}=yield o.from("profiles").select("*").eq("user_id",r.id).single();if(p)throw p;E(N);const{data:R,error:A}=yield o.from("artists").select("id").eq("user_id",r.id).single();if(A){console.log("No artist record found, using mock data"),b({totalBookings:0,pendingRequests:0,totalEarnings:0,averageRating:0});return}const[q,k,S]=yield Promise.all([o.from("artist_bookings").select("id, budget_min, budget_max, status").eq("artist_id",R.id).in("status",["accepted","completed"]),o.from("artist_bookings").select("id").eq("artist_id",R.id).eq("status","pending"),o.from("chat_conversations").select("id").eq("artist_id",r.id).eq("status","active")]),T=((t=q.data)==null?void 0:t.length)||0,ne=((l=k.data)==null?void 0:l.length)||0,ce=(((h=q.data)==null?void 0:h.filter(Q=>Q.status==="completed"))||[]).reduce((Q,ee)=>Q+(ee.budget_max||ee.budget_min||0),0),oe=T>0?4.2+Math.random()*.8:0;b({totalBookings:T,pendingRequests:ne,totalEarnings:ce,averageRating:oe})}catch(N){console.error("Error fetching artist data:",N)}finally{j(!1)}}),[r]);return u.useEffect(()=>{r&&s()},[r,s]),r?C?e.jsx(re,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsx(re,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Artist Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your bookings, track earnings, and grow your business"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(B,{variant:"outline",onClick:()=>i("/settings"),children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Settings"]})})]}),e.jsx(f,{children:e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(X,{className:"h-16 w-16",children:[e.jsx(I,{src:c==null?void 0:c.avatar_url}),e.jsx(G,{children:((d=c==null?void 0:c.display_name)==null?void 0:d.charAt(0))||((x=r.email)==null?void 0:x.charAt(0).toUpperCase())})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:c==null?void 0:c.display_name}),(c==null?void 0:c.is_verified)&&e.jsx(D,{variant:"secondary",children:"Verified"})]}),e.jsx("p",{className:"text-muted-foreground",children:c==null?void 0:c.bio}),e.jsx("div",{className:"flex items-center gap-4 mt-2",children:((m=c==null?void 0:c.artist_skills)==null?void 0:m.length)>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[c.artist_skills.slice(0,3).map(t=>e.jsx(D,{variant:"outline",className:"text-xs",children:t},t)),c.artist_skills.length>3&&e.jsxs(D,{variant:"outline",className:"text-xs",children:["+",c.artist_skills.length-3," more"]})]})})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(f,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>a("bookings"),children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Total Bookings"}),e.jsx(qe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.totalBookings}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Click to view all bookings"})]})]}),e.jsxs(f,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>a("bookings"),children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Pending Requests"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.pendingRequests}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.pendingRequests>0?"Awaiting your response":"No pending requests"})]})]}),e.jsxs(f,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>a("earnings"),children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Total Earnings"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",n.totalEarnings.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Click for earnings details"})]})]}),e.jsxs(f,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>a("chats"),children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Average Rating"}),e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.averageRating>0?n.averageRating.toFixed(1):"N/A"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.totalBookings>0?`From ${n.totalBookings} bookings`:"Complete bookings to get rated"})]})]})]}),e.jsxs(Be,{value:g,onValueChange:a,className:"space-y-6",children:[e.jsxs(Pe,{children:[e.jsxs(z,{value:"bookings",children:["Booking Requests",n.pendingRequests>0&&e.jsx(D,{variant:"destructive",className:"ml-2 h-5 w-5 rounded-full p-0 text-xs",children:n.pendingRequests})]}),e.jsx(z,{value:"accepted",children:"Accepted Bookings"}),e.jsx(z,{value:"chats",children:"Active Chats"}),e.jsx(z,{value:"earnings",children:"Earnings"}),e.jsx(z,{value:"moderation",children:"Discussion Moderation"})]}),e.jsx(O,{value:"bookings",children:e.jsx($e,{})}),e.jsx(O,{value:"accepted",children:e.jsx(Me,{})}),e.jsx(O,{value:"chats",children:e.jsx(Le,{})}),e.jsx(O,{value:"earnings",children:e.jsx(Fe,{})}),e.jsx(O,{value:"moderation",children:e.jsx(Ue,{})})]})]})}):(i("/signin"),null)};export{ks as default};
