var gt=Object.defineProperty,ft=Object.defineProperties;var pt=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var De=(i,t,s)=>t in i?gt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s,I=(i,t)=>{for(var s in t||(t={}))Xe.call(t,s)&&De(i,s,t[s]);if(ve)for(var s of ve(t))Ke.call(t,s)&&De(i,s,t[s]);return i},P=(i,t)=>ft(i,pt(t));var Ze=(i,t)=>{var s={};for(var a in i)Xe.call(i,a)&&t.indexOf(a)<0&&(s[a]=i[a]);if(i!=null&&ve)for(var a of ve(i))t.indexOf(a)<0&&Ke.call(i,a)&&(s[a]=i[a]);return s};var pe=(i,t,s)=>De(i,typeof t!="symbol"?t+"":t,s);var f=(i,t,s)=>new Promise((a,r)=>{var n=d=>{try{c(s.next(d))}catch(u){r(u)}},o=d=>{try{c(s.throw(d))}catch(u){r(u)}},c=d=>d.done?a(d.value):Promise.resolve(d.value).then(n,o);c((s=s.apply(i,t)).next())});import{c as Ve,s as N,r as l,u as We,j as e,B as R,X as at,C as O,p as ae,q as re,v as $,e as rt,b as le,g as xt,t as je}from"./main-Dczk40-q.js";import{B as Q}from"./badge-iBsRNaSn.js";import{T as Ge,a as Qe,b as W,c as G}from"./tabs-ChvN7mKq.js";import{A as Ne,b as He,c as be,S as ge,a as Le,R as yt}from"./ResponsiveLayout-CxdDAcTl.js";import{u as nt}from"./useLocation-Cm6aJjbC.js";import{I as xe}from"./index-DxDoSqvO.js";import{S as et}from"./slider-CHiF0Bk_.js";import{S as Fe,a as Me,b as Te,c as Ee,d as H}from"./select-B_T1mZfW.js";import{C as Ae}from"./checkbox-C46tIEHU.js";import{L as K}from"./label-KS36zHkM.js";import{S as ue}from"./search-CoqTXUJe.js";import{F as it}from"./filter-xZnHztIy.js";import{M as Je}from"./map-pin-B65WKje7.js";import{D as wt}from"./dollar-sign-0rtG2nV9.js";import{f as Ce}from"./index-BCwUGNws.js";import{C as ye}from"./calendar-DbYgxsnG.js";import{T as we}from"./trending-up-DelZ4I2y.js";import{U as J}from"./alert-vAohCTxn.js";import{C as Pe}from"./clock-D-HXAPEh.js";import{H as Oe}from"./plus-B7hFD5Z2.js";import{M as ot}from"./message-circle-CrqL1ene.js";import{S as vt}from"./share-2-CeGn1hMG.js";import{E as jt}from"./eye-CXD-3Vg7.js";import{U as St}from"./user-plus-DoUP2pA_.js";import{E as he}from"./EnhancedUserProfileCard-B0uln5n8.js";import{G as Nt,L as bt}from"./list-CO4Q_dSM.js";import{C as tt}from"./check-circle-CJSaU0rJ.js";import{A as Ct}from"./award-CU5m2ckN.js";import{S as _t}from"./scroll-area-Ya-nYYPz.js";import{C as kt,a as Dt}from"./chevron-up-BzEWPbkd.js";import{B as Ft}from"./bar-chart-3-DDoBEagZ.js";import"./separator-CnmZayxo.js";import"./index-Bvi8qGb8.js";import"./index-p4sF6Wge.js";import"./databaseUtils-DDxBFZda.js";import"./useNotifications-DdfHYMMR.js";import"./notificationService-DiBkqnn5.js";import"./bell-CB9MQoCr.js";import"./check-Dn5E7z_E.js";import"./user-xzPyfs-H.js";import"./zap-BM2f935p.js";import"./message-square-BskFJ3te.js";import"./wifi-D1BoRTe0.js";import"./log-out-vClmguiA.js";import"./locationService-DP6rxedy.js";import"./index-MbWpnwLW.js";import"./mail-CApItZTg.js";import"./pen-square-BFdqAlw9.js";import"./globe-DZrEywGl.js";import"./phone-B0zkk_50.js";import"./shield-Bq_L1461.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=Ve("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=Ve("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=Ve("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);class Re{static calculateRelevanceScore(t,s){const a=this.calculateTextRelevance(t,s),r=this.calculateLocationRelevance(t,s),n=this.calculateCategoryRelevance(t,s),o=this.calculateEngagementScore(t),c=this.calculateFreshnessScore(t),d=a*.35+r*.25+n*.15+o*.15+c*.1;return{textRelevance:a,locationRelevance:r,categoryRelevance:n,engagementScore:o,freshnessScore:c,totalScore:d}}static calculateTextRelevance(t,s){var d,u;const a=s.query.toLowerCase(),r=t.title.toLowerCase(),n=((d=t.description)==null?void 0:d.toLowerCase())||"",o=((u=t.tags)==null?void 0:u.map(h=>h.toLowerCase()))||[];let c=0;return r.includes(a)?c+=10:r.split(" ").some(h=>h.includes(a))&&(c+=7),n.includes(a)?c+=5:n.split(" ").some(h=>h.includes(a))&&(c+=3),o.forEach(h=>{h.includes(a)&&(c+=3)}),r===a&&(c+=5),Math.min(c,20)}static calculateLocationRelevance(t,s){var d,u,h;if(!s.location||!t.location)return 0;let a=0;t.distance!==void 0&&(t.distance<=5?a+=10:t.distance<=15?a+=7:t.distance<=30?a+=4:t.distance<=50&&(a+=2));const r=s.query.toLowerCase(),n=((d=t.location.name)==null?void 0:d.toLowerCase())||"",o=((u=t.location.city)==null?void 0:u.toLowerCase())||"",c=((h=t.location.state)==null?void 0:h.toLowerCase())||"";return(n.includes(r)||o.includes(r)||c.includes(r))&&(a+=5),Math.min(a,15)}static calculateCategoryRelevance(t,s){return!s.category||s.category==="all",5}static calculateEngagementScore(t){if(!t.engagement)return 0;const{likes:s,comments:a,shares:r,views:n}=t.engagement,o=s*1+a*2+r*3+n*.1;return Math.min(o/100,10)}static calculateFreshnessScore(t){const s=new Date,a=new Date(t.createdAt),r=(s.getTime()-a.getTime())/(1e3*60*60);return r<=1?10:r<=24?8:r<=168?6:r<=720?4:2}static rankSearchResults(t,s){return t.map(a=>{const r=this.calculateRelevanceScore(a,s);return P(I({},a),{relevanceScore:r.totalScore})}).sort((a,r)=>{switch(s.sortBy){case"relevance":return(r.relevanceScore||0)-(a.relevanceScore||0);case"distance":return(a.distance||0)-(r.distance||0);case"date":return new Date(r.createdAt).getTime()-new Date(a.createdAt).getTime();case"popularity":{const n=a.engagement?a.engagement.likes+a.engagement.comments:0;return(r.engagement?r.engagement.likes+r.engagement.comments:0)-n}case"rating":return(r.rating||0)-(a.rating||0);default:return(r.relevanceScore||0)-(a.relevanceScore||0)}})}static generateSearchSuggestions(t,s=[]){const a=new Set;return s.forEach(o=>{o.toLowerCase().includes(t.toLowerCase())&&a.add(o)}),["music","art","food","sports","business","education","concert","exhibition","restaurant","gym","workshop","local","nearby","today","this week","free","paid"].forEach(o=>{o.toLowerCase().includes(t.toLowerCase())&&a.add(o)}),["music","art","food","sports","business","education","entertainment","health","technology","fashion","travel"].forEach(o=>{o.toLowerCase().includes(t.toLowerCase())&&a.add(o)}),Array.from(a).slice(0,10)}static calculateDistance(t,s,a,r){const o=this.deg2rad(a-t),c=this.deg2rad(r-s),d=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this.deg2rad(t))*Math.cos(this.deg2rad(a))*Math.sin(c/2)*Math.sin(c/2);return 6371*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}static deg2rad(t){return t*(Math.PI/180)}}const ne=class ne{static getInstance(){return ne.instance||(ne.instance=new ne),ne.instance}search(t){return f(this,null,function*(){const s=[];try{const a=[];(t.type==="all"||t.type==="artist")&&a.push(this.searchArtists(t)),(t.type==="all"||t.type==="event")&&a.push(this.searchEvents(t)),(t.type==="all"||t.type==="post")&&a.push(this.searchPosts(t)),(t.type==="all"||t.type==="group")&&a.push(this.searchGroups(t)),(yield Promise.all(a)).forEach(d=>{s.push(...d)});const n=this.scoreAndSortResults(s,t),o=(t.page||0)*(t.limit||20),c=o+(t.limit||20);return n.slice(o,c)}catch(a){throw console.error("Search error:",a),new Error("Failed to perform search")}})}searchArtists(t){return f(this,null,function*(){const{data:s}=yield N.from("artists").select(`
        id,
        user_id,
        specialty,
        hourly_rate_min,
        hourly_rate_max,
        bio,
        is_available
      `).or(`specialty.cs.{${t.query}},bio.ilike.%${t.query}%`).eq("is_available",!0);if(!s)return[];const a=[];for(const r of s){const{data:n}=yield N.from("profiles").select("display_name, avatar_url, location_city, location_state, latitude, longitude").eq("user_id",r.user_id).single();if(n){const o=t.location?this.calculateDistance(t.location.latitude,t.location.longitude,n.latitude,n.longitude):void 0;(!t.location||o&&o<=t.location.radius)&&a.push({id:r.id,type:"artist",title:n.display_name||"Anonymous",description:r.bio,image:n.avatar_url,price:r.hourly_rate_min,location:{name:n.location_city||"",city:n.location_city||"",state:n.location_state||"",latitude:n.latitude,longitude:n.longitude},distance:o,tags:r.specialty,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}}return a})}searchEvents(t){return f(this,null,function*(){let s=N.from("events").select(`
        id,
        title,
        description,
        event_date,
        event_time,
        location_name,
        location_city,
        location_state,
        category,
        price,
        image_url,
        tags,
        created_at
      `).or(`title.ilike.%${t.query}%,description.ilike.%${t.query}%,category.ilike.%${t.query}%`);t.dateRange?s=s.gte("event_date",t.dateRange.start).lte("event_date",t.dateRange.end):s=s.gte("event_date",new Date().toISOString().split("T")[0]);const{data:a}=yield s;return a?a.map(r=>({id:r.id,type:"event",title:r.title,description:r.description,image:r.image_url,price:r.price,location:{name:r.location_name||"",city:r.location_city||"",state:r.location_state||""},date:`${r.event_date} ${r.event_time}`,tags:r.tags,createdAt:r.created_at,updatedAt:r.created_at})):[]})}searchPosts(t){return f(this,null,function*(){const{data:s}=yield N.from("posts").select(`
        id,
        user_id,
        title,
        content,
        type,
        likes_count,
        comments_count,
        created_at
      `).or(`title.ilike.%${t.query}%,content.ilike.%${t.query}%`).eq("status","active");if(!s)return[];const a=[];for(const r of s){const{data:n}=yield N.from("profiles").select("display_name, avatar_url").eq("user_id",r.user_id).single();n&&a.push({id:r.id,type:"post",title:r.title||"Untitled Post",description:r.content.substring(0,100)+"...",image:n.avatar_url,date:r.created_at,tags:r.type?[r.type]:[],engagement:{likes:r.likes_count||0,comments:r.comments_count||0,shares:0,views:0},createdAt:r.created_at,updatedAt:r.created_at})}return a})}searchGroups(t){return f(this,null,function*(){const{data:s}=yield N.from("community_groups").select(`
        id,
        name,
        description,
        category,
        created_at
      `).or(`name.ilike.%${t.query}%,description.ilike.%${t.query}%,category.ilike.%${t.query}%`);return s?s.map(a=>({id:a.id,type:"group",title:a.name,description:a.description,date:a.created_at,tags:a.category?[a.category]:[],createdAt:a.created_at,updatedAt:a.created_at})):[]})}calculateDistance(t,s,a,r){return!t||!s||!a||!r?0:Re.calculateDistance(t,s,a,r)}scoreAndSortResults(t,s){return Re.rankSearchResults(t,s)}getSearchSuggestions(t){return f(this,null,function*(){if(!t.trim())return[];const{data:s}=yield N.from("search_history").select("query").ilike("query",`%${t}%`).order("created_at",{ascending:!1}).limit(5),a=s?s.map(r=>r.query):[];return Re.generateSearchSuggestions(t,a)})}saveSearchHistory(t,s,a,r){return f(this,null,function*(){yield N.from("search_history").insert({user_id:t,query:s,filters:JSON.stringify(a),results_count:r,created_at:new Date().toISOString()})})}};pe(ne,"instance");let $e=ne;const Ue=$e.getInstance(),Tt=()=>{const[i,t]=l.useState(""),[s,a]=l.useState([]),[r,n]=l.useState(!1),[o,c]=l.useState(null),[d,u]=l.useState({type:"all",category:"all",location:{enabled:!1,radius:50},dateRange:{enabled:!1,start:"",end:""},priceRange:{enabled:!1,min:0,max:1e3},tags:[],rating:0,sortBy:"relevance"}),[h,p]=l.useState([]),[g,w]=l.useState(0),[x,C]=l.useState(!0),{user:_}=We(),{currentLocation:U}=nt(),M=l.useCallback((m,y,v)=>f(void 0,null,function*(){const D=m||i,S=y||d,A=v||0;if(!D.trim()){a([]),C(!1);return}n(!0),c(null);try{const Y={query:D,type:S.type==="all"?void 0:S.type,category:S.category==="all"?void 0:S.category,location:S.location.enabled&&U?{latitude:U.latitude,longitude:U.longitude,radius:S.location.radius}:void 0,dateRange:S.dateRange.enabled?{start:S.dateRange.start,end:S.dateRange.end}:void 0,priceRange:S.priceRange.enabled?{min:S.priceRange.min,max:S.priceRange.max}:void 0,tags:S.tags.length>0?S.tags:void 0,sortBy:S.sortBy,page:A,limit:20},Z=yield Ue.search(Y);a(A===0?Z:fe=>[...fe,...Z]),C(Z.length===20),w(A),_&&(yield Ue.saveSearchHistory(_.id,D,S,Z.length))}catch(Y){c(Y instanceof Error?Y.message:"Search failed"),console.error("Search error:",Y)}finally{n(!1)}}),[i,d,U,_]),B=l.useCallback(m=>f(void 0,null,function*(){if(!m.trim()){p([]);return}try{const y=yield Ue.getSearchSuggestions(m);p(y)}catch(y){console.error("Error getting suggestions:",y)}}),[]),L=l.useCallback(m=>{u(y=>I(I({},y),m)),w(0)},[]),q=l.useCallback(()=>{u({type:"all",category:"all",location:{enabled:!1,radius:50},dateRange:{enabled:!1,start:"",end:""},priceRange:{enabled:!1,min:0,max:1e3},tags:[],rating:0,sortBy:"relevance"}),w(0)},[]),E=l.useCallback(()=>{!r&&x&&M(i,d,g+1)},[r,x,M,i,d,g]),b=l.useCallback(()=>{a([]),w(0),C(!0),c(null)},[]);return l.useEffect(()=>{const m=setTimeout(()=>{i.trim()?(M(),B(i)):(b(),p([]))},500);return()=>clearTimeout(m)},[i,M,B,b]),l.useEffect(()=>{i.trim()&&M()},[d,M,i]),{query:i,setQuery:t,results:s,loading:r,error:o,filters:d,updateFilters:L,resetFilters:q,suggestions:h,hasMore:x,loadMore:E,clearResults:b,search:()=>M()}},lt=l.memo(({result:i})=>{const t=l.useCallback(s=>({artist:e.jsx(ge,{className:"h-4 w-4"}),event:e.jsx(ye,{className:"h-4 w-4"}),post:e.jsx(J,{className:"h-4 w-4"}),group:e.jsx(J,{className:"h-4 w-4"}),business:e.jsx(Se,{className:"h-4 w-4"})})[s]||e.jsx(ue,{className:"h-4 w-4"}),[]);return e.jsx(O,{className:"hover:shadow-md transition-shadow",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(Ne,{className:"h-12 w-12",children:[e.jsx(He,{src:i.image}),e.jsx(be,{children:i.title.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t(i.type),e.jsx(Q,{variant:"secondary",className:"text-xs",children:i.type}),e.jsx("h3",{className:"font-semibold truncate",children:i.title}),i.relevanceScore&&e.jsxs(Q,{variant:"outline",className:"text-xs",children:[Math.round(i.relevanceScore),"% match"]})]}),i.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[i.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{className:"h-3 w-3"}),i.location.name||`${i.location.city}, ${i.location.state}`]}),i.distance&&e.jsxs("span",{children:[i.distance.toFixed(1),"km away"]}),i.price&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(wt,{className:"h-3 w-3"}),"$",i.price]}),i.date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"h-3 w-3"}),Ce(new Date(i.date),"MMM dd, yyyy")]}),i.engagement&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),i.engagement.likes+i.engagement.comments]})]}),i.tags&&i.tags.length>0&&e.jsx("div",{className:"flex gap-1 mt-2",children:i.tags.slice(0,3).map((s,a)=>e.jsx(Q,{variant:"outline",className:"text-xs",children:s},a))})]}),e.jsx(R,{variant:"outline",size:"sm",children:"View"})]})})})});lt.displayName="SearchResultItem";const dt=l.memo(({filters:i,updateFilters:t,resetFilters:s,categories:a})=>{var r;return e.jsxs(O,{children:[e.jsx(ae,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(re,{children:"Search Filters"}),e.jsxs(R,{variant:"outline",size:"sm",onClick:s,children:[e.jsx(at,{className:"h-4 w-4 mr-2"}),"Reset"]})]})}),e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Content Type"}),e.jsxs(Fe,{value:i.type,onValueChange:n=>t({type:n}),children:[e.jsx(Me,{children:e.jsx(Te,{})}),e.jsxs(Ee,{children:[e.jsx(H,{value:"all",children:"All Types"}),e.jsx(H,{value:"artist",children:"Artists"}),e.jsx(H,{value:"event",children:"Events"}),e.jsx(H,{value:"post",children:"Posts"}),e.jsx(H,{value:"group",children:"Groups"}),e.jsx(H,{value:"business",children:"Businesses"})]})]})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Category"}),e.jsxs(Fe,{value:i.category,onValueChange:n=>t({category:n}),children:[e.jsx(Me,{children:e.jsx(Te,{})}),e.jsxs(Ee,{children:[e.jsx(H,{value:"all",children:"All Categories"}),i.type!=="all"&&((r=a[i.type])==null?void 0:r.map(n=>e.jsx(H,{value:n.toLowerCase(),children:n},n)))]})]})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Sort By"}),e.jsxs(Fe,{value:i.sortBy,onValueChange:n=>t({sortBy:n}),children:[e.jsx(Me,{children:e.jsx(Te,{})}),e.jsxs(Ee,{children:[e.jsx(H,{value:"relevance",children:"Relevance"}),e.jsx(H,{value:"distance",children:"Distance"}),e.jsx(H,{value:"date",children:"Date"}),e.jsx(H,{value:"popularity",children:"Popularity"}),e.jsx(H,{value:"rating",children:"Rating"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ae,{id:"location-filter",checked:i.location.enabled,onCheckedChange:n=>t({location:P(I({},i.location),{enabled:n})})}),e.jsx(K,{htmlFor:"location-filter",children:"Filter by location"})]}),i.location.enabled&&e.jsxs("div",{children:[e.jsxs(K,{className:"text-sm font-medium",children:["Max Distance: ",i.location.radius,"km"]}),e.jsx(et,{value:[i.location.radius],onValueChange:([n])=>t({location:P(I({},i.location),{radius:n})}),max:100,min:1,step:1})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ae,{id:"date-filter",checked:i.dateRange.enabled,onCheckedChange:n=>t({dateRange:P(I({},i.dateRange),{enabled:n})})}),e.jsx(K,{htmlFor:"date-filter",children:"Filter by date range"})]}),i.dateRange.enabled&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Start Date"}),e.jsx(xe,{type:"date",value:i.dateRange.start,onChange:n=>t({dateRange:P(I({},i.dateRange),{start:n.target.value})})})]}),e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"End Date"}),e.jsx(xe,{type:"date",value:i.dateRange.end,onChange:n=>t({dateRange:P(I({},i.dateRange),{end:n.target.value})})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ae,{id:"price-filter",checked:i.priceRange.enabled,onCheckedChange:n=>t({priceRange:P(I({},i.priceRange),{enabled:n})})}),e.jsx(K,{htmlFor:"price-filter",children:"Filter by price range"})]}),i.priceRange.enabled&&e.jsxs("div",{children:[e.jsxs(K,{className:"text-sm font-medium",children:["Price Range: $",i.priceRange.min," - $",i.priceRange.max]}),e.jsx(et,{value:[i.priceRange.min,i.priceRange.max],onValueChange:n=>t({priceRange:P(I({},i.priceRange),{min:n[0],max:n[1]})}),max:1e3,min:0,step:10})]})]})]})]})});dt.displayName="SearchFilters";const Et=()=>{const{query:i,setQuery:t,results:s,loading:a,error:r,filters:n,updateFilters:o,resetFilters:c,suggestions:d,hasMore:u,loadMore:h}=Tt(),[p,g]=l.useState(!1),[w,x]=l.useState(!1),C=l.useMemo(()=>({artist:["Photographer","Musician","DJ","Chef","Designer","Writer","Performer"],event:["Music","Food","Art","Sports","Business","Education","Entertainment"],post:["News","Discussion","Question","Announcement","Review"],group:["Hobby","Professional","Community","Interest","Location-based"],business:["Restaurant","Shop","Service","Entertainment","Health","Education"]}),[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(xe,{placeholder:"Search artists, events, posts, groups, businesses...",value:i,onChange:_=>{t(_.target.value),x(_.target.value.length>0)},onFocus:()=>x(i.length>0),className:"pl-10"}),i&&e.jsx(R,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",onClick:()=>{t(""),x(!1)},children:e.jsx(at,{className:"h-3 w-3"})})]}),e.jsxs(R,{variant:"outline",onClick:()=>g(!p),children:[e.jsx(it,{className:"h-4 w-4 mr-2"}),"Filters"]})]}),w&&d.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 bg-background border rounded-md shadow-lg z-10 mt-1",children:d.map((_,U)=>e.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-muted flex items-center gap-2",onClick:()=>{t(_),x(!1)},children:[e.jsx(ue,{className:"h-3 w-3 text-muted-foreground"}),_]},U))})]}),p&&e.jsx(dt,{filters:n,updateFilters:o,resetFilters:c,categories:C}),r&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:e.jsx("p",{className:"text-destructive text-sm",children:r})}),e.jsxs("div",{className:"space-y-4",children:[a&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Searching..."})]}),!a&&s.length===0&&i&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No results found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search terms or filters"})]}),s.map(_=>e.jsx(lt,{result:_},`${_.type}-${_.id}`)),u&&s.length>0&&e.jsx("div",{className:"text-center pt-4",children:e.jsx(R,{variant:"outline",onClick:h,disabled:a,children:a?"Loading...":"Load More"})})]})]})};class At{static calculateTrendingScore(t,s="day"){const a=this.calculateEngagementScore(t),r=this.calculateVelocityScore(t),n=this.calculateTimeDecayScore(t),o=this.calculateCategoryWeight(t),c=this.calculateLocationRelevance(t),d=this.calculateQualityScore(t),u=this.getPeriodWeights(s),h=a*u.engagement+r*u.velocity+n*u.timeDecay+o*u.category+c*u.location+d*u.quality;return{engagementScore:a,velocityScore:r,timeDecayScore:n,categoryWeight:o,locationRelevance:c,qualityScore:d,finalScore:h}}static calculateEngagementScore(t){const{likes:s,comments:a,shares:r,views:n}=t.engagement,o=s*1+a*2+r*3+n*.1;return Math.min(o/10,100)}static calculateVelocityScore(t){const{velocity:s}=t.engagement;return Math.min(s*10,100)}static calculateTimeDecayScore(t){const s=new Date,a=new Date(t.createdAt),r=(s.getTime()-a.getTime())/(1e3*60*60),n=Math.exp(-.1*r)*100;return Math.max(n,1)}static calculateCategoryWeight(t){return({music:1.2,art:1.1,food:1,sports:1.3,business:.9,education:1,entertainment:1.2,health:1.1,technology:1,fashion:1.1,travel:1}[t.category.toLowerCase()]||1)*100}static calculateLocationRelevance(t){return 80}static calculateQualityScore(t){let s=50;if(t.title&&t.title.length>10&&(s+=10),t.description&&t.description.length>50&&(s+=10),t.image&&(s+=10),t.engagement.views>0){const a=t.engagement.likes/t.engagement.views;s+=Math.min(a*100,20)}return Math.min(s,100)}static getPeriodWeights(t){return{hour:{engagement:.25,velocity:.35,timeDecay:.2,category:.1,location:.05,quality:.05},day:{engagement:.3,velocity:.25,timeDecay:.25,category:.1,location:.05,quality:.05},week:{engagement:.35,velocity:.15,timeDecay:.2,category:.15,location:.1,quality:.05},month:{engagement:.4,velocity:.1,timeDecay:.15,category:.2,location:.1,quality:.05}}[t]}static rankTrendingContent(t,s="day"){return t.map(a=>{const r=this.calculateTrendingScore(a,s);return P(I({},a),{trendingScore:r.finalScore})}).sort((a,r)=>r.trendingScore-a.trendingScore)}static calculateTrendingVelocity(t){if(t.length<2)return 0;const s=t.sort((n,o)=>new Date(n.timestamp).getTime()-new Date(o.timestamp).getTime()),a=(new Date(s[s.length-1].timestamp).getTime()-new Date(s[0].timestamp).getTime())/(1e3*60*60),r=s[s.length-1].engagement-s[0].engagement;return a>0?r/a:0}static detectTrendingPattern(t){const s=t.engagement.velocity;return s>10?"rising":s>2?"stable":"declining"}static calculateTrendingMomentum(t){if(t.length<3)return 0;const s=[];for(let a=1;a<t.length;a++){const r=(new Date(t[a].timestamp).getTime()-new Date(t[a-1].timestamp).getTime())/36e5,n=t[a].engagement-t[a-1].engagement;s.push(r>0?n/r:0)}return s.length<2?0:s[s.length-1]-s[0]}static filterByQuality(t,s=30){return t.filter(a=>this.calculateTrendingScore(a).qualityScore>=s)}static getTrendingInsights(t){const s=this.detectTrendingPattern(t),a=t.engagement.velocity;let r="stable";a>20?r="strong":a>10?r="moderate":a<2&&(r="weak");let n="stable";a>15&&s==="rising"?n="likely to trend higher":a<5&&s==="declining"?n="likely to decline":n="expected to remain stable";const o=[];return s==="rising"?(o.push("Consider promoting this content"),o.push("Monitor engagement closely")):s==="declining"&&(o.push("Consider refreshing content"),o.push("Analyze engagement patterns")),{pattern:s,momentum:r,prediction:n,recommendations:o}}}const ie=class ie{static getInstance(){return ie.instance||(ie.instance=new ie),ie.instance}getTrendingContent(t="day",s=20){return f(this,null,function*(){try{const a=[],r=yield this.getTrendingEvents(t,s/4);a.push(...r);const n=yield this.getTrendingPosts(t,s/4);a.push(...n);const o=yield this.getTrendingArtists(t,s/4);a.push(...o);const c=yield this.getTrendingGroups(t,s/4);return a.push(...c),At.rankTrendingContent(a,t).slice(0,s)}catch(a){return console.error("Error fetching trending content:",a),[]}})}getTrendingEvents(t,s){return f(this,null,function*(){const a=this.getTimeFilter(t),{data:r}=yield N.from("events").select(`
        id,
        title,
        description,
        category,
        event_date,
        location_name,
        location_city,
        location_state,
        image_url,
        max_attendees,
        created_at
      `).gte("event_date",new Date().toISOString().split("T")[0]).gte("created_at",a).order("max_attendees",{ascending:!1}).limit(s);return r?r.map(n=>({id:n.id,type:"event",title:n.title,description:n.description,image:n.image_url,engagement:{likes:0,comments:0,shares:0,views:0,velocity:n.max_attendees||0},trendingScore:this.calculateTrendingScore(n.max_attendees||0,n.created_at),category:n.category,location:{name:n.location_name||"",city:n.location_city||"",state:n.location_state||""},createdAt:n.created_at,trendingPeriod:t})):[]})}getTrendingPosts(t,s){return f(this,null,function*(){const a=this.getTimeFilter(t),{data:r}=yield N.from("posts").select(`
        id,
        user_id,
        title,
        content,
        type,
        likes_count,
        comments_count,
        created_at
      `).eq("status","active").gte("created_at",a).order("likes_count",{ascending:!1}).limit(s);if(!r)return[];const n=[];for(const o of r){const{data:c}=yield N.from("profiles").select("display_name, avatar_url").eq("user_id",o.user_id).single();if(c){const d=(o.likes_count||0)+(o.comments_count||0)*2;n.push({id:o.id,type:"post",title:o.title||"Untitled Post",description:o.content.substring(0,100)+"...",image:c.avatar_url,engagement:{likes:o.likes_count||0,comments:o.comments_count||0,shares:0,views:0,velocity:d},trendingScore:this.calculateTrendingScore(d,o.created_at),category:o.type||"general",createdAt:o.created_at,trendingPeriod:t})}}return n})}getTrendingArtists(t,s){return f(this,null,function*(){var n;this.getTimeFilter(t);const{data:a}=yield N.from("artists").select(`
        id,
        user_id,
        specialty,
        bio,
        hourly_rate_min,
        is_available
      `).eq("is_available",!0).limit(s);if(!a)return[];const r=[];for(const o of a){const{data:c}=yield N.from("profiles").select("display_name, avatar_url, location_city, location_state").eq("user_id",o.user_id).single();if(c){const d=Math.floor(Math.random()*100)+10;r.push({id:o.id,type:"artist",title:c.display_name||"Anonymous",description:o.bio,image:c.avatar_url,engagement:{likes:0,comments:0,shares:0,views:d,velocity:d},trendingScore:this.calculateTrendingScore(d,new Date().toISOString()),category:((n=o.specialty)==null?void 0:n[0])||"artist",location:{name:c.location_city||"",city:c.location_city||"",state:c.location_state||""},createdAt:new Date().toISOString(),trendingPeriod:t})}}return r})}getTrendingGroups(t,s){return f(this,null,function*(){const a=this.getTimeFilter(t),{data:r}=yield N.from("community_groups").select(`
        id,
        name,
        description,
        category,
        created_at
      `).gte("created_at",a).limit(s);return r?r.map(n=>{const o=Math.floor(Math.random()*50)+5;return{id:n.id,type:"group",title:n.name,description:n.description,engagement:{likes:0,comments:0,shares:0,views:o,velocity:o},trendingScore:this.calculateTrendingScore(o,n.created_at),category:n.category,createdAt:n.created_at,trendingPeriod:t}}):[]})}getTimeFilter(t){const s=new Date;let a;switch(t){case"hour":a=new Date(s.getTime()-60*60*1e3);break;case"day":a=new Date(s.getTime()-24*60*60*1e3);break;case"week":a=new Date(s.getTime()-7*24*60*60*1e3);break;case"month":a=new Date(s.getTime()-30*24*60*60*1e3);break;default:a=new Date(s.getTime()-24*60*60*1e3)}return a.toISOString()}calculateTrendingScore(t,s){const a=new Date,r=new Date(s),n=(a.getTime()-r.getTime())/(1e3*60*60),o=Math.max(.1,1-n/168),c=t/Math.max(1,n);return(t*.4+c*.4+o*.2)*100}getDiscoverContent(t,s=20){return f(this,null,function*(){try{const a=yield this.getUserPreferences(t);return(yield this.getTrendingContent("day",s*2)).map(o=>P(I({},o),{personalizationScore:this.calculatePersonalizationScore(o,a)})).sort((o,c)=>c.personalizationScore-o.personalizationScore).slice(0,s).map(d=>{var u=d,{personalizationScore:o}=u,c=Ze(u,["personalizationScore"]);return c})}catch(a){return console.error("Error fetching discover content:",a),this.getTrendingContent("day",s)}})}getUserPreferences(t){return f(this,null,function*(){const{data:s}=yield N.from("posts").select("type, category").eq("user_id",t).gte("created_at",new Date(Date.now()-2592e6).toISOString()).limit(50);if(!s)return[];const a=new Set;return s.forEach(r=>{r.type&&a.add(r.type),r.category&&a.add(r.category)}),Array.from(a)})}calculatePersonalizationScore(t,s){if(s.length===0)return .5;let a=0,r=0;return s.includes(t.category)&&(a+=.4,r++),t.tags&&t.tags.forEach(n=>{s.includes(n)&&(a+=.2,r++)}),r>0?a/r:.5}};pe(ie,"instance");let qe=ie;const Rt=qe.getInstance(),Ut=()=>{const[i,t]=l.useState([]),[s,a]=l.useState(!1),[r,n]=l.useState(null),[o,c]=l.useState("day"),[d,u]=l.useState(20),h=l.useCallback(()=>f(void 0,null,function*(){a(!0),n(null);try{const x=yield Rt.getTrendingContent(o,d);t(x)}catch(x){n(x instanceof Error?x.message:"Failed to fetch trending content"),console.error("Error fetching trending content:",x)}finally{a(!1)}}),[o,d]),p=l.useCallback(()=>{h()},[h]),g=l.useCallback(x=>{c(x)},[]),w=l.useCallback(x=>{u(x)},[]);return l.useEffect(()=>{h()},[h]),{trendingContent:i,loading:s,error:r,period:o,limit:d,fetchTrendingContent:h,refreshTrendingContent:p,changePeriod:g,changeLimit:w}},It=({content:i})=>{var a;const t=r=>({artist:e.jsx(ge,{className:"h-4 w-4"}),event:e.jsx(ye,{className:"h-4 w-4"}),post:e.jsx(J,{className:"h-4 w-4"}),group:e.jsx(J,{className:"h-4 w-4"}),business:e.jsx(Se,{className:"h-4 w-4"})})[r]||e.jsx(we,{className:"h-4 w-4"}),s=r=>r>=1e3?`${(r/1e3).toFixed(1)}k`:Math.round(r).toString();return e.jsx(O,{className:"hover:shadow-md transition-shadow",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(Ne,{className:"h-12 w-12",children:[e.jsx(He,{src:i.image}),e.jsx(be,{children:i.title.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t(i.type),e.jsx(Q,{variant:"secondary",className:"text-xs",children:i.type}),e.jsxs(Q,{variant:"outline",className:"text-xs text-green-600",children:[s(i.trendingScore)," trending"]}),e.jsx("h3",{className:"font-semibold truncate",children:i.title})]}),i.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[i.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"h-3 w-3"}),i.location.name||`${i.location.city}, ${i.location.state}`]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"h-3 w-3"}),Ce(new Date(i.createdAt),"MMM dd, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"h-3 w-3"}),i.engagement.likes]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ot,{className:"h-3 w-3"}),i.engagement.comments]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vt,{className:"h-3 w-3"}),i.engagement.shares]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(jt,{className:"h-3 w-3"}),i.engagement.views]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),i.engagement.velocity,"/hr"]})]}),((a=i.metadata)==null?void 0:a.tags)&&Array.isArray(i.metadata.tags)&&e.jsx("div",{className:"flex gap-1 mt-2",children:i.metadata.tags.slice(0,3).map((r,n)=>e.jsx(Q,{variant:"outline",className:"text-xs",children:r},n))})]}),e.jsx(R,{variant:"outline",size:"sm",children:"View"})]})})})},Lt=()=>{const{trendingContent:i,loading:t,error:s,period:a,changePeriod:r,refreshTrendingContent:n}=Ut(),o=[{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Trending Content"}),e.jsx("p",{className:"text-muted-foreground",children:"Discover what's popular in your area"})]}),e.jsx(R,{variant:"outline",onClick:n,disabled:t,children:"Refresh"})]}),e.jsxs(Ge,{value:a,onValueChange:c=>r(c),children:[e.jsx(Qe,{children:o.map(c=>e.jsx(W,{value:c.value,children:c.label},c.value))}),e.jsxs(G,{value:a,className:"space-y-4",children:[s&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:e.jsx("p",{className:"text-destructive text-sm",children:s})}),t&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading trending content..."})]}),!t&&i.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(we,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No trending content"}),e.jsx("p",{className:"text-muted-foreground",children:"Check back later for trending content in your area"})]}),e.jsx("div",{className:"grid gap-4",children:i.map(c=>e.jsx(It,{content:c},`${c.type}-${c.id}`))})]})]})]})};class Pt{static generateRecommendations(t,s,a=20){const n=s.map(c=>{const d=this.calculateRecommendationScores(t,c);return P(I({},c),{scores:d})}).sort((c,d)=>d.scores.finalScore-c.scores.finalScore);return this.applyDiversityFilter(n,a).map((c,d)=>({id:`rec_${c.id}_${d}`,userId:t.userId,contentId:c.id,contentType:c.type,score:c.scores.finalScore,reason:this.generateRecommendationReason(t,c,c.scores),algorithm:"hybrid",metadata:{collaborativeScore:c.scores.collaborativeScore,contentBasedScore:c.scores.contentBasedScore,locationScore:c.scores.locationScore,freshnessScore:c.scores.freshnessScore,diversityScore:c.scores.diversityScore},createdAt:new Date().toISOString(),expiresAt:new Date(Date.now()+24*60*60*1e3).toISOString()}))}static calculateRecommendationScores(t,s){const a=this.calculateCollaborativeScore(t,s),r=this.calculateContentBasedScore(t,s),n=this.calculateLocationScore(t,s),o=this.calculateFreshnessScore(s),c=this.calculateDiversityScore(s),d=a*.3+r*.25+n*.2+o*.15+c*.1;return{collaborativeScore:a,contentBasedScore:r,locationScore:n,freshnessScore:o,diversityScore:c,finalScore:d}}static calculateCollaborativeScore(t,s){const a=this.findSimilarUsers(t);if(a.length===0)return .5;const r=a.map(o=>{const c=o.preferences.find(d=>d.category===s.category);return c?c.weight:.5}),n=r.reduce((o,c)=>o+c,0)/r.length;return Math.min(n,1)}static calculateContentBasedScore(t,s){const a=t.preferences;if(a.length===0)return .5;const r=a.find(d=>d.category===s.category);if(r)return r.weight;const n=this.extractContentFeatures(s),o=this.extractUserInterests(t),c=this.calculateFeatureSimilarity(n,o);return Math.min(c,1)}static calculateLocationScore(t,s){if(!t.location||!s.location)return .5;const a=this.calculateDistance(t.location.latitude,t.location.longitude,s.location.latitude,s.location.longitude);return Math.max(0,1-a/50)}static calculateFreshnessScore(t){const s=new Date,a=new Date(t.createdAt),r=(s.getTime()-a.getTime())/(1e3*60*60),n=Math.exp(-.05*r);return Math.max(n,.1)}static calculateDiversityScore(t){return .8}static findSimilarUsers(t){return[]}static extractContentFeatures(t){const s={};if(s[`category_${t.category}`]=1,t.tags&&t.tags.forEach(a=>{s[`tag_${a}`]=1}),t.price&&(s.price_low=t.price<50?1:0,s.price_medium=t.price>=50&&t.price<200?1:0,s.price_high=t.price>=200?1:0),t.date){const a=new Date(t.date),r=new Date,n=(a.getTime()-r.getTime())/(1e3*60*60*24);s.time_soon=n<=7?1:0,s.time_medium=n>7&&n<=30?1:0,s.time_far=n>30?1:0}return s}static extractUserInterests(t){const s={};t.preferences.forEach(n=>{s[`category_${n.category}`]=n.weight});const a={};t.behaviorHistory.forEach(n=>{const o=`${n.action}_${n.contentType}`;a[o]=(a[o]||0)+1});const r=Math.max(...Object.values(a),1);return Object.entries(a).forEach(([n,o])=>{s[n]=o/r}),s}static calculateFeatureSimilarity(t,s){const a=new Set([...Object.keys(t),...Object.keys(s)]);let r=0,n=0,o=0;return a.forEach(c=>{const d=t[c]||0,u=s[c]||0;r+=d*u,n+=d*d,o+=u*u}),n===0||o===0?0:r/(Math.sqrt(n)*Math.sqrt(o))}static applyDiversityFilter(t,s){const a=[],r=new Set,n=new Set;for(const o of t){if(a.length>=s)break;const c=!r.has(o.category)||r.size>=3,d=!n.has(o.type)||n.size>=2;c&&d&&(a.push(o),r.add(o.category),n.add(o.type))}if(a.length<s)for(const o of t){if(a.length>=s)break;a.find(c=>c.id===o.id)||a.push(o)}return a}static generateRecommendationReason(t,s,a){const r=[];return a.contentBasedScore>.7&&t.preferences.find(o=>o.category===s.category)&&r.push(`Based on your interest in ${s.category}`),a.locationScore>.7&&r.push("Happening near you"),a.freshnessScore>.8&&r.push("Recently added"),a.collaborativeScore>.7&&r.push("Popular with similar users"),r.length===0&&r.push("Recommended for you"),r.join(", ")}static calculateDistance(t,s,a,r){const o=this.deg2rad(a-t),c=this.deg2rad(r-s),d=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this.deg2rad(t))*Math.cos(this.deg2rad(a))*Math.sin(c/2)*Math.sin(c/2);return 6371*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}static deg2rad(t){return t*(Math.PI/180)}static updateUserPreferences(t,s,a,r){const n=[...t.preferences];let o=n.find(d=>d.category===a);o||(o={id:`pref_${a}`,userId:t.userId,category:a,weight:.5,source:"behavioral",lastUpdated:new Date().toISOString()},n.push(o));const c=this.getWeightChangeForAction(s);return o.weight=Math.max(0,Math.min(1,o.weight+c)),o.lastUpdated=new Date().toISOString(),n}static getWeightChangeForAction(t){return{like:.1,comment:.15,share:.2,bookmark:.1,follow:.25,view:.02,search:.05}[t]||0}}const oe=class oe{static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}getRecommendations(t,s=20){return f(this,null,function*(){try{const a=yield this.getUserProfile(t),r=yield this.getAvailableContent(t);return Pt.generateRecommendations(a,r,s)}catch(a){return console.error("Error getting recommendations:",a),[]}})}getUserProfile(t){return f(this,null,function*(){try{const{data:s}=yield N.from("user_preferences").select("*").eq("user_id",t).single(),{data:a}=yield N.from("user_behavior").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(100);return{userId:t,preferences:s||{},behavior:a||[],interests:(s==null?void 0:s.interests)||[],location:(s==null?void 0:s.location)||null}}catch(s){return console.error("Error getting user profile:",s),{userId:t,preferences:{},behavior:[],interests:[],location:null}}})}getAvailableContent(t){return f(this,null,function*(){try{const{data:s}=yield N.from("posts").select("*").neq("user_id",t).order("created_at",{ascending:!1}).limit(100),{data:a}=yield N.from("events").select("*").order("created_at",{ascending:!1}).limit(50),{data:r}=yield N.from("profiles").select("*").eq("is_artist",!0).neq("id",t).limit(50);return[...(s||[]).map(n=>P(I({},n),{type:"post"})),...(a||[]).map(n=>P(I({},n),{type:"event"})),...(r||[]).map(n=>P(I({},n),{type:"artist"}))]}catch(s){return console.error("Error getting available content:",s),[]}})}generatePreferencesFromBehavior(t){return f(this,null,function*(){const s=[],{data:a}=yield N.from("posts").select("type, category").eq("user_id",t).limit(100);if(a){const n=new Map;a.forEach(o=>{o.type&&n.set(o.type,(n.get(o.type)||0)+1),o.category&&n.set(o.category,(n.get(o.category)||0)+1)}),n.forEach((o,c)=>{s.push({id:`${t}-${c}`,userId:t,category:c,weight:Math.min(1,o/10),source:"behavioral",lastUpdated:new Date().toISOString()})})}const{data:r}=yield N.from("post_likes").select("post_id").eq("user_id",t).limit(100);if(r)for(const n of r){const{data:o}=yield N.from("posts").select("type, category").eq("id",n.post_id).single();if(o){const c=s.find(d=>d.category===(o.type||o.category));c?c.weight+=.1:s.push({id:`${t}-${o.type||o.category}`,userId:t,category:o.type||o.category||"general",weight:.1,source:"behavioral",lastUpdated:new Date().toISOString()})}}return s})}getContentScores(t,s){return f(this,null,function*(){const a=[],{data:r}=yield N.from("posts").select(`
        id,
        user_id,
        title,
        content,
        type,
        category,
        likes_count,
        comments_count,
        created_at
      `).eq("status","active").neq("user_id",t).order("created_at",{ascending:!1}).limit(200);if(!r)return a;for(const n of r){const o=yield this.calculateContentScore(n,s,t);a.push(o)}return a})}calculateContentScore(t,s,a){return f(this,null,function*(){let r=0,n=0,o=0,c=0;s.forEach(g=>{(t.type===g.category||t.category===g.category)&&(r+=g.weight)});const d=(t.likes_count||0)+(t.comments_count||0)*2;n=Math.min(1,d/100);const u=(Date.now()-new Date(t.created_at).getTime())/(1e3*60*60);o=Math.max(0,1-u/168);const{data:h}=yield N.from("profiles").select("latitude, longitude").eq("user_id",a).single();h!=null&&h.latitude&&(h!=null&&h.longitude)&&(c=.5);const p=r*.4+n*.3+o*.2+c*.1;return{contentId:t.id,contentType:"post",relevanceScore:r,popularityScore:n,freshnessScore:o,locationScore:c,overallScore:p,factors:{userInterest:r,contentQuality:n,engagement:n,recency:o,proximity:c}}})}generateRecommendations(t,s,a){return f(this,null,function*(){const r=[],n=s.sort((o,c)=>c.overallScore-o.overallScore).slice(0,a);for(const o of n){const c=this.generateRecommendationReason(o);r.push({id:`${t}-${o.contentId}`,userId:t,contentId:o.contentId,contentType:o.contentType,score:o.overallScore,reason:c,algorithm:"hybrid",metadata:{relevanceScore:o.relevanceScore,popularityScore:o.popularityScore,freshnessScore:o.freshnessScore,locationScore:o.locationScore},createdAt:new Date().toISOString(),expiresAt:new Date(Date.now()+24*60*60*1e3).toISOString()})}return r})}generateRecommendationReason(t){const s=[];return t.factors.userInterest>.5&&s.push("matches your interests"),t.factors.contentQuality>.7&&s.push("highly engaging content"),t.factors.recency>.8&&s.push("fresh content"),t.factors.proximity>.6&&s.push("local to you"),s.length===0?"trending in your area":s.join(", ")}updateUserPreferences(t,s,a){return f(this,null,function*(){yield N.from("user_preferences").upsert({user_id:t,category:s,weight:a,source:"explicit",last_updated:new Date().toISOString()})})}trackUserBehavior(t,s,a,r){return f(this,null,function*(){yield N.from("user_behavior").insert({user_id:t,action:s,content_type:a,content_id:r,metadata:{},timestamp:new Date().toISOString(),session_id:`session-${Date.now()}`})})}};pe(oe,"instance");let ze=oe;const Ie=ze.getInstance(),Ot=()=>{const[i,t]=l.useState([]),[s,a]=l.useState(!1),[r,n]=l.useState(null),[o,c]=l.useState(20),{user:d}=We(),u=l.useCallback(()=>f(void 0,null,function*(){if(!d){t([]);return}a(!0),n(null);try{const x=yield Ie.getRecommendations(d.id,o);t(x)}catch(x){n(x instanceof Error?x.message:"Failed to fetch recommendations"),console.error("Error fetching recommendations:",x)}finally{a(!1)}}),[d,o]),h=l.useCallback(()=>{u()},[u]),p=l.useCallback((x,C)=>f(void 0,null,function*(){if(d)try{yield Ie.updateUserPreferences(d.id,x,C),yield u()}catch(_){console.error("Error updating user preference:",_)}}),[d,u]),g=l.useCallback((x,C,_)=>f(void 0,null,function*(){if(d)try{yield Ie.trackUserBehavior(d.id,x,C,_)}catch(U){console.error("Error tracking user behavior:",U)}}),[d]),w=l.useCallback(x=>{c(x)},[]);return l.useEffect(()=>{u()},[u]),{recommendations:i,loading:s,error:r,limit:o,fetchRecommendations:u,refreshRecommendations:h,updateUserPreference:p,trackUserBehavior:g,changeLimit:w}},$t=({recommendation:i})=>{const t=a=>({artist:e.jsx(ge,{className:"h-4 w-4"}),event:e.jsx(ye,{className:"h-4 w-4"}),post:e.jsx(J,{className:"h-4 w-4"}),group:e.jsx(J,{className:"h-4 w-4"}),business:e.jsx(Se,{className:"h-4 w-4"})})[a]||e.jsx(Le,{className:"h-4 w-4"}),s=a=>Math.round(a*100);return e.jsx(O,{className:"hover:shadow-md transition-shadow border-l-4 border-l-primary",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Ne,{className:"h-12 w-12",children:e.jsx(be,{children:i.contentType.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t(i.contentType),e.jsx(Q,{variant:"secondary",className:"text-xs",children:i.contentType}),e.jsxs(Q,{variant:"outline",className:"text-xs text-blue-600",children:[s(i.score),"% match"]}),e.jsx("h3",{className:"font-semibold truncate",children:"Recommended Content"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:i.reason}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:"h-3 w-3"}),i.algorithm]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"h-3 w-3"}),Ce(new Date(i.createdAt),"MMM dd, yyyy")]})]}),i.metadata&&e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[i.metadata.relevanceScore&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"h-3 w-3"}),Math.round(i.metadata.relevanceScore*100),"% relevant"]}),i.metadata.popularityScore&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ot,{className:"h-3 w-3"}),Math.round(i.metadata.popularityScore*100),"% popular"]}),i.metadata.freshnessScore&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"h-3 w-3"}),Math.round(i.metadata.freshnessScore*100),"% fresh"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(R,{variant:"outline",size:"sm",children:"View"}),e.jsx(R,{variant:"ghost",size:"sm",children:e.jsx(Oe,{className:"h-3 w-3"})})]})]})})})},qt=()=>{const{recommendations:i,loading:t,error:s,refreshRecommendations:a}=Ot();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recommended for You"}),e.jsx("p",{className:"text-muted-foreground",children:"Personalized content based on your interests and behavior"})]}),e.jsxs(R,{variant:"outline",onClick:a,disabled:t,children:[e.jsx(rt,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),"Refresh"]})]}),s&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:e.jsx("p",{className:"text-destructive text-sm",children:s})}),t&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading recommendations..."})]}),!t&&i.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Le,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No recommendations yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Start exploring content to get personalized recommendations"})]}),e.jsx("div",{className:"grid gap-4",children:i.map(r=>e.jsx($t,{recommendation:r},r.id))})]})};class st{static generateFollowSuggestions(t,s,a,r,n,o=20){return n.filter(h=>h.id!==t&&!r.includes(h.id)).map(h=>{const p=this.calculateFollowRecommendationScores(t,s,a,h,n);return P(I({},h),{scores:p})}).sort((h,p)=>p.scores.finalScore-h.scores.finalScore).slice(0,o).map((h,p)=>({id:`suggestion_${h.id}_${p}`,userId:h.id,displayName:h.display_name||h.username||"Anonymous",avatarUrl:h.avatar_url,bio:h.bio||"",score:h.scores.finalScore,commonInterests:this.findCommonInterests(s,h.interests||[]),mutualFollowers:this.countMutualFollowers(t,h.id,n),location:h.location?{city:h.location.city||"",state:h.location.state||""}:null,reason:this.generateFollowReason(h.scores,h),createdAt:new Date().toISOString()}))}static calculateFollowRecommendationScores(t,s,a,r,n){const o=this.calculateSimilarityScore(s,r.interests||[]),c=this.calculateMutualConnectionsScore(t,r.id,n),d=this.calculateActivityScore(r),u=this.calculateLocationScore(a,r.location),h=this.calculateInterestOverlapScore(s,r.interests||[]),p=o*.25+c*.3+d*.2+u*.15+h*.1;return{similarityScore:o,mutualConnectionsScore:c,activityScore:d,locationScore:u,interestOverlapScore:h,finalScore:p}}static calculateSimilarityScore(t,s){if(t.length===0||s.length===0)return .5;const r=this.findCommonInterests(t,s).length/Math.max(t.length,s.length);return Math.min(r,1)}static calculateMutualConnectionsScore(t,s,a){const r=this.countMutualFollowers(t,s,a);return Math.min(r/50,1)}static calculateActivityScore(t){let s=.5;if(t.posts_count){const a=Math.min(t.posts_count/100,1);s+=a*.2}if(t.events_created_count){const a=Math.min(t.events_created_count/20,1);s+=a*.2}if(t.last_activity){const a=(new Date().getTime()-new Date(t.last_activity).getTime())/864e5;a<=7?s+=.3:a<=30?s+=.2:a<=90&&(s+=.1)}return Math.min(s,1)}static calculateLocationScore(t,s){if(!t||!s)return .5;if(t.city===s.city)return 1;if(t.state===s.state)return .7;if(s.latitude&&s.longitude){const a=this.calculateDistance(t.latitude,t.longitude,s.latitude,s.longitude);return Math.max(0,1-a/100)}return .3}static calculateInterestOverlapScore(t,s){if(t.length===0||s.length===0)return .5;const r=this.findCommonInterests(t,s).length/Math.min(t.length,s.length);return Math.min(r,1)}static findCommonInterests(t,s){const a=t.map(n=>n.toLowerCase()),r=s.map(n=>n.toLowerCase());return a.filter(n=>r.includes(n))}static countMutualFollowers(t,s,a){const r=a.find(u=>u.id===t),n=a.find(u=>u.id===s);if(!r||!n)return 0;const o=r.followers_count||0,c=n.followers_count||0,d=Math.min(o,c);return Math.floor(d*.1)}static calculateDistance(t,s,a,r){const o=this.deg2rad(a-t),c=this.deg2rad(r-s),d=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this.deg2rad(t))*Math.cos(this.deg2rad(a))*Math.sin(c/2)*Math.sin(c/2);return 6371*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}static deg2rad(t){return t*(Math.PI/180)}static generateFollowReason(t,s){const a=[];if(t.similarityScore>.7&&a.push("Similar interests"),t.mutualConnectionsScore>.5){const r=Math.floor(t.mutualConnectionsScore*50);a.push(`${r} mutual connections`)}return t.activityScore>.7?a.push("Very active"):t.activityScore>.5&&a.push("Active user"),t.locationScore>.8?a.push("Same city"):t.locationScore>.6&&a.push("Nearby"),t.interestOverlapScore>.6&&a.push("Shared interests"),a.length===0&&a.push("Recommended for you"),a.join(", ")}static getPopularUsers(t,s=10){return t.filter(a=>a.followers_count>0).sort((a,r)=>(r.followers_count||0)-(a.followers_count||0)).slice(0,s)}static getUsersByInterest(t,s,a=10){const r=s.toLowerCase();return t.filter(n=>(n.interests||[]).some(c=>c.toLowerCase().includes(r))).sort((n,o)=>(o.followers_count||0)-(n.followers_count||0)).slice(0,a)}static calculateFollowStats(t,s,a){const r=s.length,n=a.length,o=s.filter(g=>a.some(w=>w.id===g.id)).length,c=s.reduce((g,w)=>g+(w.engagement_count||0),0),d=r>0?c/r:0,u=new Date(Date.now()-30*24*60*60*1e3),h=s.filter(g=>new Date(g.followed_at||g.created_at)>u).length,p=r>0?h/r:0;return{userId:t,totalFollowers:r,totalFollowing:n,mutualFollowers:o,engagementRate:d,growthRate:p,lastUpdated:new Date().toISOString()}}static analyzeFollowNetwork(t,s,a){const r=new Set([...s.map(w=>w.id),...a.map(w=>w.id)]).size,n=r*(r-1)/2,o=s.length+a.length,c=n>0?o/n:0,d=[...s,...a].filter(w=>(w.followers_count||0)>1e3).length,u=[...s,...a].flatMap(w=>w.interests||[]),h={};u.forEach(w=>{h[w]=(h[w]||0)+1});const p=Object.entries(h).filter(([w,x])=>x>1).sort(([w,x],[C,_])=>_-x).slice(0,5).map(([w,x])=>w),g=[];return c<.1&&g.push("Consider following more people to expand your network"),d<5&&g.push("Connect with more influential users in your field"),p.length<3&&g.push("Diversify your interests to connect with more people"),{networkSize:r,networkDensity:c,influentialConnections:d,commonInterests:p,recommendations:g}}}const ce=class ce{static getInstance(){return ce.instance||(ce.instance=new ce),ce.instance}followUser(t,s){return f(this,null,function*(){const{data:a,error:r}=yield N.from("user_follows").insert({follower_id:t,following_id:s,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(r)throw new Error(`Failed to follow user: ${r.message}`);return a})}unfollowUser(t,s){return f(this,null,function*(){const{error:a}=yield N.from("user_follows").delete().eq("follower_id",t).eq("following_id",s);if(a)throw new Error(`Failed to unfollow user: ${a.message}`)})}getFollowStatus(t,s){return f(this,null,function*(){const{data:a}=yield N.from("user_follows").select("status").eq("follower_id",t).eq("following_id",s).single();return a?a.status:"not_following"})}getFollowers(t,s=20){return f(this,null,function*(){const{data:a}=yield N.from("user_follows").select(`
        *,
        follower:profiles!user_follows_follower_id_fkey(
          user_id,
          display_name,
          avatar_url,
          bio
        )
      `).eq("following_id",t).eq("status","active").order("created_at",{ascending:!1}).limit(s);return a||[]})}getFollowing(t,s=20){return f(this,null,function*(){const{data:a}=yield N.from("user_follows").select(`
        *,
        following:profiles!user_follows_following_id_fkey(
          user_id,
          display_name,
          avatar_url,
          bio
        )
      `).eq("follower_id",t).eq("status","active").order("created_at",{ascending:!1}).limit(s);return a||[]})}getFollowStats(t){return f(this,null,function*(){const{count:s}=yield N.from("user_follows").select("*",{count:"exact",head:!0}).eq("following_id",t).eq("status","active"),{count:a}=yield N.from("user_follows").select("*",{count:"exact",head:!0}).eq("follower_id",t).eq("status","active"),{data:r}=yield N.from("user_follows").select("follower_id").eq("following_id",t).eq("status","active"),{data:n}=yield N.from("user_follows").select("following_id").eq("follower_id",t).eq("status","active");return st.calculateFollowStats(t,r||[],n||[])})}getFollowSuggestions(t,s=10){return f(this,null,function*(){try{const a=yield this.getUserProfile(t),r=yield this.getAllUsers(t);return st.generateFollowSuggestions(t,a.interests,a.location,this.getExistingFollows(t),r,s)}catch(a){return console.error("Error getting follow suggestions:",a),[]}})}getPopularUsers(t=10){return f(this,null,function*(){try{const{data:s}=yield N.from("profiles").select(`
          user_id,
          display_name,
          avatar_url,
          bio,
          location_city,
          location_state
        `).order("created_at",{ascending:!1}).limit(t*2);if(!s)return[];const a=[];for(const r of s){const{count:n}=yield N.from("user_follows").select("*",{count:"exact",head:!0}).eq("following_id",r.user_id).eq("status","active");n&&n>5&&a.push({userId:r.user_id,displayName:r.display_name||"Anonymous",avatarUrl:r.avatar_url,bio:r.bio,mutualFollowers:0,commonInterests:[],location:r.location_city?{city:r.location_city,state:r.location_state||""}:void 0,score:n,reason:"Popular in your area"})}return a.sort((r,n)=>n.score-r.score).slice(0,t)}catch(s){return console.error("Error getting popular users:",s),[]}})}getUsersByInterest(t,s=10){return f(this,null,function*(){try{const{data:a}=yield N.from("posts").select("user_id").or(`content.ilike.%${t}%,title.ilike.%${t}%`).eq("status","active").limit(100);if(!a)return[];const r=[...new Set(a.map(o=>o.user_id))];if(r.length===0)return[];const{data:n}=yield N.from("profiles").select(`
          user_id,
          display_name,
          avatar_url,
          bio,
          location_city,
          location_state
        `).in("user_id",r).limit(s);return n?n.map(o=>({userId:o.user_id,displayName:o.display_name||"Anonymous",avatarUrl:o.avatar_url,bio:o.bio,mutualFollowers:0,commonInterests:[t],location:o.location_city?{city:o.location_city,state:o.location_state||""}:void 0,score:1,reason:`Interested in ${t}`})):[]}catch(a){return console.error("Error getting users by interest:",a),[]}})}getUserProfile(t){return f(this,null,function*(){try{const{data:s}=yield N.from("profiles").select("*").eq("id",t).single(),{data:a}=yield N.from("user_preferences").select("*").eq("user_id",t).single();return{id:t,interests:(a==null?void 0:a.interests)||[],location:(s==null?void 0:s.location)||null,skills:(s==null?void 0:s.skills)||[],bio:(s==null?void 0:s.bio)||""}}catch(s){return console.error("Error getting user profile:",s),{id:t,interests:[],location:null,skills:[],bio:""}}})}getAllUsers(t){return f(this,null,function*(){try{const{data:s}=yield N.from("user_follows").select("following_id").eq("follower_id",t).eq("status","active"),a=(s==null?void 0:s.map(n=>n.following_id))||[],{data:r}=yield N.from("profiles").select("*").neq("id",t).not("id","in",`(${a.join(",")})`);return r||[]}catch(s){return console.error("Error getting all users:",s),[]}})}getExistingFollows(t){return[]}};pe(ce,"instance");let Be=ce;const se=Be.getInstance(),mt=()=>{const[i,t]=l.useState([]),[s,a]=l.useState([]),[r,n]=l.useState(null),[o,c]=l.useState([]),[d,u]=l.useState(!1),[h,p]=l.useState(null),{user:g}=We(),w=l.useCallback(b=>f(void 0,null,function*(){if(!g&&!b)return;const m=b||g.id;u(!0),p(null);try{const y=yield se.getFollowers(m);t(y)}catch(y){p(y instanceof Error?y.message:"Failed to fetch followers"),console.error("Error fetching followers:",y)}finally{u(!1)}}),[g]),x=l.useCallback(b=>f(void 0,null,function*(){if(!g&&!b)return;const m=b||g.id;u(!0),p(null);try{const y=yield se.getFollowing(m);a(y)}catch(y){p(y instanceof Error?y.message:"Failed to fetch following"),console.error("Error fetching following:",y)}finally{u(!1)}}),[g]),C=l.useCallback(b=>f(void 0,null,function*(){if(!g&&!b)return;const m=b||g.id;u(!0),p(null);try{const y=yield se.getFollowStats(m);n(y)}catch(y){p(y instanceof Error?y.message:"Failed to fetch follow stats"),console.error("Error fetching follow stats:",y)}finally{u(!1)}}),[g]),_=l.useCallback(()=>f(void 0,null,function*(){if(g){u(!0),p(null);try{const b=yield se.getFollowSuggestions(g.id);c(b)}catch(b){p(b instanceof Error?b.message:"Failed to fetch suggestions"),console.error("Error fetching suggestions:",b)}finally{u(!1)}}}),[g]),U=l.useCallback(b=>f(void 0,null,function*(){if(g){u(!0),p(null);try{yield se.followUser(g.id,b),a(m=>[...m,{id:`${g.id}-${b}`,followerId:g.id,followingId:b,status:"active",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]),yield C()}catch(m){p(m instanceof Error?m.message:"Failed to follow user"),console.error("Error following user:",m)}finally{u(!1)}}}),[g,C]),M=l.useCallback(b=>f(void 0,null,function*(){if(g){u(!0),p(null);try{yield se.unfollowUser(g.id,b),a(m=>m.filter(y=>y.followingId!==b)),yield C()}catch(m){p(m instanceof Error?m.message:"Failed to unfollow user"),console.error("Error unfollowing user:",m)}finally{u(!1)}}}),[g,C]),B=l.useCallback(b=>f(void 0,null,function*(){if(!g)return"not_following";try{return yield se.getFollowStatus(g.id,b)}catch(m){return console.error("Error getting follow status:",m),"not_following"}}),[g]),L=l.useCallback((b=10)=>f(void 0,null,function*(){u(!0),p(null);try{return yield se.getPopularUsers(b)}catch(m){return p(m instanceof Error?m.message:"Failed to fetch popular users"),console.error("Error fetching popular users:",m),[]}finally{u(!1)}}),[]),q=l.useCallback((b,m=10)=>f(void 0,null,function*(){u(!0),p(null);try{return yield se.getUsersByInterest(b,m)}catch(y){return p(y instanceof Error?y.message:"Failed to fetch users by interest"),console.error("Error fetching users by interest:",y),[]}finally{u(!1)}}),[]),E=l.useCallback(b=>f(void 0,null,function*(){if(!g&&!b)return;const m=b||g.id;yield Promise.all([w(m),x(m),C(m)]),b||(yield _())}),[g,w,x,C,_]);return l.useEffect(()=>{g&&E()},[g,E]),{followers:i,following:s,followStats:r,suggestions:o,loading:d,error:h,fetchFollowers:w,fetchFollowing:x,fetchFollowStats:C,fetchSuggestions:_,followUser:U,unfollowUser:M,getFollowStatus:B,getPopularUsers:L,getUsersByInterest:q,refreshAll:E}},zt=({suggestion:i})=>{const{followUser:t,loading:s}=mt(),a=()=>f(void 0,null,function*(){yield t(i.userId)});return e.jsx(O,{className:"hover:shadow-md transition-shadow",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(Ne,{className:"h-12 w-12",children:[e.jsx(He,{src:i.avatarUrl}),e.jsx(be,{children:i.displayName.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold truncate",children:i.displayName}),e.jsxs(Q,{variant:"outline",className:"text-xs",children:[Math.round(i.score),"% match"]})]}),i.bio&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:i.bio}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[i.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{className:"h-3 w-3"}),i.location.city,", ",i.location.state]}),i.mutualFollowers>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),i.mutualFollowers," mutual"]})]}),i.commonInterests.length>0&&e.jsx("div",{className:"flex gap-1 mb-2",children:i.commonInterests.slice(0,3).map((r,n)=>e.jsx(Q,{variant:"outline",className:"text-xs",children:r},n))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.reason})]}),e.jsxs(R,{variant:"outline",size:"sm",onClick:a,disabled:s,children:[e.jsx(St,{className:"h-3 w-3 mr-1"}),"Follow"]})]})})})},Bt=()=>{const{suggestions:i,loading:t,error:s,fetchSuggestions:a}=mt();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"People to Follow"}),e.jsx("p",{className:"text-muted-foreground",children:"Discover people with similar interests"})]}),e.jsxs(R,{variant:"outline",onClick:a,disabled:t,children:[e.jsx(rt,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),"Refresh"]})]}),s&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:e.jsx("p",{className:"text-destructive text-sm",children:s})}),t&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading suggestions..."})]}),!t&&i.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No suggestions yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Start following people to get personalized suggestions"})]}),e.jsx("div",{className:"grid gap-4",children:i.map(r=>e.jsx(zt,{suggestion:r},r.userId))})]})},Vt=({users:i,variant:t="default",layout:s="grid",showSearch:a=!0,showFilters:r=!0,showTabs:n=!0,className:o,loading:c=!1,error:d=null,onUserAction:u,onFollow:h,onMessage:p,onViewProfile:g,onShare:w,onEdit:x,onContact:C})=>{const[_,U]=l.useState(""),[M,B]=l.useState("all"),[L,q]=l.useState("name"),[E,b]=l.useState(!1),[m,y]=l.useState(!1),[v,D]=l.useState(!1),S=l.useMemo(()=>{let j=i;switch(_.trim()&&(j=j.filter(k=>{var V,me;return k.name.toLowerCase().includes(_.toLowerCase())||((V=k.bio)==null?void 0:V.toLowerCase().includes(_.toLowerCase()))||((me=k.location)==null?void 0:me.toLowerCase().includes(_.toLowerCase()))})),M){case"verified":j=j.filter(k=>k.verified);break;case"online":j=j.filter(k=>k.isOnline);break;case"premium":j=j.filter(k=>k.isPremium);break;case"trending":j=j.filter(k=>{var V;return(V=k.badges)==null?void 0:V.includes("trending")});break;case"featured":j=j.filter(k=>k.isFeatured);break}return E&&(j=j.filter(k=>k.verified)),m&&(j=j.filter(k=>k.isOnline)),v&&(j=j.filter(k=>k.isPremium)),j.sort((k,V)=>{switch(L){case"name":return k.name.localeCompare(V.name);case"followers":return(V.followersCount||0)-(k.followersCount||0);case"rating":return(V.rating||0)-(k.rating||0);case"recent":return new Date(V.joinDate||"").getTime()-new Date(k.joinDate||"").getTime();default:return 0}}),j},[i,_,M,L,E,m,v]),A=l.useCallback((j,k,V)=>f(void 0,null,function*(){if(u)try{yield u(j,k,V)}catch(me){console.error(`Failed to perform action ${k}:`,me)}}),[u]),Y=l.useCallback(j=>f(void 0,null,function*(){h&&(yield h(j)),yield A(j,"follow")}),[h,A]),Z=l.useCallback(j=>f(void 0,null,function*(){p&&(yield p(j)),yield A(j,"message")}),[p,A]),fe=l.useCallback(j=>f(void 0,null,function*(){g&&(yield g(j)),yield A(j,"view_profile")}),[g,A]),_e=l.useCallback(j=>f(void 0,null,function*(){w&&(yield w(j)),yield A(j,"share")}),[w,A]),de=l.useCallback(j=>f(void 0,null,function*(){x&&(yield x(j)),yield A(j,"edit")}),[x,A]),ke=l.useCallback(j=>f(void 0,null,function*(){C&&(yield C(j)),yield A(j,"contact")}),[C,A]);if(c)return e.jsx("div",{className:le("space-y-4",o),children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((j,k)=>e.jsxs(O,{className:"animate-pulse",children:[e.jsx(ae,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-32"}),e.jsx("div",{className:"h-3 bg-muted rounded w-24"})]})]})}),e.jsxs($,{className:"space-y-3",children:[e.jsx("div",{className:"h-3 bg-muted rounded w-full"}),e.jsx("div",{className:"h-3 bg-muted rounded w-3/4"})]})]},k))})});if(d)return e.jsx(O,{className:le("w-full",o),children:e.jsx($,{className:"p-6 text-center",children:e.jsxs("div",{className:"text-destructive",children:[e.jsx(J,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Users"}),e.jsx("p",{className:"text-muted-foreground",children:d})]})})});if(S.length===0)return e.jsx(O,{className:le("w-full",o),children:e.jsx($,{className:"p-6 text-center",children:e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx(J,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Users Found"}),e.jsx("p",{className:"mb-4",children:_?`No users match "${_}"`:"No users available"}),_&&e.jsx(R,{variant:"outline",onClick:()=>U(""),children:"Clear Search"})]})})});const ee=()=>{const j=S.map(k=>e.jsx(he,{user:k,variant:t,onFollow:Y,onMessage:Z,onViewProfile:fe,onShare:_e,onEdit:de,onContact:ke,showActions:!0,showStats:t!=="minimal",showSocialLinks:t==="detailed"||t==="premium"||t==="featured",showSkills:t==="detailed"||t==="premium"||t==="featured",showInterests:t==="featured",animate:!0,interactive:!0},k.id));switch(s){case"grid":return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:j});case"list":return e.jsx("div",{className:"space-y-3",children:j});case"cards":return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:j});case"enterprise":return e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:i.map(k=>e.jsx(he,{user:k,variant:"enterprise",showActions:!0,showStats:!0,showSkills:!0,onFollow:h,onMessage:p,onViewProfile:g,onShare:w,onEdit:x,onContact:C,className:"h-full"},k.id))});case"dark":return e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:i.map(k=>e.jsx(he,{user:k,variant:"dark",showActions:!0,showStats:!0,showSkills:!0,onFollow:h,onMessage:p,onViewProfile:g,onShare:w,onEdit:x,onContact:C,className:"h-full"},k.id))});default:return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j})}};return e.jsxs("div",{className:le("space-y-6",o),children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Users"}),e.jsxs("p",{className:"text-muted-foreground",children:[S.length," of ",i.length," users"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{variant:s==="grid"?"default":"outline",size:"sm",onClick:()=>q("name"),children:e.jsx(Nt,{className:"h-4 w-4"})}),e.jsx(R,{variant:s==="list"?"default":"outline",size:"sm",onClick:()=>q("name"),children:e.jsx(bt,{className:"h-4 w-4"})})]})]}),(a||r)&&e.jsxs(O,{children:[e.jsx(ae,{children:e.jsx(re,{className:"text-lg",children:"Search & Filters"})}),e.jsxs($,{className:"space-y-4",children:[a&&e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(xe,{placeholder:"Search users by name, bio, or location...",value:_,onChange:j=>U(j.target.value),className:"pl-10"})]}),r&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(R,{variant:E?"default":"outline",size:"sm",onClick:()=>b(!E),children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Verified"]}),e.jsxs(R,{variant:m?"default":"outline",size:"sm",onClick:()=>y(!m),children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Online"]}),e.jsxs(R,{variant:v?"default":"outline",size:"sm",onClick:()=>D(!v),children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Premium"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Sort by:"}),e.jsxs("select",{value:L,onChange:j=>q(j.target.value),className:"px-3 py-1 border rounded-md text-sm",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"followers",children:"Followers"}),e.jsx("option",{value:"rating",children:"Rating"}),e.jsx("option",{value:"recent",children:"Recently Joined"})]})]})]})]}),n&&e.jsxs(Ge,{value:M,onValueChange:B,children:[e.jsxs(Qe,{className:"grid w-full grid-cols-6",children:[e.jsx(W,{value:"all",children:"All"}),e.jsxs(W,{value:"verified",children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Verified"]}),e.jsxs(W,{value:"online",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Online"]}),e.jsxs(W,{value:"premium",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Premium"]}),e.jsxs(W,{value:"trending",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Trending"]}),e.jsxs(W,{value:"featured",children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Featured"]})]}),e.jsx(G,{value:"all",className:"mt-6",children:ee()}),e.jsx(G,{value:"verified",className:"mt-6",children:ee()}),e.jsx(G,{value:"online",className:"mt-6",children:ee()}),e.jsx(G,{value:"premium",className:"mt-6",children:ee()}),e.jsx(G,{value:"trending",className:"mt-6",children:ee()}),e.jsx(G,{value:"featured",className:"mt-6",children:ee()})]}),!n&&ee()]})};function Wt({users:i,variant:t="default",onReorder:s,onUserAction:a,onFollow:r,onMessage:n,onViewProfile:o,onShare:c,onEdit:d,onContact:u,className:h,showDragHandles:p=!0,allowReordering:g=!0}){const[w,x]=l.useState(i),[C,_]=l.useState(null),[U,M]=l.useState(null),B=l.useCallback((v,D)=>{if(!g)return;_(D),v.dataTransfer&&(v.dataTransfer.effectAllowed="move",v.dataTransfer.setData("text/html",D.toString()));const S=v.target;S.style.opacity="0.5"},[g]),L=l.useCallback((v,D)=>{!g||C===null||(v.preventDefault(),v.dataTransfer&&(v.dataTransfer.dropEffect="move"),U!==D&&M(D))},[g,C,U]),q=l.useCallback(v=>{v.preventDefault(),M(null)},[]),E=l.useCallback((v,D)=>{if(!g||C===null)return;v.preventDefault();const S=[...w],[A]=S.splice(C,1);S.splice(D,0,A),x(S),_(null),M(null);const Y=v.target;Y.style.opacity="1",s==null||s(S)},[g,C,w,s]),b=l.useCallback(v=>{_(null),M(null);const D=v.target;D.style.opacity="1"},[]),m=l.useCallback(()=>{const v=[...w].sort(()=>Math.random()-.5);x(v),s==null||s(v)},[w,s]),y=l.useCallback(()=>{x(i),s==null||s(i)},[i,s]);return e.jsxs("div",{className:le("space-y-4",h),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[w.length," users"]}),g&&e.jsx(Q,{variant:"secondary",className:"text-xs",children:"Drag to reorder"})]}),g&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(R,{variant:"outline",size:"sm",onClick:m,className:"text-xs",children:[e.jsx(Mt,{className:"h-3 w-3 mr-1"}),"Shuffle"]}),e.jsx(R,{variant:"outline",size:"sm",onClick:y,className:"text-xs",children:"Reset"})]})]}),e.jsx("div",{className:"space-y-3",children:w.map((v,D)=>e.jsx(O,P(I({className:le("transition-all duration-200 cursor-move","hover:shadow-md hover:scale-[1.01]",C===D&&"opacity-50 scale-95",U===D&&"ring-2 ring-primary/50 ring-offset-2",!g&&"cursor-default")},g?{draggable:!0}:{}),{onDragStart:S=>B(S,D),onDragOver:S=>L(S,D),onDragLeave:q,onDrop:S=>E(S,D),onDragEnd:b,"data-testid":"user-card",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[p&&g&&e.jsx("div",{className:"flex-shrink-0 text-muted-foreground hover:text-foreground transition-colors","data-testid":"drag-handle",children:e.jsx(ct,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-1",children:e.jsx(he,{user:v,variant:t,showActions:!0,showStats:!1,showSkills:!1,onFollow:r,onMessage:n,onViewProfile:o,onShare:c,onEdit:d,onContact:u,className:"border-0 shadow-none p-0"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs(Q,{variant:"outline",className:"text-xs",children:["#",D+1]})})]})})}),v.id))})]})}function Gt({users:i,variant:t="default",height:s=600,itemHeight:a=120,onUserAction:r,onFollow:n,onMessage:o,onViewProfile:c,onShare:d,onEdit:u,onContact:h,className:p,showSearch:g=!0,showFilters:w=!0,showSorting:x=!0,enableVirtualization:C=!0}){const[_,U]=l.useState(i),[M,B]=l.useState(i),[L,q]=l.useState(""),[E,b]=l.useState("name"),[m,y]=l.useState("asc"),[v,D]=l.useState(new Set),S=l.useRef(null),[A,Y]=l.useState(0),Z=l.useMemo(()=>{let F=[...i];if(L){const T=L.toLowerCase();F=F.filter(z=>{var X,te,Ye;return z.name.toLowerCase().includes(T)||((X=z.bio)==null?void 0:X.toLowerCase().includes(T))||((te=z.location)==null?void 0:te.toLowerCase().includes(T))||((Ye=z.skills)==null?void 0:Ye.some(ht=>ht.toLowerCase().includes(T)))})}return v.size>0&&(F=F.filter(T=>!(v.has("verified")&&!T.verified||v.has("premium")&&!T.isPremium||v.has("featured")&&!T.isFeatured||v.has("online")&&!T.isOnline))),F.sort((T,z)=>{let X,te;switch(E){case"name":X=T.name.toLowerCase(),te=z.name.toLowerCase();break;case"followers":X=T.followersCount||0,te=z.followersCount||0;break;case"joinDate":X=new Date(T.joinDate||"").getTime(),te=new Date(z.joinDate||"").getTime();break;case"rating":X=T.rating||0,te=z.rating||0;break;default:return 0}return m==="asc"?X>te?1:-1:X<te?1:-1}),F},[i,L,v,E,m]);l.useEffect(()=>{B(Z)},[Z]);const fe=M.length*a,_e=Math.ceil(s/a)+2,de=Math.max(0,Math.floor(A/a)),ke=Math.min(M.length,de+_e),ee=C?M.slice(de,ke):M,j=l.useCallback(F=>{C&&Y(F.currentTarget.scrollTop)},[C]),k=l.useCallback(F=>{q(F)},[]),V=l.useCallback(F=>{D(T=>{const z=new Set(T);return z.has(F)?z.delete(F):z.add(F),z})},[]),me=l.useCallback(F=>{E===F?y(T=>T==="asc"?"desc":"asc"):(b(F),y("asc"))},[E]),ut=l.useCallback((F,T)=>{const z=C?de+T:T,X=C?z*a:0;return e.jsx("div",{className:"w-full",style:C?{position:"absolute",top:X,height:a}:void 0,children:e.jsx(O,{className:"h-full mx-2 mb-2 transition-all duration-200 hover:shadow-md",children:e.jsx($,{className:"p-4",children:e.jsx(he,{user:F,variant:t,showActions:!0,showStats:!1,showSkills:!1,onFollow:n,onMessage:o,onViewProfile:c,onShare:d,onEdit:u,onContact:h,className:"border-0 shadow-none p-0"})})})},F.id)},[de,a,C,t,n,o,c,d,u,h]);return e.jsxs("div",{className:le("space-y-4",p),children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[M.length," of ",i.length," users"]}),C&&e.jsx(Q,{variant:"secondary",className:"text-xs",children:"Virtualized"})]})}),g&&e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(xe,{placeholder:"Search users by name, bio, location, or skills...",value:L,onChange:F=>k(F.target.value),className:"pl-10"})]}),(w||x)&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[w&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Filters:"}),["verified","premium","featured","online"].map(F=>e.jsxs(R,{variant:v.has(F)?"default":"outline",size:"sm",onClick:()=>V(F),className:"text-xs capitalize",children:[e.jsx(it,{className:"h-3 w-3 mr-1"}),F]},F))]}),x&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground ml-4",children:"Sort by:"}),[{key:"name",label:"Name"},{key:"followers",label:"Followers"},{key:"joinDate",label:"Join Date"},{key:"rating",label:"Rating"}].map(({key:F,label:T})=>e.jsxs(R,{variant:E===F?"default":"outline",size:"sm",onClick:()=>me(F),className:"text-xs",children:[T,E===F&&(m==="asc"?e.jsx(kt,{className:"h-3 w-3 ml-1"}):e.jsx(Dt,{className:"h-3 w-3 ml-1"}))]},F))]})]})]}),e.jsx("div",{ref:S,className:"border rounded-lg",style:{height:s},children:e.jsx(_t,{className:"h-full",onScroll:j,children:e.jsx("div",{className:"relative w-full",style:{height:C?fe:"auto"},children:ee.map((F,T)=>ut(F,T))})})})]})}const Ws=()=>{const{toast:i}=xt(),{currentLocation:t}=nt(),[s,a]=l.useState("search"),[r,n]=l.useState([]),[o,c]=l.useState([]),[d,u]=l.useState([]),[h,p]=l.useState(!0),[g,w]=l.useState([]),x=l.useCallback(()=>f(void 0,null,function*(){try{p(!0);const{data:m,error:y}=yield N.functions.invoke("fetch-local-news",{body:{location:t?"Your Area":"Local Area",latitude:t==null?void 0:t.latitude,longitude:t==null?void 0:t.longitude,radius:50}});y?(console.error("Error fetching news:",y),n([{title:"Local Community Updates",description:"Stay connected with your local community and discover what's happening around you.",url:"#",source:"Local News",publishedAt:new Date().toISOString(),category:"General"},{title:"Community Events This Week",description:"Find exciting events and activities happening in your neighborhood this week.",url:"#",source:"Community Events",publishedAt:new Date(Date.now()-2*60*60*1e3).toISOString(),category:"Events"}])):m&&m.news?n(m.news.slice(0,5)):n([{title:"Local Community Updates",description:"Stay connected with your local community and discover what's happening around you.",url:"#",source:"Local News",publishedAt:new Date().toISOString(),category:"General"},{title:"Community Events This Week",description:"Find exciting events and activities happening in your neighborhood this week.",url:"#",source:"Community Events",publishedAt:new Date(Date.now()-2*60*60*1e3).toISOString(),category:"Events"}]);try{const{data:v}=yield N.from("events").select("*").gte("event_date",new Date().toISOString().split("T")[0]).order("event_date",{ascending:!0}).limit(6);v&&c(v.map(D=>({id:D.id,title:D.title,description:D.description,location:D.location_name,date:D.event_date,category:D.category,price:D.price?`$${D.price}`:"Free"})))}catch(v){console.error("Error fetching events:",v),c([{id:"1",title:"Community Meetup",description:"Join us for a friendly community gathering",location:"Local Community Center",date:new Date(Date.now()+7*24*60*60*1e3).toISOString(),category:"Community",price:"Free"}])}}catch(m){console.error("Error fetching local content:",m),i({title:"Error",description:"Failed to load local content",variant:"destructive"})}finally{p(!1)}}),[t,i]),C=l.useCallback(()=>f(void 0,null,function*(){try{const{data:m}=yield N.from("events").select(`
          id,
          title,
          description,
          category,
          max_attendees,
          event_date,
          image_url
        `).gte("event_date",new Date().toISOString().split("T")[0]).order("max_attendees",{ascending:!1}).limit(3),{data:y}=yield N.from("artists").select(`
          id,
          user_id,
          specialty,
          bio
        `).eq("is_available",!0).limit(3),{data:v}=yield N.from("posts").select(`
          id,
          user_id,
          title,
          content,
          type,
          likes_count
        `).eq("status","active").order("likes_count",{ascending:!1}).limit(3),D=[...(m==null?void 0:m.map(S=>({id:S.id,type:"event",title:S.title,description:S.description,engagement:S.max_attendees||0,image:S.image_url})))||[],...(y==null?void 0:y.map(S=>{var A;return{id:S.id,type:"artist",title:"Artist Profile",description:S.bio||((A=S.specialty)==null?void 0:A.join(", "))||"",engagement:0,image:void 0}}))||[],...(v==null?void 0:v.map(S=>({id:S.id,type:"post",title:S.title||"Untitled Post",description:S.content.substring(0,100)+"...",engagement:S.likes_count||0,image:void 0})))||[]];u(D)}catch(m){console.error("Error fetching trending content:",m)}}),[]),_=l.useCallback(()=>f(void 0,null,function*(){try{w([{id:"user-1",name:"Sarah Johnson",email:"sarah@example.com",avatar:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=200&h=200&fit=crop&crop=face",bio:"Event organizer and community builder passionate about bringing people together",location:"San Francisco, CA",verified:!0,followersCount:2341,followingCount:189,isFollowing:!1,isOnline:!0,badges:["trending"],skills:["Event Planning","Community Management","Marketing"],interests:["Community","Events","Networking"],joinDate:"2021-08-15",eventsCount:23,projectsCount:12,isPremium:!0,isFeatured:!1},{id:"user-2",name:"Michael Chen",email:"michael@example.com",avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face",bio:"Tech entrepreneur and startup mentor helping others build successful businesses",location:"Austin, TX",verified:!0,followersCount:5678,followingCount:234,isFollowing:!0,isOnline:!1,badges:["trending"],skills:["Startup Strategy","Product Development","Investor Relations"],interests:["Technology","Business","Innovation"],joinDate:"2020-12-01",eventsCount:45,projectsCount:18,isPremium:!0,isFeatured:!0},{id:"user-3",name:"Emma Rodriguez",email:"emma@example.com",avatar:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop&crop=face",bio:"Creative designer and artist exploring the intersection of art and technology",location:"Portland, OR",verified:!1,followersCount:892,followingCount:456,isFollowing:!1,isOnline:!0,badges:[],skills:["UI/UX Design","Digital Art","Creative Direction"],interests:["Art","Design","Technology"],joinDate:"2023-01-20",eventsCount:8,projectsCount:5,isPremium:!1,isFeatured:!1},{id:"user-4",name:"David Kim",email:"david@example.com",avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop&crop=face",bio:"Fitness coach and wellness advocate promoting healthy lifestyles",location:"Miami, FL",verified:!0,followersCount:3456,followingCount:123,isFollowing:!1,isOnline:!1,badges:["trending"],skills:["Personal Training","Nutrition","Wellness Coaching"],interests:["Fitness","Health","Wellness"],joinDate:"2022-06-10",eventsCount:32,projectsCount:14,isPremium:!0,isFeatured:!1}])}catch(m){console.error("Error fetching discovered users:",m),i({title:"Error",description:"Failed to load discovered users",variant:"destructive"})}}),[i]);l.useEffect(()=>{x(),C(),_()},[x,C,_]);const U=l.useCallback((m,y,v)=>f(void 0,null,function*(){switch(console.log(`User action: ${y} for user ${m}`,v),y){case"follow":i({title:"Success",description:"You are now following this user"});break;case"message":i({title:"Message",description:"Opening message composer..."});break;case"view_profile":i({title:"Profile",description:"Navigating to user profile..."});break;case"share":i({title:"Share",description:"Sharing user profile..."});break;case"edit":i({title:"Edit",description:"Opening profile editor..."});break;case"contact":i({title:"Contact",description:"Opening contact options..."});break}}),[i]),M=l.useCallback(m=>f(void 0,null,function*(){try{w(y=>y.map(v=>v.id===m?P(I({},v),{isFollowing:!v.isFollowing}):v)),i({title:"Success",description:"Follow status updated"})}catch(y){i({title:"Error",description:"Failed to update follow status",variant:"destructive"})}}),[i]),B=l.useCallback(m=>f(void 0,null,function*(){i({title:"Message",description:"Opening message composer..."})}),[i]),L=l.useCallback(m=>f(void 0,null,function*(){i({title:"Profile",description:"Navigating to user profile..."})}),[i]),q=l.useCallback(m=>f(void 0,null,function*(){i({title:"Share",description:"Sharing user profile..."})}),[i]),E=l.useCallback(m=>f(void 0,null,function*(){i({title:"Edit",description:"Opening profile editor..."})}),[i]),b=l.useCallback(m=>f(void 0,null,function*(){i({title:"Contact",description:"Opening contact options..."})}),[i]);return e.jsx(yt,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-center mb-4",children:"Discover Your Community"}),e.jsx("p",{className:"text-xl text-center text-muted-foreground max-w-3xl mx-auto",children:"Connect with amazing people, discover local events, and explore trending content in your area"})]}),e.jsxs(Ge,{value:s,onValueChange:a,className:"w-full",children:[e.jsxs(Qe,{className:"grid w-full grid-cols-7",children:[e.jsx(W,{value:"overview",children:"Overview"}),e.jsx(W,{value:"users",children:"People"}),e.jsx(W,{value:"events",children:"Events"}),e.jsx(W,{value:"trending",children:"Trending"}),e.jsx(W,{value:"recommendations",children:"Recommendations"}),e.jsx(W,{value:"draggable",children:"Draggable"}),e.jsx(W,{value:"virtualized",children:"Virtualized"})]}),e.jsx(G,{value:"search",className:"space-y-6",children:e.jsx(Et,{})}),e.jsxs(G,{value:"users",className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Discover Amazing People"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect with verified professionals, creators, and community leaders"})]}),e.jsxs(O,{children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-yellow-500"}),"Featured Users"]}),e.jsx(je,{children:"Premium and verified users you might want to connect with"})]}),e.jsx($,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:g.filter(m=>m.isPremium||m.isFeatured).map(m=>e.jsx(he,{user:m,variant:m.isFeatured?"featured":"premium",onFollow:M,onMessage:B,onViewProfile:L,onShare:q,onEdit:E,onContact:b,showActions:!0,showStats:!0,showSocialLinks:!0,showSkills:!0,showInterests:!0,animate:!0,interactive:!0},m.id))})})]}),e.jsxs(O,{children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"All Users"]}),e.jsx(je,{children:"Browse and discover users in your community"})]}),e.jsx($,{children:e.jsx(Vt,{users:g,variant:"compact",layout:"grid",showSearch:!0,showFilters:!0,showTabs:!0,onUserAction:U,onFollow:M,onMessage:B,onViewProfile:L,onShare:q,onEdit:E,onContact:b})})]})]}),e.jsxs(G,{value:"events",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Nearby Events"}),e.jsx(R,{variant:"outline",onClick:()=>window.location.href="/events",children:"View All Events"})]}),h?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((m,y)=>e.jsxs(O,{className:"animate-pulse",children:[e.jsx(ae,{children:e.jsx("div",{className:"h-4 bg-muted rounded w-3/4"})}),e.jsxs($,{children:[e.jsx("div",{className:"h-3 bg-muted rounded w-full mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-2/3"})]})]},y))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(m=>e.jsxs(O,{className:"hover:shadow-md transition-shadow",children:[e.jsxs(ae,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Q,{variant:"outline",children:m.category}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:m.price})]}),e.jsx(re,{className:"text-lg",children:m.title})]}),e.jsxs($,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:m.description}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:m.location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:Ce(new Date(m.date),"MMM dd, yyyy")})]})]})]})]},m.id))})]}),e.jsx(G,{value:"trending",className:"space-y-6",children:e.jsx(Lt,{})}),e.jsxs(G,{value:"recommendations",className:"space-y-6",children:[e.jsx(qt,{}),e.jsx(Bt,{})]}),e.jsx(G,{value:"draggable",className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Interactive User List"}),e.jsx("p",{className:"text-muted-foreground",children:"Drag and drop users to reorder them. Use the shuffle button to randomize the order."})]}),e.jsxs(O,{children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"h-5 w-5 text-blue-500"}),"Draggable Users"]}),e.jsx(je,{children:"Drag users to reorder them. Click shuffle to randomize the order."})]}),e.jsx($,{children:e.jsx(Wt,{users:g,variant:"compact",onReorder:m=>{w(m),i({title:"Users Reordered",description:"The user list has been updated with the new order."})},onFollow:M,onMessage:B,onViewProfile:L,onShare:q,onEdit:E,onContact:b,showDragHandles:!0,allowReordering:!0})})]})]})}),e.jsx(G,{value:"virtualized",className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"High-Performance User List"}),e.jsx("p",{className:"text-muted-foreground",children:"This list uses virtualization to handle large datasets efficiently. Only visible items are rendered."})]}),e.jsxs(O,{children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(Ft,{className:"h-5 w-5 text-green-500"}),"Virtualized Users"]}),e.jsx(je,{children:"High-performance list with search, filtering, and sorting capabilities."})]}),e.jsx($,{children:e.jsx(Gt,{users:g,variant:"dark",height:600,itemHeight:120,onFollow:M,onMessage:B,onViewProfile:L,onShare:q,onEdit:E,onContact:b,showSearch:!0,showFilters:!0,showSorting:!0,enableVirtualization:!0})})]})]})})]})]})})};export{Ws as default};
