var us=Object.defineProperty,xs=Object.defineProperties;var gs=Object.getOwnPropertyDescriptors;var ke=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable;var Re=(a,s,t)=>s in a?us(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,B=(a,s)=>{for(var t in s||(s={}))Ze.call(s,t)&&Re(a,t,s[t]);if(ke)for(var t of ke(s))es.call(s,t)&&Re(a,t,s[t]);return a},G=(a,s)=>xs(a,gs(s));var Ie=(a,s)=>{var t={};for(var r in a)Ze.call(a,r)&&s.indexOf(r)<0&&(t[r]=a[r]);if(a!=null&&ke)for(var r of ke(a))s.indexOf(r)<0&&es.call(a,r)&&(t[r]=a[r]);return t};var _e=(a,s,t)=>Re(a,typeof s!="symbol"?s+"":s,t);var g=(a,s,t)=>new Promise((r,i)=>{var n=d=>{try{c(t.next(d))}catch(x){i(x)}},l=d=>{try{c(t.throw(d))}catch(x){i(x)}},c=d=>d.done?r(d.value):Promise.resolve(d.value).then(n,l);c((t=t.apply(a,s)).next())});import{R as fs,j as e,aI as ts,aJ as ps,ay as js,r as o,a2 as ye,X as as,a4 as rs,M as we,ap as vs,o as Se,t as be,aK as Fe,U as Z,z as me,a6 as We,w as Me,x as Ee,q as is,au as ws,f as ns,aH as Ge,Z as Qe,v as ge,a8 as ys,ad as Ns,av as bs,aj as Pe,aL as Ss,G as Cs,a7 as ks,a9 as _s,m as Ds,$ as Ts,a3 as Fs,aA as Ms,aM as Es,aN as ls,aO as Ls,aP as As,aQ as Rs}from"./chunk-COTa-BBv.js";import{e as Q,a as cs,B as b,C as O,c as ie,d as fe,b as $,u as Is,f as De}from"./main-BMj1NFFE.js";import{B as z}from"./chunk-BCSLz2CJ.js";import{T as Ye,a as Xe,b as Y,c as X}from"./chunk-BzTmHFr7.js";import{ResponsiveLayout as Ps}from"./ResponsiveLayout.tsx-wqK2pe-W.js";import{u as os}from"./chunk-DYZWJdwa.js";import{s as M}from"./chunk-CasIWBEQ.js";import{I as Ce}from"./chunk-BQur_cHm.js";import{S as ss}from"./chunk-DQqbdQUG.js";import{S as Ue,a as Oe,b as $e,c as ze,d as te}from"./chunk-Caym9pUi.js";import{L as le}from"./chunk-UbFD0_dp.js";import{A as oe,a as he,b as de}from"./chunk-mExNus9E.js";import{a as Le}from"./chunk-DJzzOJWe.js";import{u as ds}from"./chunk-Drm-sIqC.js";import{S as Us}from"./chunk-D-G76ObT.js";import"./chunk-DvlvDbdf.js";import"./chunk-BlluHz2J.js";import"./chunk-BA32w1ww.js";import"./chunk-DmQrF9DI.js";import"./chunk-C4jjqBrH.js";const Te=fs.forwardRef((r,t)=>{var i=r,{className:a}=i,s=Ie(i,["className"]);return e.jsx(ts,G(B({ref:t,className:Q("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a)},s),{children:e.jsx(ps,{className:Q("flex items-center justify-center text-current"),children:e.jsx(js,{className:"h-4 w-4"})})}))});Te.displayName=ts.displayName;class Be{static calculateRelevanceScore(s,t){const r=this.calculateTextRelevance(s,t),i=this.calculateLocationRelevance(s,t),n=this.calculateCategoryRelevance(s,t),l=this.calculateEngagementScore(s),c=this.calculateFreshnessScore(s),d=r*.35+i*.25+n*.15+l*.15+c*.1;return{textRelevance:r,locationRelevance:i,categoryRelevance:n,engagementScore:l,freshnessScore:c,totalScore:d}}static calculateTextRelevance(s,t){var d,x;const r=t.query.toLowerCase(),i=s.title.toLowerCase(),n=((d=s.description)==null?void 0:d.toLowerCase())||"",l=((x=s.tags)==null?void 0:x.map(p=>p.toLowerCase()))||[];let c=0;return i.includes(r)?c+=10:i.split(" ").some(p=>p.includes(r))&&(c+=7),n.includes(r)?c+=5:n.split(" ").some(p=>p.includes(r))&&(c+=3),l.forEach(p=>{p.includes(r)&&(c+=3)}),i===r&&(c+=5),Math.min(c,20)}static calculateLocationRelevance(s,t){var d,x,p;if(!t.location||!s.location)return 0;let r=0;s.distance!==void 0&&(s.distance<=5?r+=10:s.distance<=15?r+=7:s.distance<=30?r+=4:s.distance<=50&&(r+=2));const i=t.query.toLowerCase(),n=((d=s.location.name)==null?void 0:d.toLowerCase())||"",l=((x=s.location.city)==null?void 0:x.toLowerCase())||"",c=((p=s.location.state)==null?void 0:p.toLowerCase())||"";return(n.includes(i)||l.includes(i)||c.includes(i))&&(r+=5),Math.min(r,15)}static calculateCategoryRelevance(s,t){return!t.category||t.category==="all",5}static calculateEngagementScore(s){if(!s.engagement)return 0;const{likes:t,comments:r,shares:i,views:n}=s.engagement,l=t*1+r*2+i*3+n*.1;return Math.min(l/100,10)}static calculateFreshnessScore(s){const t=new Date,r=new Date(s.createdAt),i=(t.getTime()-r.getTime())/(1e3*60*60);return i<=1?10:i<=24?8:i<=168?6:i<=720?4:2}static rankSearchResults(s,t){return s.map(r=>{const i=this.calculateRelevanceScore(r,t);return G(B({},r),{relevanceScore:i.totalScore})}).sort((r,i)=>{switch(t.sortBy){case"relevance":return(i.relevanceScore||0)-(r.relevanceScore||0);case"distance":return(r.distance||0)-(i.distance||0);case"date":return new Date(i.createdAt).getTime()-new Date(r.createdAt).getTime();case"popularity":{const n=r.engagement?r.engagement.likes+r.engagement.comments:0;return(i.engagement?i.engagement.likes+i.engagement.comments:0)-n}case"rating":return(i.rating||0)-(r.rating||0);default:return(i.relevanceScore||0)-(r.relevanceScore||0)}})}static generateSearchSuggestions(s,t=[]){const r=new Set;return t.forEach(l=>{l.toLowerCase().includes(s.toLowerCase())&&r.add(l)}),["music","art","food","sports","business","education","concert","exhibition","restaurant","gym","workshop","local","nearby","today","this week","free","paid"].forEach(l=>{l.toLowerCase().includes(s.toLowerCase())&&r.add(l)}),["music","art","food","sports","business","education","entertainment","health","technology","fashion","travel"].forEach(l=>{l.toLowerCase().includes(s.toLowerCase())&&r.add(l)}),Array.from(r).slice(0,10)}static calculateDistance(s,t,r,i){const l=this.deg2rad(r-s),c=this.deg2rad(i-t),d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(this.deg2rad(s))*Math.cos(this.deg2rad(r))*Math.sin(c/2)*Math.sin(c/2);return 6371*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}static deg2rad(s){return s*(Math.PI/180)}}const pe=class pe{static getInstance(){return pe.instance||(pe.instance=new pe),pe.instance}search(s){return g(this,null,function*(){const t=[];try{const r=[];(s.type==="all"||s.type==="artist")&&r.push(this.searchArtists(s)),(s.type==="all"||s.type==="event")&&r.push(this.searchEvents(s)),(s.type==="all"||s.type==="post")&&r.push(this.searchPosts(s)),(s.type==="all"||s.type==="group")&&r.push(this.searchGroups(s)),(yield Promise.all(r)).forEach(d=>{t.push(...d)});const n=this.scoreAndSortResults(t,s),l=(s.page||0)*(s.limit||20),c=l+(s.limit||20);return n.slice(l,c)}catch(r){throw console.error("Search error:",r),new Error("Failed to perform search")}})}searchArtists(s){return g(this,null,function*(){const{data:t}=yield M.from("artists").select(`
        id,
        user_id,
        specialty,
        hourly_rate_min,
        hourly_rate_max,
        bio,
        is_available
      `).or(`specialty.cs.{${s.query}},bio.ilike.%${s.query}%`).eq("is_available",!0);if(!t)return[];const r=[];for(const i of t){const{data:n}=yield M.from("profiles").select("display_name, avatar_url, location_city, location_state, latitude, longitude").eq("user_id",i.user_id).single();if(n){const l=s.location?this.calculateDistance(s.location.latitude,s.location.longitude,n.latitude,n.longitude):void 0;(!s.location||l&&l<=s.location.radius)&&r.push({id:i.id,type:"artist",title:n.display_name||"Anonymous",description:i.bio,image:n.avatar_url,price:i.hourly_rate_min,location:{name:n.location_city||"",city:n.location_city||"",state:n.location_state||"",latitude:n.latitude,longitude:n.longitude},distance:l,tags:i.specialty,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}}return r})}searchEvents(s){return g(this,null,function*(){let t=M.from("events").select(`
        id,
        title,
        description,
        event_date,
        event_time,
        location_name,
        location_city,
        location_state,
        category,
        price,
        image_url,
        tags,
        created_at
      `).or(`title.ilike.%${s.query}%,description.ilike.%${s.query}%,category.ilike.%${s.query}%`);s.dateRange?t=t.gte("event_date",s.dateRange.start).lte("event_date",s.dateRange.end):t=t.gte("event_date",new Date().toISOString().split("T")[0]);const{data:r}=yield t;return r?r.map(i=>({id:i.id,type:"event",title:i.title,description:i.description,image:i.image_url,price:i.price,location:{name:i.location_name||"",city:i.location_city||"",state:i.location_state||""},date:`${i.event_date} ${i.event_time}`,tags:i.tags,createdAt:i.created_at,updatedAt:i.created_at})):[]})}searchPosts(s){return g(this,null,function*(){const{data:t}=yield M.from("posts").select(`
        id,
        user_id,
        title,
        content,
        type,
        likes_count,
        comments_count,
        created_at
      `).or(`title.ilike.%${s.query}%,content.ilike.%${s.query}%`).eq("status","active");if(!t)return[];const r=[];for(const i of t){const{data:n}=yield M.from("profiles").select("display_name, avatar_url").eq("user_id",i.user_id).single();n&&r.push({id:i.id,type:"post",title:i.title||"Untitled Post",description:i.content.substring(0,100)+"...",image:n.avatar_url,date:i.created_at,tags:i.type?[i.type]:[],engagement:{likes:i.likes_count||0,comments:i.comments_count||0,shares:0,views:0},createdAt:i.created_at,updatedAt:i.created_at})}return r})}searchGroups(s){return g(this,null,function*(){const{data:t}=yield M.from("community_groups").select(`
        id,
        name,
        description,
        category,
        created_at
      `).or(`name.ilike.%${s.query}%,description.ilike.%${s.query}%,category.ilike.%${s.query}%`);return t?t.map(r=>({id:r.id,type:"group",title:r.name,description:r.description,date:r.created_at,tags:r.category?[r.category]:[],createdAt:r.created_at,updatedAt:r.created_at})):[]})}calculateDistance(s,t,r,i){return!s||!t||!r||!i?0:Be.calculateDistance(s,t,r,i)}scoreAndSortResults(s,t){return Be.rankSearchResults(s,t)}getSearchSuggestions(s){return g(this,null,function*(){if(!s.trim())return[];const{data:t}=yield M.from("search_history").select("query").ilike("query",`%${s}%`).order("created_at",{ascending:!1}).limit(5),r=t?t.map(i=>i.query):[];return Be.generateSearchSuggestions(s,r)})}saveSearchHistory(s,t,r,i){return g(this,null,function*(){yield M.from("search_history").insert({user_id:s,query:t,filters:JSON.stringify(r),results_count:i,created_at:new Date().toISOString()})})}};_e(pe,"instance");let He=pe;const Ve=He.getInstance(),Os=()=>{const[a,s]=o.useState(""),[t,r]=o.useState([]),[i,n]=o.useState(!1),[l,c]=o.useState(null),[d,x]=o.useState({type:"all",category:"all",location:{enabled:!1,radius:50},dateRange:{enabled:!1,start:"",end:""},priceRange:{enabled:!1,min:0,max:1e3},tags:[],rating:0,sortBy:"relevance"}),[p,R]=o.useState([]),[v,k]=o.useState(0),[j,S]=o.useState(!0),{user:y}=cs(),{currentLocation:P}=os(),D=o.useCallback((m,T,h)=>g(null,null,function*(){const C=m||a,f=T||d,I=h||0;if(!C.trim()){r([]),S(!1);return}n(!0),c(null);try{const ee={query:C,type:f.type==="all"?void 0:f.type,category:f.category==="all"?void 0:f.category,location:f.location.enabled&&P?{latitude:P.latitude,longitude:P.longitude,radius:f.location.radius}:void 0,dateRange:f.dateRange.enabled?{start:f.dateRange.start,end:f.dateRange.end}:void 0,priceRange:f.priceRange.enabled?{min:f.priceRange.min,max:f.priceRange.max}:void 0,tags:f.tags.length>0?f.tags:void 0,sortBy:f.sortBy,page:I,limit:20},ae=yield Ve.search(ee);r(I===0?ae:V=>[...V,...ae]),S(ae.length===20),k(I),y&&(yield Ve.saveSearchHistory(y.id,C,f,ae.length))}catch(ee){c(ee instanceof Error?ee.message:"Search failed"),console.error("Search error:",ee)}finally{n(!1)}}),[a,d,P,y]),H=o.useCallback(m=>g(null,null,function*(){if(!m.trim()){R([]);return}try{const T=yield Ve.getSearchSuggestions(m);R(T)}catch(T){console.error("Error getting suggestions:",T)}}),[]),N=o.useCallback(m=>{x(T=>B(B({},T),m)),k(0)},[]),E=o.useCallback(()=>{x({type:"all",category:"all",location:{enabled:!1,radius:50},dateRange:{enabled:!1,start:"",end:""},priceRange:{enabled:!1,min:0,max:1e3},tags:[],rating:0,sortBy:"relevance"}),k(0)},[]),U=o.useCallback(()=>{!i&&j&&D(a,d,v+1)},[i,j,D,a,d,v]),L=o.useCallback(()=>{r([]),k(0),S(!0),c(null)},[]);return o.useEffect(()=>{const m=setTimeout(()=>{a.trim()?(D(),H(a)):(L(),R([]))},500);return()=>clearTimeout(m)},[a,D,H,L]),o.useEffect(()=>{a.trim()&&D()},[d,D,a]),{query:a,setQuery:s,results:t,loading:i,error:l,filters:d,updateFilters:N,resetFilters:E,suggestions:p,hasMore:j,loadMore:U,clearResults:L,search:()=>D()}},ms=o.memo(({result:a})=>{const s=o.useCallback(t=>({artist:e.jsx(me,{className:"h-4 w-4"}),event:e.jsx(Se,{className:"h-4 w-4"}),post:e.jsx(Z,{className:"h-4 w-4"}),group:e.jsx(Z,{className:"h-4 w-4"}),business:e.jsx(Fe,{className:"h-4 w-4"})})[t]||e.jsx(ye,{className:"h-4 w-4"}),[]);return e.jsx(O,{className:"hover:shadow-md transition-shadow",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(oe,{className:"h-12 w-12",children:[e.jsx(he,{src:a.image}),e.jsx(de,{children:a.title.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s(a.type),e.jsx(z,{variant:"secondary",className:"text-xs",children:a.type}),e.jsx("h3",{className:"font-semibold truncate",children:a.title}),a.relevanceScore&&e.jsxs(z,{variant:"outline",className:"text-xs",children:[Math.round(a.relevanceScore),"% match"]})]}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:a.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[a.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),a.location.name||`${a.location.city}, ${a.location.state}`]}),a.distance&&e.jsxs("span",{children:[a.distance.toFixed(1),"km away"]}),a.price&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vs,{className:"h-3 w-3"}),"$",a.price]}),a.date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"h-3 w-3"}),Le(new Date(a.date),"MMM dd, yyyy")]}),a.engagement&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),a.engagement.likes+a.engagement.comments]})]}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex gap-1 mt-2",children:a.tags.slice(0,3).map((t,r)=>e.jsx(z,{variant:"outline",className:"text-xs",children:t},r))})]}),e.jsx(b,{variant:"outline",size:"sm",children:"View"})]})})})});ms.displayName="SearchResultItem";const hs=o.memo(({filters:a,updateFilters:s,resetFilters:t,categories:r})=>{var i;return e.jsxs(O,{children:[e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{children:"Search Filters"}),e.jsxs(b,{variant:"outline",size:"sm",onClick:t,children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Reset"]})]})}),e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Content Type"}),e.jsxs(Ue,{value:a.type,onValueChange:n=>s({type:n}),children:[e.jsx(Oe,{children:e.jsx($e,{})}),e.jsxs(ze,{children:[e.jsx(te,{value:"all",children:"All Types"}),e.jsx(te,{value:"artist",children:"Artists"}),e.jsx(te,{value:"event",children:"Events"}),e.jsx(te,{value:"post",children:"Posts"}),e.jsx(te,{value:"group",children:"Groups"}),e.jsx(te,{value:"business",children:"Businesses"})]})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Category"}),e.jsxs(Ue,{value:a.category,onValueChange:n=>s({category:n}),children:[e.jsx(Oe,{children:e.jsx($e,{})}),e.jsxs(ze,{children:[e.jsx(te,{value:"all",children:"All Categories"}),a.type!=="all"&&((i=r[a.type])==null?void 0:i.map(n=>e.jsx(te,{value:n.toLowerCase(),children:n},n)))]})]})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Sort By"}),e.jsxs(Ue,{value:a.sortBy,onValueChange:n=>s({sortBy:n}),children:[e.jsx(Oe,{children:e.jsx($e,{})}),e.jsxs(ze,{children:[e.jsx(te,{value:"relevance",children:"Relevance"}),e.jsx(te,{value:"distance",children:"Distance"}),e.jsx(te,{value:"date",children:"Date"}),e.jsx(te,{value:"popularity",children:"Popularity"}),e.jsx(te,{value:"rating",children:"Rating"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{id:"location-filter",checked:a.location.enabled,onCheckedChange:n=>s({location:G(B({},a.location),{enabled:n})})}),e.jsx(le,{htmlFor:"location-filter",children:"Filter by location"})]}),a.location.enabled&&e.jsxs("div",{children:[e.jsxs(le,{className:"text-sm font-medium",children:["Max Distance: ",a.location.radius,"km"]}),e.jsx(ss,{value:[a.location.radius],onValueChange:([n])=>s({location:G(B({},a.location),{radius:n})}),max:100,min:1,step:1})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{id:"date-filter",checked:a.dateRange.enabled,onCheckedChange:n=>s({dateRange:G(B({},a.dateRange),{enabled:n})})}),e.jsx(le,{htmlFor:"date-filter",children:"Filter by date range"})]}),a.dateRange.enabled&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"Start Date"}),e.jsx(Ce,{type:"date",value:a.dateRange.start,onChange:n=>s({dateRange:G(B({},a.dateRange),{start:n.target.value})})})]}),e.jsxs("div",{children:[e.jsx(le,{className:"text-sm font-medium",children:"End Date"}),e.jsx(Ce,{type:"date",value:a.dateRange.end,onChange:n=>s({dateRange:G(B({},a.dateRange),{end:n.target.value})})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{id:"price-filter",checked:a.priceRange.enabled,onCheckedChange:n=>s({priceRange:G(B({},a.priceRange),{enabled:n})})}),e.jsx(le,{htmlFor:"price-filter",children:"Filter by price range"})]}),a.priceRange.enabled&&e.jsxs("div",{children:[e.jsxs(le,{className:"text-sm font-medium",children:["Price Range: $",a.priceRange.min," - $",a.priceRange.max]}),e.jsx(ss,{value:[a.priceRange.min,a.priceRange.max],onValueChange:n=>s({priceRange:G(B({},a.priceRange),{min:n[0],max:n[1]})}),max:1e3,min:0,step:10})]})]})]})]})});hs.displayName="SearchFilters";const $s=()=>{const{query:a,setQuery:s,results:t,loading:r,error:i,filters:n,updateFilters:l,resetFilters:c,suggestions:d,hasMore:x,loadMore:p}=Os(),[R,v]=o.useState(!1),[k,j]=o.useState(!1),S=o.useMemo(()=>({artist:["Photographer","Musician","DJ","Chef","Designer","Writer","Performer"],event:["Music","Food","Art","Sports","Business","Education","Entertainment"],post:["News","Discussion","Question","Announcement","Review"],group:["Hobby","Professional","Community","Interest","Location-based"],business:["Restaurant","Shop","Service","Entertainment","Health","Education"]}),[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(Ce,{placeholder:"Search artists, events, posts, groups, businesses...",value:a,onChange:y=>{s(y.target.value),j(y.target.value.length>0)},onFocus:()=>j(a.length>0),className:"pl-10"}),a&&e.jsx(b,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",onClick:()=>{s(""),j(!1)},children:e.jsx(as,{className:"h-3 w-3"})})]}),e.jsxs(b,{variant:"outline",onClick:()=>v(!R),children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Filters"]})]}),k&&d.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 bg-background border rounded-md shadow-lg z-10 mt-1",children:d.map((y,P)=>e.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-muted flex items-center gap-2",onClick:()=>{s(y),j(!1)},children:[e.jsx(ye,{className:"h-3 w-3 text-muted-foreground"}),y]},P))})]}),R&&e.jsx(hs,{filters:n,updateFilters:l,resetFilters:c,categories:S}),i&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:e.jsx("p",{className:"text-destructive text-sm",children:i})}),e.jsxs("div",{className:"space-y-4",children:[r&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Searching..."})]}),!r&&t.length===0&&a&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ye,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No results found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search terms or filters"})]}),t.map(y=>e.jsx(ms,{result:y},`${y.type}-${y.id}`)),x&&t.length>0&&e.jsx("div",{className:"text-center pt-4",children:e.jsx(b,{variant:"outline",onClick:p,disabled:r,children:r?"Loading...":"Load More"})})]})]})};class zs{static calculateTrendingScore(s,t="day"){const r=this.calculateEngagementScore(s),i=this.calculateVelocityScore(s),n=this.calculateTimeDecayScore(s),l=this.calculateCategoryWeight(s),c=this.calculateLocationRelevance(s),d=this.calculateQualityScore(s),x=this.getPeriodWeights(t),p=r*x.engagement+i*x.velocity+n*x.timeDecay+l*x.category+c*x.location+d*x.quality;return{engagementScore:r,velocityScore:i,timeDecayScore:n,categoryWeight:l,locationRelevance:c,qualityScore:d,finalScore:p}}static calculateEngagementScore(s){const{likes:t,comments:r,shares:i,views:n}=s.engagement,l=t*1+r*2+i*3+n*.1;return Math.min(l/10,100)}static calculateVelocityScore(s){const{velocity:t}=s.engagement;return Math.min(t*10,100)}static calculateTimeDecayScore(s){const t=new Date,r=new Date(s.createdAt),i=(t.getTime()-r.getTime())/(1e3*60*60),n=Math.exp(-.1*i)*100;return Math.max(n,1)}static calculateCategoryWeight(s){return({music:1.2,art:1.1,food:1,sports:1.3,business:.9,education:1,entertainment:1.2,health:1.1,technology:1,fashion:1.1,travel:1}[s.category.toLowerCase()]||1)*100}static calculateLocationRelevance(s){return 80}static calculateQualityScore(s){let t=50;if(s.title&&s.title.length>10&&(t+=10),s.description&&s.description.length>50&&(t+=10),s.image&&(t+=10),s.engagement.views>0){const r=s.engagement.likes/s.engagement.views;t+=Math.min(r*100,20)}return Math.min(t,100)}static getPeriodWeights(s){return{hour:{engagement:.25,velocity:.35,timeDecay:.2,category:.1,location:.05,quality:.05},day:{engagement:.3,velocity:.25,timeDecay:.25,category:.1,location:.05,quality:.05},week:{engagement:.35,velocity:.15,timeDecay:.2,category:.15,location:.1,quality:.05},month:{engagement:.4,velocity:.1,timeDecay:.15,category:.2,location:.1,quality:.05}}[s]}static rankTrendingContent(s,t="day"){return s.map(r=>{const i=this.calculateTrendingScore(r,t);return G(B({},r),{trendingScore:i.finalScore})}).sort((r,i)=>i.trendingScore-r.trendingScore)}static calculateTrendingVelocity(s){if(s.length<2)return 0;const t=s.sort((n,l)=>new Date(n.timestamp).getTime()-new Date(l.timestamp).getTime()),r=(new Date(t[t.length-1].timestamp).getTime()-new Date(t[0].timestamp).getTime())/(1e3*60*60),i=t[t.length-1].engagement-t[0].engagement;return r>0?i/r:0}static detectTrendingPattern(s){const t=s.engagement.velocity;return t>10?"rising":t>2?"stable":"declining"}static calculateTrendingMomentum(s){if(s.length<3)return 0;const t=[];for(let r=1;r<s.length;r++){const i=(new Date(s[r].timestamp).getTime()-new Date(s[r-1].timestamp).getTime())/36e5,n=s[r].engagement-s[r-1].engagement;t.push(i>0?n/i:0)}return t.length<2?0:t[t.length-1]-t[0]}static filterByQuality(s,t=30){return s.filter(r=>this.calculateTrendingScore(r).qualityScore>=t)}static getTrendingInsights(s){const t=this.detectTrendingPattern(s),r=s.engagement.velocity;let i="stable";r>20?i="strong":r>10?i="moderate":r<2&&(i="weak");let n="stable";r>15&&t==="rising"?n="likely to trend higher":r<5&&t==="declining"?n="likely to decline":n="expected to remain stable";const l=[];return t==="rising"?(l.push("Consider promoting this content"),l.push("Monitor engagement closely")):t==="declining"&&(l.push("Consider refreshing content"),l.push("Analyze engagement patterns")),{pattern:t,momentum:i,prediction:n,recommendations:l}}}const je=class je{static getInstance(){return je.instance||(je.instance=new je),je.instance}getTrendingContent(s="day",t=20){return g(this,null,function*(){try{const r=[],i=yield this.getTrendingEvents(s,t/4);r.push(...i);const n=yield this.getTrendingPosts(s,t/4);r.push(...n);const l=yield this.getTrendingArtists(s,t/4);r.push(...l);const c=yield this.getTrendingGroups(s,t/4);return r.push(...c),zs.rankTrendingContent(r,s).slice(0,t)}catch(r){return console.error("Error fetching trending content:",r),[]}})}getTrendingEvents(s,t){return g(this,null,function*(){const r=this.getTimeFilter(s),{data:i}=yield M.from("events").select(`
        id,
        title,
        description,
        category,
        event_date,
        location_name,
        location_city,
        location_state,
        image_url,
        max_attendees,
        created_at
      `).gte("event_date",new Date().toISOString().split("T")[0]).gte("created_at",r).order("max_attendees",{ascending:!1}).limit(t);return i?i.map(n=>({id:n.id,type:"event",title:n.title,description:n.description,image:n.image_url,engagement:{likes:0,comments:0,shares:0,views:0,velocity:n.max_attendees||0},trendingScore:this.calculateTrendingScore(n.max_attendees||0,n.created_at),category:n.category,location:{name:n.location_name||"",city:n.location_city||"",state:n.location_state||""},createdAt:n.created_at,trendingPeriod:s})):[]})}getTrendingPosts(s,t){return g(this,null,function*(){const r=this.getTimeFilter(s),{data:i}=yield M.from("posts").select(`
        id,
        user_id,
        title,
        content,
        type,
        likes_count,
        comments_count,
        created_at
      `).eq("status","active").gte("created_at",r).order("likes_count",{ascending:!1}).limit(t);if(!i)return[];const n=[];for(const l of i){const{data:c}=yield M.from("profiles").select("display_name, avatar_url").eq("user_id",l.user_id).single();if(c){const d=(l.likes_count||0)+(l.comments_count||0)*2;n.push({id:l.id,type:"post",title:l.title||"Untitled Post",description:l.content.substring(0,100)+"...",image:c.avatar_url,engagement:{likes:l.likes_count||0,comments:l.comments_count||0,shares:0,views:0,velocity:d},trendingScore:this.calculateTrendingScore(d,l.created_at),category:l.type||"general",createdAt:l.created_at,trendingPeriod:s})}}return n})}getTrendingArtists(s,t){return g(this,null,function*(){var n;this.getTimeFilter(s);const{data:r}=yield M.from("artists").select(`
        id,
        user_id,
        specialty,
        bio,
        hourly_rate_min,
        is_available
      `).eq("is_available",!0).limit(t);if(!r)return[];const i=[];for(const l of r){const{data:c}=yield M.from("profiles").select("display_name, avatar_url, location_city, location_state").eq("user_id",l.user_id).single();if(c){const d=Math.floor(Math.random()*100)+10;i.push({id:l.id,type:"artist",title:c.display_name||"Anonymous",description:l.bio,image:c.avatar_url,engagement:{likes:0,comments:0,shares:0,views:d,velocity:d},trendingScore:this.calculateTrendingScore(d,new Date().toISOString()),category:((n=l.specialty)==null?void 0:n[0])||"artist",location:{name:c.location_city||"",city:c.location_city||"",state:c.location_state||""},createdAt:new Date().toISOString(),trendingPeriod:s})}}return i})}getTrendingGroups(s,t){return g(this,null,function*(){const r=this.getTimeFilter(s),{data:i}=yield M.from("community_groups").select(`
        id,
        name,
        description,
        category,
        created_at
      `).gte("created_at",r).limit(t);return i?i.map(n=>{const l=Math.floor(Math.random()*50)+5;return{id:n.id,type:"group",title:n.name,description:n.description,engagement:{likes:0,comments:0,shares:0,views:l,velocity:l},trendingScore:this.calculateTrendingScore(l,n.created_at),category:n.category,createdAt:n.created_at,trendingPeriod:s}}):[]})}getTimeFilter(s){const t=new Date;let r;switch(s){case"hour":r=new Date(t.getTime()-3600*1e3);break;case"day":r=new Date(t.getTime()-1440*60*1e3);break;case"week":r=new Date(t.getTime()-10080*60*1e3);break;case"month":r=new Date(t.getTime()-720*60*60*1e3);break;default:r=new Date(t.getTime()-1440*60*1e3)}return r.toISOString()}calculateTrendingScore(s,t){const r=new Date,i=new Date(t),n=(r.getTime()-i.getTime())/(1e3*60*60),l=Math.max(.1,1-n/168),c=s/Math.max(1,n);return(s*.4+c*.4+l*.2)*100}getDiscoverContent(s,t=20){return g(this,null,function*(){try{const r=yield this.getUserPreferences(s);return(yield this.getTrendingContent("day",t*2)).map(l=>G(B({},l),{personalizationScore:this.calculatePersonalizationScore(l,r)})).sort((l,c)=>c.personalizationScore-l.personalizationScore).slice(0,t).map(d=>{var x=d,{personalizationScore:l}=x,c=Ie(x,["personalizationScore"]);return c})}catch(r){return console.error("Error fetching discover content:",r),this.getTrendingContent("day",t)}})}getUserPreferences(s){return g(this,null,function*(){const{data:t}=yield M.from("posts").select("type, category").eq("user_id",s).gte("created_at",new Date(Date.now()-2592e6).toISOString()).limit(50);if(!t)return[];const r=new Set;return t.forEach(i=>{i.type&&r.add(i.type),i.category&&r.add(i.category)}),Array.from(r)})}calculatePersonalizationScore(s,t){if(t.length===0)return .5;let r=0,i=0;return t.includes(s.category)&&(r+=.4,i++),s.tags&&s.tags.forEach(n=>{t.includes(n)&&(r+=.2,i++)}),i>0?r/i:.5}};_e(je,"instance");let Je=je;const Bs=Je.getInstance(),Vs=()=>{const[a,s]=o.useState([]),[t,r]=o.useState(!1),[i,n]=o.useState(null),[l,c]=o.useState("day"),[d,x]=o.useState(20),p=o.useCallback(()=>g(null,null,function*(){r(!0),n(null);try{const j=yield Bs.getTrendingContent(l,d);s(j)}catch(j){n(j instanceof Error?j.message:"Failed to fetch trending content"),console.error("Error fetching trending content:",j)}finally{r(!1)}}),[l,d]),R=o.useCallback(()=>{p()},[p]),v=o.useCallback(j=>{c(j)},[]),k=o.useCallback(j=>{x(j)},[]);return o.useEffect(()=>{p()},[p]),{trendingContent:a,loading:t,error:i,period:l,limit:d,fetchTrendingContent:p,refreshTrendingContent:R,changePeriod:v,changeLimit:k}},qs=({content:a})=>{var r;const s=i=>({artist:e.jsx(me,{className:"h-4 w-4"}),event:e.jsx(Se,{className:"h-4 w-4"}),post:e.jsx(Z,{className:"h-4 w-4"}),group:e.jsx(Z,{className:"h-4 w-4"}),business:e.jsx(Fe,{className:"h-4 w-4"})})[i]||e.jsx(be,{className:"h-4 w-4"}),t=i=>i>=1e3?`${(i/1e3).toFixed(1)}k`:Math.round(i).toString();return e.jsx(O,{className:"hover:shadow-md transition-shadow",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(oe,{className:"h-12 w-12",children:[e.jsx(he,{src:a.image}),e.jsx(de,{children:a.title.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s(a.type),e.jsx(z,{variant:"secondary",className:"text-xs",children:a.type}),e.jsxs(z,{variant:"outline",className:"text-xs text-green-600",children:[t(a.trendingScore)," trending"]}),e.jsx("h3",{className:"font-semibold truncate",children:a.title})]}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:a.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[a.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"h-3 w-3"}),a.location.name||`${a.location.city}, ${a.location.state}`]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),Le(new Date(a.createdAt),"MMM dd, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"h-3 w-3"}),a.engagement.likes]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),a.engagement.comments]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(is,{className:"h-3 w-3"}),a.engagement.shares]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ws,{className:"h-3 w-3"}),a.engagement.views]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),a.engagement.velocity,"/hr"]})]}),((r=a.metadata)==null?void 0:r.tags)&&Array.isArray(a.metadata.tags)&&e.jsx("div",{className:"flex gap-1 mt-2",children:a.metadata.tags.slice(0,3).map((i,n)=>e.jsx(z,{variant:"outline",className:"text-xs",children:i},n))})]}),e.jsx(b,{variant:"outline",size:"sm",children:"View"})]})})})},Ws=()=>{const{trendingContent:a,loading:s,error:t,period:r,changePeriod:i,refreshTrendingContent:n}=Vs(),l=[{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Trending Content"}),e.jsx("p",{className:"text-muted-foreground",children:"Discover what's popular in your area"})]}),e.jsx(b,{variant:"outline",onClick:n,disabled:s,children:"Refresh"})]}),e.jsxs(Ye,{value:r,onValueChange:c=>i(c),children:[e.jsx(Xe,{children:l.map(c=>e.jsx(Y,{value:c.value,children:c.label},c.value))}),e.jsxs(X,{value:r,className:"space-y-4",children:[t&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:e.jsx("p",{className:"text-destructive text-sm",children:t})}),s&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading trending content..."})]}),!s&&a.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No trending content"}),e.jsx("p",{className:"text-muted-foreground",children:"Check back later for trending content in your area"})]}),e.jsx("div",{className:"grid gap-4",children:a.map(c=>e.jsx(qs,{content:c},`${c.type}-${c.id}`))})]})]})]})};class Gs{static generateRecommendations(s,t,r=20){const n=t.map(c=>{const d=this.calculateRecommendationScores(s,c);return G(B({},c),{scores:d})}).sort((c,d)=>d.scores.finalScore-c.scores.finalScore);return this.applyDiversityFilter(n,r).map((c,d)=>({id:`rec_${c.id}_${d}`,userId:s.userId,contentId:c.id,contentType:c.type,score:c.scores.finalScore,reason:this.generateRecommendationReason(s,c,c.scores),algorithm:"hybrid",metadata:{collaborativeScore:c.scores.collaborativeScore,contentBasedScore:c.scores.contentBasedScore,locationScore:c.scores.locationScore,freshnessScore:c.scores.freshnessScore,diversityScore:c.scores.diversityScore},createdAt:new Date().toISOString(),expiresAt:new Date(Date.now()+1440*60*1e3).toISOString()}))}static calculateRecommendationScores(s,t){const r=this.calculateCollaborativeScore(s,t),i=this.calculateContentBasedScore(s,t),n=this.calculateLocationScore(s,t),l=this.calculateFreshnessScore(t),c=this.calculateDiversityScore(t),d=r*.3+i*.25+n*.2+l*.15+c*.1;return{collaborativeScore:r,contentBasedScore:i,locationScore:n,freshnessScore:l,diversityScore:c,finalScore:d}}static calculateCollaborativeScore(s,t){const r=this.findSimilarUsers(s);if(r.length===0)return .5;const i=r.map(l=>{const c=l.preferences.find(d=>d.category===t.category);return c?c.weight:.5}),n=i.reduce((l,c)=>l+c,0)/i.length;return Math.min(n,1)}static calculateContentBasedScore(s,t){const r=s.preferences;if(r.length===0)return .5;const i=r.find(d=>d.category===t.category);if(i)return i.weight;const n=this.extractContentFeatures(t),l=this.extractUserInterests(s),c=this.calculateFeatureSimilarity(n,l);return Math.min(c,1)}static calculateLocationScore(s,t){if(!s.location||!t.location)return .5;const r=this.calculateDistance(s.location.latitude,s.location.longitude,t.location.latitude,t.location.longitude);return Math.max(0,1-r/50)}static calculateFreshnessScore(s){const t=new Date,r=new Date(s.createdAt),i=(t.getTime()-r.getTime())/(1e3*60*60),n=Math.exp(-.05*i);return Math.max(n,.1)}static calculateDiversityScore(s){return .8}static findSimilarUsers(s){return[]}static extractContentFeatures(s){const t={};if(t[`category_${s.category}`]=1,s.tags&&s.tags.forEach(r=>{t[`tag_${r}`]=1}),s.price&&(t.price_low=s.price<50?1:0,t.price_medium=s.price>=50&&s.price<200?1:0,t.price_high=s.price>=200?1:0),s.date){const r=new Date(s.date),i=new Date,n=(r.getTime()-i.getTime())/(1e3*60*60*24);t.time_soon=n<=7?1:0,t.time_medium=n>7&&n<=30?1:0,t.time_far=n>30?1:0}return t}static extractUserInterests(s){const t={};s.preferences.forEach(n=>{t[`category_${n.category}`]=n.weight});const r={};s.behaviorHistory.forEach(n=>{const l=`${n.action}_${n.contentType}`;r[l]=(r[l]||0)+1});const i=Math.max(...Object.values(r),1);return Object.entries(r).forEach(([n,l])=>{t[n]=l/i}),t}static calculateFeatureSimilarity(s,t){const r=new Set([...Object.keys(s),...Object.keys(t)]);let i=0,n=0,l=0;return r.forEach(c=>{const d=s[c]||0,x=t[c]||0;i+=d*x,n+=d*d,l+=x*x}),n===0||l===0?0:i/(Math.sqrt(n)*Math.sqrt(l))}static applyDiversityFilter(s,t){const r=[],i=new Set,n=new Set;for(const l of s){if(r.length>=t)break;const c=!i.has(l.category)||i.size>=3,d=!n.has(l.type)||n.size>=2;c&&d&&(r.push(l),i.add(l.category),n.add(l.type))}if(r.length<t)for(const l of s){if(r.length>=t)break;r.find(c=>c.id===l.id)||r.push(l)}return r}static generateRecommendationReason(s,t,r){const i=[];return r.contentBasedScore>.7&&s.preferences.find(l=>l.category===t.category)&&i.push(`Based on your interest in ${t.category}`),r.locationScore>.7&&i.push("Happening near you"),r.freshnessScore>.8&&i.push("Recently added"),r.collaborativeScore>.7&&i.push("Popular with similar users"),i.length===0&&i.push("Recommended for you"),i.join(", ")}static calculateDistance(s,t,r,i){const l=this.deg2rad(r-s),c=this.deg2rad(i-t),d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(this.deg2rad(s))*Math.cos(this.deg2rad(r))*Math.sin(c/2)*Math.sin(c/2);return 6371*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}static deg2rad(s){return s*(Math.PI/180)}static updateUserPreferences(s,t,r,i){const n=[...s.preferences];let l=n.find(d=>d.category===r);l||(l={id:`pref_${r}`,userId:s.userId,category:r,weight:.5,source:"behavioral",lastUpdated:new Date().toISOString()},n.push(l));const c=this.getWeightChangeForAction(t);return l.weight=Math.max(0,Math.min(1,l.weight+c)),l.lastUpdated=new Date().toISOString(),n}static getWeightChangeForAction(s){return{like:.1,comment:.15,share:.2,bookmark:.1,follow:.25,view:.02,search:.05}[s]||0}}const ve=class ve{static getInstance(){return ve.instance||(ve.instance=new ve),ve.instance}getRecommendations(s,t=20){return g(this,null,function*(){try{const r=yield this.getUserProfile(s),i=yield this.getAvailableContent(s);return Gs.generateRecommendations(r,i,t)}catch(r){return console.error("Error getting recommendations:",r),[]}})}getUserProfile(s){return g(this,null,function*(){try{const{data:t}=yield M.from("user_preferences").select("*").eq("user_id",s).single(),{data:r}=yield M.from("user_behavior").select("*").eq("user_id",s).order("created_at",{ascending:!1}).limit(100);return{userId:s,preferences:t||{},behavior:r||[],interests:(t==null?void 0:t.interests)||[],location:(t==null?void 0:t.location)||null}}catch(t){return console.error("Error getting user profile:",t),{userId:s,preferences:{},behavior:[],interests:[],location:null}}})}getAvailableContent(s){return g(this,null,function*(){try{const{data:t}=yield M.from("posts").select("*").neq("user_id",s).order("created_at",{ascending:!1}).limit(100),{data:r}=yield M.from("events").select("*").order("created_at",{ascending:!1}).limit(50),{data:i}=yield M.from("profiles").select("*").eq("is_artist",!0).neq("id",s).limit(50);return[...(t||[]).map(n=>G(B({},n),{type:"post"})),...(r||[]).map(n=>G(B({},n),{type:"event"})),...(i||[]).map(n=>G(B({},n),{type:"artist"}))]}catch(t){return console.error("Error getting available content:",t),[]}})}generatePreferencesFromBehavior(s){return g(this,null,function*(){const t=[],{data:r}=yield M.from("posts").select("type, category").eq("user_id",s).limit(100);if(r){const n=new Map;r.forEach(l=>{l.type&&n.set(l.type,(n.get(l.type)||0)+1),l.category&&n.set(l.category,(n.get(l.category)||0)+1)}),n.forEach((l,c)=>{t.push({id:`${s}-${c}`,userId:s,category:c,weight:Math.min(1,l/10),source:"behavioral",lastUpdated:new Date().toISOString()})})}const{data:i}=yield M.from("post_likes").select("post_id").eq("user_id",s).limit(100);if(i)for(const n of i){const{data:l}=yield M.from("posts").select("type, category").eq("id",n.post_id).single();if(l){const c=t.find(d=>d.category===(l.type||l.category));c?c.weight+=.1:t.push({id:`${s}-${l.type||l.category}`,userId:s,category:l.type||l.category||"general",weight:.1,source:"behavioral",lastUpdated:new Date().toISOString()})}}return t})}getContentScores(s,t){return g(this,null,function*(){const r=[],{data:i}=yield M.from("posts").select(`
        id,
        user_id,
        title,
        content,
        type,
        category,
        likes_count,
        comments_count,
        created_at
      `).eq("status","active").neq("user_id",s).order("created_at",{ascending:!1}).limit(200);if(!i)return r;for(const n of i){const l=yield this.calculateContentScore(n,t,s);r.push(l)}return r})}calculateContentScore(s,t,r){return g(this,null,function*(){let i=0,n=0,l=0,c=0;t.forEach(v=>{(s.type===v.category||s.category===v.category)&&(i+=v.weight)});const d=(s.likes_count||0)+(s.comments_count||0)*2;n=Math.min(1,d/100);const x=(Date.now()-new Date(s.created_at).getTime())/(1e3*60*60);l=Math.max(0,1-x/168);const{data:p}=yield M.from("profiles").select("latitude, longitude").eq("user_id",r).single();p!=null&&p.latitude&&(p!=null&&p.longitude)&&(c=.5);const R=i*.4+n*.3+l*.2+c*.1;return{contentId:s.id,contentType:"post",relevanceScore:i,popularityScore:n,freshnessScore:l,locationScore:c,overallScore:R,factors:{userInterest:i,contentQuality:n,engagement:n,recency:l,proximity:c}}})}generateRecommendations(s,t,r){return g(this,null,function*(){const i=[],n=t.sort((l,c)=>c.overallScore-l.overallScore).slice(0,r);for(const l of n){const c=this.generateRecommendationReason(l);i.push({id:`${s}-${l.contentId}`,userId:s,contentId:l.contentId,contentType:l.contentType,score:l.overallScore,reason:c,algorithm:"hybrid",metadata:{relevanceScore:l.relevanceScore,popularityScore:l.popularityScore,freshnessScore:l.freshnessScore,locationScore:l.locationScore},createdAt:new Date().toISOString(),expiresAt:new Date(Date.now()+1440*60*1e3).toISOString()})}return i})}generateRecommendationReason(s){const t=[];return s.factors.userInterest>.5&&t.push("matches your interests"),s.factors.contentQuality>.7&&t.push("highly engaging content"),s.factors.recency>.8&&t.push("fresh content"),s.factors.proximity>.6&&t.push("local to you"),t.length===0?"trending in your area":t.join(", ")}updateUserPreferences(s,t,r){return g(this,null,function*(){yield M.from("user_preferences").upsert({user_id:s,category:t,weight:r,source:"explicit",last_updated:new Date().toISOString()})})}trackUserBehavior(s,t,r,i){return g(this,null,function*(){yield M.from("user_behavior").insert({user_id:s,action:t,content_type:r,content_id:i,metadata:{},timestamp:new Date().toISOString(),session_id:`session-${Date.now()}`})})}};_e(ve,"instance");let Ke=ve;const qe=Ke.getInstance(),Qs=()=>{const[a,s]=o.useState([]),[t,r]=o.useState(!1),[i,n]=o.useState(null),[l,c]=o.useState(20),{user:d}=cs(),x=o.useCallback(()=>g(null,null,function*(){if(!d){s([]);return}r(!0),n(null);try{const j=yield qe.getRecommendations(d.id,l);s(j)}catch(j){n(j instanceof Error?j.message:"Failed to fetch recommendations"),console.error("Error fetching recommendations:",j)}finally{r(!1)}}),[d,l]),p=o.useCallback(()=>{x()},[x]),R=o.useCallback((j,S)=>g(null,null,function*(){if(d)try{yield qe.updateUserPreferences(d.id,j,S),yield x()}catch(y){console.error("Error updating user preference:",y)}}),[d,x]),v=o.useCallback((j,S,y)=>g(null,null,function*(){if(d)try{yield qe.trackUserBehavior(d.id,j,S,y)}catch(P){console.error("Error tracking user behavior:",P)}}),[d]),k=o.useCallback(j=>{c(j)},[]);return o.useEffect(()=>{x()},[x]),{recommendations:a,loading:t,error:i,limit:l,fetchRecommendations:x,refreshRecommendations:p,updateUserPreference:R,trackUserBehavior:v,changeLimit:k}},Hs=({recommendation:a})=>{const s=r=>({artist:e.jsx(me,{className:"h-4 w-4"}),event:e.jsx(Se,{className:"h-4 w-4"}),post:e.jsx(Z,{className:"h-4 w-4"}),group:e.jsx(Z,{className:"h-4 w-4"}),business:e.jsx(Fe,{className:"h-4 w-4"})})[r]||e.jsx(Ge,{className:"h-4 w-4"}),t=r=>Math.round(r*100);return e.jsx(O,{className:"hover:shadow-md transition-shadow border-l-4 border-l-primary",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(oe,{className:"h-12 w-12",children:e.jsx(de,{children:a.contentType.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s(a.contentType),e.jsx(z,{variant:"secondary",className:"text-xs",children:a.contentType}),e.jsxs(z,{variant:"outline",className:"text-xs text-blue-600",children:[t(a.score),"% match"]}),e.jsx("h3",{className:"font-semibold truncate",children:"Recommended Content"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:a.reason}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"h-3 w-3"}),a.algorithm]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),Le(new Date(a.createdAt),"MMM dd, yyyy")]})]}),a.metadata&&e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[a.metadata.relevanceScore&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"h-3 w-3"}),Math.round(a.metadata.relevanceScore*100),"% relevant"]}),a.metadata.popularityScore&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),Math.round(a.metadata.popularityScore*100),"% popular"]}),a.metadata.freshnessScore&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),Math.round(a.metadata.freshnessScore*100),"% fresh"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(b,{variant:"outline",size:"sm",children:"View"}),e.jsx(b,{variant:"ghost",size:"sm",children:e.jsx(Me,{className:"h-3 w-3"})})]})]})})})},Js=()=>{const{recommendations:a,loading:s,error:t,refreshRecommendations:r}=Qs();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recommended for You"}),e.jsx("p",{className:"text-muted-foreground",children:"Personalized content based on your interests and behavior"})]}),e.jsxs(b,{variant:"outline",onClick:r,disabled:s,children:[e.jsx(ns,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"Refresh"]})]}),t&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:e.jsx("p",{className:"text-destructive text-sm",children:t})}),s&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading recommendations..."})]}),!s&&a.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ge,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No recommendations yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Start exploring content to get personalized recommendations"})]}),e.jsx("div",{className:"grid gap-4",children:a.map(i=>e.jsx(Hs,{recommendation:i},i.id))})]})},Ks=({suggestion:a})=>{const{followUser:s,loading:t}=ds(),r=()=>g(null,null,function*(){yield s(a.userId)});return e.jsx(O,{className:"hover:shadow-md transition-shadow",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(oe,{className:"h-12 w-12",children:[e.jsx(he,{src:a.avatarUrl}),e.jsx(de,{children:a.displayName.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold truncate",children:a.displayName}),e.jsxs(z,{variant:"outline",className:"text-xs",children:[Math.round(a.score),"% match"]})]}),a.bio&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:a.bio}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[a.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),a.location.city,", ",a.location.state]}),a.mutualFollowers>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),a.mutualFollowers," mutual"]})]}),a.commonInterests.length>0&&e.jsx("div",{className:"flex gap-1 mb-2",children:a.commonInterests.slice(0,3).map((i,n)=>e.jsx(z,{variant:"outline",className:"text-xs",children:i},n))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.reason})]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:r,disabled:t,children:[e.jsx(Qe,{className:"h-3 w-3 mr-1"}),"Follow"]})]})})})},Ys=()=>{const{suggestions:a,loading:s,error:t,fetchSuggestions:r}=ds();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"People to Follow"}),e.jsx("p",{className:"text-muted-foreground",children:"Discover people with similar interests"})]}),e.jsxs(b,{variant:"outline",onClick:r,disabled:s,children:[e.jsx(ns,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"Refresh"]})]}),t&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:e.jsx("p",{className:"text-destructive text-sm",children:t})}),s&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading suggestions..."})]}),!s&&a.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No suggestions yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Start following people to get personalized suggestions"})]}),e.jsx("div",{className:"grid gap-4",children:a.map(i=>e.jsx(Ks,{suggestion:i},i.userId))})]})},Ne=({user:a,onFollow:s,onMessage:t,onViewProfile:r,onShare:i,onEdit:n,onContact:l,showActions:c=!0,showStats:d=!0,showSocialLinks:x=!1,showSkills:p=!1,showInterests:R=!1,className:v,variant:k="default",loading:j=!1,error:S=null,animate:y=!0,interactive:P=!0})=>{var re;const[D,H]=o.useState(a.isFollowing||!1),[N,E]=o.useState(!1),[U,L]=o.useState(S),[m,T]=o.useState(!1),[h,C]=o.useState(!1),[f,I]=o.useState(0),ee=o.useCallback(()=>{C(!h),I(F=>h?F-1:F+1)},[h]),ae=o.useCallback(F=>{T(F)},[]),V=o.useMemo(()=>a.name?a.name:"Anonymous User",[a.name]),ne=o.useMemo(()=>a.bio?a.bio:null,[a.bio]),J=o.useMemo(()=>a.location?a.location:null,[a.location]),ue=o.useMemo(()=>V.charAt(0).toUpperCase(),[V]),se=o.useMemo(()=>a.verified===!0,[a.verified]),u=o.useMemo(()=>a.isOnline===!0,[a.isOnline]),w=o.useMemo(()=>a.isPremium===!0,[a.isPremium]);o.useMemo(()=>a.isFeatured===!0,[a.isFeatured]);const q=o.useCallback(()=>g(null,null,function*(){if(!(!s||N))try{E(!0),L(null),yield s(a.id),H(!D)}catch(F){L(F instanceof Error?F.message:"Failed to follow user")}finally{E(!1)}}),[s,a.id,D,N]),ce=o.useCallback(()=>g(null,null,function*(){if(!(!t||N))try{E(!0),L(null),yield t(a.id)}catch(F){L(F instanceof Error?F.message:"Failed to send message")}finally{E(!1)}}),[t,a.id,N]),Ae=o.useCallback(()=>g(null,null,function*(){if(!(!r||N))try{E(!0),L(null),yield r(a.id)}catch(F){L(F instanceof Error?F.message:"Failed to view profile")}finally{E(!1)}}),[r,a.id,N]),_=o.useCallback(()=>g(null,null,function*(){if(!(!i||N))try{E(!0),L(null),yield i(a.id)}catch(F){L(F instanceof Error?F.message:"Failed to share profile")}finally{E(!1)}}),[i,a.id,N]),A=o.useCallback(()=>g(null,null,function*(){if(!(!n||N))try{E(!0),L(null),yield n(a.id)}catch(F){L(F instanceof Error?F.message:"Failed to edit profile")}finally{E(!1)}}),[n,a.id,N]),W=o.useCallback(()=>g(null,null,function*(){if(!(!l||N))try{E(!0),L(null),yield l(a.id)}catch(F){L(F instanceof Error?F.message:"Failed to contact user")}finally{E(!1)}}),[l,a.id,N]);if(j)return e.jsxs(O,{className:Q("w-full animate-pulse",v),"data-testid":"loading-skeleton",children:[e.jsx(ie,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-32"}),e.jsx("div",{className:"h-3 bg-muted rounded w-24"})]})]})}),e.jsxs($,{className:"space-y-3",children:[e.jsx("div",{className:"h-3 bg-muted rounded w-full"}),e.jsx("div",{className:"h-3 bg-muted rounded w-3/4"})]})]});const K=U&&e.jsxs("div",{className:"mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-destructive",children:[e.jsx(Ds,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Error loading profile"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:U})]});return k==="minimal"?e.jsx(O,{className:Q("w-full transition-all duration-200",P&&"hover:shadow-md cursor-pointer",y&&"animate-in fade-in-0 slide-in-from-bottom-2",v),onMouseEnter:()=>P&&T(!0),onMouseLeave:()=>P&&T(!1),"data-testid":"enhanced-user-profile-card-minimal",children:e.jsx($,{className:"p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(oe,{className:"h-10 w-10",children:[e.jsx(he,{src:a.avatar,alt:V}),e.jsx(de,{className:"text-sm",children:ue})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:V}),se&&e.jsx(ge,{className:"h-3 w-3 text-blue-500 flex-shrink-0","data-testid":"verified-badge"}),u&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full","data-testid":"online-indicator"})]}),J&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate flex items-center",children:[e.jsx(we,{className:"h-3 w-3 mr-1"}),J]})]})]})})}):k==="compact"?e.jsx(O,{className:Q("w-full transition-all duration-200",P&&"hover:shadow-md",y&&"animate-in fade-in-0 slide-in-from-bottom-2",v),"data-testid":"enhanced-user-profile-card-compact",children:e.jsxs($,{className:"p-4",children:[K,e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(oe,{className:"h-12 w-12",children:[e.jsx(he,{src:a.avatar,alt:V}),e.jsx(de,{children:ue})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-semibold text-sm truncate",children:V}),se&&e.jsx(ge,{className:"h-4 w-4 text-blue-500 flex-shrink-0","data-testid":"verified-badge"}),u&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full","data-testid":"online-indicator"}),w&&e.jsx(me,{className:"h-4 w-4 text-yellow-500 flex-shrink-0","data-testid":"premium-badge"})]}),ne&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:ne}),J&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate flex items-center",children:[e.jsx(we,{className:"h-3 w-3 mr-1"}),J]})]}),c&&e.jsx(b,{size:"sm",variant:D?"outline":"default",onClick:q,disabled:N,className:"flex-shrink-0",children:D?"Following":"Follow"})]})]})}):k==="default"?e.jsxs(O,{className:Q("w-full transition-all duration-200",P&&"hover:shadow-md hover:scale-[1.02]",y&&"animate-in fade-in-0 slide-in-from-bottom-2",m&&"shadow-lg ring-2 ring-primary/20",v),"data-testid":"enhanced-user-profile-card-default",onMouseEnter:()=>ae(!0),onMouseLeave:()=>ae(!1),children:[K,e.jsx(ie,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(oe,{className:"h-20 w-20",children:[e.jsx(he,{src:a.avatar,alt:V}),e.jsx(de,{className:"text-lg",children:ue})]}),u&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-background","data-testid":"online-indicator"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-xl font-bold",children:V}),se&&e.jsx(ge,{className:"h-5 w-5 text-blue-500","data-testid":"verified-badge"}),((re=a.badges)==null?void 0:re.includes("trending"))&&e.jsx(be,{className:"h-5 w-5 text-orange-500","data-testid":"trending-badge"}),w&&e.jsx(me,{className:"h-5 w-5 text-yellow-500","data-testid":"premium-badge"})]}),ne&&e.jsx("p",{className:"text-muted-foreground",children:ne}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[J&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:J})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{children:a.email})]})]})]})]}),c&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(b,{variant:D?"outline":"default",onClick:q,disabled:N,className:"flex-shrink-0","aria-label":`${D?"Unfollow":"Follow"} ${V}`,children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),D?"Following":"Follow",N&&e.jsx("span",{"data-testid":"loading-indicator",className:"ml-2",children:"..."})]}),e.jsxs(b,{variant:"outline",onClick:ce,disabled:N,className:"flex-shrink-0",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Message"]}),n&&e.jsxs(b,{variant:"ghost",size:"sm",onClick:A,disabled:N,className:"flex-shrink-0","aria-label":"Edit profile",children:[e.jsx(Ns,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Edit"})]}),e.jsxs(b,{variant:"ghost",size:"sm",onClick:_,disabled:N,className:"flex-shrink-0","aria-label":"Share profile",children:[e.jsx(is,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Share"})]})]})]})}),e.jsxs($,{className:"space-y-4",children:[p&&a.skills&&a.skills.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.skills.map((F,xe)=>e.jsxs(z,{variant:"secondary",children:[e.jsx(bs,{className:"h-3 w-3 mr-1"}),F]},xe))})]}),d&&(a.followersCount!==void 0||a.followingCount!==void 0)&&e.jsxs("div",{className:"flex items-center space-x-6 py-4 border-t",children:[a.followersCount!==void 0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:a.followersCount.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Followers"})]}),a.followingCount!==void 0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:a.followingCount.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Following"})]}),a.eventsCount!==void 0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:a.eventsCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Events"})]})]}),x&&a.socialLinks&&e.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t",children:[a.socialLinks.twitter&&e.jsx(b,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs("a",{href:a.socialLinks.twitter,target:"_blank",rel:"noopener noreferrer","aria-label":"Twitter",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Twitter"})]})}),a.socialLinks.linkedin&&e.jsx(b,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs("a",{href:a.socialLinks.linkedin,target:"_blank",rel:"noopener noreferrer","aria-label":"LinkedIn",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"LinkedIn"})]})}),a.socialLinks.github&&e.jsx(b,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs("a",{href:a.socialLinks.github,target:"_blank",rel:"noopener noreferrer","aria-label":"GitHub",children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"GitHub"})]})}),a.socialLinks.website&&e.jsx(b,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs("a",{href:a.socialLinks.website,target:"_blank",rel:"noopener noreferrer","aria-label":"Website",children:[e.jsx(Cs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Website"})]})}),a.socialLinks.phone&&e.jsxs(b,{variant:"ghost",size:"sm",onClick:W,"aria-label":"Phone",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Phone"})]})]}),r&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(b,{variant:"outline",onClick:Ae,disabled:N,className:"w-full",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"View Full Profile"]})}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(b,{variant:"ghost",size:"sm",onClick:ee,className:Q("w-full transition-all duration-200",h&&"text-red-500 hover:text-red-600"),children:[e.jsx(Me,{className:Q("h-4 w-4 mr-2 transition-all duration-200",h&&"fill-current")}),h?"Liked":"Like"," ",f>0&&`(${f})`]})})]})]}):k==="enterprise"?e.jsxs(O,{className:Q("relative overflow-hidden border-2 border-slate-200 bg-gradient-to-br from-slate-50 to-slate-100 shadow-xl","hover:shadow-2xl hover:border-slate-300 transition-all duration-300",v),children:[e.jsx("div",{className:"absolute top-0 right-0 bg-slate-800 text-white px-3 py-1 text-xs font-bold rounded-bl-lg",children:"ENTERPRISE"}),e.jsxs($,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(oe,{className:"h-20 w-20 border-4 border-slate-200",children:[e.jsx(he,{src:a.avatar,alt:a.name}),e.jsx(de,{className:"text-lg font-bold bg-slate-700 text-white",children:a.name.split(" ").map(F=>F[0]).join("")})]}),a.isOnline&&e.jsx("div",{className:"absolute -bottom-1 -right-1 h-6 w-6 bg-green-500 border-4 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 truncate",children:a.name}),a.verified&&e.jsxs(z,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"Verified"]})]}),a.bio&&e.jsx("p",{className:"text-slate-600 text-sm mb-3 line-clamp-2",children:a.bio}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:a.eventsCount||0}),e.jsx("div",{className:"text-xs text-slate-500",children:"Events"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:a.projectsCount||0}),e.jsx("div",{className:"text-xs text-slate-500",children:"Projects"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:a.followersCount||0}),e.jsx("div",{className:"text-xs text-slate-500",children:"Followers"})]})]}),p&&a.skills&&a.skills.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Key Skills"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.skills.slice(0,4).map((F,xe)=>e.jsx(z,{variant:"outline",className:"text-xs bg-slate-100 border-slate-300",children:F},xe)),a.skills.length>4&&e.jsxs(z,{variant:"outline",className:"text-xs bg-slate-100 border-slate-300",children:["+",a.skills.length-4," more"]})]})]})]})]}),c&&e.jsxs("div",{className:"flex space-x-2 mt-4 pt-4 border-t border-slate-200",children:[e.jsxs(b,{size:"sm",className:"flex-1 bg-slate-800 hover:bg-slate-900",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"View Profile"]}),e.jsxs(b,{size:"sm",variant:"outline",className:"border-slate-300",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Contact"]})]})]})]}):k==="dark"?e.jsxs(O,{className:Q("relative overflow-hidden border border-slate-700 bg-gradient-to-br from-slate-900 to-slate-800 text-white shadow-2xl","hover:shadow-slate-900/50 hover:border-slate-600 transition-all duration-300",v),children:[e.jsx("div",{className:"absolute top-0 right-0 bg-slate-600 text-slate-200 px-3 py-1 text-xs font-bold rounded-bl-lg",children:"DARK"}),e.jsx($,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(oe,{className:"h-20 w-20 border-4 border-slate-600 ring-2 ring-slate-500",children:[e.jsx(he,{src:a.avatar,alt:V}),e.jsx(de,{className:"bg-slate-700 text-slate-200 text-xl font-bold",children:V.charAt(0)})]}),a.isOnline&&e.jsx("div",{className:"absolute -bottom-1 -right-1 h-5 w-5 bg-green-500 border-2 border-slate-800 rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-white truncate",children:V}),a.verified&&e.jsxs(z,{className:"bg-blue-600 text-white text-xs",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"Verified"]}),a.isPremium&&e.jsxs(z,{className:"bg-amber-600 text-white text-xs",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"Premium"]})]}),ne&&e.jsx("p",{className:"text-slate-300 text-sm mb-3 line-clamp-2",children:ne}),J&&e.jsxs("div",{className:"flex items-center text-slate-400 text-sm mb-3",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),J]})]})}),d&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:a.followersCount||0}),e.jsx("div",{className:"text-xs text-slate-400",children:"Followers"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:a.followingCount||0}),e.jsx("div",{className:"text-xs text-slate-400",children:"Following"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:a.eventsCount||0}),e.jsx("div",{className:"text-xs text-slate-400",children:"Events"})]})]}),p&&a.skills&&a.skills.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Skills"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.skills.slice(0,3).map((F,xe)=>e.jsx(z,{variant:"secondary",className:"bg-slate-700 text-slate-200 border-slate-600",children:F},xe)),a.skills.length>3&&e.jsxs(z,{variant:"secondary",className:"bg-slate-700 text-slate-200 border-slate-600",children:["+",a.skills.length-3," more"]})]})]}),c&&e.jsxs("div",{className:"flex gap-2",children:[s&&e.jsxs(b,{variant:a.isFollowing?"default":"outline",size:"sm",onClick:q,disabled:N,className:Q("flex-1",a.isFollowing?"bg-slate-600 hover:bg-slate-700 text-white":"border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white"),children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),a.isFollowing?"Following":"Follow"]}),t&&e.jsxs(b,{variant:"outline",size:"sm",onClick:ce,disabled:N,className:"border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Message"]})]})]})]})})]}):null},Xs=({users:a,variant:s="default",layout:t="grid",showSearch:r=!0,showFilters:i=!0,showTabs:n=!0,className:l,loading:c=!1,error:d=null,onUserAction:x,onFollow:p,onMessage:R,onViewProfile:v,onShare:k,onEdit:j,onContact:S})=>{const[y,P]=o.useState(""),[D,H]=o.useState("all"),[N,E]=o.useState("name"),[U,L]=o.useState(!1),[m,T]=o.useState(!1),[h,C]=o.useState(!1),f=o.useMemo(()=>{let u=a;switch(y.trim()&&(u=u.filter(w=>{var q,ce;return w.name.toLowerCase().includes(y.toLowerCase())||((q=w.bio)==null?void 0:q.toLowerCase().includes(y.toLowerCase()))||((ce=w.location)==null?void 0:ce.toLowerCase().includes(y.toLowerCase()))})),D){case"verified":u=u.filter(w=>w.verified);break;case"online":u=u.filter(w=>w.isOnline);break;case"premium":u=u.filter(w=>w.isPremium);break;case"trending":u=u.filter(w=>{var q;return(q=w.badges)==null?void 0:q.includes("trending")});break;case"featured":u=u.filter(w=>w.isFeatured);break}return U&&(u=u.filter(w=>w.verified)),m&&(u=u.filter(w=>w.isOnline)),h&&(u=u.filter(w=>w.isPremium)),u.sort((w,q)=>{switch(N){case"name":return w.name.localeCompare(q.name);case"followers":return(q.followersCount||0)-(w.followersCount||0);case"rating":return(q.rating||0)-(w.rating||0);case"recent":return new Date(q.joinDate||"").getTime()-new Date(w.joinDate||"").getTime();default:return 0}}),u},[a,y,D,N,U,m,h]),I=o.useCallback((u,w,q)=>g(null,null,function*(){if(x)try{yield x(u,w,q)}catch(ce){console.error(`Failed to perform action ${w}:`,ce)}}),[x]),ee=o.useCallback(u=>g(null,null,function*(){p&&(yield p(u)),yield I(u,"follow")}),[p,I]),ae=o.useCallback(u=>g(null,null,function*(){R&&(yield R(u)),yield I(u,"message")}),[R,I]),V=o.useCallback(u=>g(null,null,function*(){v&&(yield v(u)),yield I(u,"view_profile")}),[v,I]),ne=o.useCallback(u=>g(null,null,function*(){k&&(yield k(u)),yield I(u,"share")}),[k,I]),J=o.useCallback(u=>g(null,null,function*(){j&&(yield j(u)),yield I(u,"edit")}),[j,I]),ue=o.useCallback(u=>g(null,null,function*(){S&&(yield S(u)),yield I(u,"contact")}),[S,I]);if(c)return e.jsx("div",{className:Q("space-y-4",l),children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((u,w)=>e.jsxs(O,{className:"animate-pulse",children:[e.jsx(ie,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-32"}),e.jsx("div",{className:"h-3 bg-muted rounded w-24"})]})]})}),e.jsxs($,{className:"space-y-3",children:[e.jsx("div",{className:"h-3 bg-muted rounded w-full"}),e.jsx("div",{className:"h-3 bg-muted rounded w-3/4"})]})]},w))})});if(d)return e.jsx(O,{className:Q("w-full",l),children:e.jsx($,{className:"p-6 text-center",children:e.jsxs("div",{className:"text-destructive",children:[e.jsx(Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Users"}),e.jsx("p",{className:"text-muted-foreground",children:d})]})})});if(f.length===0)return e.jsx(O,{className:Q("w-full",l),children:e.jsx($,{className:"p-6 text-center",children:e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx(Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Users Found"}),e.jsx("p",{className:"mb-4",children:y?`No users match "${y}"`:"No users available"}),y&&e.jsx(b,{variant:"outline",onClick:()=>P(""),children:"Clear Search"})]})})});const se=()=>{const u=f.map(w=>e.jsx(Ne,{user:w,variant:s,onFollow:ee,onMessage:ae,onViewProfile:V,onShare:ne,onEdit:J,onContact:ue,showActions:!0,showStats:s!=="minimal",showSocialLinks:s==="detailed"||s==="premium"||s==="featured",showSkills:s==="detailed"||s==="premium"||s==="featured",showInterests:s==="featured",animate:!0,interactive:!0},w.id));switch(t){case"grid":return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:u});case"list":return e.jsx("div",{className:"space-y-3",children:u});case"cards":return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:u});case"enterprise":return e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:a.map(w=>e.jsx(Ne,{user:w,variant:"enterprise",showActions:!0,showStats:!0,showSkills:!0,onFollow:p,onMessage:R,onViewProfile:v,onShare:k,onEdit:j,onContact:S,className:"h-full"},w.id))});case"dark":return e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:a.map(w=>e.jsx(Ne,{user:w,variant:"dark",showActions:!0,showStats:!0,showSkills:!0,onFollow:p,onMessage:R,onViewProfile:v,onShare:k,onEdit:j,onContact:S,className:"h-full"},w.id))});default:return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u})}};return e.jsxs("div",{className:Q("space-y-6",l),children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Users"}),e.jsxs("p",{className:"text-muted-foreground",children:[f.length," of ",a.length," users"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{variant:t==="grid"?"default":"outline",size:"sm",onClick:()=>E("name"),children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx(b,{variant:t==="list"?"default":"outline",size:"sm",onClick:()=>E("name"),children:e.jsx(Fs,{className:"h-4 w-4"})})]})]}),(r||i)&&e.jsxs(O,{children:[e.jsx(ie,{children:e.jsx(fe,{className:"text-lg",children:"Search & Filters"})}),e.jsxs($,{className:"space-y-4",children:[r&&e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search users by name, bio, or location...",value:y,onChange:u=>P(u.target.value),className:"pl-10"})]}),i&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(b,{variant:U?"default":"outline",size:"sm",onClick:()=>L(!U),children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Verified"]}),e.jsxs(b,{variant:m?"default":"outline",size:"sm",onClick:()=>T(!m),children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Online"]}),e.jsxs(b,{variant:h?"default":"outline",size:"sm",onClick:()=>C(!h),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Premium"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Sort by:"}),e.jsxs("select",{value:N,onChange:u=>E(u.target.value),className:"px-3 py-1 border rounded-md text-sm",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"followers",children:"Followers"}),e.jsx("option",{value:"rating",children:"Rating"}),e.jsx("option",{value:"recent",children:"Recently Joined"})]})]})]})]}),n&&e.jsxs(Ye,{value:D,onValueChange:H,children:[e.jsxs(Xe,{className:"grid w-full grid-cols-6",children:[e.jsx(Y,{value:"all",children:"All"}),e.jsxs(Y,{value:"verified",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Verified"]}),e.jsxs(Y,{value:"online",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Online"]}),e.jsxs(Y,{value:"premium",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Premium"]}),e.jsxs(Y,{value:"trending",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Trending"]}),e.jsxs(Y,{value:"featured",children:[e.jsx(Ms,{className:"h-4 w-4 mr-2"}),"Featured"]})]}),e.jsx(X,{value:"all",className:"mt-6",children:se()}),e.jsx(X,{value:"verified",className:"mt-6",children:se()}),e.jsx(X,{value:"online",className:"mt-6",children:se()}),e.jsx(X,{value:"premium",className:"mt-6",children:se()}),e.jsx(X,{value:"trending",className:"mt-6",children:se()}),e.jsx(X,{value:"featured",className:"mt-6",children:se()})]}),!n&&se()]})};function Zs({users:a,variant:s="default",onReorder:t,onUserAction:r,onFollow:i,onMessage:n,onViewProfile:l,onShare:c,onEdit:d,onContact:x,className:p,showDragHandles:R=!0,allowReordering:v=!0}){const[k,j]=o.useState(a),[S,y]=o.useState(null),[P,D]=o.useState(null),H=o.useCallback((h,C)=>{if(!v)return;y(C),h.dataTransfer&&(h.dataTransfer.effectAllowed="move",h.dataTransfer.setData("text/html",C.toString()));const f=h.target;f.style.opacity="0.5"},[v]),N=o.useCallback((h,C)=>{!v||S===null||(h.preventDefault(),h.dataTransfer&&(h.dataTransfer.dropEffect="move"),P!==C&&D(C))},[v,S,P]),E=o.useCallback(h=>{h.preventDefault(),D(null)},[]),U=o.useCallback((h,C)=>{if(!v||S===null)return;h.preventDefault();const f=[...k],[I]=f.splice(S,1);f.splice(C,0,I),j(f),y(null),D(null);const ee=h.target;ee.style.opacity="1",t==null||t(f)},[v,S,k,t]),L=o.useCallback(h=>{y(null),D(null);const C=h.target;C.style.opacity="1"},[]),m=o.useCallback(()=>{const h=[...k].sort(()=>Math.random()-.5);j(h),t==null||t(h)},[k,t]),T=o.useCallback(()=>{j(a),t==null||t(a)},[a,t]);return e.jsxs("div",{className:Q("space-y-4",p),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[k.length," users"]}),v&&e.jsx(z,{variant:"secondary",className:"text-xs",children:"Drag to reorder"})]}),v&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:m,className:"text-xs",children:[e.jsx(Es,{className:"h-3 w-3 mr-1"}),"Shuffle"]}),e.jsx(b,{variant:"outline",size:"sm",onClick:T,className:"text-xs",children:"Reset"})]})]}),e.jsx("div",{className:"space-y-3",children:k.map((h,C)=>e.jsx(O,G(B({className:Q("transition-all duration-200 cursor-move","hover:shadow-md hover:scale-[1.01]",S===C&&"opacity-50 scale-95",P===C&&"ring-2 ring-primary/50 ring-offset-2",!v&&"cursor-default")},v?{draggable:!0}:{}),{onDragStart:f=>H(f,C),onDragOver:f=>N(f,C),onDragLeave:E,onDrop:f=>U(f,C),onDragEnd:L,"data-testid":"user-card",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[R&&v&&e.jsx("div",{className:"flex-shrink-0 text-muted-foreground hover:text-foreground transition-colors","data-testid":"drag-handle",children:e.jsx(ls,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Ne,{user:h,variant:s,showActions:!0,showStats:!1,showSkills:!1,onFollow:i,onMessage:n,onViewProfile:l,onShare:c,onEdit:d,onContact:x,className:"border-0 shadow-none p-0"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs(z,{variant:"outline",className:"text-xs",children:["#",C+1]})})]})})}),h.id))})]})}function et({users:a,variant:s="default",height:t=600,itemHeight:r=120,onUserAction:i,onFollow:n,onMessage:l,onViewProfile:c,onShare:d,onEdit:x,onContact:p,className:R,showSearch:v=!0,showFilters:k=!0,showSorting:j=!0,enableVirtualization:S=!0}){const[y,P]=o.useState(a),[D,H]=o.useState(a),[N,E]=o.useState(""),[U,L]=o.useState("name"),[m,T]=o.useState("asc"),[h,C]=o.useState(new Set),f=o.useRef(null),[I,ee]=o.useState(0),ae=o.useMemo(()=>{let _=[...a];if(N){const A=N.toLowerCase();_=_.filter(W=>{var K,re,F;return W.name.toLowerCase().includes(A)||((K=W.bio)==null?void 0:K.toLowerCase().includes(A))||((re=W.location)==null?void 0:re.toLowerCase().includes(A))||((F=W.skills)==null?void 0:F.some(xe=>xe.toLowerCase().includes(A)))})}return h.size>0&&(_=_.filter(A=>!(h.has("verified")&&!A.verified||h.has("premium")&&!A.isPremium||h.has("featured")&&!A.isFeatured||h.has("online")&&!A.isOnline))),_.sort((A,W)=>{let K,re;switch(U){case"name":K=A.name.toLowerCase(),re=W.name.toLowerCase();break;case"followers":K=A.followersCount||0,re=W.followersCount||0;break;case"joinDate":K=new Date(A.joinDate||"").getTime(),re=new Date(W.joinDate||"").getTime();break;case"rating":K=A.rating||0,re=W.rating||0;break;default:return 0}return m==="asc"?K>re?1:-1:K<re?1:-1}),_},[a,N,h,U,m]);o.useEffect(()=>{H(ae)},[ae]);const V=D.length*r,ne=Math.ceil(t/r)+2,J=Math.max(0,Math.floor(I/r)),ue=Math.min(D.length,J+ne),se=S?D.slice(J,ue):D,u=o.useCallback(_=>{S&&ee(_.currentTarget.scrollTop)},[S]),w=o.useCallback(_=>{E(_)},[]),q=o.useCallback(_=>{C(A=>{const W=new Set(A);return W.has(_)?W.delete(_):W.add(_),W})},[]),ce=o.useCallback(_=>{U===_?T(A=>A==="asc"?"desc":"asc"):(L(_),T("asc"))},[U]),Ae=o.useCallback((_,A)=>{const W=S?J+A:A,K=S?W*r:0;return e.jsx("div",{className:"w-full",style:S?{position:"absolute",top:K,height:r}:void 0,children:e.jsx(O,{className:"h-full mx-2 mb-2 transition-all duration-200 hover:shadow-md",children:e.jsx($,{className:"p-4",children:e.jsx(Ne,{user:_,variant:s,showActions:!0,showStats:!1,showSkills:!1,onFollow:n,onMessage:l,onViewProfile:c,onShare:d,onEdit:x,onContact:p,className:"border-0 shadow-none p-0"})})})},_.id)},[J,r,S,s,n,l,c,d,x,p]);return e.jsxs("div",{className:Q("space-y-4",R),children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[D.length," of ",a.length," users"]}),S&&e.jsx(z,{variant:"secondary",className:"text-xs",children:"Virtualized"})]})}),v&&e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search users by name, bio, location, or skills...",value:N,onChange:_=>w(_.target.value),className:"pl-10"})]}),(k||j)&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[k&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Filters:"}),["verified","premium","featured","online"].map(_=>e.jsxs(b,{variant:h.has(_)?"default":"outline",size:"sm",onClick:()=>q(_),className:"text-xs capitalize",children:[e.jsx(rs,{className:"h-3 w-3 mr-1"}),_]},_))]}),j&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground ml-4",children:"Sort by:"}),[{key:"name",label:"Name"},{key:"followers",label:"Followers"},{key:"joinDate",label:"Join Date"},{key:"rating",label:"Rating"}].map(({key:_,label:A})=>e.jsxs(b,{variant:U===_?"default":"outline",size:"sm",onClick:()=>ce(_),className:"text-xs",children:[A,U===_&&(m==="asc"?e.jsx(Ls,{className:"h-3 w-3 ml-1"}):e.jsx(As,{className:"h-3 w-3 ml-1"}))]},_))]})]})]}),e.jsx("div",{ref:f,className:"border rounded-lg",style:{height:t},children:e.jsx(Us,{className:"h-full",onScroll:u,children:e.jsx("div",{className:"relative w-full",style:{height:S?V:"auto"},children:se.map((_,A)=>Ae(_,A))})})})]})}const Nt=()=>{const{toast:a}=Is(),{currentLocation:s}=os(),[t,r]=o.useState("search"),[i,n]=o.useState([]),[l,c]=o.useState([]),[d,x]=o.useState([]),[p,R]=o.useState(!0),[v,k]=o.useState([]),j=o.useCallback(()=>g(null,null,function*(){try{R(!0);const{data:m,error:T}=yield M.functions.invoke("fetch-local-news",{body:{location:s?"Your Area":"Local Area",latitude:s==null?void 0:s.latitude,longitude:s==null?void 0:s.longitude,radius:50}});T?(console.error("Error fetching news:",T),n([{title:"Local Community Updates",description:"Stay connected with your local community and discover what's happening around you.",url:"#",source:"Local News",publishedAt:new Date().toISOString(),category:"General"},{title:"Community Events This Week",description:"Find exciting events and activities happening in your neighborhood this week.",url:"#",source:"Community Events",publishedAt:new Date(Date.now()-7200*1e3).toISOString(),category:"Events"}])):m&&m.news?n(m.news.slice(0,5)):n([{title:"Local Community Updates",description:"Stay connected with your local community and discover what's happening around you.",url:"#",source:"Local News",publishedAt:new Date().toISOString(),category:"General"},{title:"Community Events This Week",description:"Find exciting events and activities happening in your neighborhood this week.",url:"#",source:"Community Events",publishedAt:new Date(Date.now()-7200*1e3).toISOString(),category:"Events"}]);try{const{data:h}=yield M.from("events").select("*").gte("event_date",new Date().toISOString().split("T")[0]).order("event_date",{ascending:!0}).limit(6);h&&c(h.map(C=>({id:C.id,title:C.title,description:C.description,location:C.location_name,date:C.event_date,category:C.category,price:C.price?`$${C.price}`:"Free"})))}catch(h){console.error("Error fetching events:",h),c([{id:"1",title:"Community Meetup",description:"Join us for a friendly community gathering",location:"Local Community Center",date:new Date(Date.now()+10080*60*1e3).toISOString(),category:"Community",price:"Free"}])}}catch(m){console.error("Error fetching local content:",m),a({title:"Error",description:"Failed to load local content",variant:"destructive"})}finally{R(!1)}}),[s,a]),S=o.useCallback(()=>g(null,null,function*(){try{const{data:m}=yield M.from("events").select(`
          id,
          title,
          description,
          category,
          max_attendees,
          event_date,
          image_url
        `).gte("event_date",new Date().toISOString().split("T")[0]).order("max_attendees",{ascending:!1}).limit(3),{data:T}=yield M.from("artists").select(`
          id,
          user_id,
          specialty,
          bio
        `).eq("is_available",!0).limit(3),{data:h}=yield M.from("posts").select(`
          id,
          user_id,
          title,
          content,
          type,
          likes_count
        `).eq("status","active").order("likes_count",{ascending:!1}).limit(3),C=[...(m==null?void 0:m.map(f=>({id:f.id,type:"event",title:f.title,description:f.description,engagement:f.max_attendees||0,image:f.image_url})))||[],...(T==null?void 0:T.map(f=>{var I;return{id:f.id,type:"artist",title:"Artist Profile",description:f.bio||((I=f.specialty)==null?void 0:I.join(", "))||"",engagement:0,image:void 0}}))||[],...(h==null?void 0:h.map(f=>({id:f.id,type:"post",title:f.title||"Untitled Post",description:f.content.substring(0,100)+"...",engagement:f.likes_count||0,image:void 0})))||[]];x(C)}catch(m){console.error("Error fetching trending content:",m)}}),[]),y=o.useCallback(()=>g(null,null,function*(){try{k([{id:"user-1",name:"Sarah Johnson",email:"sarah@example.com",avatar:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=200&h=200&fit=crop&crop=face",bio:"Event organizer and community builder passionate about bringing people together",location:"San Francisco, CA",verified:!0,followersCount:2341,followingCount:189,isFollowing:!1,isOnline:!0,badges:["trending"],skills:["Event Planning","Community Management","Marketing"],interests:["Community","Events","Networking"],joinDate:"2021-08-15",eventsCount:23,projectsCount:12,isPremium:!0,isFeatured:!1},{id:"user-2",name:"Michael Chen",email:"michael@example.com",avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face",bio:"Tech entrepreneur and startup mentor helping others build successful businesses",location:"Austin, TX",verified:!0,followersCount:5678,followingCount:234,isFollowing:!0,isOnline:!1,badges:["trending"],skills:["Startup Strategy","Product Development","Investor Relations"],interests:["Technology","Business","Innovation"],joinDate:"2020-12-01",eventsCount:45,projectsCount:18,isPremium:!0,isFeatured:!0},{id:"user-3",name:"Emma Rodriguez",email:"emma@example.com",avatar:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop&crop=face",bio:"Creative designer and artist exploring the intersection of art and technology",location:"Portland, OR",verified:!1,followersCount:892,followingCount:456,isFollowing:!1,isOnline:!0,badges:[],skills:["UI/UX Design","Digital Art","Creative Direction"],interests:["Art","Design","Technology"],joinDate:"2023-01-20",eventsCount:8,projectsCount:5,isPremium:!1,isFeatured:!1},{id:"user-4",name:"David Kim",email:"david@example.com",avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop&crop=face",bio:"Fitness coach and wellness advocate promoting healthy lifestyles",location:"Miami, FL",verified:!0,followersCount:3456,followingCount:123,isFollowing:!1,isOnline:!1,badges:["trending"],skills:["Personal Training","Nutrition","Wellness Coaching"],interests:["Fitness","Health","Wellness"],joinDate:"2022-06-10",eventsCount:32,projectsCount:14,isPremium:!0,isFeatured:!1}])}catch(m){console.error("Error fetching discovered users:",m),a({title:"Error",description:"Failed to load discovered users",variant:"destructive"})}}),[a]);o.useEffect(()=>{j(),S(),y()},[j,S,y]);const P=o.useCallback((m,T,h)=>g(null,null,function*(){switch(console.log(`User action: ${T} for user ${m}`,h),T){case"follow":a({title:"Success",description:"You are now following this user"});break;case"message":a({title:"Message",description:"Opening message composer..."});break;case"view_profile":a({title:"Profile",description:"Navigating to user profile..."});break;case"share":a({title:"Share",description:"Sharing user profile..."});break;case"edit":a({title:"Edit",description:"Opening profile editor..."});break;case"contact":a({title:"Contact",description:"Opening contact options..."});break}}),[a]),D=o.useCallback(m=>g(null,null,function*(){try{k(T=>T.map(h=>h.id===m?G(B({},h),{isFollowing:!h.isFollowing}):h)),a({title:"Success",description:"Follow status updated"})}catch(T){a({title:"Error",description:"Failed to update follow status",variant:"destructive"})}}),[a]),H=o.useCallback(m=>g(null,null,function*(){a({title:"Message",description:"Opening message composer..."})}),[a]),N=o.useCallback(m=>g(null,null,function*(){a({title:"Profile",description:"Navigating to user profile..."})}),[a]),E=o.useCallback(m=>g(null,null,function*(){a({title:"Share",description:"Sharing user profile..."})}),[a]),U=o.useCallback(m=>g(null,null,function*(){a({title:"Edit",description:"Opening profile editor..."})}),[a]),L=o.useCallback(m=>g(null,null,function*(){a({title:"Contact",description:"Opening contact options..."})}),[a]);return e.jsx(Ps,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-center mb-4",children:"Discover Your Community"}),e.jsx("p",{className:"text-xl text-center text-muted-foreground max-w-3xl mx-auto",children:"Connect with amazing people, discover local events, and explore trending content in your area"})]}),e.jsxs(Ye,{value:t,onValueChange:r,className:"w-full",children:[e.jsxs(Xe,{className:"grid w-full grid-cols-7",children:[e.jsx(Y,{value:"overview",children:"Overview"}),e.jsx(Y,{value:"users",children:"People"}),e.jsx(Y,{value:"events",children:"Events"}),e.jsx(Y,{value:"trending",children:"Trending"}),e.jsx(Y,{value:"recommendations",children:"Recommendations"}),e.jsx(Y,{value:"draggable",children:"Draggable"}),e.jsx(Y,{value:"virtualized",children:"Virtualized"})]}),e.jsx(X,{value:"search",className:"space-y-6",children:e.jsx($s,{})}),e.jsxs(X,{value:"users",className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Discover Amazing People"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect with verified professionals, creators, and community leaders"})]}),e.jsxs(O,{children:[e.jsxs(ie,{children:[e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5 text-yellow-500"}),"Featured Users"]}),e.jsx(De,{children:"Premium and verified users you might want to connect with"})]}),e.jsx($,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:v.filter(m=>m.isPremium||m.isFeatured).map(m=>e.jsx(Ne,{user:m,variant:m.isFeatured?"featured":"premium",onFollow:D,onMessage:H,onViewProfile:N,onShare:E,onEdit:U,onContact:L,showActions:!0,showStats:!0,showSocialLinks:!0,showSkills:!0,showInterests:!0,animate:!0,interactive:!0},m.id))})})]}),e.jsxs(O,{children:[e.jsxs(ie,{children:[e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"All Users"]}),e.jsx(De,{children:"Browse and discover users in your community"})]}),e.jsx($,{children:e.jsx(Xs,{users:v,variant:"compact",layout:"grid",showSearch:!0,showFilters:!0,showTabs:!0,onUserAction:P,onFollow:D,onMessage:H,onViewProfile:N,onShare:E,onEdit:U,onContact:L})})]})]}),e.jsxs(X,{value:"events",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Nearby Events"}),e.jsx(b,{variant:"outline",onClick:()=>window.location.href="/events",children:"View All Events"})]}),p?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((m,T)=>e.jsxs(O,{className:"animate-pulse",children:[e.jsx(ie,{children:e.jsx("div",{className:"h-4 bg-muted rounded w-3/4"})}),e.jsxs($,{children:[e.jsx("div",{className:"h-3 bg-muted rounded w-full mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-2/3"})]})]},T))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(m=>e.jsxs(O,{className:"hover:shadow-md transition-shadow",children:[e.jsxs(ie,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(z,{variant:"outline",children:m.category}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:m.price})]}),e.jsx(fe,{className:"text-lg",children:m.title})]}),e.jsxs($,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:m.description}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:m.location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:Le(new Date(m.date),"MMM dd, yyyy")})]})]})]})]},m.id))})]}),e.jsx(X,{value:"trending",className:"space-y-6",children:e.jsx(Ws,{})}),e.jsxs(X,{value:"recommendations",className:"space-y-6",children:[e.jsx(Js,{}),e.jsx(Ys,{})]}),e.jsx(X,{value:"draggable",className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Interactive User List"}),e.jsx("p",{className:"text-muted-foreground",children:"Drag and drop users to reorder them. Use the shuffle button to randomize the order."})]}),e.jsxs(O,{children:[e.jsxs(ie,{children:[e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-5 w-5 text-blue-500"}),"Draggable Users"]}),e.jsx(De,{children:"Drag users to reorder them. Click shuffle to randomize the order."})]}),e.jsx($,{children:e.jsx(Zs,{users:v,variant:"compact",onReorder:m=>{k(m),a({title:"Users Reordered",description:"The user list has been updated with the new order."})},onFollow:D,onMessage:H,onViewProfile:N,onShare:E,onEdit:U,onContact:L,showDragHandles:!0,allowReordering:!0})})]})]})}),e.jsx(X,{value:"virtualized",className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"High-Performance User List"}),e.jsx("p",{className:"text-muted-foreground",children:"This list uses virtualization to handle large datasets efficiently. Only visible items are rendered."})]}),e.jsxs(O,{children:[e.jsxs(ie,{children:[e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5 text-green-500"}),"Virtualized Users"]}),e.jsx(De,{children:"High-performance list with search, filtering, and sorting capabilities."})]}),e.jsx($,{children:e.jsx(et,{users:v,variant:"dark",height:600,itemHeight:120,onFollow:D,onMessage:H,onViewProfile:N,onShare:E,onEdit:U,onContact:L,showSearch:!0,showFilters:!0,showSorting:!0,enableVirtualization:!0})})]})]})})]})]})})};export{Nt as default};
