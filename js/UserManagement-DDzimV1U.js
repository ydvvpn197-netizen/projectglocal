var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,t=(s,a,l)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[a]=l,n=(e,s)=>{for(var a in s||(s={}))r.call(s,a)&&t(e,a,s[a]);if(l)for(var a of l(s))i.call(s,a)&&t(e,a,s[a]);return e},c=(e,l)=>s(e,a(l)),d=(e,s,a)=>new Promise((l,r)=>{var i=e=>{try{n(a.next(e))}catch(s){r(s)}},t=e=>{try{n(a.throw(e))}catch(s){r(s)}},n=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,t);n((a=a.apply(e,s)).next())});import{r as o,j as x,B as m}from"./index-B5IYdG7F.js";import{C as h,a as j,b as u,d as p,c as v}from"./card-Bm1jiGt-.js";import{B as g}from"./badge-Dh5Uj8vN.js";import{I as f}from"./input-C4_QhDnm.js";import{S as N,a as y,b,c as w,d as S}from"./select-DME_qdt9.js";import{T as A,a as C,b as U,c as _,d as P,e as O}from"./table-BBH90-5Z.js";import{D as E,a as k,b as D,c as M,d as R}from"./dialog-UfmTf-qG.js";import{A as T,a as L}from"./alert-CQybxmNr.js";import{u as F,A as V,a as z,b as I}from"./AdminLayout-_0vC0t44.js";import{F as q}from"./filter-DejZCL1b.js";import{S as B}from"./search-Co_OHmlK.js";import{U as J}from"./users-Dh-Bdb-k.js";import{M as W}from"./mail-D46AJ_e2.js";import{C as H}from"./index-DD_J5sPn.js";import{M as Y}from"./map-pin-BwnggLrZ.js";import{E as Z}from"./eye-DAEnomQ6.js";import"./index-jVOyRz7F.js";import"./index-9msbY5CZ.js";import"./Combination-BxRIZ8rt.js";import"./index-_KG4atBu.js";import"./chevron-up-DvjQ7ry8.js";import"./check-C9wwFfOs.js";import"./label-BIAuZBUP.js";import"./shield-CcnVg-IR.js";import"./eye-off-Yicyrlvk.js";import"./loader-2-DMKXv0ZB.js";import"./scroll-area-Beiyt5Kx.js";import"./settings-DSEWn2wM.js";import"./log-out-DchhrZ8K.js";const $=()=>{var e,s,a,l,r;F();const i=new V,[t,$]=o.useState([]),[G,K]=o.useState(!0),[Q,X]=o.useState(null),[ee,se]=o.useState({search:"",role:"all",status:"all",dateRange:"all",page:1,limit:20}),[ae,le]=o.useState(0),[re,ie]=o.useState(null),[te,ne]=o.useState(!1);o.useEffect(()=>{ce()},[ee]);const ce=()=>d(void 0,null,function*(){try{K(!0),X(null);const e=yield i.getUsers(ee);$(e.data||[]),le(e.total||0)}catch(e){X(e instanceof Error?e.message:"Failed to load users")}finally{K(!1)}}),de=(e,s)=>{se(a=>c(n({},a),{[e]:s,page:1}))},oe=e=>{se(s=>c(n({},s),{page:e}))},xe=e=>{switch(e){case"active":return x.jsx(g,{className:"bg-green-100 text-green-800",children:"Active"});case"suspended":return x.jsx(g,{className:"bg-red-100 text-red-800",children:"Suspended"});case"pending":return x.jsx(g,{className:"bg-yellow-100 text-yellow-800",children:"Pending"});default:return x.jsx(g,{variant:"secondary",children:e})}},me=e=>{switch(e){case"admin":return x.jsx(g,{className:"bg-purple-100 text-purple-800",children:"Admin"});case"moderator":return x.jsx(g,{className:"bg-blue-100 text-blue-800",children:"Moderator"});case"user":return x.jsx(g,{className:"bg-gray-100 text-gray-800",children:"User"});default:return x.jsx(g,{variant:"secondary",children:e})}},he=e=>new Date(e).toLocaleDateString();return G&&0===t.length?x.jsx("div",{className:"flex items-center justify-center min-h-screen",children:x.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"})}):x.jsx(z,{requiredPermission:"users:manage",children:x.jsxs(I,{children:[x.jsxs("div",{className:"p-6",children:[x.jsxs("div",{className:"mb-6",children:[x.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),x.jsx("p",{className:"text-gray-600",children:"Manage user accounts, roles, and permissions"})]}),Q&&x.jsx(T,{className:"mb-6",children:x.jsx(L,{children:Q})}),x.jsxs(h,{className:"mb-6",children:[x.jsx(j,{children:x.jsxs(u,{className:"flex items-center gap-2",children:[x.jsx(q,{className:"h-5 w-5"}),"Filters"]})}),x.jsx(p,{children:x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[x.jsxs("div",{className:"relative",children:[x.jsx(B,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),x.jsx(f,{placeholder:"Search users...",value:ee.search,onChange:e=>(e=>{se(s=>c(n({},s),{search:e,page:1}))})(e.target.value),className:"pl-10"})]}),x.jsxs(N,{value:ee.role,onValueChange:e=>de("role",e),children:[x.jsx(y,{children:x.jsx(b,{placeholder:"All Roles"})}),x.jsxs(w,{children:[x.jsx(S,{value:"all",children:"All Roles"}),x.jsx(S,{value:"user",children:"User"}),x.jsx(S,{value:"moderator",children:"Moderator"}),x.jsx(S,{value:"admin",children:"Admin"})]})]}),x.jsxs(N,{value:ee.status,onValueChange:e=>de("status",e),children:[x.jsx(y,{children:x.jsx(b,{placeholder:"All Status"})}),x.jsxs(w,{children:[x.jsx(S,{value:"all",children:"All Status"}),x.jsx(S,{value:"active",children:"Active"}),x.jsx(S,{value:"suspended",children:"Suspended"}),x.jsx(S,{value:"pending",children:"Pending"})]})]}),x.jsxs(N,{value:ee.dateRange,onValueChange:e=>de("dateRange",e),children:[x.jsx(y,{children:x.jsx(b,{placeholder:"Date Range"})}),x.jsxs(w,{children:[x.jsx(S,{value:"all",children:"All Time"}),x.jsx(S,{value:"today",children:"Today"}),x.jsx(S,{value:"week",children:"This Week"}),x.jsx(S,{value:"month",children:"This Month"})]})]})]})})]}),x.jsxs(h,{children:[x.jsx(j,{children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsxs(u,{children:["Users (",ae,")"]}),x.jsx(v,{children:"Platform user accounts"})]}),x.jsxs(m,{children:[x.jsx(J,{className:"mr-2 h-4 w-4"}),"Export Users"]})]})}),x.jsxs(p,{children:[x.jsxs(A,{children:[x.jsx(C,{children:x.jsxs(U,{children:[x.jsx(_,{children:"User"}),x.jsx(_,{children:"Email"}),x.jsx(_,{children:"Role"}),x.jsx(_,{children:"Status"}),x.jsx(_,{children:"Joined"}),x.jsx(_,{children:"Location"}),x.jsx(_,{children:"Actions"})]})}),x.jsx(P,{children:t.map(e=>{var s,a,l,r,t,n;return x.jsxs(U,{children:[x.jsx(O,{children:x.jsxs("div",{className:"flex items-center space-x-3",children:[x.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:x.jsx("span",{className:"text-sm font-medium",children:(null==(a=null==(s=e.profile)?void 0:s.full_name)?void 0:a.charAt(0))||e.email.charAt(0).toUpperCase()})}),x.jsxs("div",{children:[x.jsx("div",{className:"font-medium",children:(null==(l=e.profile)?void 0:l.full_name)||"No Name"}),x.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",e.id.slice(0,8),"..."]})]})]})}),x.jsx(O,{children:x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx(W,{className:"h-4 w-4 text-gray-400"}),x.jsx("span",{children:e.email})]})}),x.jsx(O,{children:me((null==(r=e.profile)?void 0:r.role)||"user")}),x.jsx(O,{children:xe((null==(t=e.profile)?void 0:t.status)||"active")}),x.jsx(O,{children:x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx(H,{className:"h-4 w-4 text-gray-400"}),x.jsx("span",{children:he(e.created_at)})]})}),x.jsx(O,{children:(null==(n=e.profile)?void 0:n.location_name)?x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx(Y,{className:"h-4 w-4 text-gray-400"}),x.jsx("span",{className:"text-sm",children:e.profile.location_name})]}):x.jsx("span",{className:"text-gray-400",children:"Not set"})}),x.jsx(O,{children:x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{ie(e),ne(!0)},children:x.jsx(Z,{className:"h-4 w-4"})}),x.jsxs(N,{onValueChange:s=>((e,s)=>d(void 0,null,function*(){try{switch(s){case"suspend":yield i.suspendUser(e);break;case"activate":yield i.activateUser(e);break;case"delete":confirm("Are you sure you want to delete this user? This action cannot be undone.")&&(yield i.deleteUser(e))}ce()}catch(a){X(a instanceof Error?a.message:"Failed to perform action")}}))(e.id,s),children:[x.jsx(y,{className:"w-32",children:x.jsx(b,{placeholder:"Actions"})}),x.jsxs(w,{children:[x.jsx(S,{value:"view",children:"View Details"}),x.jsx(S,{value:"edit",children:"Edit User"}),x.jsx(S,{value:"suspend",children:"Suspend"}),x.jsx(S,{value:"activate",children:"Activate"}),x.jsx(S,{value:"delete",className:"text-red-600",children:"Delete"})]})]})]})})]},e.id)})})]}),0===t.length&&!G&&x.jsxs("div",{className:"text-center py-8",children:[x.jsx(J,{className:"mx-auto h-12 w-12 text-gray-400"}),x.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No users found"}),x.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Try adjusting your search or filter criteria."})]})]})]}),ae>ee.limit&&x.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[x.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(ee.page-1)*ee.limit+1," to ",Math.min(ee.page*ee.limit,ae)," of ",ae," users"]}),x.jsxs("div",{className:"flex space-x-2",children:[x.jsx(m,{variant:"outline",size:"sm",disabled:1===ee.page,onClick:()=>oe(ee.page-1),children:"Previous"}),x.jsx(m,{variant:"outline",size:"sm",disabled:ee.page*ee.limit>=ae,onClick:()=>oe(ee.page+1),children:"Next"})]})]})]}),x.jsx(E,{open:te,onOpenChange:ne,children:x.jsxs(k,{className:"max-w-2xl",children:[x.jsxs(D,{children:[x.jsx(M,{children:"User Details"}),x.jsx(R,{children:"Detailed information about the selected user"})]}),re&&x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Full Name"}),x.jsx("p",{className:"text-sm text-gray-900",children:(null==(e=re.profile)?void 0:e.full_name)||"Not provided"})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email"}),x.jsx("p",{className:"text-sm text-gray-900",children:re.email})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Role"}),x.jsx("div",{className:"mt-1",children:me((null==(s=re.profile)?void 0:s.role)||"user")})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Status"}),x.jsx("div",{className:"mt-1",children:xe((null==(a=re.profile)?void 0:a.status)||"active")})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Joined"}),x.jsx("p",{className:"text-sm text-gray-900",children:he(re.created_at)})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Last Login"}),x.jsx("p",{className:"text-sm text-gray-900",children:(null==(l=re.profile)?void 0:l.last_login_at)?he(re.profile.last_login_at):"Never"})]})]}),(null==(r=re.profile)?void 0:r.location_name)&&x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Location"}),x.jsx("p",{className:"text-sm text-gray-900",children:re.profile.location_name})]}),x.jsxs("div",{className:"flex justify-end space-x-2",children:[x.jsx(m,{variant:"outline",onClick:()=>ne(!1),children:"Close"}),x.jsx(m,{onClick:()=>{ne(!1)},children:"Edit User"})]})]})]})})]})})};export{$ as default};
