var K=Object.defineProperty,Q=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var $=(t,a,r)=>a in t?K(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,z=(t,a)=>{for(var r in a||(a={}))W.call(a,r)&&$(t,r,a[r]);if(U)for(var r of U(a))Z.call(a,r)&&$(t,r,a[r]);return t},L=(t,a)=>Q(t,R(a));var b=(t,a,r)=>new Promise((p,n)=>{var v=l=>{try{h(r.next(l))}catch(c){n(c)}},w=l=>{try{h(r.throw(l))}catch(c){n(c)}},h=l=>l.done?p(l.value):Promise.resolve(l.value).then(v,w);h((r=r.apply(t,a)).next())});import{u as V,g as ee,f as H,r as x,s as j,j as e,C as d,p as k,q as S,v as o,t as T,B as _,S as se}from"./main-jfCIwKxb.js";import{R as F,A as te,b as ae,c as re,S as ie}from"./ResponsiveLayout-Dd-U-XTf.js";import{B as N}from"./badge-Cxniq3nT.js";import{S as ne}from"./separator-CQeeh5sy.js";import{S as le}from"./scroll-area-Bsyy6uVd.js";import{D as ce,e as de,a as oe,b as me,c as xe,d as he}from"./dialog-Db9VuKsi.js";import{C as ue}from"./chatService-Cge3LvMh.js";import{C as D}from"./calendar-CXbnSY_4.js";import{U as X}from"./user-cZSM4iEh.js";import{f as A}from"./index-DCmZQWeX.js";import{M as je}from"./map-pin-B5hnRU36.js";import{D as pe}from"./dollar-sign-ytgA1ZFZ.js";import{M as O}from"./message-circle-BzbuDOEE.js";import{C as q}from"./clock-CT2ky6hG.js";import{C as M}from"./check-circle-DlKkeJkD.js";import{X as ge}from"./x-circle-kobPzj2Z.js";import{T as fe,a as Ne,b as E,c as P}from"./tabs-Bho2AISw.js";import{C as I}from"./calendar-days-B_eBygCV.js";import"./index-DGobKVbi.js";import"./index-D6sgUugm.js";import"./index-CaL9moq2.js";import"./databaseUtils-Cc-GydU0.js";import"./useNotifications-DlynYvan.js";import"./notificationService-DPR46Nx3.js";import"./bell-CXNc_0l5.js";import"./check-CWeqS_MX.js";import"./search-DIpOLffQ.js";import"./alert-f_BC70aV.js";import"./zap-C2TAeX5H.js";import"./plus-Bi3vU8QF.js";import"./message-square-oWFCH1Pi.js";import"./wifi-Ue5kLFZw.js";import"./log-out-CxjypOOW.js";const ve=()=>{const{user:t}=V(),{toast:a}=ee(),r=H(),[p,n]=x.useState([]),[v,w]=x.useState(!0),h=x.useCallback(()=>b(void 0,null,function*(){if(t)try{const{data:s,error:m}=yield j.from("artist_bookings").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(m)throw m;const C=yield Promise.all((s||[]).map(g=>b(void 0,null,function*(){var B;const{data:u}=yield j.from("artists").select("user_id").eq("id",g.artist_id).single(),{data:i}=yield j.from("profiles").select("display_name, avatar_url, artist_skills").eq("user_id",u==null?void 0:u.user_id).single(),{data:f}=yield j.from("chat_conversations").select("id").eq("client_id",t.id).eq("artist_id",u==null?void 0:u.user_id).single();return L(z({},g),{artist_name:(i==null?void 0:i.display_name)||"Unknown Artist",artist_avatar:(i==null?void 0:i.avatar_url)||"",artist_specialty:((B=i==null?void 0:i.artist_skills)==null?void 0:B[0])||"Artist",chat_conversation_id:f==null?void 0:f.id})})));n(C)}catch(s){console.error("Error fetching client bookings:",s),a({title:"Error",description:"Failed to load your bookings",variant:"destructive"})}finally{w(!1)}}),[t,a]);x.useEffect(()=>{if(t){h();const s=j.channel("client-bookings").on("postgres_changes",{event:"UPDATE",schema:"public",table:"artist_bookings",filter:`user_id=eq.${t.id}`},()=>{h()}).subscribe();return()=>{j.removeChannel(s)}}},[t,h]);const l=s=>{switch(s){case"pending":return e.jsx(N,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:"Pending"});case"accepted":return e.jsx(N,{variant:"outline",className:"text-green-600 border-green-600",children:"Accepted"});case"declined":return e.jsx(N,{variant:"outline",className:"text-red-600 border-red-600",children:"Declined"});case"completed":return e.jsx(N,{variant:"outline",className:"text-blue-600 border-blue-600",children:"Completed"});default:return e.jsx(N,{variant:"outline",children:s})}},c=s=>{switch(s){case"pending":return e.jsx(q,{className:"h-4 w-4 text-yellow-600"});case"accepted":return e.jsx(M,{className:"h-4 w-4 text-green-600"});case"declined":return e.jsx(ge,{className:"h-4 w-4 text-red-600"});case"completed":return e.jsx(M,{className:"h-4 w-4 text-blue-600"});default:return e.jsx(q,{className:"h-4 w-4"})}};return t?v?e.jsxs(d,{children:[e.jsx(k,{children:e.jsx(S,{children:"My Bookings"})}),e.jsx(o,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(d,{children:[e.jsxs(k,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"My Bookings"]}),e.jsx(T,{children:"View and manage your booking requests"})]}),e.jsx(o,{children:p.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No bookings yet"}),e.jsx("p",{className:"text-sm",children:"Your booking requests will appear here"})]}):e.jsx(le,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:p.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(X,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.artist_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.artist_specialty," â€¢ ",A(new Date(s.created_at),"PPp")]})]})]}),l(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:A(new Date(s.event_date),"PPP")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:s.event_location||"Location TBD"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.budget_min&&s.budget_max?`$${s.budget_min} - $${s.budget_max}`:"Budget TBD"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c(s.status),e.jsx("span",{className:"capitalize",children:s.status})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.event_description})}),e.jsx(ne,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(_,{variant:"outline",size:"sm",children:"View Details"})}),e.jsxs(oe,{children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Booking Details"}),e.jsx(he,{children:"Full information about this booking"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Artist Information"}),e.jsxs("p",{children:["Name: ",s.artist_name]}),e.jsxs("p",{children:["Specialty: ",s.artist_specialty]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Event Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",A(new Date(s.event_date),"PPP")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," ",s.event_location]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",s.event_description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Budget:"}),s.budget_min&&s.budget_max?` $${s.budget_min} - $${s.budget_max}`:" Not specified"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:"capitalize",children:s.status})]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="accepted"&&e.jsxs(_,{size:"sm",onClick:()=>b(void 0,null,function*(){try{const m=yield ue.getOrCreateConversationForBooking(s.id);m?r(`/chat/${m}`):a({title:"Error",description:"Unable to start chat. Please try again.",variant:"destructive"})}catch(m){console.error("Error starting chat:",m),a({title:"Error",description:"Unable to start chat. Please try again.",variant:"destructive"})}}),children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"Chat with Artist"]}),s.status==="pending"&&e.jsx(_,{size:"sm",variant:"outline",onClick:()=>{a({title:"Contact Support",description:"Please contact support to cancel this booking"})},children:"Cancel Booking"})]})]})]},s.id))})})})]}):null},ss=()=>{var m,C;const{user:t}=V(),a=H(),[r,p]=x.useState({totalBookings:0,pendingBookings:0,activeBookings:0,completedBookings:0}),[n,v]=x.useState(null),[w,h]=x.useState(!0),[l,c]=x.useState("bookings"),s=x.useCallback(()=>b(void 0,null,function*(){if(t)try{const{data:g,error:u}=yield j.from("profiles").select("*").eq("user_id",t.id).single();if(u)throw u;v(g);const{data:i,error:f}=yield j.from("artist_bookings").select("status").eq("user_id",t.id);if(f)throw f;const B=(i==null?void 0:i.length)||0,Y=(i==null?void 0:i.filter(y=>y.status==="pending").length)||0,G=(i==null?void 0:i.filter(y=>y.status==="accepted").length)||0,J=(i==null?void 0:i.filter(y=>y.status==="completed").length)||0;p({totalBookings:B,pendingBookings:Y,activeBookings:G,completedBookings:J})}catch(g){console.error("Error fetching user data:",g)}finally{h(!1)}}),[t]);return x.useEffect(()=>{t&&s()},[t,s]),t?w?e.jsx(F,{children:e.jsx("div",{className:"container max-w-6xl mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})}):e.jsx(F,{children:e.jsxs("div",{className:"container max-w-6xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(te,{className:"h-16 w-16",children:[e.jsx(ae,{src:n==null?void 0:n.avatar_url}),e.jsx(re,{className:"text-lg",children:((m=n==null?void 0:n.display_name)==null?void 0:m.charAt(0))||((C=t.email)==null?void 0:C.charAt(0))||"U"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:(n==null?void 0:n.display_name)||"User"}),e.jsx("p",{className:"text-muted-foreground",children:t.email})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(d,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>c("bookings"),children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Bookings"}),e.jsx("p",{className:"text-2xl font-bold",children:r.totalBookings})]}),e.jsx(I,{className:"h-8 w-8 text-primary"})]})})}),e.jsx(d,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>c("bookings"),children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:r.pendingBookings})]}),e.jsx(q,{className:"h-8 w-8 text-yellow-600"})]})})}),e.jsx(d,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>c("bookings"),children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.activeBookings})]}),e.jsx(M,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(d,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>c("bookings"),children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r.completedBookings})]}),e.jsx(ie,{className:"h-8 w-8 text-blue-600"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsx(d,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>a("/book-artist"),children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(X,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Book an Artist"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Find and book artists for your events"})]})]})})}),e.jsx(d,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>a("/events"),children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(I,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Browse Events"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Discover local events and activities"})]})]})})}),e.jsx(d,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>a("/messages"),children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(O,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Messages"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chat with artists and organizers"})]})]})})})]}),e.jsxs(fe,{value:l,onValueChange:c,className:"space-y-6",children:[e.jsxs(Ne,{children:[e.jsxs(E,{value:"bookings",children:["My Bookings",r.pendingBookings>0&&e.jsx(N,{variant:"destructive",className:"ml-2 h-5 w-5 rounded-full p-0 text-xs",children:r.pendingBookings})]}),e.jsx(E,{value:"profile",children:"Profile"}),e.jsx(E,{value:"settings",children:"Settings"})]}),e.jsx(P,{value:"bookings",children:e.jsx(ve,{})}),e.jsx(P,{value:"profile",children:e.jsxs(d,{children:[e.jsxs(k,{children:[e.jsx(S,{children:"Profile Information"}),e.jsx(T,{children:"Manage your profile and preferences"})]}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Display Name"}),e.jsx("p",{className:"text-muted-foreground",children:(n==null?void 0:n.display_name)||"Not set"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Email"}),e.jsx("p",{className:"text-muted-foreground",children:t.email})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Bio"}),e.jsx("p",{className:"text-muted-foreground",children:(n==null?void 0:n.bio)||"No bio added yet"})]}),e.jsx(_,{onClick:()=>a("/profile"),children:"Edit Profile"})]})})]})}),e.jsx(P,{value:"settings",children:e.jsxs(d,{children:[e.jsxs(k,{children:[e.jsx(S,{children:"Account Settings"}),e.jsx(T,{children:"Manage your account preferences and security"})]}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs(_,{variant:"outline",onClick:()=>a("/settings"),children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Account Settings"]})})})]})})]})]})}):(a("/signin"),null)};export{ss as default};
