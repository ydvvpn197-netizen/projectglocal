var p=Object.defineProperty;var y=(l,e,n)=>e in l?p(l,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[e]=n;var f=(l,e,n)=>y(l,typeof e!="symbol"?e+"":e,n);var u=(l,e,n)=>new Promise((t,i)=>{var r=o=>{try{a(n.next(o))}catch(c){i(c)}},s=o=>{try{a(n.throw(o))}catch(c){i(c)}},a=o=>o.done?t(o.value):Promise.resolve(o.value).then(r,s);a((n=n.apply(l,e)).next())});import{s as d}from"./chunk-CasIWBEQ.js";import"./chunk-C4jjqBrH.js";import"./chunk-BlluHz2J.js";import"./chunk-DJzzOJWe.js";import"./chunk-COTa-BBv.js";import"./chunk-DvlvDbdf.js";import"./chunk-BA32w1ww.js";const m=class m{static getInstance(){return m.instance||(m.instance=new m),m.instance}analyzeSentiment(e){return u(this,null,function*(){try{const n=this.calculateSentimentScore(e),t=this.getSentimentLabel(n),i=this.calculateConfidenceScore(e,n);return{sentiment_score:n,sentiment_label:t,confidence_score:i}}catch(n){return console.error("Error analyzing sentiment:",n),{sentiment_score:0,sentiment_label:"neutral",confidence_score:.5}}})}storeSentimentAnalysis(e){return u(this,null,function*(){try{const n=yield this.analyzeSentiment(e.content_text),{error:t}=yield d.from("community_sentiment").insert({content_id:e.content_id,content_type:e.content_type,sentiment_score:n.sentiment_score,sentiment_label:n.sentiment_label,confidence_score:n.confidence_score,analysis_metadata:{user_id:e.user_id,location:e.location,text_length:e.content_text.length,analysis_timestamp:new Date().toISOString()}});if(t)throw console.error("Error storing sentiment analysis:",t),t}catch(n){throw console.error("Error in storeSentimentAnalysis:",n),n}})}getSentimentTrends(e,n,t,i){return u(this,null,function*(){try{let r=d.from("community_sentiment").select("*").gte("created_at",e.toISOString()).lte("created_at",n.toISOString());t&&(r=r.eq("content_type",t));const{data:s,error:a}=yield r;if(a)throw a;return this.calculateSentimentTrends(s||[])}catch(r){throw console.error("Error getting sentiment trends:",r),r}})}getCommunitySentimentSummary(e="week",n){return u(this,null,function*(){try{const t=new Date,i=new Date;switch(e){case"day":i.setDate(i.getDate()-1);break;case"week":i.setDate(i.getDate()-7);break;case"month":i.setMonth(i.getMonth()-1);break}const{data:r,error:s}=yield d.from("community_sentiment").select("*").gte("created_at",i.toISOString()).lte("created_at",t.toISOString());if(s)throw s;return this.calculateSentimentSummary(r||[])}catch(t){throw console.error("Error getting community sentiment summary:",t),t}})}calculateSentimentScore(e){const n=e.toLowerCase().split(/\s+/);let t=0,i=0;const r=["good","great","excellent","amazing","wonderful","fantastic","love","like","happy","excited","awesome","brilliant","outstanding","perfect","beautiful","amazing","incredible","superb","delighted","pleased","satisfied","content","joyful","cheerful","optimistic","hopeful","successful","achievement","victory","triumph","celebration","congratulations","praise"],s=["bad","terrible","awful","hate","dislike","angry","sad","disappointed","frustrated","horrible","disgusting","annoying","irritating","upset","worried","concerned","fearful","depressed","miserable","unhappy","disgusted","outraged","furious","devastated","crushed","failure","disaster","catastrophe","crisis","problem","issue","complaint","criticism"],a=["very","extremely","incredibly","absolutely","completely","totally","really","so"],o=["not","no","never","none","nothing","nowhere","neither","nor"];let c=0,_=0;for(const g of n)i++,r.includes(g)?t+=1:s.includes(g)?t-=1:a.includes(g)?c++:o.includes(g)&&_++;return c>0&&(t*=1+c*.3),_>0&&(t*=-1),Math.max(-1,Math.min(1,t/Math.max(i,1)))}getSentimentLabel(e){return e>.1?"positive":e<-.1?"negative":"neutral"}calculateConfidenceScore(e,n){const t=e.length,i=e.split(/\s+/).length;let r=.5;t>50&&(r+=.2),t>100&&(r+=.1);const s=Math.abs(n);return r+=s*.3,i>10&&(r+=.1),Math.min(1,Math.max(.1,r))}calculateSentimentTrends(e){if(e.length===0)return{average_sentiment:0,positive_percentage:0,negative_percentage:0,neutral_percentage:0,trend_direction:"stable",confidence_trend:0};const t=e.reduce((o,c)=>o+c.sentiment_score,0)/e.length,i=e.filter(o=>o.sentiment_label==="positive").length,r=e.filter(o=>o.sentiment_label==="negative").length,s=e.filter(o=>o.sentiment_label==="neutral").length,a=e.length;return{average_sentiment:t,positive_percentage:i/a*100,negative_percentage:r/a*100,neutral_percentage:s/a*100,trend_direction:t>.1?"rising":t<-.1?"falling":"stable",confidence_trend:e.reduce((o,c)=>o+c.confidence_score,0)/a}}calculateSentimentSummary(e){if(e.length===0)return{total_analyses:0,average_sentiment:0,sentiment_distribution:{positive:0,negative:0,neutral:0},top_positive_content:[],top_negative_content:[],sentiment_evolution:[]};const n=e.length,t=e.reduce((o,c)=>o+c.sentiment_score,0)/n,i={positive:e.filter(o=>o.sentiment_label==="positive").length,negative:e.filter(o=>o.sentiment_label==="negative").length,neutral:e.filter(o=>o.sentiment_label==="neutral").length},r=e.sort((o,c)=>c.sentiment_score-o.sentiment_score),s=r.slice(0,5),a=r.slice(-5).reverse();return{total_analyses:n,average_sentiment:t,sentiment_distribution:i,top_positive_content:s,top_negative_content:a,sentiment_evolution:this.calculateSentimentEvolution(e)}}calculateSentimentEvolution(e){const n=e.reduce((t,i)=>{const r=new Date(i.created_at).toISOString().split("T")[0];return t[r]||(t[r]={scores:[],count:0}),t[r].scores.push(i.sentiment_score),t[r].count++,t},{});return Object.entries(n).map(([t,i])=>({date:t,average_sentiment:i.scores.reduce((r,s)=>r+s,0)/i.count,count:i.count})).sort((t,i)=>t.date.localeCompare(i.date))}};f(m,"instance");let h=m;export{h as SentimentAnalysisService};
