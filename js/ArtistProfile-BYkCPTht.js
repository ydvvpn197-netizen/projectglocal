var ye=Object.defineProperty,Ne=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var le=(r,o,s)=>o in r?ye(r,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[o]=s,p=(r,o)=>{for(var s in o||(o={}))Ce.call(o,s)&&le(r,s,o[s]);if(ne)for(var s of ne(o))ke.call(o,s)&&le(r,s,o[s]);return r},y=(r,o)=>Ne(r,we(o));var v=(r,o,s)=>new Promise((E,a)=>{var b=f=>{try{g(s.next(f))}catch(_){a(_)}},q=f=>{try{g(s.throw(f))}catch(_){a(_)}},g=f=>f.done?E(f.value):Promise.resolve(f.value).then(b,q);g((s=s.apply(r,o)).next())});import{M as Ee,u as qe,g as De,f as Se,r as l,s as c,j as e,B as N,C as j,p as w,q as S,v as C}from"./main-B2Z1A0fl.js";import{R as L,A as ce,b as de,c as ue,S as Ae}from"./ResponsiveLayout-CYnOsYqc.js";import{B as A}from"./badge-CdNeXDip.js";import{T as Be,a as Te,b as $,c as U}from"./tabs-WXu0DGF3.js";import{T as H}from"./textarea-DgIPQeWX.js";import{I as k}from"./index-yZSPA8A-.js";import{D as Me,e as Pe,a as Fe,b as Ie,c as Re}from"./dialog-KM5TFbjt.js";import{u as Ye,F as Le}from"./FollowButton-CJNTp5WO.js";import{n as $e}from"./notificationService-BphN-zZk.js";import{C as me}from"./chatService-ChjNDZXa.js";import{M as Ue}from"./map-pin-CZucSvvB.js";import{C as He}from"./clock-DJLknj0F.js";import{U as fe}from"./alert-DX9hSffn.js";import{C as ze}from"./calendar-Cawp_lnB.js";import{M as xe}from"./message-circle-_vsuaFG3.js";import{H as Oe}from"./plus-B4gpjJdq.js";import"./separator-DjSuCMYj.js";import"./index-oNALVX6M.js";import"./index-DJ86sh13.js";import"./databaseUtils-EE95jGy-.js";import"./scroll-area-BhRuPQbm.js";import"./index-BccyXWdq.js";import"./check-DuTiAf7C.js";import"./useNotifications-BC0Dj2vc.js";import"./bell-BrPt3aXG.js";import"./user-etsi-1kT.js";import"./search-DJSs7YT2.js";import"./zap-BDCYOuKc.js";import"./message-square-B_GUjDSs.js";import"./wifi-BixKGM4R.js";import"./log-out-wiSeNNbg.js";import"./user-check-CYwjRMrY.js";import"./user-plus-KGdGQjCp.js";const kt=()=>{var ie,ae,re;const{artistId:r}=Ee(),{user:o}=qe(),{toast:s}=De(),E=Se(),[a,b]=l.useState(null),[q,g]=l.useState([]),[f,_]=l.useState(!0),[he,pe]=l.useState("about"),[B,z]=l.useState(""),[T,O]=l.useState(""),[W,V]=l.useState(!1),[ge,G]=l.useState(!1),[D,J]=l.useState(""),[M,K]=l.useState(""),[P,Q]=l.useState(""),[F,X]=l.useState(""),[I,Z]=l.useState(""),[R,ee]=l.useState(""),{followersCount:ve,followingCount:je}=Ye(r);l.useEffect(()=>{r&&(te(),se())},[r,o,te,se]);const te=l.useCallback(()=>v(void 0,null,function*(){try{const{data:t,error:i}=yield c.from("profiles").select("*").eq("user_id",r).single();if(i)throw i;const{data:n,error:u}=yield c.from("artists").select("*").eq("user_id",r).single();if(u){const{data:d,error:x}=yield c.from("artists").insert({user_id:r,specialty:t.artist_skills||[],experience_years:0,hourly_rate_min:t.hourly_rate_min||0,hourly_rate_max:t.hourly_rate_max||0,bio:t.bio||"",is_available:!0}).select().single();if(x){console.error("Error creating artist record:",x),b(y(p({},t),{id:t.user_id,experience_years:0,is_available:!1,hourly_rate_min:t.hourly_rate_min||0,hourly_rate_max:t.hourly_rate_max||0}));return}b(y(p(p({},t),d),{id:d.id}));return}b(y(p(p({},t),n),{id:n.id}))}catch(t){console.error("Error fetching artist profile:",t),s({title:"Error",description:"Failed to load artist profile",variant:"destructive"})}}),[r,s]),se=l.useCallback(()=>v(void 0,null,function*(){try{const{data:t,error:i}=yield c.from("artists").select("id").eq("user_id",r).single();if(i){console.error("Error fetching artist record:",i),g([]);return}const{data:n,error:u}=yield c.from("artist_discussions").select("*").eq("artist_id",t.id).eq("status","approved").order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1});if(u)throw u;const d=(n||[]).map(m=>m.user_id);let x={};if(d.length>0){const{data:m}=yield c.from("profiles").select("user_id, display_name, avatar_url").in("user_id",d);x=Object.fromEntries((m||[]).map(h=>[h.user_id,h]))}const Y=(n||[]).map(m=>{var h,oe;return y(p({},m),{user_display_name:((h=x[m.user_id])==null?void 0:h.display_name)||"Anonymous",user_avatar_url:((oe=x[m.user_id])==null?void 0:oe.avatar_url)||""})});g(Y)}catch(t){console.error("Error fetching discussions:",t)}finally{_(!1)}}),[r]),be=()=>v(void 0,null,function*(){if(!o){s({title:"Sign in required",description:"Please sign in to post discussions",variant:"destructive"});return}if(!B.trim()||!T.trim()){s({title:"Missing information",description:"Please fill in both title and content",variant:"destructive"});return}V(!0);try{const{data:t,error:i}=yield c.from("artists").select("id").eq("user_id",r).single();if(i)throw new Error("Artist profile not found");const{data:n,error:u}=yield c.from("artist_discussions").insert({user_id:o.id,artist_id:t.id,title:B,content:T,status:"pending"}).select().single();if(u)throw u;try{yield $e.createDiscussionRequestNotification(r,n)}catch(d){console.error("Error creating discussion request notification:",d)}s({title:"Discussion submitted",description:"Your discussion request has been sent to the artist for approval"}),z(""),O("")}catch(t){console.error("Error submitting discussion:",t);let i="Failed to submit discussion request";(t==null?void 0:t.code)==="23503"?i="Artist profile not found or invalid":t!=null&&t.message&&(i=t.message),s({title:"Error",description:i,variant:"destructive"})}finally{V(!1)}}),_e=()=>v(void 0,null,function*(){if(!o){s({title:"Sign in required",description:"Please sign in to book artists",variant:"destructive"});return}if(!(a!=null&&a.id)||a.id===r||!a.is_available){s({title:"Artist not available",description:"This artist is not available for booking at the moment",variant:"destructive"});return}if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a.id)){s({title:"Artist not available",description:"This artist profile is not properly set up for bookings",variant:"destructive"});return}if(!D||!M||!P||!F||!R){s({title:"Missing information",description:"Please fill in all required fields",variant:"destructive"});return}try{const{data:i}=yield c.from("artist_bookings").select("id").eq("user_id",o.id).eq("artist_id",a==null?void 0:a.id).eq("event_date",D).single();if(i){s({title:"Booking already exists",description:"You have already sent a booking request for this date and artist.",variant:"destructive"});return}const{error:n}=yield c.from("artist_bookings").insert({user_id:o.id,artist_id:a==null?void 0:a.id,event_date:D,event_location:M,event_description:P,budget_min:parseFloat(F),budget_max:I?parseFloat(I):null,contact_info:R,status:"pending"});if(n){if(n.code==="23505"){s({title:"Booking already exists",description:"You have already sent a booking request for this date and artist.",variant:"destructive"});return}if(n.code==="23503"){s({title:"Artist not available",description:"This artist is not available for booking at the moment.",variant:"destructive"});return}throw n}s({title:"Booking request sent",description:"Your booking request has been sent to the artist"}),G(!1),J(""),K(""),Q(""),X(""),Z(""),ee("")}catch(i){console.error("Error creating booking:",i);let n="Failed to send booking request";(i==null?void 0:i.code)==="23503"?n="Artist profile is not properly set up for bookings":(i==null?void 0:i.code)==="23505"?n="You have already sent a booking request for this date and artist":i!=null&&i.message&&(n=i.message),s({title:"Error",description:n,variant:"destructive"})}});return f?e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):a?e.jsx(L,{children:e.jsxs("div",{className:"space-y-8 max-w-4xl mx-auto",children:[e.jsx(j,{children:e.jsx(w,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs(ce,{className:"h-32 w-32 mx-auto md:mx-0",children:[e.jsx(de,{src:a.avatar_url}),e.jsx(ue,{className:"text-2xl",children:((ie=a.display_name)==null?void 0:ie.charAt(0))||"A"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 md:gap-4 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:a.display_name}),a.is_verified&&e.jsx(A,{variant:"secondary",children:"Verified"}),a.is_available&&e.jsx(A,{variant:"outline",className:"text-green-600 border-green-600",children:"Available"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-2 md:gap-4 mb-4 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-1",children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.location_city,", ",a.location_state]})]}),e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-1",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsxs("span",{children:["$",a.hourly_rate_min,"-$",a.hourly_rate_max,"/hr"]})]}),e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-1",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.experience_years," years experience"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4 justify-center md:justify-start",children:(ae=a.artist_skills)==null?void 0:ae.map(t=>e.jsx(A,{variant:"outline",children:t},t))}),e.jsxs("div",{className:"flex items-center gap-6 mb-4 justify-center md:justify-start text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium text-foreground",children:ve})," followers"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium text-foreground",children:je})," following"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center md:justify-start",children:[e.jsxs(Me,{open:ge,onOpenChange:G,children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(N,{size:"lg",className:"w-full sm:w-auto",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Book Now"]})}),e.jsxs(Fe,{className:"max-w-md",children:[e.jsx(Ie,{children:e.jsxs(Re,{children:["Book ",a.display_name]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Event Date"}),e.jsx(k,{type:"datetime-local",value:D,onChange:t=>J(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Event Location"}),e.jsx(k,{placeholder:"Event location",value:M,onChange:t=>K(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Event Description"}),e.jsx(H,{placeholder:"Describe your event...",value:P,onChange:t=>Q(t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Min Budget ($)"}),e.jsx(k,{type:"number",placeholder:"500",value:F,onChange:t=>X(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Max Budget ($)"}),e.jsx(k,{type:"number",placeholder:"1000",value:I,onChange:t=>Z(t.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Contact Information"}),e.jsx(H,{placeholder:"Your phone number, email, or other contact details",value:R,onChange:t=>ee(t.target.value)})]}),e.jsx(N,{onClick:_e,className:"w-full",children:"Send Booking Request"})]})]})]}),e.jsx(Le,{userId:r,size:"lg",className:"w-full sm:w-auto"}),o&&o.id!==r&&e.jsxs(N,{variant:"outline",size:"lg",className:"w-full sm:w-auto",onClick:()=>v(void 0,null,function*(){try{if(!(yield me.canUserChatWithArtist(o.id,r))){s({title:"Chat Not Available",description:"You can only chat with artists after they accept your booking request. Please book this artist first.",variant:"destructive"});return}const{data:i}=yield c.from("chat_conversations").select("id, status, client_id, artist_id").eq("client_id",o.id).eq("artist_id",r).not("status","eq","closed").maybeSingle(),{data:n}=yield c.from("chat_conversations").select("id, status, client_id, artist_id").eq("client_id",r).eq("artist_id",o.id).not("status","eq","closed").maybeSingle(),u=i||n;let d=u==null?void 0:u.id;if(!d){const{data:x,error:Y}=yield c.from("artists").select("id").eq("user_id",r).single();if(Y||!x){s({title:"Error",description:"Artist not found. Please try again.",variant:"destructive"});return}const{data:m,error:h}=yield c.from("artist_bookings").select("id").eq("user_id",o.id).eq("artist_id",x.id).eq("status","accepted").single();if(h||!m){s({title:"Error",description:"No accepted booking found. Please book this artist first.",variant:"destructive"});return}if(d=yield me.getOrCreateConversationForBooking(m.id),!d){s({title:"Error",description:"Failed to create chat conversation",variant:"destructive"});return}}E(`/chat/${d}`)}catch(t){console.error("Error starting chat:",t),s({title:"Error",description:"Failed to start chat conversation",variant:"destructive"})}}),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"})," Message"]})]})]})]})})}),e.jsxs(Be,{value:he,onValueChange:pe,children:[e.jsxs(Te,{className:"grid w-full grid-cols-3",children:[e.jsx($,{value:"about",children:"About"}),e.jsx($,{value:"portfolio",children:"Portfolio"}),e.jsx($,{value:"discussions",children:"Discussions"})]}),e.jsx(U,{value:"about",className:"space-y-6",children:e.jsxs(j,{children:[e.jsx(w,{children:e.jsx(S,{children:"About"})}),e.jsx(C,{children:e.jsx("p",{className:"text-muted-foreground",children:a.bio||"No bio available."})})]})}),e.jsx(U,{value:"portfolio",className:"space-y-6",children:e.jsxs(j,{children:[e.jsx(w,{children:e.jsx(S,{children:"Portfolio"})}),e.jsx(C,{children:((re=a.portfolio_urls)==null?void 0:re.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.portfolio_urls.map((t,i)=>e.jsx("div",{className:"aspect-video bg-muted rounded-lg flex items-center justify-center",children:e.jsx("img",{src:t,alt:`Portfolio ${i+1}`,className:"w-full h-full object-cover rounded-lg"})},i))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No portfolio items available."})})]})}),e.jsxs(U,{value:"discussions",className:"space-y-6",children:[o&&e.jsxs(j,{children:[e.jsxs(w,{children:[e.jsx(S,{children:"Start a Discussion"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your discussion will be sent to the artist for approval before being visible to others."})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsx(k,{placeholder:"Discussion title",value:B,onChange:t=>z(t.target.value)}),e.jsx(H,{placeholder:"What would you like to discuss?",value:T,onChange:t=>O(t.target.value),rows:4}),e.jsx(N,{onClick:be,disabled:W,className:"w-full",children:W?"Submitting...":"Submit for Approval"})]})]}),e.jsx("div",{className:"space-y-4",children:q.length>0?q.map(t=>{var i;return e.jsxs(j,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ce,{className:"h-8 w-8",children:[e.jsx(de,{src:t.user_avatar_url}),e.jsx(ue,{children:((i=t.user_display_name)==null?void 0:i.charAt(0))||"U"})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-lg",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",t.user_display_name," • ",new Date(t.created_at).toLocaleDateString()]})]})]}),t.is_pinned&&e.jsx(A,{variant:"secondary",children:"Pinned"})]})}),e.jsxs(C,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:t.content}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx("span",{children:t.likes_count})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.replies_count," replies"]})]})]})]})]},t.id)}):e.jsx(j,{children:e.jsx(C,{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No discussions yet. Be the first to start one!"})})})})]})]})]})}):e.jsx(L,{children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Artist not found"}),e.jsx(N,{onClick:()=>E("/book-artist"),children:"Browse Artists"})]})})};export{kt as default};
