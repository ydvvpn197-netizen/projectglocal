var Ce=Object.defineProperty,ke=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var re=(d,r,s)=>r in d?Ce(d,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[r]=s,T=(d,r)=>{for(var s in r||(r={}))Ee.call(r,s)&&re(d,s,r[s]);if(ae)for(var s of ae(r))Ue.call(r,s)&&re(d,s,r[s]);return d},B=(d,r)=>ke(d,Se(r));var p=(d,r,s)=>new Promise((i,a)=>{var x=m=>{try{l(s.next(m))}catch(C){a(C)}},h=m=>{try{l(s.throw(m))}catch(C){a(C)}},l=m=>m.done?i(m.value):Promise.resolve(m.value).then(x,h);l((s=s.apply(d,r)).next())});import{s as _,u as ee,g as se,r as u,j as e,C as v,v as N,B as y,f as ce,G as De}from"./main-jfCIwKxb.js";import{S as G,A as de,b as me,c as ue,R as Q}from"./ResponsiveLayout-Dd-U-XTf.js";import{I as Y}from"./index-DGobKVbi.js";import{B as V}from"./badge-Cxniq3nT.js";import{T as xe,a as he,b as q,c as z}from"./tabs-Bho2AISw.js";import{D as ge,e as pe,a as fe,b as je,c as ve,d as Ne}from"./dialog-Db9VuKsi.js";import{T as Pe}from"./textarea-Dm2RgXBl.js";import{L as O}from"./label-BhjyL16S.js";import{u as Te,T as H,M as Be,a as ye}from"./usePoints-Dnu7EIBD.js";import{Z as te}from"./zap-C2TAeX5H.js";import{T as we}from"./trending-up-XhhBv7nP.js";import{A as Me}from"./award-CeTAlyPH.js";import{S as be}from"./share-2-DOcEOH4v.js";import{C as $}from"./calendar-CXbnSY_4.js";import{H as Ae,P as _e}from"./plus-Bi3vU8QF.js";import{M as Z}from"./message-circle-BzbuDOEE.js";import{S as Fe}from"./search-DIpOLffQ.js";import{F as Le}from"./filter-IFAci8Bw.js";import{S as Ie}from"./send-DzW_Bs8U.js";import{C as K}from"./clock-CT2ky6hG.js";import{M as $e}from"./more-horizontal-70T_MGi1.js";import{f as Re}from"./index-vtwxq0WP.js";import{L as W}from"./loader-2-iBg9Stez.js";import{C as qe}from"./camera-B3Yd7dEF.js";import{M as ie}from"./map-pin-B5hnRU36.js";import{P as ze}from"./pen-square-Ciuy6KYM.js";import{U as X}from"./alert-f_BC70aV.js";import{X as Je}from"./x-circle-kobPzj2Z.js";import{C as Oe}from"./check-circle-DlKkeJkD.js";import{F as He}from"./flame-CgtvzVnh.js";import{S as Ve}from"./shield-C-Scp_5m.js";import{C as Ye}from"./crown-T9wFyzOV.js";import"./separator-CQeeh5sy.js";import"./index-D6sgUugm.js";import"./index-CaL9moq2.js";import"./databaseUtils-Cc-GydU0.js";import"./scroll-area-Bsyy6uVd.js";import"./index-DCmZQWeX.js";import"./check-CWeqS_MX.js";import"./useNotifications-DlynYvan.js";import"./notificationService-DPR46Nx3.js";import"./bell-CXNc_0l5.js";import"./user-cZSM4iEh.js";import"./message-square-oWFCH1Pi.js";import"./wifi-Ue5kLFZw.js";import"./log-out-CxjypOOW.js";import"./pointsService-BEnKQBdP.js";import"./index-CFmCEJzK.js";class Ze{getUserProfile(r){return p(this,null,function*(){try{const{data:s,error:i}=yield _.from("profiles").select("*").eq("user_id",r).single();return i?(console.error("Error fetching user profile:",i),null):s}catch(s){return console.error("Error in getUserProfile:",s),null}})}updateUserProfile(r,s){return p(this,null,function*(){try{const{error:i}=yield _.from("profiles").update(B(T({},s),{updated_at:new Date().toISOString()})).eq("user_id",r);return i?(console.error("Error updating user profile:",i),{success:!1,error:i.message}):{success:!0}}catch(i){return console.error("Error in updateUserProfile:",i),{success:!1,error:i instanceof Error?i.message:"Unknown error occurred"}}})}getUserStats(r){return p(this,null,function*(){try{const{data:s}=yield _.from("events").select("id").eq("user_id",r),{data:i}=yield _.from("posts").select("id").eq("user_id",r),{data:a}=yield _.from("follows").select("id").eq("followed_id",r),{data:x}=yield _.from("follows").select("id").eq("follower_id",r),h=((s==null?void 0:s.length)||0)*10+((i==null?void 0:i.length)||0)*5+((a==null?void 0:a.length)||0)*2;return{eventsAttended:0,eventsCreated:(s==null?void 0:s.length)||0,communitiesJoined:0,postsCreated:(i==null?void 0:i.length)||0,followers:(a==null?void 0:a.length)||0,following:(x==null?void 0:x.length)||0,points:h}}catch(s){return console.error("Error fetching user stats:",s),{eventsAttended:0,eventsCreated:0,communitiesJoined:0,postsCreated:0,followers:0,following:0,points:0}}})}getUserPosts(r){return p(this,null,function*(){try{const{data:s,error:i}=yield _.from("posts").select(`
          id,
          title,
          content,
          likes_count,
          comments_count,
          created_at,
          image_url
        `).eq("user_id",r).order("created_at",{ascending:!1}).limit(10);return i?(console.error("Error fetching user posts:",i),[]):(s==null?void 0:s.map(a=>({id:a.id,title:a.title||"Untitled Post",content:a.content,likes:a.likes_count||0,comments:a.comments_count||0,date:this.formatRelativeDate(a.created_at),image:a.image_url})))||[]}catch(s){return console.error("Error in getUserPosts:",s),[]}})}getUserBookings(r){return p(this,null,function*(){try{const{data:s,error:i}=yield _.from("event_attendees").select(`
          id,
          status,
          events (
            id,
            title,
            image_url,
            event_date,
            event_time,
            location_name,
            location_city,
            location_state,
            location_country
          )
        `).eq("user_id",r).eq("status","attending").order("created_at",{ascending:!1}).limit(10);if(i)return console.error("Error fetching event attendees:",i),[];const{data:a,error:x}=yield _.from("artist_bookings").select(`
          id,
          event_date,
          event_location,
          event_description,
          status,
          artists (
            id,
            specialty,
            bio
          )
        `).eq("user_id",r).order("created_at",{ascending:!1}).limit(10);x&&console.error("Error fetching artist bookings:",x);const h=[];return s==null||s.forEach(l=>{if(l.events){const m=[l.events.location_city,l.events.location_state,l.events.location_country].filter(Boolean).join(", ")||l.events.location_name;h.push({id:l.id,eventTitle:l.events.title,eventImage:l.events.image_url||"",date:this.formatDate(l.events.event_date),time:l.events.event_time,location:m,status:l.status==="attending"?"confirmed":"pending",tickets:1})}}),a==null||a.forEach(l=>{var C,k;const m=((k=(C=l.artists)==null?void 0:C.specialty)==null?void 0:k[0])||"Artist";h.push({id:l.id,eventTitle:`${m} Booking`,eventImage:"",date:this.formatDate(l.event_date),time:"TBD",location:l.event_location,status:l.status,tickets:1})}),h.sort((l,m)=>new Date(m.date).getTime()-new Date(l.date).getTime()).slice(0,10)}catch(s){return console.error("Error in getUserBookings:",s),[]}})}getUserCommunities(r){return p(this,null,function*(){try{return[{id:"1",name:"Local Artists Collective",image:"https://images.unsplash.com/photo-1541961017774-22349e4a1262?w=100&h=100&fit=crop",members:234,role:"admin",joinedDate:"Jan 2024"},{id:"2",name:"Food Lovers United",image:"https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=100&h=100&fit=crop",members:456,role:"member",joinedDate:"Feb 2024"}]}catch(s){return console.error("Error in getUserCommunities:",s),[]}})}getUserBadges(r){return p(this,null,function*(){try{const s=yield this.getUserStats(r),i=[];return s.eventsCreated>=5&&i.push({id:1,name:"Community Leader",icon:"Crown",color:"bg-yellow-500",description:"Created 5+ successful events"}),s.postsCreated>=10&&i.push({id:2,name:"Top Contributor",icon:"Trophy",color:"bg-orange-500",description:"Top 10% contributor"}),s.followers>=100&&i.push({id:3,name:"Social Butterfly",icon:"Users",color:"bg-pink-500",description:"100+ followers"}),s.points>=1e3&&i.push({id:4,name:"Point Collector",icon:"Star",color:"bg-purple-500",description:"Earned 1000+ points"}),i}catch(s){return console.error("Error in getUserBadges:",s),[]}})}uploadAvatar(r,s){return p(this,null,function*(){try{const i=s.name.split(".").pop(),x=`avatars/${`${r}-${Date.now()}.${i}`}`,{error:h}=yield _.storage.from("avatars").upload(x,s);if(h)return console.error("Error uploading avatar:",h),{success:!1,error:h.message};const{data:{publicUrl:l}}=_.storage.from("avatars").getPublicUrl(x),{error:m}=yield _.from("profiles").update({avatar_url:l}).eq("user_id",r);return m?(console.error("Error updating profile with avatar:",m),{success:!1,error:m.message}):{success:!0,url:l}}catch(i){return console.error("Error in uploadAvatar:",i),{success:!1,error:i instanceof Error?i.message:"Unknown error occurred"}}})}formatRelativeDate(r){const s=new Date(r),a=Math.floor((new Date().getTime()-s.getTime())/(1e3*60*60));if(a<1)return"Just now";if(a<24)return`${a} hour${a>1?"s":""} ago`;const x=Math.floor(a/24);if(x<7)return`${x} day${x>1?"s":""} ago`;const h=Math.floor(x/7);return h<4?`${h} week${h>1?"s":""} ago`:s.toLocaleDateString()}formatDate(r){return r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"TBD"}}const M=new Ze,Qe=d=>{const{user:r}=ee(),{toast:s}=se(),[i,a]=u.useState(null),[x,h]=u.useState(null),[l,m]=u.useState([]),[C,k]=u.useState([]),[D,g]=u.useState([]),[A,F]=u.useState([]),[w,n]=u.useState(!0),[f,b]=u.useState(!1),c=r==null?void 0:r.id,j=u.useCallback(()=>p(void 0,null,function*(){if(!c){n(!1);return}try{n(!0);const o=yield M.getUserProfile(c);a(o)}catch(o){console.error("Error fetching profile:",o),s({title:"Error",description:"Failed to load profile data",variant:"destructive"})}finally{n(!1)}}),[c,s]),P=u.useCallback(()=>p(void 0,null,function*(){if(c)try{const o=yield M.getUserStats(c);h(o)}catch(o){console.error("Error fetching stats:",o)}}),[c]),U=u.useCallback(()=>p(void 0,null,function*(){if(c)try{const o=yield M.getUserPosts(c);m(o)}catch(o){console.error("Error fetching posts:",o)}}),[c]),L=u.useCallback(()=>p(void 0,null,function*(){if(c)try{const o=yield M.getUserBookings(c);k(o)}catch(o){console.error("Error fetching bookings:",o)}}),[c]),I=u.useCallback(()=>p(void 0,null,function*(){if(c)try{const o=yield M.getUserCommunities(c);g(o)}catch(o){console.error("Error fetching communities:",o)}}),[c]),E=u.useCallback(()=>p(void 0,null,function*(){if(c)try{const o=yield M.getUserBadges(c);F(o)}catch(o){console.error("Error fetching badges:",o)}}),[c]),J=u.useCallback(o=>p(void 0,null,function*(){if(!c)return s({title:"Error",description:"User not authenticated",variant:"destructive"}),{success:!1};try{b(!0);const S=yield M.updateUserProfile(c,o);return S.success?(s({title:"Success",description:"Profile updated successfully"}),yield j()):s({title:"Error",description:S.error||"Failed to update profile",variant:"destructive"}),S}catch(S){return console.error("Error updating profile:",S),s({title:"Error",description:"Failed to update profile",variant:"destructive"}),{success:!1,error:"Unknown error"}}finally{b(!1)}}),[c,s,j]),R=u.useCallback(o=>p(void 0,null,function*(){if(!c)return s({title:"Error",description:"User not authenticated",variant:"destructive"}),{success:!1};try{b(!0);const S=yield M.uploadAvatar(c,o);return S.success?(s({title:"Success",description:"Avatar uploaded successfully"}),yield j()):s({title:"Error",description:S.error||"Failed to upload avatar",variant:"destructive"}),S}catch(S){return console.error("Error uploading avatar:",S),s({title:"Error",description:"Failed to upload avatar",variant:"destructive"}),{success:!1,error:"Unknown error"}}finally{b(!1)}}),[c,s,j]),t=u.useCallback(()=>p(void 0,null,function*(){c&&(yield Promise.all([j(),P(),U(),L(),I(),E()]))}),[c,j,P,U,L,I,E]);return u.useEffect(()=>{t()},[t]),{profile:i,stats:x,posts:l,bookings:C,communities:D,badges:A,loading:w,updating:f,updateProfile:J,uploadAvatar:R,refreshAll:t,fetchProfile:j,fetchStats:P,fetchPosts:U,fetchBookings:L,fetchCommunities:I,fetchBadges:E}},ne=d=>d>=1e6?`${(d/1e6).toFixed(1)}M`:d>=1e3?`${(d/1e3).toFixed(1)}K`:d.toString(),We=d=>d<=3?e.jsx(H,{className:"w-4 h-4 text-yellow-500"}):d<=10?e.jsx(Be,{className:"w-4 h-4 text-gray-400"}):d<=50?e.jsx(G,{className:"w-4 h-4 text-blue-500"}):e.jsx(ye,{className:"w-4 h-4 text-gray-500"}),Xe=d=>d<=3?"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white":d<=10?"bg-gradient-to-r from-gray-300 to-gray-500 text-white":d<=50?"bg-gradient-to-r from-blue-400 to-blue-600 text-white":"bg-gray-100 text-gray-800",le=d=>{switch(d){case"post_created":return e.jsx(_e,{className:"w-4 h-4 text-green-500"});case"comment_created":return e.jsx(Z,{className:"w-4 h-4 text-blue-500"});case"post_like_received":case"comment_like_received":return e.jsx(Ae,{className:"w-4 h-4 text-red-500"});case"event_organized":return e.jsx($,{className:"w-4 h-4 text-purple-500"});case"event_attended":return e.jsx($,{className:"w-4 h-4 text-green-500"});case"post_shared":return e.jsx(be,{className:"w-4 h-4 text-orange-500"});case"poll_created":return e.jsx(Me,{className:"w-4 h-4 text-indigo-500"});case"poll_voted":return e.jsx(ye,{className:"w-4 h-4 text-cyan-500"});default:return e.jsx(te,{className:"w-4 h-4 text-gray-500"})}},oe=d=>{switch(d){case"post_created":return"Created a post";case"comment_created":return"Added a comment";case"post_like_received":return"Post received a like";case"comment_like_received":return"Comment received a like";case"post_like_given":return"Liked a post";case"comment_like_given":return"Liked a comment";case"event_organized":return"Organized an event";case"event_attended":return"Attended an event";case"post_shared":return"Shared a post";case"poll_created":return"Created a poll";case"poll_voted":return"Voted in a poll";case"post_deleted":return"Deleted a post";case"comment_deleted":return"Deleted a comment";case"event_deleted":return"Deleted an event";case"poll_deleted":return"Deleted a poll";default:return"Earned points"}},Ge=({userId:d,className:r="",showDetails:s=!0,compact:i=!1})=>{const{userPoints:a,loading:x,error:h,pointHistory:l,historyLoading:m}=Te(),[C,k]=u.useState(!1);if(x)return e.jsx(v,{className:`user-points-display ${r}`,children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-20 animate-pulse"})]})]})})});if(h||!a)return e.jsx(v,{className:`user-points-display ${r}`,children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(te,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Points not available"})]})})});const D=l.slice(0,5);return e.jsx(e.Fragment,{children:e.jsx(v,{className:`user-points-display ${r}`,children:e.jsx(N,{className:`${i?"p-3":"p-4"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-gradient-to-r from-orange-400 to-red-400 rounded-full",children:We(a.rank)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg text-orange-600",children:ne(a.total_points)}),e.jsxs(V,{className:`text-xs ${Xe(a.rank)}`,children:["Rank #",a.rank]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Community Points"})]})]}),s&&e.jsxs(ge,{open:C,onOpenChange:k,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(y,{variant:"outline",size:"sm",className:"text-orange-600 border-orange-200 hover:bg-orange-50",children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),"Details"]})}),e.jsxs(fe,{className:"max-w-md",children:[e.jsxs(je,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-orange-500"}),"Points Details"]}),e.jsx(Ne,{children:"Your community engagement history and points breakdown"})]}),e.jsxs(xe,{defaultValue:"overview",className:"w-full",children:[e.jsxs(he,{className:"grid w-full grid-cols-2",children:[e.jsx(q,{value:"overview",children:"Overview"}),e.jsx(q,{value:"history",children:"History"})]}),e.jsxs(z,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"font-bold text-2xl text-orange-600",children:ne(a.total_points)}),e.jsx("div",{className:"text-xs text-orange-700",children:"Total Points"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"font-bold text-2xl text-blue-600",children:["#",a.rank]}),e.jsx("div",{className:"text-xs text-blue-700",children:"Community Rank"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Recent Activity"}),D.length>0?e.jsx("div",{className:"space-y-2",children:D.map(g=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded",children:[le(g.transaction_type),e.jsx("div",{className:"flex-1 text-sm",children:oe(g.transaction_type)}),e.jsxs("span",{className:`text-xs font-semibold ${g.points>0?"text-green-600":"text-red-600"}`,children:[g.points>0?"+":"",g.points]})]},g.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No recent activity"})]})]}),e.jsx(z,{value:"history",className:"space-y-4",children:e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:m?e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((g,A)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded animate-pulse",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"flex-1 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-8 h-4 bg-gray-200 rounded"})]},A))}):l.length>0?l.map(g=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100",children:[le(g.transaction_type),e.jsx("div",{className:"flex-1 text-sm",children:oe(g.transaction_type)}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:`text-xs font-semibold ${g.points>0?"text-green-600":"text-red-600"}`,children:[g.points>0?"+":"",g.points]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(g.created_at).toLocaleDateString()})]})]},g.id)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No transaction history available"})})})]})]})]})]})})})})},Ke=({userId:d})=>{const{user:r}=ee(),{toast:s}=se(),i=ce(),[a,x]=u.useState([]),[h,l]=u.useState(!0),[m,C]=u.useState(""),k=u.useCallback(()=>p(void 0,null,function*(){if(r){l(!0);try{const{data:n,error:f}=yield _.from("chat_conversations").select("*").or(`client_id.eq.${r.id},artist_id.eq.${r.id}`).order("updated_at",{ascending:!1});if(f)throw f;const b=n||[],c=b.map(t=>t.id),{data:j,error:P}=yield _.from("chat_messages").select("id, conversation_id, message, created_at, sender_id").in("conversation_id",c).order("created_at",{ascending:!1});if(P)throw P;const U=new Map;(j||[]).forEach(t=>{U.has(t.conversation_id)||U.set(t.conversation_id,t)});const L=b.map(t=>t.client_id===r.id?t.artist_id:t.client_id),{data:I,error:E}=yield _.from("profiles").select("user_id, display_name, avatar_url").in("user_id",L);if(E)throw E;const J=new Map((I||[]).map(t=>[t.user_id,t])),R=b.map(t=>B(T({},t),{last_message:U.get(t.id),other_user:J.get(t.client_id===r.id?t.artist_id:t.client_id)}));x(R)}catch(n){console.error("Error fetching conversations:",n),s({title:"Error",description:"Failed to load messages. Please try again.",variant:"destructive"})}finally{l(!1)}}}),[r,s]);u.useEffect(()=>{r&&k()},[r,k]);const D=n=>{i(`/chat/${n}`)},g=a.filter(n=>{var c,j;if(!m)return!0;const f=((c=n.other_user)==null?void 0:c.display_name)||"",b=((j=n.last_message)==null?void 0:j.message)||"";return f.toLowerCase().includes(m.toLowerCase())||b.toLowerCase().includes(m.toLowerCase())}),A=n=>n.split(" ").map(f=>f.charAt(0)).join("").toUpperCase().slice(0,2),F=n=>{try{return Re(new Date(n),{addSuffix:!0})}catch(f){return"Unknown time"}},w=(n,f=50)=>n.length<=f?n:n.substring(0,f)+"...";return h?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Messages"})}),e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((n,f)=>e.jsx(v,{className:"animate-pulse",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})})},f))})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Messages"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>i("/messages"),className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"View All"]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:m,onChange:n=>C(n.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx(y,{variant:"outline",size:"sm",children:e.jsx(Le,{className:"w-4 h-4"})})]}),g.length===0?e.jsx(v,{children:e.jsxs(N,{className:"p-8 text-center",children:[e.jsx(Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:m?"No conversations found":"No messages yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:m?"Try adjusting your search terms":"Start a conversation with other users to see your messages here"}),!m&&e.jsxs(y,{onClick:()=>i("/messages"),children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Start Messaging"]})]})}):e.jsx("div",{className:"space-y-2",children:g.map(n=>{var f,b,c,j;return e.jsx(v,{className:"cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>D(n.id),children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(de,{className:"w-12 h-12",children:[e.jsx(me,{src:(f=n.other_user)==null?void 0:f.avatar_url,alt:(b=n.other_user)==null?void 0:b.display_name}),e.jsx(ue,{children:(c=n.other_user)!=null&&c.display_name?A(n.other_user.display_name):"U"})]}),n.status==="pending"&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 truncate",children:((j=n.other_user)==null?void 0:j.display_name)||"Unknown User"}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.last_message&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),F(n.last_message.created_at)]}),n.unread_count&&n.unread_count>0&&e.jsx(V,{variant:"destructive",className:"h-5 w-5 rounded-full p-0 text-xs flex items-center justify-center",children:n.unread_count})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 truncate",children:n.last_message?w(n.last_message.message):"No messages yet"}),e.jsxs("div",{className:"flex items-center gap-1",children:[n.status==="pending"&&e.jsx(V,{variant:"outline",className:"text-xs",children:"Pending"}),e.jsx(y,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx($e,{className:"w-4 h-4"})})]})]})]})]})})},n.id)})}),a.length>5&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs(y,{variant:"outline",onClick:()=>i("/messages"),className:"w-full",children:["View All Messages (",a.length,")"]})})]})},Qs=()=>{var R;const d=ce(),{user:r}=ee(),{toast:s}=se(),i=u.useRef(null),{profile:a,stats:x,bookings:h,communities:l,badges:m,loading:C,updating:k,updateProfile:D,uploadAvatar:g}=Qe(),[A,F]=u.useState(!1),[w,n]=u.useState({display_name:"",bio:"",location_city:"",location_state:"",location_country:""});u.useEffect(()=>{a&&n({display_name:a.display_name||"",bio:a.bio||"",location_city:a.location_city||"",location_state:a.location_state||"",location_country:a.location_country||""})},[a]);const f=()=>p(void 0,null,function*(){(yield D(w)).success&&F(!1)}),b=t=>p(void 0,null,function*(){var S;const o=(S=t.target.files)==null?void 0:S[0];if(o){if(!o.type.startsWith("image/")){s({title:"Invalid file type",description:"Please select an image file",variant:"destructive"});return}if(o.size>5*1024*1024){s({title:"File too large",description:"Please select an image smaller than 5MB",variant:"destructive"});return}yield g(o)}}),c=()=>{d("/create")},j=t=>{switch(t){case"confirmed":return e.jsx(Oe,{className:"w-4 h-4 text-green-500"});case"pending":return e.jsx(K,{className:"w-4 h-4 text-yellow-500"});case"cancelled":return e.jsx(Je,{className:"w-4 h-4 text-red-500"});default:return e.jsx(De,{className:"w-4 h-4 text-gray-500"})}},P=t=>{switch(t){case"confirmed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},U=t=>{switch(t){case"admin":return"bg-red-100 text-red-800";case"moderator":return"bg-blue-100 text-blue-800";case"member":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},L=t=>({Crown:Ye,Shield:Ve,Zap:te,Trophy:H,Calendar:$,Users:X,Star:G,Flame:He,TrendingUp:we})[t]||G,I=t=>{try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long"})}catch(o){return"Unknown"}};if(C)return e.jsx(Q,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading profile..."})]})})});if(!a)return e.jsx(Q,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Profile Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Unable to load profile data. Please try refreshing the page."}),e.jsx(y,{onClick:()=>window.location.reload(),children:"Refresh Page"})]})});const E=(a==null?void 0:a.display_name)||((R=r==null?void 0:r.email)==null?void 0:R.split("@")[0])||"User",J=a&&[a.location_city,a.location_state,a.location_country].filter(Boolean).join(", ")||"Location not set";return e.jsx(Q,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs(v,{className:"relative overflow-hidden",children:[e.jsx("div",{className:"h-32 bg-gradient-to-r from-purple-500 to-pink-500"}),e.jsx(N,{className:"relative pt-0",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-6",children:[e.jsxs("div",{className:"relative -mt-16",children:[e.jsxs(de,{className:"w-32 h-32 border-4 border-white shadow-lg",children:[e.jsx(me,{src:(a==null?void 0:a.avatar_url)||void 0,alt:E}),e.jsx(ue,{className:"text-2xl font-bold bg-gradient-to-br from-primary to-primary/80 text-primary-foreground",children:E.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2)})]}),e.jsx(y,{size:"icon",className:"absolute bottom-0 right-0 rounded-full",onClick:()=>{var t;return(t=i.current)==null?void 0:t.click()},disabled:k,children:k?e.jsx(W,{className:"w-4 h-4 animate-spin"}):e.jsx(qe,{className:"w-4 h-4"})}),e.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:b,className:"hidden"})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:E}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-4 h-4"}),J]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-4 h-4"}),"Joined ",I((a==null?void 0:a.created_at)||"")]})]}),e.jsx("p",{className:"text-muted-foreground max-w-2xl",children:(a==null?void 0:a.bio)||"No bio available"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"outline",size:"sm",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Share Profile"]}),e.jsxs(ge,{open:A,onOpenChange:F,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(y,{size:"sm",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Edit Profile"]})}),e.jsxs(fe,{className:"max-w-2xl",children:[e.jsxs(je,{children:[e.jsx(ve,{children:"Edit Profile"}),e.jsx(Ne,{children:"Update your profile information and settings"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"display_name",children:"Display Name"}),e.jsx(Y,{id:"display_name",value:w.display_name,onChange:t=>n(B(T({},w),{display_name:t.target.value})),placeholder:"Enter your display name"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"bio",children:"Bio"}),e.jsx(Pe,{id:"bio",value:w.bio,onChange:t=>n(B(T({},w),{bio:t.target.value})),rows:4,placeholder:"Tell us about yourself..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"location_city",children:"City"}),e.jsx(Y,{id:"location_city",value:w.location_city,onChange:t=>n(B(T({},w),{location_city:t.target.value})),placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"location_state",children:"State"}),e.jsx(Y,{id:"location_state",value:w.location_state,onChange:t=>n(B(T({},w),{location_state:t.target.value})),placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"location_country",children:"Country"}),e.jsx(Y,{id:"location_country",value:w.location_country,onChange:t=>n(B(T({},w),{location_country:t.target.value})),placeholder:"Country"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(y,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(y,{onClick:f,disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})]})]})]})]})})]})})]}),x&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(v,{children:e.jsxs(N,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:x.eventsCreated}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Events Created"})]})}),e.jsx(v,{children:e.jsxs(N,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:x.postsCreated}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Posts Created"})]})}),e.jsx(v,{children:e.jsxs(N,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:x.communitiesJoined}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Communities"})]})}),e.jsx(v,{children:e.jsx(N,{className:"p-4 text-center",children:e.jsx(Ge,{compact:!0,showDetails:!1})})})]}),e.jsxs(xe,{defaultValue:"messages",className:"space-y-6",children:[e.jsxs(he,{className:"grid w-full grid-cols-4",children:[e.jsxs(q,{value:"messages",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Messages"]}),e.jsxs(q,{value:"bookings",className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Bookings"]}),e.jsxs(q,{value:"communities",className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Communities"]}),e.jsxs(q,{value:"badges",className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Badges"]})]}),e.jsx(z,{value:"messages",className:"space-y-4",children:r&&e.jsx(Ke,{userId:r.id})}),e.jsxs(z,{value:"bookings",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Upcoming Bookings"}),e.jsx(y,{className:"btn-event",asChild:!0,children:e.jsx("a",{href:"/events",children:"Browse Events"})})]}),h.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(t=>e.jsx(v,{className:"event-card",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[t.eventImage&&e.jsx("img",{src:t.eventImage,alt:t.eventTitle,className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold mb-1",children:t.eventTitle}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),t.date]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),t.time]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),t.location]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(V,{className:P(t.status),children:[j(t.status),e.jsx("span",{className:"ml-1 capitalize",children:t.status})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.tickets," ticket",t.tickets>1?"s":""]})]})]})]})})},t.id))}):e.jsx(v,{children:e.jsxs(N,{className:"p-8 text-center",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Bookings Yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Start exploring events and make your first booking!"}),e.jsx(y,{asChild:!0,children:e.jsx("a",{href:"/events",children:"Browse Events"})})]})})]}),e.jsxs(z,{value:"communities",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"My Communities"}),e.jsx(y,{className:"btn-community",asChild:!0,children:e.jsx("a",{href:"/community",children:"Discover Communities"})})]}),l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(t=>e.jsx(v,{className:"community-card",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:t.image,alt:t.name,className:"w-16 h-16 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold mb-1",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:U(t.role),children:t.role}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.members," members"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Joined ",t.joinedDate]})]})]})})},t.id))}):e.jsx(v,{children:e.jsxs(N,{className:"p-8 text-center",children:[e.jsx(X,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Communities Yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Join communities to connect with like-minded people!"}),e.jsx(y,{asChild:!0,children:e.jsx("a",{href:"/community",children:"Discover Communities"})})]})})]}),e.jsxs(z,{value:"badges",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Achievement Badges"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[m.length," badges earned"]})]}),m.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(t=>{const o=L(t.icon);return e.jsx(v,{className:"trending-card",children:e.jsxs(N,{className:"p-6 text-center",children:[e.jsx("div",{className:`w-16 h-16 ${t.color} rounded-full flex items-center justify-center mx-auto mb-4`,children:e.jsx(o,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-semibold mb-2",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]})},t.id)})}):e.jsx(v,{children:e.jsxs(N,{className:"p-8 text-center",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Badges Yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Start engaging with the community to earn badges!"}),e.jsxs(y,{onClick:c,children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Create Your First Post"]})]})})]})]})]})})};export{Qs as default};
