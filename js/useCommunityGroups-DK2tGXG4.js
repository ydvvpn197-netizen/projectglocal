var e=(e,r,t)=>new Promise((i,o)=>{var u=e=>{try{n(t.next(e))}catch(r){o(r)}},l=e=>{try{n(t.throw(e))}catch(r){o(r)}},n=e=>e.done?i(e.value):Promise.resolve(e.value).then(u,l);n((t=t.apply(e,r)).next())});import{r,d as t,u as i}from"./main-6fHUpRzT.js";import{C as o}from"./communityService-D7kOi2Hb.js";const u=()=>{const[u,l]=r.useState([]),[n,s]=r.useState([]),[c,a]=r.useState([]),[d,p]=r.useState(!0),[v,y]=r.useState(!1),{toast:f}=t(),{user:g}=i(),h=r.useCallback(r=>e(void 0,null,function*(){try{p(!0);const e=yield o.getGroups(r);l(e)}catch(e){f({title:"Error",description:"Failed to fetch groups",variant:"destructive"})}finally{p(!1)}}),[f]),m=r.useCallback(()=>e(void 0,null,function*(){if(g)try{const e=yield o.getUserGroups(g.id);s(e)}catch(e){}}),[g]),G=r.useCallback((r=10)=>e(void 0,null,function*(){try{const e=yield o.getTrendingGroups(r);a(e)}catch(e){}}),[]),b=r.useCallback(r=>e(void 0,null,function*(){if(!g)return f({title:"Error",description:"You must be logged in to create groups",variant:"destructive"}),null;try{y(!0);const e=yield o.createGroup(r);if(e)return f({title:"Success",description:"Group created successfully!"}),yield h(),yield m(),e;throw new Error("Failed to create group")}catch(e){return f({title:"Error",description:"Failed to create group",variant:"destructive"}),null}finally{y(!1)}}),[g,f,h,m]),E=r.useCallback(r=>e(void 0,null,function*(){if(!g)return f({title:"Error",description:"You must be logged in to join groups",variant:"destructive"}),!1;try{if(yield o.addGroupMember(r,g.id))return f({title:"Success",description:"Joined group successfully!"}),yield h(),yield m(),!0;throw new Error("Failed to join group")}catch(e){let r="Failed to join group";return"23505"===(null==e?void 0:e.code)?r="You are already a member of this group":(null==e?void 0:e.message)&&(r=e.message),f({title:"Error",description:r,variant:"destructive"}),!1}}),[g,f,h,m]),C=r.useCallback(r=>e(void 0,null,function*(){if(!g)return f({title:"Error",description:"You must be logged in to leave groups",variant:"destructive"}),!1;try{if(yield o.removeGroupMember(r,g.id))return f({title:"Success",description:"Left group successfully!"}),yield h(),yield m(),!0;throw new Error("Failed to leave group")}catch(e){return f({title:"Error",description:"Failed to leave group",variant:"destructive"}),!1}}),[g,f,h,m]),k=r.useCallback(r=>e(void 0,null,function*(){if(!g)return!1;try{return yield o.isGroupMember(r,g.id)}catch(e){return!1}}),[g]),S=r.useCallback(r=>e(void 0,null,function*(){if(!g)return null;try{return yield o.getUserRole(r,g.id)}catch(e){return null}}),[g]),w=r.useCallback((r,t)=>e(void 0,null,function*(){try{return yield o.searchGroups(r,t)}catch(e){return f({title:"Error",description:"Failed to search groups",variant:"destructive"}),[]}}),[f]);return r.useEffect(()=>{(()=>{e(void 0,null,function*(){try{yield h(),yield m(),yield G()}catch(e){}})})()},[h,m,G]),{groups:u,userGroups:n,trendingGroups:c,loading:d,creating:v,fetchGroups:h,fetchUserGroups:m,fetchTrendingGroups:G,createGroup:b,joinGroup:E,leaveGroup:C,isGroupMember:k,getUserRole:S,searchGroups:w}};export{u};
