var e=(e,s,a)=>new Promise((t,i)=>{var r=e=>{try{n(a.next(e))}catch(s){i(s)}},l=e=>{try{n(a.throw(e))}catch(s){i(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,l);n((a=a.apply(e,s)).next())});import{r as s,j as a,C as t,y as i,B as r,v as l,w as n,x as o,b as c,u as m,d,L as x}from"./main-6fHUpRzT.js";import{S as h,R as u}from"./ResponsiveLayout-Bc2JEU4o.js";import{I as j}from"./input-C0XSs2D-.js";import{B as p}from"./badge-Bj-CyBpD.js";import{S as g,a as N,b as f,c as v,d as b}from"./select-CsS9Kpur.js";import{A as y,a as w,b as C,i as _,P as k}from"./sheet-D2smYKYW.js";import{u as S,T as L,a as P,M as T}from"./usePoints-CbNlRcUn.js";import{T as M}from"./trending-up-EJ6gDKFP.js";import{Z as A}from"./zap-Dyj-3m1T.js";import{U as F}from"./users-Czby48qY.js";import"./label-B5VpaZlr.js";import"./textarea-DdxXr3wS.js";import"./tabs-BNobDGc4.js";import{u as z}from"./useCommunityGroups-DK2tGXG4.js";import{u as $}from"./useLocation-Bl6dvRZN.js";import{C as D}from"./communityService-D7kOi2Hb.js";import{L as J}from"./loader-2-CTqUz6P4.js";import{M as G}from"./more-horizontal-Km-67MNI.js";import{M as U}from"./message-circle-clGX_rmg.js";import{S as E}from"./search-CeL_nYcN.js";import{G as I,L as R}from"./list-BKTfrDzq.js";import{M as B}from"./map-pin-DJOBTPKn.js";import{C as V}from"./index-YNlOS8aM.js";import"./separator-55ip2E4B.js";import"./NotificationBell-C-odGad4.js";import"./Combination-Bb2n9b59.js";import"./scroll-area-DRpKKhsW.js";import"./index-BlbmBgSN.js";import"./index-jVOyRz7F.js";import"./useNotifications-DlOFbLc9.js";import"./check-BVB7WkBF.js";import"./bell-DFXHEubE.js";import"./user-DoINJrqZ.js";import"./index-GQUAIkZv.js";import"./NotificationButton-CnmvsVP-.js";import"./message-square-BNIlY-fX.js";import"./alert-BCcU8rrr.js";import"./wifi-D7M5OVnX.js";import"./log-out-B3lkkfQi.js";import"./index-WEre3Vep.js";import"./chevron-up-k-AfHmE-.js";import"./pointsService-BOpHKILN.js";import"./locationService-BtZ0rgoF.js";const O=[{value:"5",label:"Top 5"},{value:"20",label:"Top 20"},{value:"50",label:"Top 50"},{value:"100",label:"Top 100"},{value:"1000",label:"Top 1000"}],q=e=>{switch(e){case 1:return a.jsx(L,{className:"w-5 h-5 text-yellow-500"});case 2:return a.jsx(T,{className:"w-5 h-5 text-gray-400"});case 3:return a.jsx(T,{className:"w-5 h-5 text-amber-600"});default:return a.jsx(_,{className:"w-4 h-4 text-blue-500"})}},K=e=>{switch(e){case 1:return"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white";case 2:return"bg-gradient-to-r from-gray-300 to-gray-500 text-white";case 3:return"bg-gradient-to-r from-amber-500 to-amber-700 text-white";default:return"bg-blue-100 text-blue-800"}},W=e=>e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString(),Y=({className:e="",showTitle:c=!0,defaultLimit:m=5,showFilters:d=!0,showUserPosition:x=!0})=>{const{leaderboard:u,leaderboardLoading:j,leaderboardError:_,userPoints:k,refreshLeaderboard:T}=S(),[z,$]=s.useState(m.toString()),[D,J]=s.useState(!1);s.useEffect(()=>{T(parseInt(z))},[z,T]);const G=D?u:u.slice(0,5);return _?a.jsx(t,{className:`community-leaderboard ${e}`,children:a.jsx(i,{className:"p-6",children:a.jsxs("div",{className:"text-center text-red-500",children:[a.jsx(M,{className:"w-8 h-8 mx-auto mb-2"}),a.jsx("p",{children:"Failed to load leaderboard"}),a.jsx(r,{variant:"outline",size:"sm",onClick:()=>T(parseInt(z)),className:"mt-2",children:"Try Again"})]})})}):a.jsxs(t,{className:`community-leaderboard ${e}`,children:[a.jsx(l,{className:"pb-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"p-2 bg-gradient-to-r from-orange-500 to-red-500 rounded-lg",children:a.jsx(L,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx(n,{className:"text-lg",children:"Community Leaderboard"}),a.jsx(o,{children:"Top contributors this month"})]})]}),d&&a.jsxs(g,{value:z,onValueChange:e=>{$(e)},children:[a.jsx(N,{className:"w-32",children:a.jsx(f,{})}),a.jsx(v,{children:O.map(e=>a.jsx(b,{value:e.value,children:e.label},e.value))})]})]})}),a.jsx(i,{className:"space-y-4",children:j?a.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,s)=>a.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border",children:[a.jsx(h,{className:"w-8 h-8 rounded-full"}),a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsx(h,{className:"h-4 w-32"}),a.jsx(h,{className:"h-3 w-20"})]}),a.jsx(h,{className:"w-16 h-6"})]},s))}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"space-y-2",children:G.map((e,s)=>{var t,i;return a.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border transition-all duration-200 hover:shadow-md "+(s<3?"bg-gradient-to-r from-orange-50 to-red-50 border-orange-200":"hover:bg-gray-50"),children:[a.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:q(e.rank)}),a.jsxs(y,{className:"w-10 h-10",children:[a.jsx(w,{src:e.avatar_url||"",alt:e.display_name||"User"}),a.jsx(C,{className:"bg-gradient-to-r from-orange-400 to-red-400 text-white font-semibold",children:(null==(i=null==(t=e.display_name)?void 0:t.charAt(0))?void 0:i.toUpperCase())||"U"})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:e.display_name||"Anonymous User"}),s<3&&a.jsxs(p,{className:`text-xs ${K(e.rank)}`,children:["#",e.rank]})]}),a.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[a.jsx(A,{className:"w-3 h-3"}),a.jsxs("span",{children:[W(e.total_points)," points"]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"font-bold text-lg text-orange-600",children:W(e.total_points)}),a.jsx("div",{className:"text-xs text-muted-foreground",children:"points"})]})]},e.user_id)})}),u.length>5&&a.jsx("div",{className:"text-center pt-2",children:a.jsx(r,{variant:"outline",size:"sm",onClick:()=>{J(!D)},className:"text-orange-600 border-orange-200 hover:bg-orange-50",children:D?"Show Less":`Show More (${u.length-5} more)`})}),x&&k&&a.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:a.jsx(P,{className:"w-4 h-4 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-sm text-blue-900",children:"Your Position"}),a.jsxs("p",{className:"text-xs text-blue-700",children:["Rank #",k.rank]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"font-bold text-lg text-blue-600",children:W(k.total_points)}),a.jsx("div",{className:"text-xs text-blue-700",children:"your points"})]})]})}),!j&&0===u.length&&a.jsxs("div",{className:"text-center py-8",children:[a.jsx(F,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),a.jsx("p",{className:"text-gray-500",children:"No leaderboard data available"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Start engaging to earn points!"})]})]})})]})},H=["All Categories","Arts & Culture","Technology","Food & Dining","Outdoors","Education","Business","Health & Wellness","Sports","Music","Photography","General"],Q=()=>{const l=c(),{groups:n,loading:o,fetchGroups:h,joinGroup:y}=z();$();const{user:w}=m(),{toast:C}=d(),[S,L]=s.useState(""),[P,T]=s.useState("All Categories"),[M,A]=s.useState("grid"),[O,q]=s.useState("recent"),[K,W]=s.useState(null);s.useEffect(()=>{(()=>{e(void 0,null,function*(){try{yield h()}catch(e){C({title:"Error",description:"Failed to load communities. Please try again.",variant:"destructive"})}})})()},[h,C]);const Q=[...n.filter(e=>{const s=e.name.toLowerCase().includes(S.toLowerCase())||e.description&&e.description.toLowerCase().includes(S.toLowerCase()),a="All Categories"===P||e.category===P;return s&&a})].sort((e,s)=>{switch(O){case"members":return(s.member_count||0)-(e.member_count||0);case"recent":return new Date(s.created_at).getTime()-new Date(e.created_at).getTime();case"activity":return(s.post_count||0)-(e.post_count||0);default:return 0}}),X=n.filter(e=>(e.member_count||0)>10),Z=s=>e(void 0,null,function*(){if(w){if(K!==s)try{W(s);const e=yield D.validateGroupForJoining(s,w.id);if(!e.isValid)return void C({title:"Cannot Join Community",description:e.errors.join(", "),variant:"destructive"});(yield y(s))&&(yield h())}catch(e){let s="Failed to join community. Please try again.";(null==e?void 0:e.message)&&(s=e.message.includes("Group not found")?"This community no longer exists.":e.message.includes("Invalid group or user ID")?"Invalid community or user information.":e.message.includes("Cannot join private group")?"This is a private community.":e.message.includes("already a member")?"You are already a member of this community.":e.message),C({title:"Error",description:s,variant:"destructive"})}finally{W(null)}}else C({title:"Authentication Required",description:"Please log in to join communities",variant:"destructive"})});return o?a.jsx(u,{children:a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(J,{className:"h-6 w-6 animate-spin"}),a.jsx("span",{children:"Loading communities..."})]})})}):a.jsx(u,{children:a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"Communities"}),a.jsx("p",{className:"text-muted-foreground mt-2",children:"Discover and join communities that match your interests"})]}),a.jsx(r,{className:"btn-community",asChild:!0,children:a.jsxs(x,{to:"/community/create-group",onClick:()=>{h()},children:[a.jsx(k,{className:"w-4 h-4 mr-2"}),"Create Community"]})})]}),a.jsx("section",{className:"space-y-4",children:a.jsx(Y,{className:"mb-8",showTitle:!0,defaultLimit:5,showFilters:!0,showUserPosition:!0})}),!1,X.length>0&&a.jsxs("section",{className:"space-y-4",children:[a.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[a.jsx(_,{className:"w-5 h-5 text-yellow-500"}),"Featured Communities"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:X.map(e=>a.jsxs(t,{className:"community-card-featured group cursor-pointer hover:shadow-community transition-all duration-300",onClick:()=>l(`/community/${e.id}`),children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-blue-500 to-purple-600 rounded-t-lg flex items-center justify-center",children:a.jsx(F,{className:"w-16 h-16 text-white opacity-80"})}),a.jsx("div",{className:"absolute top-3 right-3 flex gap-2",children:a.jsxs(p,{className:"bg-yellow-500 text-white",children:[a.jsx(_,{className:"w-3 h-3 mr-1"}),"Featured"]})})]}),a.jsxs(i,{className:"p-4",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("h3",{className:"font-semibold text-lg",children:e.name}),a.jsx(r,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>{e.stopPropagation()},children:a.jsx(G,{className:"w-4 h-4"})})]}),a.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.description||"No description available"}),a.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(F,{className:"w-4 h-4"}),e.member_count||0," members"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(U,{className:"w-4 h-4"}),e.post_count||0," posts"]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(p,{variant:"secondary",className:"text-xs",children:["#",e.category]}),a.jsxs(r,{className:"w-full btn-community",onClick:s=>{s.stopPropagation(),Z(e.id)},disabled:K===e.id,children:[K===e.id?a.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}):a.jsx(F,{className:"w-4 h-4 mr-2"}),K===e.id?"Joining...":"Join Community"]})]})]})]},e.id))})]}),a.jsx("section",{className:"space-y-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),a.jsx(j,{placeholder:"Search communities...",value:S,onChange:e=>L(e.target.value),className:"pl-10"})]})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(g,{value:P,onValueChange:T,children:[a.jsx(N,{className:"w-[180px]",children:a.jsx(f,{})}),a.jsx(v,{children:H.map(e=>a.jsx(b,{value:e,children:e},e))})]}),a.jsxs(g,{value:O,onValueChange:q,children:[a.jsx(N,{className:"w-[140px]",children:a.jsx(f,{})}),a.jsxs(v,{children:[a.jsx(b,{value:"recent",children:"Most Recent"}),a.jsx(b,{value:"members",children:"Most Members"}),a.jsx(b,{value:"activity",children:"Most Active"})]})]}),a.jsxs("div",{className:"flex border rounded-md",children:[a.jsx(r,{variant:"grid"===M?"default":"ghost",size:"sm",onClick:()=>A("grid"),className:"rounded-r-none",children:a.jsx(I,{className:"w-4 h-4"})}),a.jsx(r,{variant:"list"===M?"default":"ghost",size:"sm",onClick:()=>A("list"),className:"rounded-l-none",children:a.jsx(R,{className:"w-4 h-4"})})]})]})]})}),a.jsxs("section",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"All Communities"}),a.jsxs("div",{className:"text-sm text-muted-foreground",children:[Q.length," communities found"]})]}),"grid"===M?a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Q.map(e=>a.jsxs(t,{className:"community-card group cursor-pointer hover:shadow-community transition-all duration-300",onClick:()=>l(`/community/${e.id}`),children:[a.jsx("div",{className:"relative",children:a.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-blue-500 to-purple-600 rounded-t-lg flex items-center justify-center",children:a.jsx(F,{className:"w-16 h-16 text-white opacity-80"})})}),a.jsxs(i,{className:"p-4",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("h3",{className:"font-semibold text-lg",children:e.name}),a.jsx(r,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>{e.stopPropagation()},children:a.jsx(G,{className:"w-4 h-4"})})]}),a.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.description||"No description available"}),a.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(F,{className:"w-4 h-4"}),e.member_count||0," members"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(U,{className:"w-4 h-4"}),e.post_count||0," posts"]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(p,{variant:"secondary",className:"text-xs",children:["#",e.category]}),a.jsxs(r,{className:"w-full btn-community",onClick:s=>{s.stopPropagation(),Z(e.id)},disabled:K===e.id,children:[K===e.id?a.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}):a.jsx(F,{className:"w-4 h-4 mr-2"}),K===e.id?"Joining...":"Join Community"]})]})]})]},e.id))}):a.jsx("div",{className:"space-y-4",children:Q.map(e=>a.jsx(t,{className:"community-card group cursor-pointer hover:shadow-community transition-all duration-300",onClick:()=>l(`/community/${e.id}`),children:a.jsx(i,{className:"p-6",children:a.jsxs("div",{className:"flex gap-6",children:[a.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:a.jsx(F,{className:"w-12 h-12 text-white opacity-80"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg flex items-center gap-2",children:e.name}),a.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:e.description||"No description available"})]}),a.jsx(r,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>{e.stopPropagation()},children:a.jsx(G,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"flex items-center gap-6 text-sm text-muted-foreground mb-3",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(F,{className:"w-4 h-4"}),e.member_count||0," members"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(U,{className:"w-4 h-4"}),e.post_count||0," posts"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(B,{className:"w-4 h-4"}),e.location_city||"Local"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(V,{className:"w-4 h-4"}),new Date(e.created_at).toLocaleDateString()]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex gap-2",children:a.jsxs(p,{variant:"secondary",className:"text-xs",children:["#",e.category]})}),a.jsxs(r,{className:"btn-community",onClick:s=>{s.stopPropagation(),Z(e.id)},disabled:K===e.id,children:[K===e.id?a.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}):a.jsx(F,{className:"w-4 h-4 mr-2"}),K===e.id?"Joining...":"Join Community"]})]})]})]})})},e.id))})]}),0===Q.length&&a.jsx(t,{className:"text-center py-12",children:a.jsxs(i,{children:[a.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(E,{className:"w-8 h-8 text-muted-foreground"})}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No communities found"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your search criteria or create a new community"}),a.jsx(r,{className:"btn-community",asChild:!0,children:a.jsxs(x,{to:"/community/create-group",children:[a.jsx(k,{className:"w-4 h-4 mr-2"}),"Create Community"]})})]})})]})})};export{Q as default};
