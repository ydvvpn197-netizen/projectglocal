var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,i=(e,s)=>{for(var t in s||(s={}))n.call(s,t)&&r(e,t,s[t]);if(a)for(var t of a(s))o.call(s,t)&&r(e,t,s[t]);return e},l=(e,a)=>s(e,t(a)),c=(e,s)=>{var t={};for(var r in e)n.call(e,r)&&s.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&a)for(var r of a(e))s.indexOf(r)<0&&o.call(e,r)&&(t[r]=e[r]);return t},d=(e,s,t)=>new Promise((a,n)=>{var o=e=>{try{i(t.next(e))}catch(s){n(s)}},r=e=>{try{i(t.throw(e))}catch(s){n(s)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,r);i((t=t.apply(e,s)).next())});import{s as u,r as m,a1 as p,h,j as f,a2 as x,i as v,a3 as useId,k as g,P as j,l as b,a4 as N,m as y,a5 as _,a6 as w,a7 as C,a8 as P,a9 as k,R as React,f as O,u as A,b as R,B as D}from"./index-B5IYdG7F.js";import{B as F}from"./badge-Dh5Uj8vN.js";import{h as M,R as E,u as z,F as G}from"./Combination-BxRIZ8rt.js";import{S as I}from"./scroll-area-Beiyt5Kx.js";import{u as S,D as T,a as q,b as B,e as H}from"./useNotifications-C0wifgqF.js";import{T as L,a as U,b as K,c as W}from"./tabs-DPPBWbFC.js";import{B as $}from"./bell-qeMkXRtc.js";import{C as V}from"./check-C9wwFfOs.js";import{S as J}from"./settings-DSEWn2wM.js";import{U as Z}from"./user-UOowhO7W.js";import{M as Q,T as X,f as Y}from"./index-DWtoKlrM.js";function ee(e){return d(this,null,function*(){try{const{data:s,error:t}=yield u.from(e).select("*").limit(1);return t?t.message.includes("relation")&&t.message.includes("does not exist")?{exists:!1,error:t.message}:{exists:!0,error:t.message}:{exists:!0}}catch(s){return{exists:!1,error:s.message}}})}function se(){return{campaigns:[],referralCode:null,socialShares:[],promotionalCodes:[]}}function te(){return{location_radius_km:50,location_notifications:!0,email_notifications:!0,push_notifications:!0,theme:"light",language:"en",timezone:"UTC",category:"general"}}var ae="Popover",[ne,oe]=v(ae,[p]),re=p(),[ie,le]=ne(ae),ce=e=>{const{__scopePopover:s,children:t,open:a,defaultOpen:n,onOpenChange:o,modal:r=!1}=e,c=re(s),d=m.useRef(null),[u,p]=m.useState(!1),[v,g]=h({prop:a,defaultProp:null!=n&&n,onChange:o,caller:ae});return f.jsx(x,l(i({},c),{children:f.jsx(ie,{scope:s,contentId:useId(),triggerRef:d,open:v,onOpenChange:g,onOpenToggle:m.useCallback(()=>g(e=>!e),[g]),hasCustomAnchor:u,onCustomAnchorAdd:m.useCallback(()=>p(!0),[]),onCustomAnchorRemove:m.useCallback(()=>p(!1),[]),modal:r,children:t})}))};ce.displayName=ae;var de="PopoverAnchor";m.forwardRef((e,s)=>{const t=e,{__scopePopover:a}=t,n=c(t,["__scopePopover"]),o=le(de,a),r=re(a),{onCustomAnchorAdd:d,onCustomAnchorRemove:u}=o;return m.useEffect(()=>(d(),()=>u()),[d,u]),f.jsx(N,l(i(i({},r),n),{ref:s}))}).displayName=de;var ue="PopoverTrigger",me=m.forwardRef((e,s)=>{const t=e,{__scopePopover:a}=t,n=c(t,["__scopePopover"]),o=le(ue,a),r=re(a),d=g(s,o.triggerRef),u=f.jsx(j.button,l(i({type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":we(o.open)},n),{ref:d,onClick:b(e.onClick,o.onOpenToggle)}));return o.hasCustomAnchor?u:f.jsx(N,l(i({asChild:!0},r),{children:u}))});me.displayName=ue;var pe="PopoverPortal",[he,fe]=ne(pe,{forceMount:void 0}),xe=e=>{const{__scopePopover:s,forceMount:t,children:a,container:n}=e,o=le(pe,s);return f.jsx(he,{scope:s,forceMount:t,children:f.jsx(y,{present:t||o.open,children:f.jsx(_,{asChild:!0,container:n,children:a})})})};xe.displayName=pe;var ve="PopoverContent",ge=m.forwardRef((e,s)=>{const t=fe(ve,e.__scopePopover),a=e,{forceMount:n=t.forceMount}=a,o=c(a,["forceMount"]),r=le(ve,e.__scopePopover);return f.jsx(y,{present:n||r.open,children:r.modal?f.jsx(be,l(i({},o),{ref:s})):f.jsx(Ne,l(i({},o),{ref:s}))})});ge.displayName=ve;var je=w("PopoverContent.RemoveScroll"),be=m.forwardRef((e,s)=>{const t=le(ve,e.__scopePopover),a=m.useRef(null),n=g(s,a),o=m.useRef(!1);return m.useEffect(()=>{const e=a.current;if(e)return M(e)},[]),f.jsx(E,{as:je,allowPinchZoom:!0,children:f.jsx(ye,l(i({},e),{ref:n,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:b(e.onCloseAutoFocus,e=>{var s;e.preventDefault(),o.current||null==(s=t.triggerRef.current)||s.focus()}),onPointerDownOutside:b(e.onPointerDownOutside,e=>{const s=e.detail.originalEvent,t=0===s.button&&!0===s.ctrlKey,a=2===s.button||t;o.current=a},{checkForDefaultPrevented:!1}),onFocusOutside:b(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})}))})}),Ne=m.forwardRef((e,s)=>{const t=le(ve,e.__scopePopover),a=m.useRef(!1),n=m.useRef(!1);return f.jsx(ye,l(i({},e),{ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,r;null==(o=e.onCloseAutoFocus)||o.call(e,s),s.defaultPrevented||(a.current||null==(r=t.triggerRef.current)||r.focus(),s.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:s=>{var o,r;null==(o=e.onInteractOutside)||o.call(e,s),s.defaultPrevented||(a.current=!0,"pointerdown"===s.detail.originalEvent.type&&(n.current=!0));const i=s.target;(null==(r=t.triggerRef.current)?void 0:r.contains(i))&&s.preventDefault(),"focusin"===s.detail.originalEvent.type&&n.current&&s.preventDefault()}}))}),ye=m.forwardRef((e,s)=>{const t=e,{__scopePopover:a,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:r,disableOutsidePointerEvents:d,onEscapeKeyDown:u,onPointerDownOutside:m,onFocusOutside:p,onInteractOutside:h}=t,x=c(t,["__scopePopover","trapFocus","onOpenAutoFocus","onCloseAutoFocus","disableOutsidePointerEvents","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside"]),v=le(ve,a),g=re(a);return z(),f.jsx(G,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:r,children:f.jsx(C,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:h,onEscapeKeyDown:u,onPointerDownOutside:m,onFocusOutside:p,onDismiss:()=>v.onOpenChange(!1),children:f.jsx(P,l(i(i({"data-state":we(v.open),role:"dialog",id:v.contentId},g),x),{ref:s,style:i(i({},x.style),{"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"})}))})})}),_e="PopoverClose";m.forwardRef((e,s)=>{const t=e,{__scopePopover:a}=t,n=c(t,["__scopePopover"]),o=le(_e,a);return f.jsx(j.button,l(i({type:"button"},n),{ref:s,onClick:b(e.onClick,()=>o.onOpenChange(!1))}))}).displayName=_e;function we(e){return e?"open":"closed"}m.forwardRef((e,s)=>{const t=e,{__scopePopover:a}=t,n=c(t,["__scopePopover"]),o=re(a);return f.jsx(k,l(i(i({},o),n),{ref:s}))}).displayName="PopoverArrow";var Ce=xe,Pe=ge;const ke=ce,Oe=me,Ae=React.forwardRef((e,s)=>{var t=e,{className:a,align:n="center",sideOffset:o=4}=t,r=c(t,["className","align","sideOffset"]);return f.jsx(Ce,{children:f.jsx(Pe,i({ref:s,align:n,sideOffset:o,className:O("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a)},r))})});Ae.displayName=Pe.displayName;const Re=m.memo(({type:e,isGeneral:s})=>f.jsx("span",{className:"text-2xl",children:(()=>{if(s){return{announcement:"ðŸ“¢",event:"ðŸ“…",community:"ðŸ‘¥",system:"âš™ï¸"}[e]||"ðŸ“¢"}return{booking_request:"ðŸŽ¯",booking_accepted:"âœ…",booking_declined:"âŒ",message_request:"ðŸ’¬",new_follower:"ðŸ‘¥",event_reminder:"ðŸ“…",poll_result:"ðŸ“Š",review_reply:"ðŸ’­",group_invite:"ðŸ‘‹",event_update:"ðŸ”„",discussion_request:"ðŸ’­",discussion_approved:"âœ…",discussion_rejected:"âŒ",event_created:"ðŸ“…",event_updated:"ðŸ”„",event_cancelled:"âŒ",payment_received:"ðŸ’°",payment_failed:"âš ï¸",system_announcement:"ðŸ“¢"}[e]||"ðŸ””"})()}));Re.displayName="NotificationIcon";const De=m.memo(({notification:e,onMarkAsRead:s,onDelete:t,onNavigate:a,isGeneral:n=!1,isAuthenticated:o=!1})=>f.jsx("div",{className:"p-3 rounded-lg mb-2 cursor-pointer transition-all hover:bg-accent/50 "+(n?`bg-card ${(e=>{switch(e){case"urgent":return"border-l-red-500";case"high":return"border-l-orange-500";case"medium":return"border-l-yellow-500";case"low":return"border-l-blue-500";default:return"border-l-primary"}})(e.priority)} border-l-4`:e.read?"bg-muted/50":"bg-primary/5 border-l-4 border-l-primary"),onClick:()=>{a(e)},children:f.jsxs("div",{className:"flex items-start gap-3",children:[f.jsx(Re,{type:e.type,isGeneral:n}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center justify-between mb-1",children:[f.jsx("h4",{className:"font-medium text-sm truncate",children:e.title}),f.jsxs("div",{className:"flex items-center gap-1",children:[!n&&!e.read&&o&&f.jsx(F,{variant:"default",className:"text-xs px-1 py-0",children:"New"}),!n&&o&&f.jsx(D,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:s=>{s.stopPropagation(),!n&&o&&t(e.id)},children:f.jsx(X,{className:"h-3 w-3"})})]})]}),f.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:e.message}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("p",{className:"text-xs text-muted-foreground",children:Y(new Date(e.created_at),"MMM dd â€¢ HH:mm")}),e.action_text&&f.jsx(D,{variant:"outline",size:"sm",className:"h-6 text-xs",onClick:s=>{s.stopPropagation(),a(e)},children:e.action_text})]})]})]})}));De.displayName="NotificationItem";const Fe=m.memo(()=>{const{user:e}=A(),s=R(),[t,a]=m.useState(!1),[n,o]=m.useState(!1),{generalNotifications:r,personalNotifications:c,counts:u,loading:p,error:h,markAsRead:x,markAllAsRead:v,deleteNotification:g,refresh:j,refreshCounts:b,isAuthenticated:N}=S(),y=m.useCallback(e=>d(void 0,null,function*(){if(!e.isGeneral&&N)try{yield x(e.id)}catch(n){}if(e.action_url)return s(e.action_url),void a(!1);const t={booking_request:"/artist-dashboard",booking_accepted:"/artist-dashboard",booking_declined:"/artist-dashboard",message_request:"/messages",new_follower:"/profile",event_reminder:"/events",event_update:"/events",event_created:"/events",event_updated:"/events",event_cancelled:"/events",poll_result:"/community",review_reply:"/community",group_invite:"/community",discussion_request:"/artist-dashboard",discussion_approved:"/community",discussion_rejected:"/community",payment_received:"/artist-dashboard",payment_failed:"/artist-dashboard",system_announcement:"/",announcement:"/",event:"/events",community:"/community",system:"/"}[e.type];t&&s(t),a(!1)}),[x,s,N]),_=m.useCallback(e=>{if(N)try{g(e)}catch(s){}},[g,N]),w=m.useMemo(()=>{try{return[...r.map(e=>l(i({},e),{isGeneral:!0,read:!1})),...c.map(e=>l(i({},e),{isGeneral:!1}))].sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime())}catch(e){return[]}},[r,c]);if(!N)return null;const C={general:Math.max(0,u.general||0),personal:Math.max(0,u.personal||0),total:Math.max(0,u.total||0)},P=m.useCallback(e=>{a(e),e&&N&&(o(!0),b().finally(()=>o(!1)))},[N,b]),k=m.useCallback(()=>d(void 0,null,function*(){if(N){o(!0);try{yield b()}finally{o(!1)}}}),[N,b]);return f.jsxs(ke,{open:t,onOpenChange:P,children:[f.jsx(Oe,{asChild:!0,children:f.jsxs(D,{variant:"ghost",size:"sm",className:"relative",children:[f.jsx($,{className:"h-4 w-4"}),C.personal>0&&f.jsx(F,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs "+(n?"animate-pulse":""),children:C.personal>99?"99+":C.personal})]})}),f.jsxs(Ae,{className:"w-80 p-0",align:"end",children:[f.jsx("div",{className:"p-4 border-b",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("h3",{className:"font-semibold",children:"Notifications"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs(D,{variant:"ghost",size:"sm",onClick:j,disabled:p,className:"h-8 w-8 p-0",title:"Refresh notifications and counts",children:[f.jsx("span",{className:"sr-only",children:"Refresh"}),f.jsx("svg",{className:"h-4 w-4 "+(p?"animate-spin":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]}),N&&C.personal>0&&f.jsx(D,{variant:"ghost",size:"sm",onClick:v,className:"h-8 w-8 p-0",title:"Mark all as read",children:f.jsx(V,{className:"h-4 w-4"})}),f.jsx(D,{variant:"ghost",size:"sm",onClick:k,disabled:n,className:"h-8 w-8 p-0",title:"Sync notification counts",children:f.jsx("svg",{className:"h-4 w-4 "+(n?"animate-spin":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),f.jsxs(T,{children:[f.jsx(q,{asChild:!0,children:f.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:f.jsx(J,{className:"h-4 w-4"})})}),f.jsxs(B,{align:"end",children:[f.jsx(H,{onClick:()=>s("/notification-settings"),children:"Settings"}),f.jsx(H,{onClick:()=>s("/notifications"),children:"View All"})]})]})]})]})}),f.jsxs(L,{defaultValue:"all",className:"w-full",children:[f.jsxs(U,{className:"grid w-full grid-cols-3",children:[f.jsxs(K,{value:"all",className:"text-xs",children:["All (",w.length,")"]}),f.jsxs(K,{value:"personal",className:"text-xs",children:["Personal (",C.personal,")"]}),f.jsxs(K,{value:"general",className:"text-xs",children:["General (",C.general,")"]})]}),f.jsx(W,{value:"all",className:"p-4",children:p?f.jsxs("div",{className:"text-center py-8",children:[f.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto mb-2"}),f.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})]}):h?f.jsxs("div",{className:"text-center py-8",children:[f.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Unable to load notifications"}),f.jsx(D,{variant:"outline",size:"sm",onClick:j,children:"Try Again"})]}):0===w.length?f.jsxs("div",{className:"text-center py-8",children:[f.jsx($,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground/50"}),f.jsx("p",{className:"text-sm text-muted-foreground",children:"No notifications"})]}):f.jsx(I,{className:"h-64",children:w.map(e=>f.jsx(De,{notification:e,onMarkAsRead:x,onDelete:_,onNavigate:y,isGeneral:e.isGeneral,isAuthenticated:N},`${e.isGeneral?"general":"personal"}-${e.id}`))})}),f.jsx(W,{value:"personal",className:"p-4",children:0===c.length?f.jsxs("div",{className:"text-center py-8",children:[f.jsx(Z,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground/50"}),f.jsx("p",{className:"text-sm text-muted-foreground",children:"No personal notifications"})]}):f.jsx(I,{className:"h-64",children:c.map(e=>f.jsx(De,{notification:e,onMarkAsRead:x,onDelete:_,onNavigate:y,isGeneral:!1,isAuthenticated:N},e.id))})}),f.jsx(W,{value:"general",className:"p-4",children:0===r.length?f.jsxs("div",{className:"text-center py-8",children:[f.jsx(Q,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground/50"}),f.jsx("p",{className:"text-sm text-muted-foreground",children:"No general notifications"})]}):f.jsx(I,{className:"h-64",children:r.map(e=>f.jsx(De,{notification:e,onMarkAsRead:x,onDelete:_,onNavigate:y,isGeneral:!0,isAuthenticated:N},e.id))})})]})]})]})});Fe.displayName="NotificationBell";export{Fe as N,ke as P,Oe as a,Ae as b,ee as c,te as d,se as e};
