var ae=Object.defineProperty,te=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var S=(s,e,t)=>e in s?ae(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,b=(s,e)=>{for(var t in e||(e={}))D.call(e,t)&&S(s,t,e[t]);if(A)for(var t of A(e))U.call(e,t)&&S(s,t,e[t]);return s},k=(s,e)=>te(s,re(e));var v=(s,e)=>{var t={};for(var a in s)D.call(s,a)&&e.indexOf(a)<0&&(t[a]=s[a]);if(s!=null&&A)for(var a of A(s))e.indexOf(a)<0&&U.call(s,a)&&(t[a]=s[a]);return t};var V=(s,e,t)=>S(s,typeof e!="symbol"?e+"":e,t);var m=(s,e,t)=>new Promise((a,r)=>{var i=g=>{try{h(t.next(g))}catch(f){r(f)}},o=g=>{try{h(t.throw(g))}catch(f){r(f)}},h=g=>g.done?a(g.value):Promise.resolve(g.value).then(i,o);h((t=t.apply(s,e)).next())});import{aY as se,bW as ne,R as E,j as n,aZ as ie,a_ as F,a$ as oe,X as H,b0 as W,b1 as Y,b2 as G,r as d,n as le,aw as ce,e as de,aL as ge}from"./chunk-COTa-BBv.js";import{V as me}from"./chunk-BlluHz2J.js";import{e as _,a as ue,B as C,C as pe,b as he}from"./main-BMj1NFFE.js";import{B as M}from"./chunk-BCSLz2CJ.js";import{A as be,a as fe}from"./chunk-CE0O3dYU.js";import{s as u}from"./chunk-CasIWBEQ.js";import{c as x,b as we}from"./chunk-DmQrF9DI.js";const Oe=se,Le=ne,ve=ie,X=E.forwardRef((a,t)=>{var r=a,{className:s}=r,e=v(r,["className"]);return n.jsx(G,k(b({className:_("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s)},e),{ref:t}))});X.displayName=G.displayName;const ye=me("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),ke=E.forwardRef((i,r)=>{var o=i,{side:s="right",className:e,children:t}=o,a=v(o,["side","className","children"]);return n.jsxs(ve,{children:[n.jsx(X,{}),n.jsxs(F,k(b({ref:r,className:_(ye({side:s}),e)},a),{children:[t,n.jsxs(oe,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[n.jsx(H,{className:"h-4 w-4"}),n.jsx("span",{className:"sr-only",children:"Close"})]})]}))]})});ke.displayName=F.displayName;const xe=t=>{var a=t,{className:s}=a,e=v(a,["className"]);return n.jsx("div",b({className:_("flex flex-col space-y-2 text-center sm:text-left",s)},e))};xe.displayName="SheetHeader";const _e=E.forwardRef((a,t)=>{var r=a,{className:s}=r,e=v(r,["className"]);return n.jsx(W,b({ref:t,className:_("text-lg font-semibold text-foreground",s)},e))});_e.displayName=W.displayName;const Ne=E.forwardRef((a,t)=>{var r=a,{className:s}=r,e=v(r,["className"]);return n.jsx(Y,b({ref:t,className:_("text-sm text-muted-foreground",s)},e))});Ne.displayName=Y.displayName;const je=d.memo(({notifications:s=0,className:e="",variant:t="ghost",size:a="sm",onClick:r})=>{const{user:i}=ue(),o=le(),h=()=>{r?r():o(i?"/notifications":"/signin")},g=i&&s>0;return n.jsxs(C,{variant:t,size:a,className:`relative ${e}`,onClick:h,children:[n.jsx(ce,{className:"h-4 w-4"}),g&&n.jsx(M,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:s>99?"99+":s})]})});je.displayName="NotificationButton";const Be=({className:s})=>{const[e,t]=d.useState(navigator.onLine),[a,r]=d.useState(!1);return d.useEffect(()=>{const i=()=>{t(!0),r(!1)},o=()=>{t(!1),r(!0)};return window.addEventListener("online",i),window.addEventListener("offline",o),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",o)}},[]),a?n.jsxs(be,{variant:"destructive",className:`mb-4 ${s}`,children:[n.jsx(de,{className:"h-4 w-4"}),n.jsx(fe,{children:"You are currently offline. Some features may not work properly. Please check your internet connection."})]}):null};class T{static checkMarketingTables(){return m(this,null,function*(){if(this.marketingTablesAvailable!==null)return this.marketingTablesAvailable;try{const e=yield x("marketing_campaigns"),t=yield x("referral_program"),a=yield x("social_shares"),r=yield x("promotional_codes");return this.marketingTablesAvailable=e.exists&&t.exists&&a.exists&&r.exists,this.marketingTablesAvailable,this.marketingTablesAvailable}catch(e){return console.error("Error checking marketing tables:",e),this.marketingTablesAvailable=!1,!1}})}static createCampaign(e){return m(this,null,function*(){if(!(yield this.checkMarketingTables()))throw console.warn("Marketing tables not available. Campaign creation skipped."),new Error("Marketing features are not available. Please ensure database migrations are applied.");try{const{data:{user:a}}=yield u.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:r,error:i}=yield u.from("marketing_campaigns").insert(k(b({},e),{created_by:a.id,status:e.status||"draft"})).select().single();if(i)throw i;return r}catch(a){throw console.error("Error creating campaign:",a),a}})}static getCampaigns(e){return m(this,null,function*(){if(!(yield this.checkMarketingTables()))return[];try{let a=u.from("marketing_campaigns").select("*");e!=null&&e.status&&(a=a.eq("status",e.status)),e!=null&&e.campaign_type&&(a=a.eq("campaign_type",e.campaign_type)),e!=null&&e.created_by&&(a=a.eq("created_by",e.created_by));const{data:r,error:i}=yield a.order("created_at",{ascending:!1});if(i)throw i;return r||[]}catch(a){return console.error("Error fetching campaigns:",a),[]}})}static getCampaign(e){return m(this,null,function*(){if(!(yield this.checkMarketingTables()))return console.warn("Marketing tables not available. Campaign not found."),null;try{const{data:a,error:r}=yield u.from("marketing_campaigns").select("*").eq("id",e).single();if(r&&r.code!=="PGRST116")throw r;return a}catch(a){return console.error("Error fetching campaign:",a),null}})}static updateCampaign(e,t){return m(this,null,function*(){if(!(yield this.checkMarketingTables()))throw new Error("Marketing features are not available. Please ensure database migrations are applied.");try{const{data:r,error:i}=yield u.from("marketing_campaigns").update(k(b({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();if(i)throw i;return r}catch(r){throw console.error("Error updating campaign:",r),r}})}static deleteCampaign(e){return m(this,null,function*(){if(!(yield this.checkMarketingTables()))throw new Error("Marketing features are not available. Please ensure database migrations are applied.");try{const{error:a}=yield u.from("marketing_campaigns").delete().eq("id",e);if(a)throw a;return!0}catch(a){return console.error("Error deleting campaign:",a),!1}})}static getActiveCampaigns(){return m(this,null,function*(){var t,a;if(!(yield this.checkMarketingTables()))return[];try{if(!u.auth||!u.from)return console.warn("Supabase client not properly configured"),[];const r=new Date().toISOString(),{data:i,error:o}=yield u.from("marketing_campaigns").select("*").eq("status","active").lte("start_date",r).gte("end_date",r).order("created_at",{ascending:!1});if(o){if((t=o.message)!=null&&t.includes("No API key found")||(a=o.message)!=null&&a.includes("apikey"))return console.warn("Supabase API key not configured properly"),[];throw o}return i||[]}catch(r){return console.error("Error fetching active campaigns:",r),[]}})}static trackEvent(e,t,a){return m(this,null,function*(){if(yield this.checkMarketingTables())try{const{data:{user:i}}=yield u.auth.getUser();yield u.from("marketing_analytics").insert({event_type:e,event_data:t,campaign_id:a,user_id:i==null?void 0:i.id,session_id:sessionStorage.getItem("session_id"),ip_address:null,user_agent:navigator.userAgent,device_type:this.getDeviceType(),location_data:null})}catch(i){console.error("Error tracking marketing event:",i)}})}static getAnalytics(e){return m(this,null,function*(){if(!(yield this.checkMarketingTables()))return we();try{let a=u.from("marketing_analytics").select("*");e!=null&&e.event_type&&(a=a.eq("event_type",e.event_type)),e!=null&&e.campaign_id&&(a=a.eq("campaign_id",e.campaign_id)),e!=null&&e.date_from&&(a=a.gte("created_at",e.date_from)),e!=null&&e.date_to&&(a=a.lte("created_at",e.date_to));const{data:r,error:i}=yield a;if(i)throw i;return r||[]}catch(a){return console.error("Error fetching analytics:",a),[]}})}static getDeviceType(){const e=navigator.userAgent;return/Mobile|Android|iPhone|iPad/.test(e)?"mobile":/Tablet|iPad/.test(e)?"tablet":"desktop"}}V(T,"marketingTablesAvailable",null);const Re=({position:s="top",variant:e="default",maxCampaigns:t=3,className:a="",onDismiss:r,onAction:i})=>{var O,L;const[o,h]=d.useState([]),[g,f]=d.useState(0),[Z,y]=d.useState(!0),[J,N]=d.useState(null),[j,P]=d.useState(null);d.useEffect(()=>{m(null,null,function*(){try{const l=yield x("marketing_campaigns");if(P(l.exists),!l.exists){N("Marketing features not available"),y(!1);return}}catch(l){console.error("Error checking marketing tables:",l),P(!1),N("Unable to check marketing features"),y(!1);return}})},[]);const q=d.useCallback(()=>m(null,null,function*(){try{y(!0),N(null);let l=(yield T.getActiveCampaigns()).filter(w=>{var B,R,I,$,z;return!!(s==="top"&&((R=(B=w.campaign_config)==null?void 0:B.positions)!=null&&R.includes("top"))||s==="sidebar"&&(($=(I=w.campaign_config)==null?void 0:I.positions)!=null&&$.includes("sidebar"))||e==="featured"&&w.campaign_type==="promotional"||e==="urgent"&&((z=w.campaign_config)!=null&&z.urgent))});l=l.slice(0,t),h(l)}catch(c){console.error("Error loading campaigns:",c),N("Failed to load promotional campaigns")}finally{y(!1)}}),[s,e,t]);d.useEffect(()=>{if(j===!1){y(!1);return}j===!0&&q()},[j,q]),d.useEffect(()=>{if(o.length<=1)return;const c=setInterval(()=>{f(l=>(l+1)%o.length)},5e3);return()=>clearInterval(c)},[o.length]);const K=c=>{h(l=>l.filter(w=>w.id!==c)),T.trackEvent("campaign_dismissed",{campaign_id:c}),r==null||r(c)},Q=c=>{T.trackEvent("campaign_clicked",{campaign_id:c.id,campaign_type:c.campaign_type}),i==null||i(c)};if(Z||J||o.length===0||j===!1)return null;const p=o[g];if(!p)return null;const ee=()=>{switch(e){case"featured":return"bg-gradient-to-r from-purple-600 to-blue-600 text-white border-purple-500";case"urgent":return"bg-gradient-to-r from-red-600 to-orange-600 text-white border-red-500";default:return"bg-gradient-to-r from-blue-600 to-indigo-600 text-white border-blue-500"}};return n.jsx("div",{className:`relative ${a}`,children:n.jsx(pe,{className:`border-2 ${ee()}`,children:n.jsx(he,{className:"p-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(M,{variant:"secondary",className:"text-xs",children:p.campaign_type}),((O=p.campaign_config)==null?void 0:O.urgent)&&n.jsx(M,{variant:"destructive",className:"text-xs",children:"Limited Time"})]}),n.jsx("h3",{className:"font-semibold text-lg mb-1",children:p.name}),p.description&&n.jsx("p",{className:"text-sm opacity-90 mb-3",children:p.description}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(C,{size:"sm",variant:"secondary",onClick:()=>Q(p),className:"bg-white/20 hover:bg-white/30 text-white border-white/30",children:[((L=p.campaign_config)==null?void 0:L.cta_text)||"Learn More",n.jsx(ge,{className:"ml-1 h-3 w-3"})]}),o.length>1&&n.jsx("div",{className:"flex gap-1",children:o.map((c,l)=>n.jsx("button",{onClick:()=>f(l),className:`w-2 h-2 rounded-full transition-colors ${l===g?"bg-white":"bg-white/50 hover:bg-white/70"}`},l))})]})]}),n.jsx(C,{size:"sm",variant:"ghost",onClick:()=>K(p.id),className:"text-white/70 hover:text-white hover:bg-white/10",children:n.jsx(H,{className:"h-4 w-4"})})]})})})})};export{Be as N,Re as P,Oe as S,ke as a,je as b,Le as c,xe as d,_e as e,Ne as f};
