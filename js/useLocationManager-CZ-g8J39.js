var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,i=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&l(e,r,t[r]);if(n)for(var r of n(t))a.call(t,r)&&l(e,r,t[r]);return e},c=(e,n)=>t(e,r(n)),s=(e,t,r)=>new Promise((n,o)=>{var a=e=>{try{i(r.next(e))}catch(t){o(t)}},l=e=>{try{i(r.throw(e))}catch(t){o(t)}},i=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,l);i((r=r.apply(e,t)).next())});import{u,r as d}from"./main-6fHUpRzT.js";import{L as g}from"./locationService-BtZ0rgoF.js";function f(){const{user:e}=u(),[t,r]=d.useState({current:null,enabled:!1,auto_detect:!0,loading:!1,error:null}),[n,o]=d.useState({enabled:!1,auto_detect:!0,radius_km:50,categories:[],notifications:!0}),a=d.useRef(t),l=d.useRef(n);d.useEffect(()=>{a.current=t},[t]),d.useEffect(()=>{l.current=n},[n]),d.useEffect(()=>{e&&f()},[e,f]);const f=d.useCallback(()=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{const[e,t]=yield Promise.all([g.getCurrentUserLocation(),g.getLocationSettings()]);r(r=>c(i({},r),{current:e,enabled:t.enabled,auto_detect:t.auto_detect,loading:!1})),o(t)}catch(t){r(e=>c(i({},e),{loading:!1,error:t instanceof Error?t.message:"Failed to load location"}))}}}),[e]),b=d.useCallback(()=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{const e=yield g.detectAndSaveLocation();r(t=>c(i({},t),{current:e,enabled:!0,auto_detect:!0,loading:!1}));const t=yield g.getLocationSettings();return o(t),e}catch(t){throw r(e=>c(i({},e),{loading:!1,error:t instanceof Error?t.message:"Failed to detect location"})),t}}}),[e]),y=d.useCallback(t=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{yield g.setManualLocation(t),r(e=>c(i({},e),{current:t,enabled:!0,auto_detect:!1,loading:!1}));const e=yield g.getLocationSettings();o(e)}catch(n){throw r(e=>c(i({},e),{loading:!1,error:n instanceof Error?n.message:"Failed to set location"})),n}}}),[e]),h=d.useCallback(t=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{yield g.updateLocationSettings(t);const e=yield g.getLocationSettings();o(e),void 0!==t.enabled?r(e=>c(i({},e),{enabled:t.enabled,loading:!1})):r(e=>c(i({},e),{loading:!1}))}catch(n){throw r(e=>c(i({},e),{loading:!1,error:n instanceof Error?n.message:"Failed to update settings"})),n}}}),[e]),p=d.useCallback(t=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{yield g.toggleLocationServices(t),r(e=>c(i({},e),{enabled:t,loading:!1})),o(e=>c(i({},e),{enabled:t}))}catch(n){throw r(e=>c(i({},e),{loading:!1,error:n instanceof Error?n.message:"Failed to toggle location services"})),n}}}),[e]),m=d.useCallback(()=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{yield g.toggleLocationServices(!1),r(e=>c(i({},e),{current:null,enabled:!1,loading:!1})),o(e=>c(i({},e),{enabled:!1}))}catch(t){throw r(e=>c(i({},e),{loading:!1,error:t instanceof Error?t.message:"Failed to clear location"})),t}}}),[e]),L=d.useCallback(()=>s(this,null,function*(){if(e&&a.current.enabled){r(e=>c(i({},e),{loading:!0,error:null}));try{a.current.auto_detect?yield b():yield f()}catch(t){r(e=>c(i({},e),{loading:!1,error:t instanceof Error?t.message:"Failed to refresh location"}))}}}),[e,b,f]),v=d.useCallback((t,r)=>s(this,null,function*(){if(!e||!a.current.enabled||!a.current.current)return[];try{return yield g.getNearbyContent(t,r)}catch(n){return[]}}),[e]),S=d.useCallback(t=>s(this,null,function*(){if(!e)return[];try{return yield g.searchPlaces(t,a.current.current||void 0)}catch(r){return[]}}),[e]);return{location:t.current,enabled:t.enabled,auto_detect:t.auto_detect,loading:t.loading,error:t.error,settings:n,detectLocation:b,setManualLocation:y,updateSettings:h,toggleLocationServices:p,clearLocation:m,refreshLocation:L,getNearbyContent:v,searchPlaces:S,loadLocationAndSettings:f}}export{f as u};
