var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,o,a)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,l=(e,t)=>{for(var o in t||(t={}))n.call(t,o)&&r(e,o,t[o]);if(a)for(var o of a(t))i.call(t,o)&&r(e,o,t[o]);return e},c=(e,a)=>t(e,o(a)),s=(e,t,o)=>new Promise((a,n)=>{var i=e=>{try{l(o.next(e))}catch(t){n(t)}},r=e=>{try{l(o.throw(e))}catch(t){n(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,r);l((o=o.apply(e,t)).next())});import{u as d,d as u,r as g}from"./index-B5IYdG7F.js";import{L as b}from"./locationService-BBE-Ay-I.js";const p=()=>{const{user:e}=d(),{toast:t}=u(),[o,a]=g.useState({currentLocation:null,isEnabled:!1,isLoading:!1,error:null,lastUpdated:null});g.useEffect(()=>{(()=>{s(void 0,null,function*(){if(e)try{const e=yield b.getCurrentUserLocation(),t=yield b.getLocationSettings();a(e?o=>c(l({},o),{isEnabled:t.enabled,currentLocation:{latitude:e.lat,longitude:e.lng},lastUpdated:new Date}):e=>c(l({},e),{isEnabled:t.enabled,currentLocation:null}))}catch(t){}})})()},[e]);const n=g.useCallback(()=>new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy})},e=>{t(new Error(`Location error: ${e.message}`))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5}):t(new Error("Geolocation is not supported by this browser"))}),[]),i=g.useCallback(t=>s(void 0,null,function*(){if(e)try{const e={lat:t.latitude,lng:t.longitude};yield b.setManualLocation(e)}catch(o){throw o}}),[e]),r=g.useCallback(()=>s(void 0,null,function*(){if(e){a(e=>c(l({},e),{isLoading:!0,error:null}));try{if(!o.isEnabled){const e=yield n();e.latitude,e.longitude;yield b.detectAndSaveLocation(),a(t=>c(l({},t),{isEnabled:!0,currentLocation:e,lastUpdated:new Date,isLoading:!1})),t({title:"Location sharing enabled",description:"Your location will be used to show relevant local content."})}else yield b.toggleLocationServices(!1),a(e=>c(l({},e),{isEnabled:!1,currentLocation:null,lastUpdated:null,isLoading:!1})),t({title:"Location sharing disabled",description:"Location data has been cleared."})}catch(i){a(e=>c(l({},e),{error:i.message,isLoading:!1})),t({title:"Location error",description:i.message,variant:"destructive"})}}}),[e,o.isEnabled,n,t]),p=g.useCallback(()=>s(void 0,null,function*(){if(e&&o.isEnabled){a(e=>c(l({},e),{isLoading:!0,error:null}));try{const e=yield n();yield i(e),a(t=>c(l({},t),{currentLocation:e,lastUpdated:new Date,isLoading:!1})),t({title:"Location updated",description:"Your current location has been refreshed."})}catch(r){a(e=>c(l({},e),{error:r.message,isLoading:!1})),t({title:"Location update failed",description:r.message,variant:"destructive"})}}}),[e,o.isEnabled,n,i,t]);return g.useEffect(()=>{if(!o.isEnabled)return;const e=setInterval(()=>{p()},9e5);return()=>clearInterval(e)},[o.isEnabled,p]),c(l({},o),{toggleLocationSharing:r,updateCurrentLocation:p})};export{p as u};
