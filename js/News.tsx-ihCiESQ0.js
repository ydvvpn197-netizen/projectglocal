const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/chart.tsx-uH2JXf2g.js","js/chunk-V8Tq47hD.js","js/main-nj8_qmr1.js","js/chunk-7Gxbu0Lx.js","js/chunk-aOfXXddH.js","js/chunk-jOF7Mqj2.js","js/chunk-BbVfpXIH.js","js/chunk-HDUI5Ctd.js","js/chunk-BD2ShIYc.js","js/chunk-DkszvQuI.js","js/chunk-Cv5hKDJv.js","css/main-CIOjpg5z.css","js/AnimatedCard.tsx-cuCj4bgn.js","js/chunk-axyawUmi.js"])))=>i.map(i=>d[i]);
var es=Object.defineProperty,ss=Object.defineProperties;var ts=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var pe=(r,i,s)=>i in r?es(r,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[i]=s,O=(r,i)=>{for(var s in i||(i={}))Ae.call(i,s)&&pe(r,s,i[s]);if(ce)for(var s of ce(i))Te.call(i,s)&&pe(r,s,i[s]);return r},K=(r,i)=>ss(r,ts(i));var fe=(r,i)=>{var s={};for(var t in r)Ae.call(r,t)&&i.indexOf(t)<0&&(s[t]=r[t]);if(r!=null&&ce)for(var t of ce(r))i.indexOf(t)<0&&Te.call(r,t)&&(s[t]=r[t]);return s};var le=(r,i,s)=>pe(r,typeof i!="symbol"?i+"":i,s);var b=(r,i,s)=>new Promise((t,a)=>{var l=h=>{try{m(s.next(h))}catch(j){a(j)}},o=h=>{try{m(s.throw(h))}catch(j){a(j)}},m=h=>h.done?t(h.value):Promise.resolve(h.value).then(l,o);m((s=s.apply(r,i)).next())});import{r as n,R as B,j as e}from"./chunk-V8Tq47hD.js";import{ResponsiveLayout as as}from"./ResponsiveLayout.tsx-CBMj4ano.js";import{T as rs,a as is,b as ge,c as je}from"./chunk-Dqojk3_S.js";import{s as U,d as ye,C as V,b as te,a as M,B as N,c as re,u as Se,f as ns,e as Be}from"./main-nj8_qmr1.js";import{I as me}from"./chunk-CfjvP89K.js";import{S as X}from"./chunk-Bwe9R7Wr.js";import{A as oe,a as de}from"./chunk-DzbWDm6p.js";import{u as He,a as cs,b as ve}from"./chunk-Cv5hKDJv.js";import{B as ie}from"./chunk-BqqQDpKD.js";import{A as ue,b as he,a as Re}from"./chunk-CJL1E-Mt.js";import{E as Ve}from"./chunk-aOfXXddH.js";import{m as $,A as Z}from"./chunk-axyawUmi.js";import{z as Ee,M as Pe,g as Qe,h as Ne,d as ls,av as be,aq as os,P as Fe,X as ds,U as ms,aw as us,f as Ke,aa as Ie,b as hs,L as ee,K as $e,ax as xs,ay as ps,O as fs,Q as gs,V as js,at as ys,au as vs,R as Ce,v as ws,T as _s,G as Ge,az as Me,S as We,x as Ns,ae as bs,ai as Cs}from"./chunk-BD2ShIYc.js";import{f as Le}from"./chunk-jOF7Mqj2.js";import{D as ks,a as Ss,b as Es,c as Ps}from"./chunk-B-6hVeMl.js";import{L as W}from"./chunk-Ch6abJed.js";import{P as Ls}from"./chunk-mpNmbJ1v.js";import{T as we}from"./chunk-DiXj0jE4.js";import{S as qe}from"./chunk-YEhQLQCo.js";import{S as zs,a as Ds,b as Us,c as As,d as Ts}from"./chunk-BJzCN5QX.js";import{S as Rs}from"./chunk-DX5IT3-R.js";import"./chunk-HDUI5Ctd.js";import"./chunk-7Gxbu0Lx.js";import"./chunk-BbVfpXIH.js";import"./chunk-DkszvQuI.js";import"./chunk-CHdjBz-i.js";const Y={getArticles(r=50,i=1){return b(this,null,function*(){return[]})},getArticleById(r){return b(this,null,function*(){return null})},searchArticles(r){return b(this,null,function*(){return[]})}};n.createContext(void 0);const Fs=(r,i)=>{const[s,t]=n.useState(1),[a,l]=n.useState(!0),[o,m]=n.useState([]);He();const{data:h,isLoading:j,error:d,refetch:u,isFetching:y}=cs({queryKey:["news",r,i.city,i.country,s],queryFn:()=>Y.getNews(r,i,s,50),enabled:!!i.city,staleTime:300*1e3,retry:2});n.useEffect(()=>{h&&(m(s===1?h.articles:z=>[...z,...h.articles]),l(h.has_more))},[h,s]);const g=n.useCallback(()=>{a&&!y&&t(z=>z+1)},[a,y]),v=n.useCallback(()=>{t(1),m([]),l(!0),u()},[u]);return{articles:o,loading:j,error:d,hasMore:a,loadMore:g,refresh:v,isFetching:y}},Is=()=>{const r=He(),[i,s]=n.useState(new Map),t=ve({mutationFn:d=>Y.likeArticle(d),onSuccess:(d,u)=>{s(y=>{const g=new Map(y),v=g.get(u)||{likesCount:0,isLiked:!1};return g.set(u,K(O({},v),{likesCount:v.likesCount+1,isLiked:!0})),g}),r.invalidateQueries({queryKey:["news-interactions",u]})},onError:d=>{console.error("Error liking article:",d)}}),a=ve({mutationFn:d=>Y.unlikeArticle(d),onSuccess:(d,u)=>{s(y=>{const g=new Map(y),v=g.get(u)||{likesCount:0,isLiked:!1};return g.set(u,K(O({},v),{likesCount:Math.max(0,v.likesCount-1),isLiked:!1})),g}),r.invalidateQueries({queryKey:["news-interactions",u]})},onError:d=>{console.error("Error unliking article:",d)}}),l=ve({mutationFn:({articleId:d,platform:u})=>Y.shareArticle(d,u),onSuccess:(d,{articleId:u})=>{s(y=>{const g=new Map(y),v=g.get(u)||{sharesCount:0};return g.set(u,K(O({},v),{sharesCount:v.sharesCount+1})),g}),r.invalidateQueries({queryKey:["news-interactions",u]})},onError:d=>{console.error("Error sharing article:",d)}}),o=n.useCallback(d=>b(null,null,function*(){try{const u=yield Y.getArticleInteractions(d);return s(y=>{const g=new Map(y);return g.set(d,u),g}),u}catch(u){return console.error("Error getting article interactions:",u),null}}),[]),m=n.useCallback(d=>{const u=i.get(d);u!=null&&u.isLiked?a.mutate(d):t.mutate(d)},[i,t,a]),h=n.useCallback((d,u)=>{l.mutate({articleId:d,platform:u})},[l]),j=n.useCallback(d=>i.get(d)||{likesCount:0,commentsCount:0,sharesCount:0,pollsCount:0,isLiked:!1},[i]);return{toggleLike:m,shareArticle:h,getArticleInteractions:o,getInteractionData:j,isLoading:t.isPending||a.isPending||l.isPending}},$s=r=>{const[i,s]=n.useState([]),[t,a]=n.useState(!1),[l,o]=n.useState(null),m=n.useCallback(()=>b(null,null,function*(){if(r){a(!0),o(null);try{const j=yield Y.getArticleComments(r);s(j)}catch(j){o(j instanceof Error?j.message:"Failed to fetch comments")}finally{a(!1)}}}),[r]),h=n.useCallback((j,d)=>b(null,null,function*(){if(r)try{const u=yield Y.addComment(r,j,d);return s(y=>[u,...y]),u}catch(u){throw o(u instanceof Error?u.message:"Failed to add comment"),u}}),[r]);return n.useEffect(()=>{m()},[m]),{comments:i,loading:t,error:l,addComment:h,refetch:m}},xe=r=>{const[i,s]=n.useState([]);return n.useEffect(()=>{if(r.length===0)return;const t=r.map(a=>U.channel(`news-${a}`).on("postgres_changes",{event:"*",schema:"public",table:"news_likes",filter:`article_id=eq.${a}`},o=>{s(m=>[...m,{type:"like",articleId:a,data:o,timestamp:new Date().toISOString()}])}).on("postgres_changes",{event:"*",schema:"public",table:"news_comments",filter:`article_id=eq.${a}`},o=>{s(m=>[...m,{type:"comment",articleId:a,data:o,timestamp:new Date().toISOString()}])}).on("postgres_changes",{event:"*",schema:"public",table:"news_shares",filter:`article_id=eq.${a}`},o=>{s(m=>[...m,{type:"share",articleId:a,data:o,timestamp:new Date().toISOString()}])}).subscribe());return()=>{t.forEach(a=>{U.removeChannel(a)})}},[r]),i},Ms=()=>{const[r,i]=n.useState(null),[s,t]=n.useState(!0),[a,l]=n.useState(null),o=n.useCallback(()=>b(null,null,function*(){t(!0),l(null);try{const h=yield Y.getCurrentLocation();return i(h),h}catch(h){const j=h instanceof Error?h.message:"Failed to get location";l(j);const d={city:"Delhi",country:"India",latitude:28.6139,longitude:77.209};return i(d),d}finally{t(!1)}}),[]),m=n.useCallback(h=>{i(h)},[]);return n.useEffect(()=>{o()},[o]),{location:r,loading:s,error:a,getCurrentLocation:o,updateLocation:m}},qs=r=>{const[i,s]=n.useState([]),[t,a]=n.useState(!1),l=n.useCallback(()=>b(null,null,function*(){if(r){a(!0);try{const{data:h,error:j}=yield U.from("news_polls").select(`
          *,
          profiles!news_polls_user_id_fkey(display_name, avatar_url),
          news_poll_votes(count)
        `).eq("article_id",r).order("created_at",{ascending:!1});if(j)throw j;s(h||[])}catch(h){console.error("Error fetching polls:",h)}finally{a(!1)}}}),[r]),o=n.useCallback((h,j)=>b(null,null,function*(){if(r)try{const{data:{user:d}}=yield U.auth.getUser();if(!d)throw new Error("User not authenticated");const{data:u,error:y}=yield U.from("news_polls").insert({article_id:r,user_id:d.id,question:h,options:j}).select(`
          *,
          profiles!news_polls_user_id_fkey(display_name, avatar_url)
        `).single();if(y)throw y;return s(g=>[u,...g]),u}catch(d){throw console.error("Error creating poll:",d),d}}),[r]),m=n.useCallback((h,j)=>b(null,null,function*(){try{const{data:{user:d}}=yield U.auth.getUser();if(!d)throw new Error("User not authenticated");const{error:u}=yield U.from("news_poll_votes").upsert({poll_id:h,user_id:d.id,option_index:j},{onConflict:"poll_id,user_id"});if(u)throw u;l()}catch(d){throw console.error("Error voting in poll:",d),d}}),[l]);return n.useEffect(()=>{l()},[l]),{polls:i,loading:t,createPoll:o,votePoll:m,refetch:l}};n.lazy(()=>Ve(()=>import("./chart.tsx-uH2JXf2g.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));n.lazy(()=>Ve(()=>import("./AnimatedCard.tsx-cuCj4bgn.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9,10,11,13])));const Os=(r,i)=>{const[s,t]=B.useState(!1);return B.useEffect(()=>{const a=new IntersectionObserver(([l])=>t(l.isIntersecting),i);return r.current&&a.observe(r.current),()=>a.disconnect()},[r,i]),s},J=class J{constructor(){le(this,"cache",new Map);le(this,"loadingPromises",new Map)}static getInstance(){return J.instance||(J.instance=new J),J.instance}optimizeImageUrl(i,s){const t=`${i}-${JSON.stringify(s)}`;if(this.cache.has(t))return this.cache.get(t);const a=i;return this.cache.set(t,a),a}generateBlurPlaceholder(i,s){const t=document.createElement("canvas");t.width=i,t.height=s;const a=t.getContext("2d");return a&&(a.fillStyle="#f3f4f6",a.fillRect(0,0,i,s)),t.toDataURL()}generateSrcSet(i,s){return s.map(t=>`${this.optimizeImageUrl(i,{width:t,height:t*.75,quality:80,format:"webp"})} ${t}w`).join(", ")}generateSizes(i){return i.map(s=>`(min-width: ${s.minWidth}px) ${s.size}`).join(", ")}getPlaceholderImage(i){return this.generateBlurPlaceholder(i.width,i.height)}lazyLoadImage(i,s,t){return b(this,null,function*(){const a=`${s}-${JSON.stringify(t)}`;if(this.loadingPromises.has(a))return this.loadingPromises.get(a);const l=new Promise((o,m)=>{const h=new Image;h.onload=()=>{i.src=this.optimizeImageUrl(s,t),o()},h.onerror=m,h.src=s});return this.loadingPromises.set(a,l),l})}};le(J,"instance");let ke=J;const se=ke.getInstance(),ne=B.memo(E=>{var c=E,{src:r,alt:i,width:s=400,height:t=300,quality:a=80,format:l="webp",blur:o=0,grayscale:m=!1,lazy:h=!0,placeholder:j,className:d,onLoad:u,onError:y,priority:g=!1,sizes:v,srcSet:z}=c,C=fe(c,["src","alt","width","height","quality","format","blur","grayscale","lazy","placeholder","className","onLoad","onError","priority","sizes","srcSet"]);const[w,_]=n.useState(!1),[D,P]=n.useState(!1),[F,S]=n.useState(""),f=n.useRef(null);Os(f,{threshold:.1});const k=n.useRef(null),L=n.useMemo(()=>({width:s,height:t,quality:a,format:l,blur:o,grayscale:m}),[s,t,a,l,o,m]),I=n.useCallback(()=>{_(!0),u==null||u()},[u]),Q=n.useCallback(()=>{P(!0),S(se.getPlaceholderImage(L)),y==null||y()},[y,L]);return n.useEffect(()=>{if(!(!h||!f.current))return k.current=new IntersectionObserver(T=>{T.forEach(q=>{var x;if(q.isIntersecting){const R=se.optimizeImageUrl(r,L);S(R),(x=k.current)==null||x.unobserve(q.target)}})},{rootMargin:"50px",threshold:.1}),k.current.observe(f.current),()=>{var T;(T=k.current)==null||T.disconnect()}},[r,h,L]),n.useEffect(()=>{if(!h||g){const T=se.optimizeImageUrl(r,L);S(T)}},[r,h,g,L]),n.useEffect(()=>()=>{var T;(T=k.current)==null||T.disconnect()},[]),D?e.jsx("div",{className:ye("flex items-center justify-center bg-gray-100 dark:bg-gray-800 text-gray-400",d),style:{width:s,height:t},children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-8 h-8 mx-auto mb-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),e.jsx("p",{className:"text-xs",children:"Image unavailable"})]})}):e.jsxs("div",{className:ye("relative overflow-hidden",d),children:[j&&!w&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 dark:bg-gray-700 animate-pulse",style:{width:s,height:t}}),e.jsx("img",O({ref:f,src:h?j||se.generateBlurPlaceholder(s,t):F,alt:i,width:s,height:t,className:ye("transition-all duration-300",!w&&"blur-sm",w&&"blur-0",d),onLoad:I,onError:Q,loading:h?"lazy":"eager",sizes:v,srcSet:z},C)),!w&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"})})]})});ne.displayName="OptimizedImage";const Bs=B.memo(o=>{var m=o,{src:r,alt:i,sizes:s,srcSet:t,breakpoints:a=[{minWidth:640,size:"50vw"},{minWidth:768,size:"33vw"},{minWidth:1024,size:"25vw"}]}=m,l=fe(m,["src","alt","sizes","srcSet","breakpoints"]);const[h,j]=n.useState(""),[d,u]=n.useState("");return n.useEffect(()=>{if(r){const y=[320,640,768,1024,1280,1536],g=se.generateSrcSet(r,y);j(g);const v=se.generateSizes(a);u(v)}},[r,a]),e.jsx(ne,O({src:r,alt:i,srcSet:t||h,sizes:s||d},l))});Bs.displayName="ResponsiveImage";const Hs=B.memo(r=>e.jsx(ne,K(O({},r),{lazy:!0})));Hs.displayName="LazyImage";const Vs=B.memo(r=>e.jsx(ne,K(O({},r),{lazy:!1,priority:!0})));Vs.displayName="PreloadImage";const _e=({article:r,showActions:i=!0,onLike:s,onComment:t,onShare:a,onPoll:l,isLiked:o=!1,likesCount:m=0,commentsCount:h=0,sharesCount:j=0,pollsCount:d=0})=>{const u=xe([r.article_id]);B.useEffect(()=>{u.length>0},[u]);const y=()=>{window.open(r.url,"_blank","noopener,noreferrer")},g=E=>{E.stopPropagation(),s==null||s(r.article_id)},v=E=>{E.stopPropagation(),t==null||t(r.article_id)},z=E=>{E.stopPropagation(),a==null||a(r.article_id)},C=E=>{E.stopPropagation(),l==null||l(r.article_id)};return e.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsxs(V,{className:"overflow-hidden hover:shadow-lg transition-shadow duration-300 cursor-pointer group",children:[e.jsx(te,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white line-clamp-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:r.title}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),e.jsx("span",{children:Le(new Date(r.published_at),{addSuffix:!0})})]}),r.city&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"h-3 w-3"}),e.jsx("span",{children:r.city})]})]})]}),r.image_url&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ne,{src:r.image_url,alt:r.title,width:80,height:80,className:"w-20 h-20 object-cover rounded-lg",lazy:!0,quality:85})})]})}),e.jsxs(M,{className:"pt-0",children:[r.ai_summary&&e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm leading-relaxed mb-4 line-clamp-3",children:r.ai_summary}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ue,{className:"h-6 w-6",children:e.jsx(he,{className:"text-xs",children:r.source_name.charAt(0).toUpperCase()})}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:r.source_name}),r.category&&e.jsx(ie,{variant:"secondary",className:"text-xs",children:r.category})]}),i&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(N,{variant:"ghost",size:"sm",onClick:g,className:`flex items-center gap-2 ${o?"text-red-500 hover:text-red-600":"text-gray-600 hover:text-red-500"}`,children:[e.jsx(Qe,{className:`h-4 w-4 ${o?"fill-current":""}`}),e.jsx("span",{className:"text-sm",children:m})]}),e.jsxs(N,{variant:"ghost",size:"sm",onClick:v,className:"flex items-center gap-2 text-gray-600 hover:text-blue-500",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:h})]}),e.jsxs(N,{variant:"ghost",size:"sm",onClick:z,className:"flex items-center gap-2 text-gray-600 hover:text-green-500",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:j})]}),e.jsxs(N,{variant:"ghost",size:"sm",onClick:C,className:"flex items-center gap-2 text-gray-600 hover:text-purple-500",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:d})]})]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:y,className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Read More"})]})]})]})]})})},Qs=B.memo(({articleId:r,onClose:i})=>{const[s,t]=n.useState(!1),[a,l]=n.useState(""),[o,m]=n.useState(["",""]),[h,j]=n.useState(null),{polls:d,loading:u,createPoll:y,votePoll:g,refetch:v}=qs(r),z=xe([r]),C=n.useCallback(()=>{v()},[v]);B.useEffect(()=>{if(z.length>0){const f=setTimeout(C,100);return()=>clearTimeout(f)}},[z.length,C]);const E=()=>{o.length<6&&m([...o,""])},c=f=>{o.length>2&&m(o.filter((k,L)=>L!==f))},w=(f,k)=>{const L=[...o];L[f]=k,m(L)},_=()=>b(null,null,function*(){if(!(!a.trim()||o.filter(f=>f.trim()).length<2))try{yield y(a,o.filter(f=>f.trim())),l(""),m(["",""]),t(!1)}catch(f){console.error("Error creating poll:",f)}}),D=(f,k)=>b(null,null,function*(){try{yield g(f,k)}catch(L){console.error("Error voting:",L)}}),P=f=>{var k;return((k=f.vote_counts)==null?void 0:k.reduce((L,I)=>L+I,0))||0},F=f=>f.user_vote,S=f=>f.expires_at?new Date(f.expires_at)<new Date:!1;return e.jsx(ks,{open:!0,onOpenChange:i,children:e.jsxs(Ss,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Es,{children:e.jsxs(Ps,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"News Polls"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(N,{onClick:()=>t(!0),className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Create Poll"]})}),e.jsx(Z,{children:s&&e.jsx($.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:e.jsxs(V,{children:[e.jsx(te,{children:e.jsx(re,{className:"text-lg",children:"Create New Poll"})}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(W,{htmlFor:"question",children:"Question"}),e.jsx(me,{id:"question",value:a,onChange:f=>l(f.target.value),placeholder:"What's your opinion on this news?",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(W,{children:"Options"}),e.jsx("div",{className:"space-y-2 mt-2",children:o.map((f,k)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{value:f,onChange:L=>w(k,L.target.value),placeholder:`Option ${k+1}`,className:"flex-1"}),o.length>2&&e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>c(k),className:"text-red-500 hover:text-red-600",children:e.jsx(ds,{className:"h-4 w-4"})})]},k))}),o.length<6&&e.jsxs(N,{variant:"outline",size:"sm",onClick:E,className:"mt-2",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Add Option"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{onClick:_,disabled:!a.trim()||o.filter(f=>f.trim()).length<2,children:"Create Poll"}),e.jsx(N,{variant:"outline",onClick:()=>t(!1),children:"Cancel"})]})]})]})})}),u?e.jsx("div",{className:"space-y-4",children:Array.from({length:2}).map((f,k)=>e.jsx(V,{children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})})},k))}):d.length===0?e.jsx(V,{children:e.jsxs(M,{className:"p-8 text-center",children:[e.jsx(be,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No polls yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Be the first to create a poll about this news!"})]})}):e.jsx("div",{className:"space-y-4",children:d.map(f=>{var k;return e.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(V,{children:[e.jsx(te,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(re,{className:"text-lg",children:f.question}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"h-3 w-3"}),e.jsxs("span",{children:[P(f)," votes"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),e.jsx("span",{children:Le(new Date(f.created_at),{addSuffix:!0})})]}),S(f)&&e.jsxs(ie,{variant:"secondary",className:"text-xs",children:[e.jsx(us,{className:"h-3 w-3 mr-1"}),"Expired"]})]})]}),e.jsx(ue,{className:"h-8 w-8",children:e.jsx(he,{className:"text-xs",children:((k=f.user_name)==null?void 0:k.charAt(0).toUpperCase())||"U"})})]})}),e.jsx(M,{className:"pt-0",children:e.jsx("div",{className:"space-y-3",children:f.options.map((L,I)=>{var G;const Q=((G=f.vote_counts)==null?void 0:G[I])||0,T=P(f),q=T>0?Q/T*100:0,x=F(f)===I,R=S(f);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:L}),e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsx(Ke,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[Q," (",q.toFixed(1),"%)"]})]})]}),e.jsx(Ls,{value:q,className:"h-2"}),!R&&F(f)===void 0&&e.jsx(N,{variant:"outline",size:"sm",onClick:()=>D(f.id,I),className:"w-full",children:"Vote"})]},I)})})})]})},f.id)})})]})]})})});class Ks{getSubscriptionPlans(i){return b(this,null,function*(){try{const{data:s,error:t}=yield U.from("subscription_plans").select("*").eq("user_type",i).eq("is_active",!0).order("plan_type",{ascending:!0});if(t)throw t;const a=[];if(s)for(const l of s)l.price_monthly>0&&a.push(K(O({},l),{plan_type:"monthly",price_in_cents:l.price_monthly,stripe_price_id:l.stripe_price_id_monthly,currency:"inr"})),l.price_yearly>0&&a.push(K(O({},l),{plan_type:"yearly",price_in_cents:l.price_yearly,stripe_price_id:l.stripe_price_id_yearly,currency:"inr"}));return a}catch(s){return console.error("Error fetching subscription plans:",s),[]}})}getUserSubscriptionStatus(i){return b(this,null,function*(){var s;try{const{data:t,error:a}=yield U.from("user_subscriptions").select(`
          *,
          plan:subscription_plans(*)
        `).eq("user_id",i).eq("status","active").single();if(a&&a.code!=="PGRST116")throw a;const l=t&&t.status==="active"&&(!t.current_period_end||new Date(t.current_period_end)>new Date),o=((s=t==null?void 0:t.plan)==null?void 0:s.features)||{};return{is_pro:l,plan:t==null?void 0:t.plan,subscription:t,expires_at:t==null?void 0:t.current_period_end,can_comment_news:l&&o.news_comments===!0,can_feature_listing:l&&o.featured_listing===!0,has_priority_support:l&&o.priority_support===!0}}catch(t){return console.error("Error fetching user subscription status:",t),{is_pro:!1,can_comment_news:!1,can_feature_listing:!1,has_priority_support:!1}}})}createSubscriptionCheckout(i,s){return b(this,null,function*(){try{const{data:t,error:a}=yield U.from("subscription_plans").select("*").eq("id",i).single();if(a||!t)throw new Error("Plan not found");const{data:l}=yield U.from("user_subscriptions").select("id, status").eq("user_id",s).eq("status","active").single();if(l)throw new Error("User already has an active subscription");let o=t.stripe_price_id;o||(o=`price_${t.user_type}_${t.plan_type}_${t.price_in_cents}`,console.warn("No Stripe price ID found for plan, using temporary ID:",o));const{data:m,error:h}=yield U.functions.invoke("create-checkout-session",{body:{priceId:o,mode:"subscription",userId:s,planId:i,planData:{name:t.name,price:t.price_in_cents,currency:t.currency,interval:t.plan_type==="monthly"?"month":"year"},successUrl:`${window.location.origin}/subscription/success?session_id={CHECKOUT_SESSION_ID}`,cancelUrl:`${window.location.origin}/subscription/cancel`}});if(h)throw new Error(h.message||"Failed to create checkout session");return{success:!0,url:m.url}}catch(t){return console.error("Error creating subscription checkout:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}})}cancelSubscription(i){return b(this,null,function*(){try{const{data:s,error:t}=yield U.from("user_subscriptions").select("*").eq("user_id",i).eq("status","active").single();if(t||!s)throw new Error("No active subscription found");if(!s.stripe_subscription_id)throw new Error("No Stripe subscription ID found");const{error:a}=yield U.functions.invoke("cancel-subscription",{body:{subscriptionId:s.stripe_subscription_id,userId:i}});if(a)throw new Error(a.message||"Failed to cancel subscription");return{success:!0}}catch(s){return console.error("Error canceling subscription:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}})}canCommentOnNews(i){return b(this,null,function*(){try{return(yield this.getUserSubscriptionStatus(i)).can_comment_news}catch(s){return console.error("Error checking news comment permission:",s),!1}})}canFeatureListing(i){return b(this,null,function*(){try{return(yield this.getUserSubscriptionStatus(i)).can_feature_listing}catch(s){return console.error("Error checking feature listing permission:",s),!1}})}getUserSubscriptionHistory(i){return b(this,null,function*(){try{const{data:s,error:t}=yield U.from("user_subscriptions").select(`
          *,
          plan:subscription_plans(*)
        `).eq("user_id",i).order("created_at",{ascending:!1});if(t)throw t;return s||[]}catch(s){return console.error("Error fetching subscription history:",s),[]}})}updateSubscriptionFromWebhook(i,s,t,a,l){return b(this,null,function*(){try{const o={status:s,updated_at:new Date().toISOString()};t&&(o.current_period_start=t),a&&(o.current_period_end=a),l!==void 0&&(o.cancel_at_period_end=l);const{error:m}=yield U.from("user_subscriptions").update(o).eq("stripe_subscription_id",i);if(m)throw m}catch(o){throw console.error("Error updating subscription from webhook:",o),o}})}createSubscription(i,s,t,a,l,o){return b(this,null,function*(){try{const{error:m}=yield U.from("user_subscriptions").insert({user_id:i,plan_id:s,stripe_subscription_id:t,stripe_customer_id:a,status:"active",current_period_start:l,current_period_end:o,cancel_at_period_end:!1});if(m)throw m}catch(m){throw console.error("Error creating subscription:",m),m}})}getAuthToken(){return b(this,null,function*(){const{data:{session:i}}=yield U.auth.getSession();return(i==null?void 0:i.access_token)||""})}}const Gs=new Ks;function Ws({children:r,fallback:i,feature:s="this feature",onUpgradeClick:t}){const{user:a}=Se(),[l,o]=n.useState(null),[m,h]=n.useState(!0),[j,d]=n.useState(!1),u=n.useCallback(()=>b(null,null,function*(){if(!(a!=null&&a.id)){d(!1),h(!1);return}try{h(!0);const g=yield Gs.getUserSubscriptionStatus(a.id);o(g);let v=!1;switch(s){case"news_comments":v=g.can_comment_news;break;case"featured_listing":v=g.can_feature_listing;break;case"priority_support":v=g.has_priority_support;break;default:v=g.is_pro}d(v)}catch(g){console.error("Error checking Pro access:",g),d(!1)}finally{h(!1)}}),[a==null?void 0:a.id,s]);n.useEffect(()=>{a!=null&&a.id&&u()},[a==null?void 0:a.id,s,u]);const y=()=>{if(t)t();else{const g=document.getElementById("subscription-plans");g&&g.scrollIntoView({behavior:"smooth"})}};return m?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):j?e.jsx(e.Fragment,{children:r}):i?e.jsx(e.Fragment,{children:i}):e.jsxs(V,{className:"border-dashed border-2 border-gray-300",children:[e.jsxs(te,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-yellow-100",children:e.jsx(Ie,{className:"h-6 w-6 text-yellow-600"})}),e.jsx(re,{className:"text-lg",children:"Pro Feature"}),e.jsxs(ns,{children:[s==="news_comments"&&"Comment on news articles",s==="featured_listing"&&"Featured listing in search results",s==="priority_support"&&"Priority customer support",!["news_comments","featured_listing","priority_support"].includes(s)&&`Access to ${s}`]})]}),e.jsxs(M,{className:"text-center space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"This feature is available to Pro subscribers only."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[e.jsx(hs,{className:"h-4 w-4"}),e.jsx("span",{children:"Upgrade to unlock"})]})]}),e.jsxs(N,{onClick:y,className:"w-full",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Upgrade to Pro"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Starting from ₹20/month for users, ₹500/year for artists"})]})]})}function Oe({children:r,fallback:i,onUpgradeClick:s}){return e.jsx(Ws,{feature:"news_comments",fallback:i,onUpgradeClick:s,children:r})}const Ys=B.memo(({articleId:r,isOpen:i,onClose:s})=>{var De,Ue;const{user:t}=Se(),{toast:a}=Be(),{comments:l,loading:o,submitting:m,error:h,addComment:j,editComment:d,deleteComment:u,voteComment:y,refetch:g}=$s(r),v=xe([r]),z=n.useCallback(()=>{g()},[g]);B.useEffect(()=>{if(v.length>0){const p=setTimeout(z,100);return()=>clearTimeout(p)}},[v.length,z]);const[C,E]=n.useState(""),[c,w]=n.useState(null),[_,D]=n.useState(null),[P,F]=n.useState(""),[S,f]=n.useState(new Set),k=p=>p?p.split(" ").map(A=>A[0]).join("").toUpperCase():"U",L=p=>{try{return Le(new Date(p),{addSuffix:!0})}catch(A){return"Unknown time"}},I=()=>b(null,null,function*(){if(!C.trim()||m)return;const A=yield j({article_id:r,content:C,parent_comment_id:c||void 0});A.success?(E(""),w(null),a({title:"Comment added",description:"Your comment has been posted successfully."})):a({title:"Error",description:A.error||"Failed to add comment",variant:"destructive"})}),Q=p=>b(null,null,function*(){if(!P.trim()||m)return;const A=yield d(p,P);A.success?(D(null),F(""),a({title:"Comment updated",description:"Your comment has been updated successfully."})):a({title:"Error",description:A.error||"Failed to update comment",variant:"destructive"})}),T=p=>b(null,null,function*(){if(!confirm("Are you sure you want to delete this comment?"))return;const A=yield u(p);A.success?a({title:"Comment deleted",description:"Your comment has been deleted successfully."}):a({title:"Error",description:A.error||"Failed to delete comment",variant:"destructive"})}),q=(p,A)=>b(null,null,function*(){const H=yield y(p,A);H.success||a({title:"Error",description:H.error||"Failed to vote",variant:"destructive"})}),x=p=>{f(A=>{const H=new Set(A);return H.has(p)?H.delete(p):H.add(p),H})},R=p=>{w(p),E("")},G=p=>{D(p.id),F(p.content)},Ye=()=>{w(null),E("")},Je=()=>{D(null),F("")},ze=(p,A=!1)=>{const H=S.has(p.id),Xe=(t==null?void 0:t.id)===p.user_id,Ze=(t==null?void 0:t.id)===p.user_id;return e.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:`${A?"ml-8 mt-4":"mb-4"}`,children:e.jsx(V,{className:`${A?"border-l-4 border-l-blue-200":""} feed-item`,children:e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(ue,{className:"h-8 w-8",children:[e.jsx(Re,{src:p.author_avatar}),e.jsx(he,{className:"text-xs",children:k(p.author_name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900 dark:text-white",children:p.author_name}),e.jsx("span",{className:"text-xs text-gray-500",children:L(p.created_at)}),p.is_edited&&e.jsx(ie,{variant:"outline",className:"text-xs",children:"edited"})]}),_===p.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(we,{value:P,onChange:ae=>F(ae.target.value),placeholder:"Edit your comment...",className:"min-h-[80px]"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{size:"sm",onClick:()=>Q(p.id),disabled:m||!P.trim(),children:m?e.jsx(ee,{className:"h-4 w-4 animate-spin"}):"Save"}),e.jsx(N,{size:"sm",variant:"outline",onClick:Je,children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mb-3",children:p.content}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(N,{variant:"ghost",size:"sm",className:"h-6 px-2 text-gray-600 hover:text-green-600",onClick:()=>q(p.id,p.user_vote===1?0:1),children:[e.jsx(xs,{className:`h-3 w-3 ${p.user_vote===1?"text-green-600":""}`}),e.jsx("span",{className:"ml-1 text-xs",children:p.upvotes})]}),e.jsxs(N,{variant:"ghost",size:"sm",className:"h-6 px-2 text-gray-600 hover:text-red-600",onClick:()=>q(p.id,p.user_vote===-1?0:-1),children:[e.jsx(ps,{className:`h-3 w-3 ${p.user_vote===-1?"text-red-600":""}`}),e.jsx("span",{className:"ml-1 text-xs",children:p.downvotes})]})]}),!A&&e.jsxs(N,{variant:"ghost",size:"sm",className:"h-6 px-2 text-gray-600 hover:text-blue-600",onClick:()=>R(p.id),children:[e.jsx(fs,{className:"h-3 w-3"}),e.jsx("span",{className:"ml-1 text-xs",children:"Reply"})]}),Xe&&e.jsx(N,{variant:"ghost",size:"sm",className:"h-6 px-2 text-gray-600 hover:text-blue-600",onClick:()=>G(p),children:e.jsx(gs,{className:"h-3 w-3"})}),Ze&&e.jsx(N,{variant:"ghost",size:"sm",className:"h-6 px-2 text-gray-600 hover:text-red-600",onClick:()=>T(p.id),children:e.jsx(js,{className:"h-3 w-3"})}),p.reply_count>0&&e.jsxs(N,{variant:"ghost",size:"sm",className:"h-6 px-2 text-gray-600 hover:text-blue-600",onClick:()=>x(p.id),children:[H?e.jsx(ys,{className:"h-3 w-3"}):e.jsx(vs,{className:"h-3 w-3"}),e.jsxs("span",{className:"ml-1 text-xs",children:[H?"Hide":"Show"," ",p.reply_count," ",p.reply_count===1?"reply":"replies"]})]})]}),c===p.id&&e.jsx(Oe,{children:e.jsxs($.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(we,{value:C,onChange:ae=>E(ae.target.value),placeholder:`Reply to ${p.author_name}...`,className:"min-h-[80px] mb-2"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{size:"sm",onClick:I,disabled:m||!C.trim(),children:m?e.jsx(ee,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),"Reply"]})}),e.jsx(N,{size:"sm",variant:"outline",onClick:Ye,children:"Cancel"})]})]})}),H&&p.replies&&p.replies.length>0&&e.jsx($.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4",children:p.replies.map(ae=>ze(ae,!0))})]})]})]})})})},p.id)};return i?e.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:s,children:e.jsxs($.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] flex flex-col",onClick:p=>p.stopPropagation(),children:[e.jsx(te,{className:"flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(re,{className:"flex items-center gap-2 text-gradient",children:[e.jsx(Ne,{className:"h-5 w-5"}),"Comments (",l.length,")"]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:s,children:"×"})]})}),e.jsxs(M,{className:"flex-1 overflow-y-auto",children:[t&&e.jsx(Oe,{children:e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(ue,{className:"h-8 w-8",children:[e.jsx(Re,{src:(De=t.user_metadata)==null?void 0:De.avatar_url}),e.jsx(he,{className:"text-xs",children:k((Ue=t.user_metadata)==null?void 0:Ue.display_name)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(we,{value:C,onChange:p=>E(p.target.value),placeholder:"Share your thoughts on this article...",className:"min-h-[100px] mb-3"}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(N,{onClick:I,disabled:m||!C.trim(),className:"btn-community",children:[m?e.jsx(ee,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx($e,{className:"h-4 w-4 mr-2"}),"Post Comment"]})})]})]})})}),o?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ee,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading comments..."})]}):h?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 mb-4",children:h}),e.jsx(N,{variant:"outline",onClick:()=>window.location.reload(),children:"Try Again"})]}):l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No comments yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Be the first to share your thoughts on this article."})]}):e.jsx("div",{className:"space-y-4",children:e.jsx(Z,{children:l.map(p=>ze(p))})})]})]})}):null}),Js=B.memo(({className:r})=>{const[i,s]=n.useState("latest"),[t,a]=n.useState(""),[l,o]=n.useState(null),[m,h]=n.useState(null),[j,d]=n.useState(null),{location:u,loading:y,error:g,updateLocation:v}=Ms(),{articles:z,loading:C,error:E,hasMore:c,loadMore:w,refresh:_,isFetching:D}=Fs(i,u||{city:"Delhi",country:"India"}),{toggleLike:P,shareArticle:F,getInteractionData:S}=Is(),f=z.map(x=>x.article_id),k=xe(f);n.useEffect(()=>{k.length>0&&_()},[k,_]),n.useCallback(x=>{v(x),_()},[v,_]);const L=n.useCallback(x=>{P(x)},[P]),I=n.useCallback(x=>b(null,null,function*(){try{if(navigator.share){const R=z.find(G=>G.article_id===x);R&&(yield navigator.share({title:R.title,text:R.ai_summary||R.description,url:R.url}))}else{const R=z.find(G=>G.article_id===x);R&&(yield navigator.clipboard.writeText(R.url))}F(x,"web")}catch(R){console.error("Error sharing article:",R)}}),[z,F]),Q=n.useCallback(x=>{h(x)},[]),T=n.useCallback(x=>{d(x)},[]);n.useEffect(()=>{const x=()=>{window.innerHeight+document.documentElement.scrollTop>=document.documentElement.offsetHeight-1e3&&c&&!D&&w()};return window.addEventListener("scroll",x),()=>window.removeEventListener("scroll",x)},[c,D,w]);const q=()=>e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((x,R)=>e.jsx(V,{className:"overflow-hidden",children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(X,{className:"w-24 h-24 rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(X,{className:"h-4 w-3/4"}),e.jsx(X,{className:"h-3 w-full"}),e.jsx(X,{className:"h-3 w-2/3"}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(X,{className:"h-6 w-16"}),e.jsx(X,{className:"h-6 w-20"})]})]})]})})},R))});return y?e.jsx("div",{className:`container mx-auto px-4 py-8 ${r}`,children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(ee,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading location..."})]})}):g?e.jsx("div",{className:`container mx-auto px-4 py-8 ${r}`,children:e.jsx(oe,{children:e.jsxs(de,{children:[g,". Using default location: Delhi, India"]})})}):e.jsxs("div",{className:`container mx-auto px-4 py-8 ${r}`,children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Local News"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsxs("span",{children:[u==null?void 0:u.city,", ",u==null?void 0:u.country]})]})]}),e.jsxs(N,{onClick:_,disabled:D,variant:"outline",size:"sm",children:[e.jsx(Ce,{className:`h-4 w-4 mr-2 ${D?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ws,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(me,{placeholder:"Search news...",value:t,onChange:x=>a(x.target.value),className:"pl-10"})]})]}),e.jsxs(rs,{value:i,onValueChange:x=>s(x),children:[e.jsxs(is,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(ge,{value:"latest",className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Latest"]}),e.jsxs(ge,{value:"trending",className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-4 w-4"}),"Trending"]}),e.jsxs(ge,{value:"for-you",className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"For You"]})]}),e.jsx(je,{value:"latest",className:"space-y-6",children:C?e.jsx(q,{}):E?e.jsx(oe,{children:e.jsxs(de,{children:["Failed to load news: ",E.message]})}):e.jsx(Z,{children:e.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-6",children:[z.map(x=>e.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsx(_e,{article:x,onLike:()=>L(x.article_id),onComment:()=>Q(x.article_id),onShare:()=>I(x.article_id),onPoll:()=>T(x.article_id),isLiked:S(x.article_id).isLiked,likesCount:S(x.article_id).likesCount,commentsCount:S(x.article_id).commentsCount,sharesCount:S(x.article_id).sharesCount,pollsCount:S(x.article_id).pollsCount})},x.article_id)),c&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(N,{onClick:w,disabled:D,variant:"outline",children:D?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Loading..."]}):"Load More"})}),z.length===0&&!C&&e.jsx(V,{children:e.jsxs(M,{className:"p-8 text-center",children:[e.jsx(Ge,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No news found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Try refreshing or check back later for updates."})]})})]})})}),e.jsx(je,{value:"trending",className:"space-y-6",children:C?e.jsx(q,{}):E?e.jsx(oe,{children:e.jsxs(de,{children:["Failed to load trending news: ",E.message]})}):e.jsx(Z,{children:e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-6",children:z.map(x=>e.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsx(_e,{article:x,onLike:()=>L(x.article_id),onComment:()=>Q(x.article_id),onShare:()=>I(x.article_id),onPoll:()=>T(x.article_id),isLiked:S(x.article_id).isLiked,likesCount:S(x.article_id).likesCount,commentsCount:S(x.article_id).commentsCount,sharesCount:S(x.article_id).sharesCount,pollsCount:S(x.article_id).pollsCount})},x.article_id))})})}),e.jsx(je,{value:"for-you",className:"space-y-6",children:C?e.jsx(q,{}):E?e.jsx(oe,{children:e.jsxs(de,{children:["Failed to load personalized news: ",E.message]})}):e.jsx(Z,{children:e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-6",children:z.map(x=>e.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsx(_e,{article:x,onLike:()=>L(x.article_id),onComment:()=>Q(x.article_id),onShare:()=>I(x.article_id),onPoll:()=>T(x.article_id),isLiked:S(x.article_id).isLiked,likesCount:S(x.article_id).likesCount,commentsCount:S(x.article_id).commentsCount,sharesCount:S(x.article_id).sharesCount,pollsCount:S(x.article_id).pollsCount})},x.article_id))})})})]}),e.jsxs(Z,{children:[m&&e.jsx(Ys,{articleId:m,onClose:()=>h(null)}),j&&e.jsx(Qs,{articleId:j,onClose:()=>d(null)})]})]})}),Xs=({isOpen:r,onClose:i})=>{const{user:s}=Se(),{toast:t}=Be(),[a,l]=n.useState(null),[o,m]=n.useState(!1),[h,j]=n.useState(!1),[d,u]=n.useState(null),y=[{value:"community",label:"Community",description:"Local events and community news"},{value:"infrastructure",label:"Infrastructure",description:"Transportation, utilities, and development"},{value:"arts",label:"Arts & Culture",description:"Cultural events, exhibitions, and performances"},{value:"environment",label:"Environment",description:"Environmental issues and sustainability"},{value:"technology",label:"Technology",description:"Tech news and digital developments"},{value:"business",label:"Business",description:"Local business and economic news"},{value:"health",label:"Health",description:"Healthcare and wellness news"},{value:"education",label:"Education",description:"Schools, universities, and educational news"},{value:"sports",label:"Sports",description:"Local sports teams and events"},{value:"politics",label:"Politics",description:"Government and political news"}],g=[{value:"delhi",label:"Delhi",coordinates:{lat:28.6139,lng:77.209}},{value:"mumbai",label:"Mumbai",coordinates:{lat:19.076,lng:72.8777}},{value:"bangalore",label:"Bangalore",coordinates:{lat:12.9716,lng:77.5946}},{value:"chennai",label:"Chennai",coordinates:{lat:13.0827,lng:80.2707}},{value:"kolkata",label:"Kolkata",coordinates:{lat:22.5726,lng:88.3639}}],v=n.useCallback(()=>b(null,null,function*(){if(s){m(!0);try{const{data:c,error:w}=yield U.from("user_news_preferences").select("*").eq("user_id",s.id).single();if(w&&w.code!=="PGRST116")throw w;if(c)l(c);else{const _={user_id:s.id,preferred_categories:["community","infrastructure","business"],excluded_categories:[],preferred_sources:[],location_radius_km:50,home_location:{city:"Delhi",state:"Delhi",country:"India",coordinates:{lat:28.6139,lng:77.209}},notification_settings:{email_notifications:!0,push_notifications:!0,breaking_news:!0,daily_digest:!1,weekly_summary:!0},display_preferences:{show_summaries:!0,show_sentiment:!0,show_reading_time:!0,articles_per_page:20,auto_refresh_interval:5}};l(_)}}catch(c){console.error("Error loading preferences:",c);const w={user_id:s.id,preferred_categories:["community","infrastructure","business"],excluded_categories:[],preferred_sources:[],location_radius_km:50,home_location:{city:"Delhi",state:"Delhi",country:"India",coordinates:{lat:28.6139,lng:77.209}},notification_settings:{email_notifications:!0,push_notifications:!0,breaking_news:!0,daily_digest:!1,weekly_summary:!0},display_preferences:{show_summaries:!0,show_sentiment:!0,show_reading_time:!0,articles_per_page:20,auto_refresh_interval:5}};l(w)}finally{m(!1)}}}),[s]),z=n.useCallback(()=>b(null,null,function*(){if(!(!s||!a)){j(!0);try{const{error:c}=yield U.from("user_news_preferences").upsert(K(O({},a),{updated_at:new Date().toISOString()}),{onConflict:"user_id"});if(c)throw c;t({title:"Preferences saved",description:"Your news preferences have been updated successfully."})}catch(c){console.error("Error saving preferences:",c),t({title:"Error",description:"Failed to save preferences. Please try again.",variant:"destructive"})}finally{j(!1)}}}),[s,a,t]),C=n.useCallback((c,w)=>{l(_=>{if(!_)return _;const D=O({},_),P=c.split(".");let F=D;for(let S=0;S<P.length-1;S++)F=F[P[S]];return F[P[P.length-1]]=w,D})},[]),E=n.useCallback((c,w)=>{if(a)if(w){const _=a.preferred_categories.includes(c)?a.preferred_categories.filter(P=>P!==c):[...a.preferred_categories,c],D=a.excluded_categories.filter(P=>P!==c);C("preferred_categories",_),C("excluded_categories",D)}else{const _=a.excluded_categories.includes(c)?a.excluded_categories.filter(P=>P!==c):[...a.excluded_categories,c],D=a.preferred_categories.filter(P=>P!==c);C("excluded_categories",_),C("preferred_categories",D)}},[a,C]);return n.useEffect(()=>{r&&s&&v()},[r,s,v]),r?o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx(V,{className:"w-full max-w-2xl mx-4",children:e.jsxs(M,{className:"p-8 text-center",children:[e.jsx(Ce,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{children:"Loading your news preferences..."})]})})}):d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx(V,{className:"w-full max-w-2xl mx-4",children:e.jsxs(M,{className:"p-8 text-center",children:[e.jsx(Me,{className:"h-8 w-8 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:d}),e.jsx(N,{onClick:v,variant:"outline",children:"Try Again"})]})})}):a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{className:"flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(re,{className:"flex items-center gap-2 text-gradient",children:[e.jsx(We,{className:"h-5 w-5"}),"News Preferences"]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:i,children:"×"})]})}),e.jsxs(M,{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 text-gradient-community",children:[e.jsx(Pe,{className:"h-5 w-5"}),"Location Settings"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(W,{htmlFor:"home-location",children:"Home Location"}),e.jsxs(zs,{value:a.home_location.city.toLowerCase(),onValueChange:c=>{const w=g.find(_=>_.value===c);w&&C("home_location",{city:w.label,state:w.label,country:"India",coordinates:w.coordinates})},children:[e.jsx(Ds,{children:e.jsx(Us,{placeholder:"Select your city"})}),e.jsx(As,{children:g.map(c=>e.jsx(Ts,{value:c.value,children:c.label},c.value))})]})]}),e.jsxs("div",{children:[e.jsxs(W,{htmlFor:"radius",children:["Search Radius: ",a.location_radius_km," km"]}),e.jsx(Rs,{value:[a.location_radius_km],onValueChange:([c])=>C("location_radius_km",c),max:200,min:10,step:10,className:"mt-2"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 text-gradient-community",children:[e.jsx(Ns,{className:"h-5 w-5"}),"Category Preferences"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(W,{className:"text-green-600 font-medium",children:"Preferred Categories"}),e.jsx("div",{className:"space-y-2 mt-2",children:y.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:c.label}),e.jsx("div",{className:"text-sm text-gray-500",children:c.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.preferred_categories.includes(c.value)&&e.jsxs(ie,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Preferred"]}),e.jsx(N,{size:"sm",variant:a.preferred_categories.includes(c.value)?"default":"outline",onClick:()=>E(c.value,!0),children:a.preferred_categories.includes(c.value)?"Remove":"Add"})]})]},c.value))})]}),e.jsxs("div",{children:[e.jsx(W,{className:"text-red-600 font-medium",children:"Excluded Categories"}),e.jsx("div",{className:"space-y-2 mt-2",children:y.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:c.label}),e.jsx("div",{className:"text-sm text-gray-500",children:c.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.excluded_categories.includes(c.value)&&e.jsxs(ie,{variant:"destructive",children:[e.jsx(Me,{className:"h-3 w-3 mr-1"}),"Excluded"]}),e.jsx(N,{size:"sm",variant:a.excluded_categories.includes(c.value)?"destructive":"outline",onClick:()=>E(c.value,!1),children:a.excluded_categories.includes(c.value)?"Remove":"Exclude"})]})]},c.value))})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 text-gradient-community",children:[e.jsx(bs,{className:"h-5 w-5"}),"Notification Settings"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(a.notification_settings).map(([c,w])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(W,{className:"font-medium",children:c.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase())}),e.jsxs("p",{className:"text-sm text-gray-500",children:[c==="email_notifications"&&"Receive news updates via email",c==="push_notifications"&&"Get push notifications for breaking news",c==="breaking_news"&&"Immediate alerts for breaking news",c==="daily_digest"&&"Daily summary of top stories",c==="weekly_summary"&&"Weekly roundup of important news"]})]}),e.jsx(qe,{checked:w,onCheckedChange:_=>C(`notification_settings.${c}`,_)})]},c))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 text-gradient-community",children:[e.jsx(Ge,{className:"h-5 w-5"}),"Display Preferences"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"space-y-4",children:Object.entries(a.display_preferences).map(([c,w])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(W,{className:"font-medium",children:c.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase())}),e.jsxs("p",{className:"text-sm text-gray-500",children:[c==="show_summaries"&&"Display AI-generated summaries",c==="show_sentiment"&&"Show sentiment analysis",c==="show_reading_time"&&"Display estimated reading time",c==="articles_per_page"&&"Number of articles per page",c==="auto_refresh_interval"&&"Auto-refresh interval (minutes)"]})]}),typeof w=="boolean"?e.jsx(qe,{checked:w,onCheckedChange:_=>C(`display_preferences.${c}`,_)}):e.jsx(me,{type:"number",value:w,onChange:_=>C(`display_preferences.${c}`,parseInt(_.target.value)),className:"w-20",min:c==="articles_per_page"?5:1,max:c==="articles_per_page"?100:60})]},c))})})]}),e.jsx("div",{className:"flex justify-end pt-6 border-t",children:e.jsxs(N,{onClick:z,disabled:h,className:"btn-community",children:[h?e.jsx(Ce,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"Save Preferences"]})})]})]})}):null:null},Zs=()=>{const[r,i]=n.useState(!1),s=()=>{i(!0)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Local News"}),e.jsxs(N,{variant:"outline",size:"sm",onClick:s,children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"News Settings"]})]}),e.jsx(Js,{}),e.jsx(Xs,{isOpen:r,onClose:()=>i(!1)})]})},St=()=>e.jsx(as,{showNewsFeed:!1,children:e.jsx(Zs,{})});export{St as default};
