var m=(o,l,e)=>new Promise((f,r)=>{var w=i=>{try{u(e.next(i))}catch(g){r(g)}},n=i=>{try{u(e.throw(i))}catch(g){r(g)}},u=i=>i.done?f(i.value):Promise.resolve(i.value).then(w,n);u((e=e.apply(o,l)).next())});import{u as p,g as y,r as a,s as d,j as c,B as C}from"./main-Dczk40-q.js";import{n as v}from"./notificationService-DiBkqnn5.js";import{U as E}from"./user-check-HA6vCK6U.js";import{U as _}from"./user-plus-DoUP2pA_.js";const j=o=>{const{user:l}=p(),{toast:e}=y(),[f,r]=a.useState(!1),[w,n]=a.useState(0),[u,i]=a.useState(0),[g,x]=a.useState(!0),F=a.useCallback(()=>m(void 0,null,function*(){if(!(!l||!o))try{const{data:t,error:s}=yield d.from("follows").select("id").eq("follower_id",l.id).eq("following_id",o).single();r(!!(t&&!s))}catch(t){r(!1)}}),[l,o]),h=a.useCallback(()=>m(void 0,null,function*(){if(o)try{const[t,s]=yield Promise.all([d.from("follows").select("id",{count:"exact"}).eq("following_id",o),d.from("follows").select("id",{count:"exact"}).eq("follower_id",o)]);n(t.count||0),i(s.count||0)}catch(t){console.error("Error fetching follow counts:",t)}finally{x(!1)}}),[o]);return a.useEffect(()=>{o&&(F(),h())},[o,l,F,h]),{isFollowing:f,followersCount:w,followingCount:u,loading:g,toggleFollow:()=>m(void 0,null,function*(){if(!l||!o)return e({title:"Sign in required",description:"Please sign in to follow users",variant:"destructive"}),!1;if(l.id===o)return e({title:"Cannot follow yourself",description:"You cannot follow your own profile",variant:"destructive"}),!1;try{if(f){const{error:t}=yield d.from("follows").delete().eq("follower_id",l.id).eq("following_id",o);if(t)throw t;r(!1),n(s=>s-1),e({title:"Unfollowed",description:"You have unfollowed this user"})}else{const{error:t}=yield d.from("follows").insert({follower_id:l.id,following_id:o});if(t)throw t;try{yield v.createNewFollowerNotification(l.id,o)}catch(s){console.error("Error creating follow notification:",s)}r(!0),n(s=>s+1),e({title:"Following",description:"You are now following this user"})}return!0}catch(t){return console.error("Error toggling follow:",t),e({title:"Error",description:"Failed to update follow status",variant:"destructive"}),!1}}),refetch:()=>{F(),h()}}},B=({userId:o,variant:l="outline",size:e="default",className:f})=>{const{user:r}=p(),{isFollowing:w,toggleFollow:n}=j(o);return(r==null?void 0:r.id)===o?null:c.jsx(C,{variant:l,size:e,onClick:n,className:f,children:w?c.jsxs(c.Fragment,{children:[c.jsx(E,{className:"h-4 w-4 mr-2"}),"Following"]}):c.jsxs(c.Fragment,{children:[c.jsx(_,{className:"h-4 w-4 mr-2"}),"Follow"]})})};export{B as F,j as u};
