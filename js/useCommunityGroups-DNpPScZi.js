var a=(h,y,l)=>new Promise((m,f)=>{var w=i=>{try{p(l.next(i))}catch(g){f(g)}},G=i=>{try{p(l.throw(i))}catch(g){f(g)}},p=i=>i.done?m(i.value):Promise.resolve(i.value).then(w,G);p((l=l.apply(h,y)).next())});import{r as s,g as j,u as M}from"./main-jfCIwKxb.js";import{C as u}from"./communityService-C-z7L7tP.js";const z=()=>{const[h,y]=s.useState([]),[l,m]=s.useState([]),[f,w]=s.useState([]),[G,p]=s.useState(!0),[i,g]=s.useState(!1),{toast:o}=j(),{user:t}=M(),c=s.useCallback(e=>a(void 0,null,function*(){try{p(!0);const r=yield u.getGroups(e);y(r)}catch(r){console.error("Error fetching groups:",r),o({title:"Error",description:"Failed to fetch groups",variant:"destructive"})}finally{p(!1)}}),[o]),n=s.useCallback(()=>a(void 0,null,function*(){if(!t){console.log("No user found, skipping user groups fetch");return}try{console.log("Fetching user groups for user:",t.id);const e=yield u.getUserGroups(t.id);m(e)}catch(e){console.error("Error fetching user groups:",e)}}),[t]),v=s.useCallback((e=10)=>a(void 0,null,function*(){try{const r=yield u.getTrendingGroups(e);w(r)}catch(r){console.error("Error fetching trending groups:",r)}}),[]),E=s.useCallback(e=>a(void 0,null,function*(){if(!t)return o({title:"Error",description:"You must be logged in to create groups",variant:"destructive"}),null;try{g(!0);const r=yield u.createGroup(e);if(r)return o({title:"Success",description:"Group created successfully!"}),yield c(),yield n(),r;throw new Error("Failed to create group")}catch(r){return console.error("Error creating group:",r),o({title:"Error",description:"Failed to create group",variant:"destructive"}),null}finally{g(!1)}}),[t,o,c,n]),b=s.useCallback(e=>a(void 0,null,function*(){if(!t)return o({title:"Error",description:"You must be logged in to join groups",variant:"destructive"}),!1;try{if(console.log("Attempting to join group:",e,"for user:",t.id),yield u.addGroupMember(e,t.id))return o({title:"Success",description:"Joined group successfully!"}),yield c(),yield n(),!0;throw new Error("Failed to join group")}catch(r){console.error("Error joining group:",r);let d="Failed to join group";return(r==null?void 0:r.code)==="23505"?d="You are already a member of this group":r!=null&&r.message&&(d=r.message),o({title:"Error",description:d,variant:"destructive"}),!1}}),[t,o,c,n]),C=s.useCallback(e=>a(void 0,null,function*(){if(!t)return o({title:"Error",description:"You must be logged in to leave groups",variant:"destructive"}),!1;try{if(yield u.removeGroupMember(e,t.id))return o({title:"Success",description:"Left group successfully!"}),yield c(),yield n(),!0;throw new Error("Failed to leave group")}catch(r){return console.error("Error leaving group:",r),o({title:"Error",description:"Failed to leave group",variant:"destructive"}),!1}}),[t,o,c,n]),k=s.useCallback(e=>a(void 0,null,function*(){if(!t)return!1;try{return yield u.isGroupMember(e,t.id)}catch(r){return console.error("Error checking group membership:",r),!1}}),[t]),F=s.useCallback(e=>a(void 0,null,function*(){if(!t)return null;try{return yield u.getUserRole(e,t.id)}catch(r){return console.error("Error getting user role:",r),null}}),[t]),S=s.useCallback((e,r)=>a(void 0,null,function*(){try{return yield u.searchGroups(e,r)}catch(d){return console.error("Error searching groups:",d),o({title:"Error",description:"Failed to search groups",variant:"destructive"}),[]}}),[o]);return s.useEffect(()=>{a(void 0,null,function*(){try{yield c(),yield n(),yield v()}catch(r){console.error("Error initializing community data:",r)}})},[c,n,v]),{groups:h,userGroups:l,trendingGroups:f,loading:G,creating:i,fetchGroups:c,fetchUserGroups:n,fetchTrendingGroups:v,createGroup:E,joinGroup:b,leaveGroup:C,isGroupMember:k,getUserRole:F,searchGroups:S}};export{z as u};
