var t,e,s,i,r,n,a,o,h,l,u,c,d,p,f,b,v,y,m,g,O,w,R,C,k,M,S,E,x,W,U,P,I,Q,T=Object.defineProperty,F=Object.defineProperties,_=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,L=t=>{throw TypeError(t)},A=(t,e,s)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,H=(t,e)=>{for(var s in e||(e={}))j.call(e,s)&&A(t,s,e[s]);if(D)for(var s of D(e))q.call(e,s)&&A(t,s,e[s]);return t},K=(t,e)=>F(t,_(e)),B=(t,e,s)=>e.has(t)||L("Cannot "+s),z=(t,e,s)=>(B(t,e,"read from private field"),s?s.call(t):e.get(t)),G=(t,e,s)=>e.has(t)?L("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),J=(t,e,s,i)=>(B(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),N=(t,e,s)=>(B(t,e,"access private method"),s);import{S as V,E as Y,F as X,G as Z,H as $,I as tt,J as et,K as st,M as it,N as rt,O as nt,Q as at,U as ot,V as ht,W as lt,r as ut,Y as ct,C as dt}from"./index-B5IYdG7F.js";var pt=(M=class extends V{constructor(v,y){super(),G(this,b),G(this,t),G(this,e),G(this,s),G(this,i),G(this,r),G(this,n),G(this,a),G(this,o),G(this,h),G(this,l),G(this,u),G(this,c),G(this,d),G(this,p),G(this,f,new Set),this.options=y,J(this,t,v),J(this,o,null),J(this,a,Y()),this.bindMethods(),this.setOptions(y)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(z(this,e).addObserver(this),ft(z(this,e),this.options)?N(this,b,v).call(this):this.updateResult(),N(this,b,O).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return bt(z(this,e),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return bt(z(this,e),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,N(this,b,w).call(this),N(this,b,R).call(this),z(this,e).removeObserver(this)}setOptions(s){const i=this.options,r=z(this,e);if(this.options=z(this,t).defaultQueryOptions(s),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof X(this.options.enabled,z(this,e)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");N(this,b,C).call(this),z(this,e).setOptions(this.options),i._defaulted&&!Z(this.options,i)&&z(this,t).getQueryCache().notify({type:"observerOptionsUpdated",query:z(this,e),observer:this});const n=this.hasListeners();n&&vt(z(this,e),r,this.options,i)&&N(this,b,v).call(this),this.updateResult(),!n||z(this,e)===r&&X(this.options.enabled,z(this,e))===X(i.enabled,z(this,e))&&$(this.options.staleTime,z(this,e))===$(i.staleTime,z(this,e))||N(this,b,y).call(this);const a=N(this,b,m).call(this);!n||z(this,e)===r&&X(this.options.enabled,z(this,e))===X(i.enabled,z(this,e))&&a===z(this,p)||N(this,b,g).call(this,a)}getOptimisticResult(s){const a=z(this,t).getQueryCache().build(z(this,t),s),o=this.createResult(a,s);return function(t,e){if(!Z(t.getCurrentResult(),e))return!0;return!1}(this,o)&&(J(this,i,o),J(this,n,this.options),J(this,r,z(this,e).state)),o}getCurrentResult(){return z(this,i)}trackResult(t,e){return new Proxy(t,{get:(t,s)=>(this.trackProp(s),null==e||e(s),"promise"!==s||this.options.experimental_prefetchInRender||"pending"!==z(this,a).status||z(this,a).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(t,s))})}trackProp(t){z(this,f).add(t)}getCurrentQuery(){return z(this,e)}refetch(t={}){var e=((t,e)=>{var s={};for(var i in t)j.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&D)for(var i of D(t))e.indexOf(i)<0&&q.call(t,i)&&(s[i]=t[i]);return s})(t,[]);return this.fetch(H({},e))}fetchOptimistic(e){const s=z(this,t).defaultQueryOptions(e),i=z(this,t).getQueryCache().build(z(this,t),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(t){var e;return N(this,b,v).call(this,K(H({},t),{cancelRefetch:null==(e=t.cancelRefetch)||e})).then(()=>(this.updateResult(),z(this,i)))}createResult(t,c){var d;const p=z(this,e),f=this.options,b=z(this,i),v=z(this,r),y=z(this,n),m=t!==p?t.state:z(this,s),{state:g}=t;let O,w=H({},g),R=!1;if(c._optimisticResults){const e=this.hasListeners(),s=!e&&ft(t,c),i=e&&vt(t,p,c,f);(s||i)&&(w=H(H({},w),nt(g.data,t.options))),"isRestoring"===c._optimisticResults&&(w.fetchStatus="idle")}let{error:C,errorUpdatedAt:k,status:M}=w;O=w.data;let S=!1;if(void 0!==c.placeholderData&&void 0===O&&"pending"===M){let t;(null==b?void 0:b.isPlaceholderData)&&c.placeholderData===(null==y?void 0:y.placeholderData)?(t=b.data,S=!0):t="function"==typeof c.placeholderData?c.placeholderData(null==(d=z(this,u))?void 0:d.state.data,z(this,u)):c.placeholderData,void 0!==t&&(M="success",O=at(null==b?void 0:b.data,t,c),R=!0)}if(c.select&&void 0!==O&&!S)if(b&&O===(null==v?void 0:v.data)&&c.select===z(this,h))O=z(this,l);else try{J(this,h,c.select),O=c.select(O),O=at(null==b?void 0:b.data,O,c),J(this,l,O),J(this,o,null)}catch(Q){J(this,o,Q)}z(this,o)&&(C=z(this,o),O=z(this,l),k=Date.now(),M="error");const E="fetching"===w.fetchStatus,x="pending"===M,W="error"===M,U=x&&E,P=void 0!==O,I={status:M,fetchStatus:w.fetchStatus,isPending:x,isSuccess:"success"===M,isError:W,isInitialLoading:U,isLoading:U,data:O,dataUpdatedAt:w.dataUpdatedAt,error:C,errorUpdatedAt:k,failureCount:w.fetchFailureCount,failureReason:w.fetchFailureReason,errorUpdateCount:w.errorUpdateCount,isFetched:w.dataUpdateCount>0||w.errorUpdateCount>0,isFetchedAfterMount:w.dataUpdateCount>m.dataUpdateCount||w.errorUpdateCount>m.errorUpdateCount,isFetching:E,isRefetching:E&&!x,isLoadingError:W&&!P,isPaused:"paused"===w.fetchStatus,isPlaceholderData:R,isRefetchError:W&&P,isStale:yt(t,c),refetch:this.refetch,promise:z(this,a),isEnabled:!1!==X(c.enabled,t)};if(this.options.experimental_prefetchInRender){const e=t=>{"error"===I.status?t.reject(I.error):void 0!==I.data&&t.resolve(I.data)},s=()=>{const t=J(this,a,I.promise=Y());e(t)},i=z(this,a);switch(i.status){case"pending":t.queryHash===p.queryHash&&e(i);break;case"fulfilled":"error"!==I.status&&I.data===i.value||s();break;case"rejected":"error"===I.status&&I.error===i.reason||s()}}return I}updateResult(){const t=z(this,i),s=this.createResult(z(this,e),this.options);if(J(this,r,z(this,e).state),J(this,n,this.options),void 0!==z(this,r).data&&J(this,u,z(this,e)),Z(s,t))return;J(this,i,s);N(this,b,k).call(this,{listeners:(()=>{if(!t)return!0;const{notifyOnChangeProps:e}=this.options,s="function"==typeof e?e():e;if("all"===s||!s&&!z(this,f).size)return!0;const r=new Set(null!=s?s:z(this,f));return this.options.throwOnError&&r.add("error"),Object.keys(z(this,i)).some(e=>{const s=e;return z(this,i)[s]!==t[s]&&r.has(s)})})()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&N(this,b,O).call(this)}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakMap,n=new WeakMap,a=new WeakMap,o=new WeakMap,h=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,b=new WeakSet,v=function(t){N(this,b,C).call(this);let s=z(this,e).fetch(this.options,t);return(null==t?void 0:t.throwOnError)||(s=s.catch(tt)),s},y=function(){N(this,b,w).call(this);const t=$(this.options.staleTime,z(this,e));if(et||z(this,i).isStale||!st(t))return;const s=it(z(this,i).dataUpdatedAt,t);J(this,c,setTimeout(()=>{z(this,i).isStale||this.updateResult()},s+1))},m=function(){var t;return null!=(t="function"==typeof this.options.refetchInterval?this.options.refetchInterval(z(this,e)):this.options.refetchInterval)&&t},g=function(t){N(this,b,R).call(this),J(this,p,t),!et&&!1!==X(this.options.enabled,z(this,e))&&st(z(this,p))&&0!==z(this,p)&&J(this,d,setInterval(()=>{(this.options.refetchIntervalInBackground||rt.isFocused())&&N(this,b,v).call(this)},z(this,p)))},O=function(){N(this,b,y).call(this),N(this,b,g).call(this,N(this,b,m).call(this))},w=function(){z(this,c)&&(clearTimeout(z(this,c)),J(this,c,void 0))},R=function(){z(this,d)&&(clearInterval(z(this,d)),J(this,d,void 0))},C=function(){const i=z(this,t).getQueryCache().build(z(this,t),this.options);if(i===z(this,e))return;const r=z(this,e);J(this,e,i),J(this,s,i.state),this.hasListeners()&&(null==r||r.removeObserver(this),i.addObserver(this))},k=function(s){ot.batch(()=>{s.listeners&&this.listeners.forEach(t=>{t(z(this,i))}),z(this,t).getQueryCache().notify({query:z(this,e),type:"observerResultsUpdated"})})},M);function ft(t,e){return function(t,e){return!1!==X(e.enabled,t)&&void 0===t.state.data&&!("error"===t.state.status&&!1===e.retryOnMount)}(t,e)||void 0!==t.state.data&&bt(t,e,e.refetchOnMount)}function bt(t,e,s){if(!1!==X(e.enabled,t)&&"static"!==$(e.staleTime,t)){const i="function"==typeof s?s(t):s;return"always"===i||!1!==i&&yt(t,e)}return!1}function vt(t,e,s,i){return(t!==e||!1===X(i.enabled,t))&&(!s.suspense||"error"!==t.state.status)&&yt(t,s)}function yt(t,e){return!1!==X(e.enabled,t)&&t.isStaleByTime($(e.staleTime,t))}var mt=(Q=class extends V{constructor(t,e){super(),G(this,U),G(this,S),G(this,E),G(this,x),G(this,W),J(this,S,t),this.setOptions(e),this.bindMethods(),N(this,U,P).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var e;const s=this.options;this.options=z(this,S).defaultMutationOptions(t),Z(this.options,s)||z(this,S).getMutationCache().notify({type:"observerOptionsUpdated",mutation:z(this,x),observer:this}),(null==s?void 0:s.mutationKey)&&this.options.mutationKey&&ht(s.mutationKey)!==ht(this.options.mutationKey)?this.reset():"pending"===(null==(e=z(this,x))?void 0:e.state.status)&&z(this,x).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||null==(t=z(this,x))||t.removeObserver(this)}onMutationUpdate(t){N(this,U,P).call(this),N(this,U,I).call(this,t)}getCurrentResult(){return z(this,E)}reset(){var t;null==(t=z(this,x))||t.removeObserver(this),J(this,x,void 0),N(this,U,P).call(this),N(this,U,I).call(this)}mutate(t,e){var s;return J(this,W,e),null==(s=z(this,x))||s.removeObserver(this),J(this,x,z(this,S).getMutationCache().build(z(this,S),this.options)),z(this,x).addObserver(this),z(this,x).execute(t)}},S=new WeakMap,E=new WeakMap,x=new WeakMap,W=new WeakMap,U=new WeakSet,P=function(){var t,e;const s=null!=(e=null==(t=z(this,x))?void 0:t.state)?e:lt();J(this,E,K(H({},s),{isPending:"pending"===s.status,isSuccess:"success"===s.status,isError:"error"===s.status,isIdle:"idle"===s.status,mutate:this.mutate,reset:this.reset}))},I=function(t){ot.batch(()=>{var e,s,i,r,n,a,o,h;if(z(this,W)&&this.hasListeners()){const l=z(this,E).variables,u=z(this,E).context;"success"===(null==t?void 0:t.type)?(null==(s=(e=z(this,W)).onSuccess)||s.call(e,t.data,l,u),null==(r=(i=z(this,W)).onSettled)||r.call(i,t.data,null,l,u)):"error"===(null==t?void 0:t.type)&&(null==(a=(n=z(this,W)).onError)||a.call(n,t.error,l,u),null==(h=(o=z(this,W)).onSettled)||h.call(o,void 0,t.error,l,u))}this.listeners.forEach(t=>{t(z(this,E))})})},Q),gt=ut.createContext(!1);gt.Provider;var Ot=ut.createContext(function(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}()),wt=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function Rt(t,e,s){var i,r,n,a,o;const h=(()=>ut.useContext(gt))(),l=(()=>ut.useContext(Ot))(),u=dt(),c=u.defaultQueryOptions(t);null==(r=null==(i=u.getDefaultOptions().queries)?void 0:i._experimental_beforeQuery)||r.call(i,c),c._optimisticResults=h?"isRestoring":"optimistic",(t=>{if(t.suspense){const e=t=>"static"===t?t:Math.max(null!=t?t:1e3,1e3),s=t.staleTime;t.staleTime="function"==typeof s?(...t)=>e(s(...t)):e(s),"number"==typeof t.gcTime&&(t.gcTime=Math.max(t.gcTime,1e3))}})(c),((t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))})(c,l),(t=>{ut.useEffect(()=>{t.clearReset()},[t])})(l);const d=!u.getQueryCache().get(c.queryHash),[p]=ut.useState(()=>new e(u,c)),f=p.getOptimisticResult(c),b=!h&&!1!==t.subscribed;if(ut.useSyncExternalStore(ut.useCallback(t=>{const e=b?p.subscribe(ot.batchCalls(t)):tt;return p.updateResult(),e},[p,b]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),ut.useEffect(()=>{p.setOptions(c)},[c,p]),((t,e)=>(null==t?void 0:t.suspense)&&e.isPending)(c,f))throw wt(c,p,l);if((({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:r})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(r&&void 0===t.data||ct(s,[t.error,i])))({result:f,errorResetBoundary:l,throwOnError:c.throwOnError,query:u.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw f.error;if(null==(a=null==(n=u.getDefaultOptions().queries)?void 0:n._experimental_afterQuery)||a.call(n,c,f),c.experimental_prefetchInRender&&!et&&((t,e)=>t.isLoading&&t.isFetching&&!e)(f,h)){const t=d?wt(c,p,l):null==(o=u.getQueryCache().get(c.queryHash))?void 0:o.promise;null==t||t.catch(tt).finally(()=>{p.updateResult()})}return c.notifyOnChangeProps?f:p.trackResult(f)}function Ct(t,e){return Rt(t,pt)}function kt(t,e){const s=dt(),[i]=ut.useState(()=>new mt(s,t));ut.useEffect(()=>{i.setOptions(t)},[i,t]);const r=ut.useSyncExternalStore(ut.useCallback(t=>i.subscribe(ot.batchCalls(t)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),n=ut.useCallback((t,e)=>{i.mutate(t,e).catch(tt)},[i]);if(r.error&&ct(i.options.throwOnError,[r.error]))throw r.error;return K(H({},r),{mutate:n,mutateAsync:r.mutate})}export{kt as a,Ct as u};
