var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,c=(e,s)=>{for(var a in s||(s={}))i.call(s,a)&&n(e,a,s[a]);if(t)for(var a of t(s))r.call(s,a)&&n(e,a,s[a]);return e},l=(e,t)=>s(e,a(t)),o=(e,s,a)=>new Promise((t,i)=>{var r=e=>{try{c(a.next(e))}catch(s){i(s)}},n=e=>{try{c(a.throw(e))}catch(s){i(s)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,n);c((a=a.apply(e,s)).next())});import{r as d,u as m,d as u,s as x,R as React,j as h,B as j}from"./index-B5IYdG7F.js";import{C as p,a as f,b as v,c as y,d as g}from"./card-Bm1jiGt-.js";import{I as N}from"./input-C4_QhDnm.js";import{L as b}from"./label-BIAuZBUP.js";import{S as w}from"./switch-1GU9K-FH.js";import{T as C,a as P,b as S,c as k}from"./tabs-DPPBWbFC.js";import{S as E}from"./separator-BZYZTYLW.js";import{R as _}from"./ResponsiveLayout-BzUw0buI.js";import{S as L}from"./slider-DR9e0kQZ.js";import{B as A}from"./badge-Dh5Uj8vN.js";import{u as D}from"./useLocationManager-Bec3bdrd.js";import{S as F}from"./settings-DSEWn2wM.js";import{L as O}from"./loader-2-DMKXv0ZB.js";import{S as T}from"./save-BfDrAOGF.js";import{A as R,a as I,b as Y,c as B,d as M,e as U,f as G,g as z,h as J}from"./alert-dialog-BO6JSvcQ.js";import{U as q}from"./user-UOowhO7W.js";import{S as V}from"./shield-CcnVg-IR.js";import{B as $}from"./bell-qeMkXRtc.js";import{L as H}from"./lock-VT3miBjZ.js";import{L as Z}from"./log-out-DchhrZ8K.js";import{T as K}from"./index-DWtoKlrM.js";import{A as W}from"./alert-triangle-C5DO0cvR.js";import"./index-_KG4atBu.js";import"./index-9msbY5CZ.js";import"./sheet-CgDUfSpi.js";import"./index-DD_J5sPn.js";import"./Combination-BxRIZ8rt.js";import"./NotificationBell-DtnEojo4.js";import"./scroll-area-Beiyt5Kx.js";import"./index-jVOyRz7F.js";import"./useNotifications-C0wifgqF.js";import"./check-C9wwFfOs.js";import"./NotificationButton-CqXjP_LK.js";import"./search-Co_OHmlK.js";import"./map-pin-BwnggLrZ.js";import"./users-Dh-Bdb-k.js";import"./zap-DPSXpNso.js";import"./message-square-j4RxGxzk.js";import"./alert-CQybxmNr.js";import"./locationService-BBE-Ay-I.js";const Q=[{id:"events",label:"Events & Activities",description:"Local events, concerts, workshops"},{id:"news",label:"Local News",description:"Community news and updates"},{id:"artists",label:"Artists & Services",description:"Local artists and service providers"},{id:"reviews",label:"Reviews & Recommendations",description:"Local business reviews"},{id:"discussions",label:"Community Discussions",description:"Local community posts and polls"},{id:"businesses",label:"Local Businesses",description:"Restaurants, shops, and services"}];function X({className:e=""}){const{settings:s,updateSettings:a,loading:t,error:i}=D(),[r,n]=d.useState(s),[m,u]=d.useState(!1);React.useEffect(()=>{n(s)},[s]);const x=JSON.stringify(r)!==JSON.stringify(s);return h.jsxs(p,{className:e,children:[h.jsxs(f,{children:[h.jsxs(v,{className:"flex items-center gap-2",children:[h.jsx(F,{className:"h-5 w-5"}),"Location Preferences"]}),h.jsx(y,{children:"Customize your location-based experience and content preferences"})]}),h.jsxs(g,{className:"space-y-6",children:[h.jsx("div",{className:"space-y-4",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(b,{className:"text-base font-medium",children:"Location Services"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Enable location-based content personalization"})]}),h.jsx(w,{checked:r.enabled,onCheckedChange:e=>n(s=>l(c({},s),{enabled:e})),disabled:t})]})}),r.enabled&&h.jsxs(h.Fragment,{children:[h.jsx(E,{}),h.jsx("div",{className:"space-y-4",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(b,{className:"text-base font-medium",children:"Auto-Detect Location"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically update your location when you move"})]}),h.jsx(w,{checked:r.auto_detect,onCheckedChange:e=>n(s=>l(c({},s),{auto_detect:e})),disabled:t})]})}),h.jsx(E,{}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(b,{className:"text-base font-medium",children:"Search Radius"}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Show content within ",r.radius_km,"km of your location"]})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsx(L,{value:[r.radius_km],onValueChange:e=>{n(s=>l(c({},s),{radius_km:e[0]}))},max:100,min:5,step:5,className:"w-full"}),h.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[h.jsx("span",{children:"5km"}),h.jsx("span",{children:"50km"}),h.jsx("span",{children:"100km"})]})]})]}),h.jsx(E,{}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(b,{className:"text-base font-medium",children:"Content Categories"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose which types of content to show based on your location"})]}),h.jsx("div",{className:"grid gap-3",children:Q.map(e=>h.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[h.jsx("div",{className:"flex items-center gap-3",children:h.jsxs("div",{className:"flex-1",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(b,{className:"font-medium cursor-pointer",children:e.label}),r.categories.includes(e.id)&&h.jsx(A,{variant:"secondary",className:"text-xs",children:"Active"})]}),h.jsx("p",{className:"text-sm text-muted-foreground",children:e.description})]})}),h.jsx(w,{checked:r.categories.includes(e.id),onCheckedChange:()=>(e=>{n(s=>l(c({},s),{categories:s.categories.includes(e)?s.categories.filter(s=>s!==e):[...s.categories,e]}))})(e.id),disabled:t})]},e.id))})]}),h.jsx(E,{}),h.jsx("div",{className:"space-y-4",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(b,{className:"text-base font-medium",children:"Location Notifications"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about new content in your area"})]}),h.jsx(w,{checked:r.notifications,onCheckedChange:e=>n(s=>l(c({},s),{notifications:e})),disabled:t})]})})]}),i&&h.jsx("div",{className:"p-3 border border-destructive/20 bg-destructive/5 rounded-lg",children:h.jsx("p",{className:"text-sm text-destructive",children:i})}),x&&h.jsx("div",{className:"flex justify-end",children:h.jsx(j,{onClick:()=>o(this,null,function*(){u(!0);try{yield a(r)}catch(e){}finally{u(!1)}}),disabled:m||t,className:"flex items-center gap-2",children:m?h.jsxs(h.Fragment,{children:[h.jsx(O,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):h.jsxs(h.Fragment,{children:[h.jsx(T,{className:"h-4 w-4"}),"Save Changes"]})})}),h.jsxs("div",{className:"text-xs text-muted-foreground bg-gray-50 p-3 rounded-lg",children:[h.jsx("p",{className:"font-medium mb-1",children:"Privacy & Data Usage"}),h.jsxs("ul",{className:"space-y-1",children:[h.jsx("li",{children:"• Your location is only used to personalize content"}),h.jsx("li",{children:"• Location data is stored securely and not shared with third parties"}),h.jsx("li",{children:"• You can disable location services at any time"}),h.jsx("li",{children:"• Location data is automatically updated when you move (if auto-detect is enabled)"})]})]})]})]})}const ee=()=>{const{user:e,signOut:s}=m(),{toast:a}=u(),{deleteAccount:t,testEdgeFunction:i,isDeleting:r}=(()=>{const[e,s]=d.useState(!1),{signOut:a}=m(),{toast:t}=u();return{deleteAccount:()=>o(void 0,null,function*(){try{s(!0);const{data:e,error:i}=yield x.functions.invoke("delete-user-account",{method:"POST",headers:{"Content-Type":"application/json"}});if(i)throw i;return t({title:"Account Deleted",description:"Your account has been permanently deleted."}),yield a(),{success:!0}}catch(e){let s="Failed to delete account. Please try again.",a="";return e.message?(s=e.message,a=e.message):e.error&&(s=e.error,a=e.error),e.details&&(a+=` | Details: ${JSON.stringify(e.details)}`),t({title:"Error",description:s,variant:"destructive"}),{success:!1,error:s}}finally{s(!1)}}),testEdgeFunction:()=>o(void 0,null,function*(){try{const{data:e,error:s}=yield x.functions.invoke("delete-user-account",{method:"GET"});t(s?{title:"Function Test Failed",description:`Error: ${s.message}`,variant:"destructive"}:{title:"Function Test Successful",description:"Edge function is accessible"})}catch(e){t({title:"Test Error",description:e.message,variant:"destructive"})}}),isDeleting:e}})(),[n,L]=d.useState(!0),[A,D]=d.useState(!1),[O,T]=d.useState(""),[Q,ee]=d.useState({real_time_location_enabled:!1,email_notifications:!0,push_notifications:!0,privacy_profile:!1,dark_mode:!1}),[se,ae]=d.useState({email:(null==e?void 0:e.email)||"",currentPassword:"",newPassword:"",confirmPassword:""});d.useEffect(()=>{e&&te()},[e]);const te=()=>o(void 0,null,function*(){try{const{data:s,error:a}=yield x.from("profiles").select("real_time_location_enabled").eq("user_id",null==e?void 0:e.id).maybeSingle();if(a&&"PGRST116"!==a.code)throw a;s&&ee(e=>l(c({},e),{real_time_location_enabled:s.real_time_location_enabled||!1}))}catch(s){a({title:"Error",description:"Failed to load settings.",variant:"destructive"})}finally{L(!1)}});return n?h.jsx(_,{children:h.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:h.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):h.jsx(_,{children:h.jsxs("div",{className:"space-y-8",children:[h.jsxs("div",{className:"flex flex-col gap-4",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(F,{className:"h-6 w-6 text-primary"}),h.jsx("h1",{className:"text-3xl font-bold",children:"Settings"})]}),h.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings and preferences."})]}),h.jsxs(C,{defaultValue:"account",className:"space-y-6",children:[h.jsxs(P,{className:"grid w-full grid-cols-5",children:[h.jsx(S,{value:"account",children:"Account"}),h.jsx(S,{value:"location",children:"Location"}),h.jsx(S,{value:"privacy",children:"Privacy"}),h.jsx(S,{value:"notifications",children:"Notifications"}),h.jsx(S,{value:"security",children:"Security"})]}),h.jsx(k,{value:"account",className:"space-y-6",children:h.jsxs(p,{children:[h.jsxs(f,{children:[h.jsxs(v,{className:"flex items-center gap-2",children:[h.jsx(q,{className:"h-5 w-5"}),"Account Information"]}),h.jsx(y,{children:"Update your account details and email address."})]}),h.jsxs(g,{className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(b,{htmlFor:"email",children:"Email Address"}),h.jsx(N,{id:"email",type:"email",value:se.email,onChange:e=>ae(s=>l(c({},s),{email:e.target.value})),disabled:!0}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Contact support to change your email address."})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(b,{htmlFor:"userId",children:"User ID"}),h.jsx(N,{id:"userId",value:(null==e?void 0:e.id)||"",disabled:!0}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Your unique user identifier."})]})]})]})}),h.jsx(k,{value:"location",className:"space-y-6",children:h.jsx(X,{})}),h.jsx(k,{value:"privacy",className:"space-y-6",children:h.jsxs(p,{children:[h.jsxs(f,{children:[h.jsxs(v,{className:"flex items-center gap-2",children:[h.jsx(V,{className:"h-5 w-5"}),"Privacy Controls"]}),h.jsx(y,{children:"Manage your privacy and data sharing preferences."})]}),h.jsxs(g,{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(b,{children:"Private Profile"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Make your profile visible only to approved followers."})]}),h.jsx(w,{checked:Q.privacy_profile,onCheckedChange:e=>ee(s=>l(c({},s),{privacy_profile:e}))})]}),h.jsx(E,{}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(b,{children:"Analytics"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Help improve the app by sharing anonymous usage data."})]}),h.jsx(w,{defaultChecked:!0})]})]})]})}),h.jsx(k,{value:"notifications",className:"space-y-6",children:h.jsxs(p,{children:[h.jsxs(f,{children:[h.jsxs(v,{className:"flex items-center gap-2",children:[h.jsx($,{className:"h-5 w-5"}),"Notification Preferences"]}),h.jsx(y,{children:"Choose what notifications you want to receive."})]}),h.jsxs(g,{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(b,{children:"Email Notifications"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive updates and announcements via email."})]}),h.jsx(w,{checked:Q.email_notifications,onCheckedChange:e=>ee(s=>l(c({},s),{email_notifications:e}))})]}),h.jsx(E,{}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(b,{children:"Push Notifications"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about new messages and activity."})]}),h.jsx(w,{checked:Q.push_notifications,onCheckedChange:e=>ee(s=>l(c({},s),{push_notifications:e}))})]}),h.jsx(E,{}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(b,{children:"Event Reminders"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Get reminded about upcoming events you're interested in."})]}),h.jsx(w,{defaultChecked:!0})]})]})]})}),h.jsxs(k,{value:"security",className:"space-y-6",children:[h.jsxs(p,{children:[h.jsxs(f,{children:[h.jsxs(v,{className:"flex items-center gap-2",children:[h.jsx(H,{className:"h-5 w-5"}),"Security Settings"]}),h.jsx(y,{children:"Manage your account security and authentication."})]}),h.jsxs(g,{className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(b,{htmlFor:"currentPassword",children:"Current Password"}),h.jsx(N,{id:"currentPassword",type:"password",value:se.currentPassword,onChange:e=>ae(s=>l(c({},s),{currentPassword:e.target.value})),placeholder:"Enter current password"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(b,{htmlFor:"newPassword",children:"New Password"}),h.jsx(N,{id:"newPassword",type:"password",value:se.newPassword,onChange:e=>ae(s=>l(c({},s),{newPassword:e.target.value})),placeholder:"Enter new password"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(b,{htmlFor:"confirmPassword",children:"Confirm New Password"}),h.jsx(N,{id:"confirmPassword",type:"password",value:se.confirmPassword,onChange:e=>ae(s=>l(c({},s),{confirmPassword:e.target.value})),placeholder:"Confirm new password"})]}),h.jsx(j,{className:"w-full",disabled:!0,children:"Update Password"}),h.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Password changes are currently disabled. Contact support for assistance."})]})]}),h.jsxs(p,{children:[h.jsxs(f,{children:[h.jsx(v,{className:"text-destructive",children:"Danger Zone"}),h.jsx(y,{children:"Irreversible and destructive actions."})]}),h.jsxs(g,{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between p-4 border border-destructive/20 rounded-lg",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(b,{children:"Sign Out"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Sign out of your account on this device."})]}),h.jsxs(j,{variant:"outline",onClick:()=>o(void 0,null,function*(){try{yield s(),a({title:"Signed Out",description:"You have been signed out successfully."})}catch(e){a({title:"Error",description:"Failed to sign out.",variant:"destructive"})}}),children:[h.jsx(Z,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]}),h.jsxs("div",{className:"flex items-center justify-between p-4 border border-destructive/20 rounded-lg",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(b,{className:"text-destructive",children:"Delete Account"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Permanently delete your account and all associated data."})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(j,{variant:"outline",onClick:i,className:"text-xs",children:"Test Function"}),h.jsxs(R,{children:[h.jsx(I,{asChild:!0,children:h.jsxs(j,{variant:"destructive",children:[h.jsx(K,{className:"h-4 w-4 mr-2"}),"Delete Account"]})}),h.jsxs(Y,{children:[h.jsxs(B,{children:[h.jsxs(M,{className:"flex items-center gap-2",children:[h.jsx(W,{className:"h-5 w-5 text-destructive"}),"Delete Account"]}),h.jsx(U,{children:"This action cannot be undone. This will permanently delete your account and remove all your data from our servers including:"})]}),h.jsx("div",{className:"space-y-2 text-sm text-muted-foreground",children:h.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[h.jsx("li",{children:"Your profile and personal information"}),h.jsx("li",{children:"All your posts and comments"}),h.jsx("li",{children:"Chat conversations and messages"}),h.jsx("li",{children:"Event bookings and artist profiles"}),h.jsx("li",{children:"Follow relationships and notifications"}),h.jsx("li",{children:"All other account data"})]})}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(b,{htmlFor:"deleteConfirmation",className:"text-sm font-medium",children:'Type "DELETE" to confirm'}),h.jsx(N,{id:"deleteConfirmation",value:O,onChange:e=>T(e.target.value),placeholder:"DELETE",className:"border-destructive/50 focus:border-destructive"})]}),h.jsxs(G,{children:[h.jsx(z,{onClick:()=>T(""),children:"Cancel"}),h.jsx(J,{onClick:()=>o(void 0,null,function*(){if("DELETE"!==O)return void a({title:"Invalid Confirmation",description:"Please type 'DELETE' to confirm account deletion.",variant:"destructive"});(yield t()).success&&T("")}),disabled:"DELETE"!==O||r,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:r?"Deleting...":"Delete Account"})]})]})]})]})]})]})]})]})]})]})})};export{ee as default};
