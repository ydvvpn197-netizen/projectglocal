var e=Object.defineProperty,s=Object.defineProperties,i=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(s,i,t)=>i in s?e(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t,n=(e,s)=>{for(var i in s||(s={}))r.call(s,i)&&l(e,i,s[i]);if(t)for(var i of t(s))a.call(s,i)&&l(e,i,s[i]);return e},c=(e,t)=>s(e,i(t)),o=(e,s,i)=>new Promise((t,r)=>{var a=e=>{try{n(i.next(e))}catch(s){r(s)}},l=e=>{try{n(i.throw(e))}catch(s){r(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(a,l);n((i=i.apply(e,s)).next())});import{r as d,u as m,d as h,s as u,b as p,j,Y as x,C as v,v as g,w as y,x as f,y as N,B as b,X as w}from"./main-u5iDOJMZ.js";import{I as S}from"./input-d0wpgTJ2.js";import{L as F}from"./label-BmJUPftL.js";import{T as _}from"./textarea-44C4KWaW.js";import{S as E,a as P,b as C,c as D,d as k}from"./select-BloqB5ko.js";import{S as O}from"./switch-CjfEjYqx.js";import{B as T}from"./badge-k0SsuPwB.js";import{T as q,a as A,b as L,c as W}from"./tabs-Dn7YRzvT.js";import{R as z}from"./ResponsiveLayout-CaFEj6Sr.js";import{u as B}from"./useEvents-CF52CN6c.js";import{s as M,b as R}from"./sanitize-D4fpKnsd.js";import{M as I}from"./map-pin-CcmxiK6P.js";import{P as Y}from"./sheet-BES5Q-Ko.js";import{C as U}from"./index-B7-3ofi9.js";import{C as H}from"./clock-k4Wuy6bB.js";import{D as G}from"./dollar-sign-BB-VnfLW.js";import{U as K}from"./users-BKDXsamp.js";import{T as X}from"./tag-B3mtoHf6.js";import"./index-jVOyRz7F.js";import"./index-Dy-VqNBB.js";import"./Combination-D3NAapk3.js";import"./index-9dp5BQ5P.js";import"./chevron-up-MfWNy2Yr.js";import"./check-CT-bNmTi.js";import"./separator-BdZu64Yb.js";import"./NotificationBell-4ukuyDx4.js";import"./scroll-area-DANvZfFy.js";import"./useNotifications-DNCpc7NU.js";import"./bell-wBykza9e.js";import"./user-DlaYKRnl.js";import"./index-azXaBhbR.js";import"./NotificationButton-QcrDLMMB.js";import"./search-BsWmJlwB.js";import"./zap-BrBeKdrO.js";import"./message-square-DQ5316cR.js";import"./alert-7nHfBPfv.js";import"./wifi-DNTf1l7S.js";import"./log-out-CGc8M4_-.js";import"./useLocation-DoOmcXMP.js";import"./locationService-DDZ4T3aM.js";import"./pointsService-1m7Vk6wG.js";const Q=()=>{const[e,s]=d.useState([]),[i,t]=d.useState(""),[r,a]=d.useState(!1),[l,Q]=d.useState(!1),{createPost:V}=(()=>{const[e,s]=d.useState([]),[i,t]=d.useState(!0),{user:r}=m(),{toast:a}=h(),l=d.useCallback(()=>o(void 0,null,function*(){if(r)try{const{data:e,error:i}=yield u.from("posts").select("\n          *,\n          profiles:user_id (\n            display_name,\n            username,\n            avatar_url\n          )\n        ").order("created_at",{ascending:!1});if(i)throw i;const t=(null==e?void 0:e.map(e=>c(n({},e),{contact_info:e.user_id===(null==r?void 0:r.id)?e.contact_info:null})))||[];s(t)}catch(e){const s=e instanceof Error?e.message:"Failed to load posts";a({title:"Error loading posts",description:s,variant:"destructive"})}finally{t(!1)}else t(!1)}),[r,a]);return d.useEffect(()=>{r&&l()},[r,l]),{posts:e,loading:i,createPost:e=>o(void 0,null,function*(){if(!r)return{error:new Error("Not authenticated")};try{const{data:s,error:i}=yield u.from("posts").insert(c(n({},e),{user_id:r.id,type:e.type})).select().single();if(i)throw i;return a({title:"Post created",description:"Your post has been shared with the community."}),l(),{data:s,error:null}}catch(s){const e=s instanceof Error?s.message:"Failed to create post";return a({title:"Error creating post",description:e,variant:"destructive"}),{error:s}}}),toggleLike:e=>o(void 0,null,function*(){if(r)try{const{data:s}=yield u.from("likes").select("id").eq("post_id",e).eq("user_id",r.id).maybeSingle();s?yield u.from("likes").delete().eq("post_id",e).eq("user_id",r.id):yield u.from("likes").insert({post_id:e,user_id:r.id}),l()}catch(s){const e=s instanceof Error?s.message:"Failed to update like";a({title:"Error updating like",description:e,variant:"destructive"})}}),deletePost:e=>o(void 0,null,function*(){if(!r)return{error:new Error("Not authenticated")};try{const{error:s}=yield u.from("posts").delete().eq("id",e).eq("user_id",r.id);if(s)throw s;return a({title:"Post deleted",description:"Your post has been deleted successfully."}),l(),{error:null}}catch(s){const e=s instanceof Error?s.message:"Failed to delete post";return a({title:"Error deleting post",description:e,variant:"destructive"}),{error:s}}}),refetch:l}})(),{createEvent:J}=B(),Z=p(),$=()=>{const r=M(i,50);r&&!e.includes(r)&&(s([...e,r]),t(""))},ee=(s,i)=>o(void 0,null,function*(){s.preventDefault();const t=s.target,r=new FormData(t);Q(!0);try{if("event"===i){const e={title:M(r.get("title")||"",200),description:M(r.get("content")||"",5e3),event_date:r.get("event_date"),event_time:r.get("event_time"),location_name:M(r.get("location_name")||"",500),category:r.get("category")||void 0,max_attendees:r.get("max_attendees")?parseInt(r.get("max_attendees")):void 0,price:r.get("price")?parseFloat(r.get("price")):0,image_url:r.get("image_url")||void 0,tags:r.get("tags")?r.get("tags").split(",").map(e=>e.trim()):void 0};(yield J(e))&&Z("/events")}else{const s={type:i,title:M(r.get("title")||"",200),content:M(r.get("content")||"",5e3),event_date:r.get("eventDate")?new Date(r.get("eventDate")).toISOString():void 0,event_location:M(r.get("eventLocation")||r.get("serviceArea")||"",500),price_range:M(r.get("eventPrice")||r.get("servicePrice")||"",100),tags:e.length>0?R(e):void 0},{error:t}=yield V(s);t||Z("/feed")}}finally{Q(!1)}});return j.jsx(x,{children:j.jsx(z,{children:j.jsxs("div",{className:"container max-w-3xl mx-auto p-6",children:[j.jsxs("div",{className:"mb-6",children:[j.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Create New Post"}),j.jsx("p",{className:"text-muted-foreground",children:"Share with your local community"})]}),j.jsxs(q,{defaultValue:"post",className:"space-y-6",children:[j.jsxs(A,{className:"grid w-full grid-cols-4",children:[j.jsx(L,{value:"post",children:"Post"}),j.jsx(L,{value:"event",children:"Event"}),j.jsx(L,{value:"service",children:"Service"}),j.jsx(L,{value:"discussion",children:"Discussion"})]}),j.jsx(W,{value:"post",children:j.jsxs(v,{children:[j.jsxs(g,{children:[j.jsx(y,{children:"Share Your Thoughts"}),j.jsx(f,{children:"Post updates, photos, or thoughts with your local community"})]}),j.jsx(N,{className:"space-y-6",children:j.jsxs("form",{onSubmit:e=>ee(e,"post"),className:"space-y-6",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"post-title",children:"Title"}),j.jsx(S,{id:"post-title",name:"title",placeholder:"What's on your mind?"})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"post-content",children:"Content"}),j.jsx(_,{id:"post-content",name:"content",placeholder:"Share your thoughts, experiences, or updates...",className:"min-h-32",required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"post-location",children:"Location (Optional)"}),j.jsxs("div",{className:"relative",children:[j.jsx(I,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),j.jsx(S,{id:"post-location",placeholder:"Add a location",className:"pl-10"})]})]}),j.jsxs("div",{className:"space-y-4",children:[j.jsx(F,{children:"Tags"}),j.jsxs("div",{className:"flex gap-2",children:[j.jsx(S,{value:i,onChange:e=>t(e.target.value),placeholder:"Add a tag",onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),$())}),j.jsx(b,{onClick:$,size:"icon",variant:"outline",children:j.jsx(Y,{className:"h-4 w-4"})})]}),j.jsx("div",{className:"flex flex-wrap gap-2",children:e.map(i=>j.jsxs(T,{variant:"secondary",className:"gap-1",children:[i,j.jsx("button",{onClick:()=>(i=>{s(e.filter(e=>e!==i))})(i),children:j.jsx(w,{className:"h-3 w-3"})})]},i))})]}),j.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[j.jsxs("div",{className:"space-y-1",children:[j.jsx(F,{children:"Privacy Setting"}),j.jsx("p",{className:"text-sm text-muted-foreground",children:r?"Only followers can see this post":"Public to local community"})]}),j.jsx(O,{checked:r,onCheckedChange:a})]}),j.jsx(b,{className:"w-full",size:"lg",type:"submit",disabled:l,children:l?"Creating...":"Share Post"})]})})]})}),j.jsx(W,{value:"event",children:j.jsxs(v,{children:[j.jsxs(g,{children:[j.jsx(y,{children:"Create Event"}),j.jsx(f,{children:"Organize local events and gatherings"})]}),j.jsx(N,{className:"space-y-6",children:j.jsxs("form",{onSubmit:e=>ee(e,"event"),className:"space-y-6",children:[j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"event-title",children:"Event Title *"}),j.jsx(S,{id:"event-title",name:"title",placeholder:"Enter event title",required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"event-category",children:"Category"}),j.jsxs(E,{name:"category",children:[j.jsx(P,{children:j.jsx(C,{placeholder:"Select category"})}),j.jsxs(D,{children:[j.jsx(k,{value:"Art & Culture",children:"Art & Culture"}),j.jsx(k,{value:"Music",children:"Music"}),j.jsx(k,{value:"Food & Drink",children:"Food & Drink"}),j.jsx(k,{value:"Sports & Fitness",children:"Sports & Fitness"}),j.jsx(k,{value:"Technology",children:"Technology"}),j.jsx(k,{value:"Business",children:"Business"}),j.jsx(k,{value:"Education",children:"Education"}),j.jsx(k,{value:"Health & Wellness",children:"Health & Wellness"}),j.jsx(k,{value:"Community",children:"Community"}),j.jsx(k,{value:"Entertainment",children:"Entertainment"}),j.jsx(k,{value:"Other",children:"Other"})]})]})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"event-description",children:"Description"}),j.jsx(_,{id:"event-description",name:"content",placeholder:"Describe your event...",className:"min-h-24",rows:3})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsxs(F,{htmlFor:"event-date",className:"flex items-center gap-2",children:[j.jsx(U,{className:"h-4 w-4"}),"Date *"]}),j.jsx(S,{id:"event-date",name:"event_date",type:"date",min:(new Date).toISOString().split("T")[0],required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsxs(F,{htmlFor:"event-time",className:"flex items-center gap-2",children:[j.jsx(H,{className:"h-4 w-4"}),"Time *"]}),j.jsx(S,{id:"event-time",name:"event_time",type:"time",required:!0})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsxs(F,{htmlFor:"event-location",className:"flex items-center gap-2",children:[j.jsx(I,{className:"h-4 w-4"}),"Location *"]}),j.jsx(S,{id:"event-location",name:"location_name",placeholder:"Event venue or address",required:!0})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsxs(F,{htmlFor:"event-price",className:"flex items-center gap-2",children:[j.jsx(G,{className:"h-4 w-4"}),"Price (USD)"]}),j.jsx(S,{id:"event-price",name:"price",placeholder:"0 for free events",type:"number",min:"0",step:"0.01"})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsxs(F,{htmlFor:"event-capacity",className:"flex items-center gap-2",children:[j.jsx(K,{className:"h-4 w-4"}),"Max Attendees"]}),j.jsx(S,{id:"event-capacity",name:"max_attendees",placeholder:"Optional",type:"number",min:"1"})]})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"event-image",children:"Image URL"}),j.jsx(S,{id:"event-image",name:"image_url",type:"url",placeholder:"Optional event image"})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsxs(F,{htmlFor:"event-tags",className:"flex items-center gap-2",children:[j.jsx(X,{className:"h-4 w-4"}),"Tags"]}),j.jsx(S,{id:"event-tags",name:"tags",placeholder:"photography, outdoor, beginner (comma separated)"})]})]}),j.jsx(b,{className:"w-full",size:"lg",type:"submit",disabled:l,children:l?"Creating...":"Create Event"})]})})]})}),j.jsx(W,{value:"service",children:j.jsxs(v,{children:[j.jsxs(g,{children:[j.jsx(y,{children:"Offer a Service"}),j.jsx(f,{children:"Share your skills and services with the local community"})]}),j.jsx(N,{className:"space-y-6",children:j.jsxs("form",{onSubmit:e=>ee(e,"service"),className:"space-y-6",children:[j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"service-title",children:"Service Title"}),j.jsx(S,{id:"service-title",name:"title",placeholder:"What service do you offer?",required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"service-category",children:"Category"}),j.jsxs(E,{children:[j.jsx(P,{children:j.jsx(C,{placeholder:"Select category"})}),j.jsxs(D,{children:[j.jsx(k,{value:"photography",children:"Photography"}),j.jsx(k,{value:"music",children:"Music & Performance"}),j.jsx(k,{value:"design",children:"Design & Art"}),j.jsx(k,{value:"fitness",children:"Fitness & Wellness"}),j.jsx(k,{value:"education",children:"Education & Tutoring"}),j.jsx(k,{value:"handyman",children:"Home & Repair"}),j.jsx(k,{value:"beauty",children:"Beauty & Style"}),j.jsx(k,{value:"tech",children:"Technology"})]})]})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"service-description",children:"Description"}),j.jsx(_,{id:"service-description",name:"content",placeholder:"Describe your service, experience, and what you offer...",className:"min-h-24",required:!0})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"service-price",children:"Price Range"}),j.jsxs("div",{className:"relative",children:[j.jsx(G,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),j.jsx(S,{id:"service-price",name:"servicePrice",placeholder:"50 - 150",className:"pl-10"})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"service-availability",children:"Availability"}),j.jsxs(E,{children:[j.jsx(P,{children:j.jsx(C,{placeholder:"Select availability"})}),j.jsxs(D,{children:[j.jsx(k,{value:"immediate",children:"Available Now"}),j.jsx(k,{value:"this-week",children:"This Week"}),j.jsx(k,{value:"this-month",children:"This Month"}),j.jsx(k,{value:"flexible",children:"Flexible"})]})]})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"service-area",children:"Service Area"}),j.jsxs("div",{className:"relative",children:[j.jsx(I,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),j.jsx(S,{id:"service-area",name:"serviceArea",placeholder:"Within 15km of current location",className:"pl-10"})]})]}),j.jsx(b,{className:"w-full",size:"lg",type:"submit",disabled:l,children:l?"Creating...":"List Service"})]})})]})}),j.jsx(W,{value:"discussion",children:j.jsxs(v,{children:[j.jsxs(g,{children:[j.jsx(y,{children:"Start a Discussion"}),j.jsx(f,{children:"Create a topic for community discussion and engagement"})]}),j.jsx(N,{className:"space-y-6",children:j.jsxs("form",{onSubmit:e=>ee(e,"discussion"),className:"space-y-6",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"discussion-title",children:"Discussion Topic"}),j.jsx(S,{id:"discussion-title",name:"title",placeholder:"What would you like to discuss?",required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"discussion-category",children:"Category"}),j.jsxs(E,{children:[j.jsx(P,{children:j.jsx(C,{placeholder:"Select category"})}),j.jsxs(D,{children:[j.jsx(k,{value:"general",children:"General Discussion"}),j.jsx(k,{value:"local-news",children:"Local News"}),j.jsx(k,{value:"recommendations",children:"Recommendations"}),j.jsx(k,{value:"events",children:"Community Events"}),j.jsx(k,{value:"safety",children:"Safety & Security"}),j.jsx(k,{value:"environment",children:"Environment"}),j.jsx(k,{value:"business",children:"Local Business"})]})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"discussion-content",children:"Discussion Starter"}),j.jsx(_,{id:"discussion-content",name:"content",placeholder:"Share your thoughts, ask questions, or provide context for the discussion...",className:"min-h-32",required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(F,{htmlFor:"discussion-rules",children:"Discussion Guidelines (Optional)"}),j.jsx(_,{id:"discussion-rules",placeholder:"Set any specific guidelines or rules for this discussion...",className:"min-h-20"})]}),j.jsx(b,{className:"w-full",size:"lg",type:"submit",disabled:l,children:l?"Creating...":"Start Discussion"})]})})]})})]})]})})})};export{Q as default};
