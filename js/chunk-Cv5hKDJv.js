var P=Object.defineProperty,N=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable;var b=(e,r,n)=>r in e?P(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,p=(e,r)=>{for(var n in r||(r={}))O.call(r,n)&&b(e,n,r[n]);if(S)for(var n of S(r))d.call(r,n)&&b(e,n,r[n]);return e},x=(e,r)=>N(e,q(r));import{r as a,j as B}from"./chunk-V8Tq47hD.js";import{s as M,n as _,a as C,i as k,Q as H,M as U}from"./chunk-aOfXXddH.js";var Q=a.createContext(void 0),w=e=>{const r=a.useContext(Q);if(!r)throw new Error("No QueryClient set, use QueryClientProvider to set one");return r},$=({client:e,children:r})=>(a.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),B.jsx(Q.Provider,{value:e,children:r})),I=a.createContext(!1),j=()=>a.useContext(I);I.Provider;function F(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var D=a.createContext(F()),A=()=>a.useContext(D),L=(e,r)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(r.isReset()||(e.retryOnMount=!1))},V=e=>{a.useEffect(()=>{e.clearReset()},[e])},z=({result:e,errorResetBoundary:r,throwOnError:n,query:u,suspense:s})=>e.isError&&!r.isReset()&&!e.isFetching&&u&&(s&&e.data===void 0||M(n,[e.error,u])),G=e=>{if(e.suspense){const n=s=>s==="static"?s:Math.max(s!=null?s:1e3,1e3),u=e.staleTime;e.staleTime=typeof u=="function"?(...s)=>n(u(...s)):n(u),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},J=(e,r)=>e.isLoading&&e.isFetching&&!r,K=(e,r)=>(e==null?void 0:e.suspense)&&r.isPending,v=(e,r,n)=>r.fetchOptimistic(e).catch(()=>{n.clearReset()});function W(e,r,n){var y,m,f,g,R;const u=j(),s=A(),i=w(),t=i.defaultQueryOptions(e);(m=(y=i.getDefaultOptions().queries)==null?void 0:y._experimental_beforeQuery)==null||m.call(y,t),t._optimisticResults=u?"isRestoring":"optimistic",G(t),L(t,s),V(s);const h=!i.getQueryCache().get(t.queryHash),[o]=a.useState(()=>new r(i,t)),c=o.getOptimisticResult(t),E=!u&&e.subscribed!==!1;if(a.useSyncExternalStore(a.useCallback(l=>{const T=E?o.subscribe(_.batchCalls(l)):C;return o.updateResult(),T},[o,E]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),a.useEffect(()=>{o.setOptions(t)},[t,o]),K(t,c))throw v(t,o,s);if(z({result:c,errorResetBoundary:s,throwOnError:t.throwOnError,query:i.getQueryCache().get(t.queryHash),suspense:t.suspense}))throw c.error;if((g=(f=i.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||g.call(f,t,c),t.experimental_prefetchInRender&&!k&&J(c,u)){const l=h?v(t,o,s):(R=i.getQueryCache().get(t.queryHash))==null?void 0:R.promise;l==null||l.catch(C).finally(()=>{o.updateResult()})}return t.notifyOnChangeProps?c:o.trackResult(c)}function ee(e,r){return W(e,H)}function re(e,r){const n=w(),[u]=a.useState(()=>new U(n,e));a.useEffect(()=>{u.setOptions(e)},[u,e]);const s=a.useSyncExternalStore(a.useCallback(t=>u.subscribe(_.batchCalls(t)),[u]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),i=a.useCallback((t,h)=>{u.mutate(t,h).catch(C)},[u]);if(s.error&&M(u.options.throwOnError,[s.error]))throw s.error;return x(p({},s),{mutate:i,mutateAsync:s.mutate})}export{$ as Q,ee as a,re as b,w as u};
