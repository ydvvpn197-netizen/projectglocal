var ue=Object.defineProperty,fe=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var se=(a,r,s)=>r in a?ue(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s,C=(a,r)=>{for(var s in r||(r={}))ge.call(r,s)&&se(a,s,r[s]);if(ee)for(var s of ee(r))je.call(r,s)&&se(a,s,r[s]);return a},A=(a,r)=>fe(a,xe(r));var _=(a,r,s)=>new Promise((t,m)=>{var h=g=>{try{i(s.next(g))}catch(b){m(b)}},n=g=>{try{i(s.throw(g))}catch(b){m(b)}},i=g=>g.done?t(g.value):Promise.resolve(g.value).then(h,n);i((s=s.apply(a,r)).next())});import{c as re,r as x,u as Z,g as W,s as U,R as pe,j as e,C as q,p as O,q as R,S as Y,t as I,v as M,B as E,X as K,e as ne}from"./main-Dczk40-q.js";import{I as k}from"./index-DxDoSqvO.js";import{L as d}from"./label-KS36zHkM.js";import{T as ve,a as ye,b as G,c as H}from"./tabs-ChvN7mKq.js";import{A as Ne,b as we,c as _e,R as te}from"./ResponsiveLayout-CxdDAcTl.js";import{S as y}from"./switch-B6gYJ-ue.js";import{S as be}from"./slider-CHiF0Bk_.js";import{B as Ce}from"./badge-iBsRNaSn.js";import{S as F}from"./separator-CnmZayxo.js";import{u as Se}from"./useLocationManager-Dc0igfRE.js";import{L as ke}from"./loader-2-DzDjnuQG.js";import{S as B}from"./save-DN_6e_8W.js";import{T as $}from"./textarea-fzgM4rGq.js";import{U as Ee}from"./user-xzPyfs-H.js";import{C as Pe}from"./camera-Dc9t8vfc.js";import{P as Ae}from"./phone-B0zkk_50.js";import{G as ce}from"./globe-DZrEywGl.js";import{M as oe}from"./mail-CApItZTg.js";import{M as Fe}from"./map-pin-B65WKje7.js";import{C as X}from"./calendar-DbYgxsnG.js";import{A as De}from"./award-CU5m2ckN.js";import{B as ae}from"./bell-CB9MQoCr.js";import{M as Te}from"./message-square-BskFJ3te.js";import{U as Le}from"./alert-vAohCTxn.js";import{M as Ue}from"./message-circle-CrqL1ene.js";import{M as qe,T as Oe}from"./index-BCwUGNws.js";import{C as Re}from"./clock-D-HXAPEh.js";import{S as Ie,a as Me,b as ze,c as We,d as V}from"./select-B_T1mZfW.js";import{S as le}from"./shield-Bq_L1461.js";import{U as ie}from"./user-check-HA6vCK6U.js";import{E as de}from"./eye-CXD-3Vg7.js";import{E as Be}from"./eye-off-DQT_il_m.js";import{C as Ge}from"./check-circle-CJSaU0rJ.js";import{X as He}from"./x-circle-DtL0wFqx.js";import{A as me}from"./alert-triangle-BCAhts2_.js";import{A as Je,a as Ye,b as $e,c as Ve,d as Xe,e as Ze,f as Ke,g as Qe,h as es}from"./alert-dialog-CEXbGQL0.js";import{L as ss}from"./log-out-vClmguiA.js";import"./index-Bvi8qGb8.js";import"./index-p4sF6Wge.js";import"./databaseUtils-DDxBFZda.js";import"./scroll-area-Ya-nYYPz.js";import"./useNotifications-DdfHYMMR.js";import"./notificationService-DiBkqnn5.js";import"./check-Dn5E7z_E.js";import"./search-CoqTXUJe.js";import"./zap-BM2f935p.js";import"./plus-B7hFD5Z2.js";import"./wifi-D1BoRTe0.js";import"./index-MbWpnwLW.js";import"./locationService-DP6rxedy.js";import"./chevron-up-BzEWPbkd.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=re("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=re("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),is=()=>{const[a,r]=x.useState(!1),{signOut:s}=Z(),{toast:t}=W();return{deleteAccount:()=>_(void 0,null,function*(){try{r(!0),console.log("Starting account deletion process...");const{data:n,error:i}=yield U.functions.invoke("delete-user-account",{method:"POST",headers:{"Content-Type":"application/json"}});if(console.log("Edge function response:",{data:n,error:i}),i)throw console.error("Edge function error:",i),i;return console.log("Account deletion successful"),t({title:"Account Deleted",description:"Your account has been permanently deleted."}),yield s(),{success:!0}}catch(n){console.error("Error deleting account:",n);let i="Failed to delete account. Please try again.",g="";if(n instanceof Error&&n.message)i=n.message,g=n.message;else if(typeof n=="object"&&n!==null&&"error"in n){const b=n;i=b.error,g=b.error}if(typeof n=="object"&&n!==null&&"details"in n){const b=n;console.error("Error details:",b.details),g+=` | Details: ${JSON.stringify(b.details)}`}return console.error("Final error message:",i),console.error("Error details:",g),t({title:"Error",description:i,variant:"destructive"}),{success:!1,error:i}}finally{r(!1)}}),testEdgeFunction:()=>_(void 0,null,function*(){try{console.log("Testing edge function accessibility...");const{data:n,error:i}=yield U.functions.invoke("delete-user-account",{method:"GET"});console.log("Test response:",{data:n,error:i}),i?(console.error("Edge function test failed:",i),t({title:"Function Test Failed",description:`Error: ${i.message}`,variant:"destructive"})):(console.log("Edge function test successful:",n),t({title:"Function Test Successful",description:"Edge function is accessible"}))}catch(n){console.error("Test function error:",n),t({title:"Test Error",description:n instanceof Error?n.message:"Unknown error occurred",variant:"destructive"})}}),isDeleting:a}};class rs{getUserSettings(r){return _(this,null,function*(){try{const[s,t]=yield Promise.all([U.from("profiles").select("*").eq("user_id",r).single(),U.from("user_notification_settings").select("*").eq("user_id",r).single()]),m=s.data||{},h=t.data||{};return{display_name:m.display_name,bio:m.bio,first_name:m.first_name,last_name:m.last_name,phone_number:m.phone_number,website_url:m.website_url,location_city:m.location_city,location_state:m.location_state,location_country:m.location_country,real_time_location_enabled:m.real_time_location_enabled,email_notifications:h.email_notifications,push_notifications:h.push_notifications,booking_notifications:h.booking_notifications,message_notifications:h.message_notifications,follower_notifications:h.follower_notifications,event_notifications:h.event_notifications,discussion_notifications:h.discussion_notifications,payment_notifications:h.payment_notifications,system_notifications:h.system_notifications,marketing_notifications:h.marketing_notifications,quiet_hours_enabled:h.quiet_hours_enabled,quiet_hours_start:h.quiet_hours_start,quiet_hours_end:h.quiet_hours_end,privacy_profile:!1,show_location:!0,show_contact_info:!0,allow_messages_from:"followers",dark_mode:!1,language:"en",timezone:"UTC",two_factor_enabled:!1,login_notifications:!0}}catch(s){throw console.error("Error fetching user settings:",s),new Error("Failed to fetch user settings")}})}updateProfileSettings(r,s){return _(this,null,function*(){try{const t={},m={};if(s.display_name!==void 0&&(t.display_name=s.display_name),s.bio!==void 0&&(t.bio=s.bio),s.first_name!==void 0&&(t.first_name=s.first_name),s.last_name!==void 0&&(t.last_name=s.last_name),s.phone_number!==void 0&&(t.phone_number=s.phone_number),s.website_url!==void 0&&(t.website_url=s.website_url),s.location_city!==void 0&&(t.location_city=s.location_city),s.location_state!==void 0&&(t.location_state=s.location_state),s.location_country!==void 0&&(t.location_country=s.location_country),s.real_time_location_enabled!==void 0&&(t.real_time_location_enabled=s.real_time_location_enabled),Object.keys(t).length>0){t.updated_at=new Date().toISOString();const{error:h}=yield U.from("profiles").update(t).eq("user_id",r);if(h)throw h}if(Object.keys(m).length>0){m.updated_at=new Date().toISOString();const{error:h}=yield U.from("user_notification_settings").upsert(C({user_id:r},m));if(h)throw h}return{success:!0}}catch(t){return console.error("Error updating profile settings:",t),{success:!1,error:t instanceof Error?t.message:"Failed to update settings"}}})}updateNotificationSettings(r,s){return _(this,null,function*(){try{const t={};if(s.email_notifications!==void 0&&(t.email_notifications=s.email_notifications),s.push_notifications!==void 0&&(t.push_notifications=s.push_notifications),s.booking_notifications!==void 0&&(t.booking_notifications=s.booking_notifications),s.message_notifications!==void 0&&(t.message_notifications=s.message_notifications),s.follower_notifications!==void 0&&(t.follower_notifications=s.follower_notifications),s.event_notifications!==void 0&&(t.event_notifications=s.event_notifications),s.discussion_notifications!==void 0&&(t.discussion_notifications=s.discussion_notifications),s.payment_notifications!==void 0&&(t.payment_notifications=s.payment_notifications),s.system_notifications!==void 0&&(t.system_notifications=s.system_notifications),s.marketing_notifications!==void 0&&(t.marketing_notifications=s.marketing_notifications),s.quiet_hours_enabled!==void 0&&(t.quiet_hours_enabled=s.quiet_hours_enabled),s.quiet_hours_start!==void 0&&(t.quiet_hours_start=s.quiet_hours_start),s.quiet_hours_end!==void 0&&(t.quiet_hours_end=s.quiet_hours_end),Object.keys(t).length===0)return{success:!0};t.updated_at=new Date().toISOString();const{error:m}=yield U.from("user_notification_settings").upsert(C({user_id:r},t));if(m)throw m;return{success:!0}}catch(t){return console.error("Error updating notification settings:",t),{success:!1,error:t instanceof Error?t.message:"Failed to update notification settings"}}})}changePassword(r,s){return _(this,null,function*(){try{if(s.newPassword!==s.confirmPassword)return{success:!1,error:"New password and confirmation password do not match"};if(s.newPassword.length<8)return{success:!1,error:"Password must be at least 8 characters long"};const{error:t}=yield U.auth.updateUser({password:s.newPassword});if(t)throw t;return{success:!0}}catch(t){return console.error("Error changing password:",t),{success:!1,error:t instanceof Error?t.message:"Failed to change password"}}})}changeEmail(r,s){return _(this,null,function*(){try{const{error:t}=yield U.auth.updateUser({email:s.newEmail});if(t)throw t;return{success:!0,data:{message:"Email change request sent. Please check your new email for confirmation."}}}catch(t){return console.error("Error changing email:",t),{success:!1,error:t instanceof Error?t.message:"Failed to change email"}}})}deleteAccount(r){return _(this,null,function*(){try{return{success:!0}}catch(s){return console.error("Error deleting account:",s),{success:!1,error:s instanceof Error?s.message:"Failed to delete account"}}})}getUserPreferences(r,s){return _(this,null,function*(){try{const t=yield this.getUserSettings(r),m={};return s.forEach(h=>{h in t&&(m[h]=t[h])}),m}catch(t){return console.error("Error fetching user preferences:",t),{}}})}resetSettingsToDefaults(r){return _(this,null,function*(){try{const s={email_notifications:!0,push_notifications:!0,booking_notifications:!0,message_notifications:!0,follower_notifications:!0,event_notifications:!0,discussion_notifications:!0,payment_notifications:!0,system_notifications:!0,marketing_notifications:!1,quiet_hours_enabled:!1,quiet_hours_start:"22:00",quiet_hours_end:"08:00"},{error:t}=yield U.from("user_notification_settings").upsert(A(C({user_id:r},s),{updated_at:new Date().toISOString()}));if(t)throw t;return{success:!0}}catch(s){return console.error("Error resetting settings:",s),{success:!1,error:s instanceof Error?s.message:"Failed to reset settings"}}})}}const z=new rs,J=()=>{const{user:a}=Z(),{toast:r}=W(),[s,t]=x.useState({}),[m,h]=x.useState(!0),[n,i]=x.useState(!1),[g,b]=x.useState(!1),f=x.useCallback(()=>_(void 0,null,function*(){if(!(a!=null&&a.id)){h(!1);return}try{h(!0);const p=yield z.getUserSettings(a.id);t(p)}catch(p){console.error("Error loading user settings:",p),r({title:"Error",description:"Failed to load user settings",variant:"destructive"})}finally{h(!1)}}),[a==null?void 0:a.id,r]),N=x.useCallback(p=>_(void 0,null,function*(){if(!(a!=null&&a.id))return{success:!1,error:"User not authenticated"};try{i(!0);const v=yield z.updateProfileSettings(a.id,p);return v.success?(t(S=>C(C({},S),p)),b(!1),r({title:"Success",description:"Profile settings updated successfully"})):r({title:"Error",description:v.error||"Failed to update profile settings",variant:"destructive"}),v}catch(v){return console.error("Error updating profile settings:",v),r({title:"Error",description:"Failed to update profile settings",variant:"destructive"}),{success:!1,error:"Unknown error"}}finally{i(!1)}}),[a==null?void 0:a.id,r]),P=x.useCallback(p=>_(void 0,null,function*(){if(!(a!=null&&a.id))return{success:!1,error:"User not authenticated"};try{i(!0);const v=yield z.updateNotificationSettings(a.id,p);return v.success?(t(S=>C(C({},S),p)),b(!1),r({title:"Success",description:"Notification settings updated successfully"})):r({title:"Error",description:v.error||"Failed to update notification settings",variant:"destructive"}),v}catch(v){return console.error("Error updating notification settings:",v),r({title:"Error",description:"Failed to update notification settings",variant:"destructive"}),{success:!1,error:"Unknown error"}}finally{i(!1)}}),[a==null?void 0:a.id,r]),o=x.useCallback(p=>_(void 0,null,function*(){if(!(a!=null&&a.id))return{success:!1,error:"User not authenticated"};try{i(!0);const v=yield z.changePassword(a.id,p);return v.success?r({title:"Success",description:"Password changed successfully"}):r({title:"Error",description:v.error||"Failed to change password",variant:"destructive"}),v}catch(v){return console.error("Error changing password:",v),r({title:"Error",description:"Failed to change password",variant:"destructive"}),{success:!1,error:"Unknown error"}}finally{i(!1)}}),[a==null?void 0:a.id,r]),l=x.useCallback(p=>_(void 0,null,function*(){var v;if(!(a!=null&&a.id))return{success:!1,error:"User not authenticated"};try{i(!0);const S=yield z.changeEmail(a.id,p);return S.success?r({title:"Success",description:((v=S.data)==null?void 0:v.message)||"Email change request sent successfully"}):r({title:"Error",description:S.error||"Failed to change email",variant:"destructive"}),S}catch(S){return console.error("Error changing email:",S),r({title:"Error",description:"Failed to change email",variant:"destructive"}),{success:!1,error:"Unknown error"}}finally{i(!1)}}),[a==null?void 0:a.id,r]),j=x.useCallback(()=>_(void 0,null,function*(){if(!(a!=null&&a.id))return{success:!1,error:"User not authenticated"};try{i(!0);const p=yield z.resetSettingsToDefaults(a.id);return p.success?(yield f(),b(!1),r({title:"Success",description:"Settings reset to defaults successfully"})):r({title:"Error",description:p.error||"Failed to reset settings",variant:"destructive"}),p}catch(p){return console.error("Error resetting settings:",p),r({title:"Error",description:"Failed to reset settings",variant:"destructive"}),{success:!1,error:"Unknown error"}}finally{i(!1)}}),[a==null?void 0:a.id,r,f]),L=x.useCallback((p,v)=>{t(S=>A(C({},S),{[p]:v})),b(!0)},[]),D=x.useCallback(()=>_(void 0,null,function*(){if(!(a!=null&&a.id)||!g)return!0;try{i(!0);const p={},v={};Object.entries(s).forEach(([c,w])=>{c.startsWith("email_")||c.startsWith("push_")||c.startsWith("booking_")||c.startsWith("message_")||c.startsWith("follower_")||c.startsWith("event_")||c.startsWith("discussion_")||c.startsWith("payment_")||c.startsWith("system_")||c.startsWith("marketing_")||c.startsWith("quiet_hours_")?v[c]=w:p[c]=w});const[S,u]=yield Promise.all([Object.keys(p).length>0?z.updateProfileSettings(a.id,p):{success:!0},Object.keys(v).length>0?z.updateNotificationSettings(a.id,v):{success:!0}]);if(S.success&&u.success)return b(!1),r({title:"Success",description:"All settings saved successfully"}),!0;{const c=S.error||u.error||"Failed to save some settings";return r({title:"Error",description:c,variant:"destructive"}),!1}}catch(p){return console.error("Error saving all changes:",p),r({title:"Error",description:"Failed to save settings",variant:"destructive"}),!1}finally{i(!1)}}),[a==null?void 0:a.id,s,g,r]);return x.useEffect(()=>{f()},[f]),{settings:s,loading:m,saving:n,hasChanges:g,loadSettings:f,updateProfileSettings:N,updateNotificationSettings:P,changePassword:o,changeEmail:l,resetSettingsToDefaults:j,handleSettingChange:L,saveAllChanges:D,setSettings:t}},ns=[{id:"events",label:"Events & Activities",description:"Local events, concerts, workshops"},{id:"news",label:"Local News",description:"Community news and updates"},{id:"artists",label:"Artists & Services",description:"Local artists and service providers"},{id:"reviews",label:"Reviews & Recommendations",description:"Local business reviews"},{id:"discussions",label:"Community Discussions",description:"Local community posts and polls"},{id:"businesses",label:"Local Businesses",description:"Restaurants, shops, and services"}];function cs({className:a=""}){const{settings:r,updateSettings:s,loading:t,error:m}=Se(),[h,n]=x.useState(r),[i,g]=x.useState(!1);pe.useEffect(()=>{n(r)},[r]);const b=o=>{n(l=>A(C({},l),{categories:l.categories.includes(o)?l.categories.filter(j=>j!==o):[...l.categories,o]}))},f=o=>{n(l=>A(C({},l),{radius_km:o[0]}))},N=()=>_(this,null,function*(){g(!0);try{yield s(h)}catch(o){console.error("Failed to save settings:",o)}finally{g(!1)}}),P=JSON.stringify(h)!==JSON.stringify(r);return e.jsxs(q,{className:a,children:[e.jsxs(O,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Location Preferences"]}),e.jsx(I,{children:"Customize your location-based experience and content preferences"})]}),e.jsxs(M,{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{className:"text-base font-medium",children:"Location Services"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enable location-based content personalization"})]}),e.jsx(y,{checked:h.enabled,onCheckedChange:o=>n(l=>A(C({},l),{enabled:o})),disabled:t})]})}),h.enabled&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{className:"text-base font-medium",children:"Auto-Detect Location"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically update your location when you move"})]}),e.jsx(y,{checked:h.auto_detect,onCheckedChange:o=>n(l=>A(C({},l),{auto_detect:o})),disabled:t})]})}),e.jsx(F,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"text-base font-medium",children:"Search Radius"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Show content within ",h.radius_km,"km of your location"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(be,{value:[h.radius_km],onValueChange:f,max:100,min:5,step:5,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"5km"}),e.jsx("span",{children:"50km"}),e.jsx("span",{children:"100km"})]})]})]}),e.jsx(F,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"text-base font-medium",children:"Content Categories"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose which types of content to show based on your location"})]}),e.jsx("div",{className:"grid gap-3",children:ns.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"font-medium cursor-pointer",children:o.label}),h.categories.includes(o.id)&&e.jsx(Ce,{variant:"secondary",className:"text-xs",children:"Active"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.description})]})}),e.jsx(y,{checked:h.categories.includes(o.id),onCheckedChange:()=>b(o.id),disabled:t})]},o.id))})]}),e.jsx(F,{}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{className:"text-base font-medium",children:"Location Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about new content in your area"})]}),e.jsx(y,{checked:h.notifications,onCheckedChange:o=>n(l=>A(C({},l),{notifications:o})),disabled:t})]})})]}),m&&e.jsx("div",{className:"p-3 border border-destructive/20 bg-destructive/5 rounded-lg",children:e.jsx("p",{className:"text-sm text-destructive",children:m})}),P&&e.jsx("div",{className:"flex justify-end",children:e.jsx(E,{onClick:N,disabled:i||t,className:"flex items-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4"}),"Save Changes"]})})}),e.jsxs("div",{className:"text-xs text-muted-foreground bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"font-medium mb-1",children:"Privacy & Data Usage"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Your location is only used to personalize content"}),e.jsx("li",{children:"• Location data is stored securely and not shared with third parties"}),e.jsx("li",{children:"• You can disable location services at any time"}),e.jsx("li",{children:"• Location data is automatically updated when you move (if auto-detect is enabled)"})]})]})]})]})}const os=({onClose:a,showAvatar:r=!0,compact:s=!1})=>{var v,S;const{toast:t}=W(),{settings:m,saving:h,updateProfileSettings:n}=J(),[i,g]=x.useState(m),[b,f]=x.useState(!1),[N,P]=x.useState(null),[o,l]=x.useState(null);x.useEffect(()=>{g(m)},[m]),x.useEffect(()=>{const u=JSON.stringify(i)!==JSON.stringify(m);f(u)},[i,m]);const j=(u,c)=>{g(w=>A(C({},w),{[u]:c}))},L=u=>{var w;const c=(w=u.target.files)==null?void 0:w[0];if(c){P(c);const T=new FileReader;T.onload=he=>{var Q;l((Q=he.target)==null?void 0:Q.result)},T.readAsDataURL(c)}},D=()=>_(void 0,null,function*(){try{(yield n(i)).success&&(t({title:"Success",description:"Profile updated successfully"}),a&&a())}catch(u){t({title:"Error",description:"Failed to update profile",variant:"destructive"})}}),p=()=>{g(m),P(null),l(null),a&&a()};return e.jsxs(q,{className:s?"":"w-full max-w-4xl",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"Profile Settings"]}),e.jsx(I,{children:"Update your personal information and profile details."})]}),a&&e.jsx(E,{variant:"ghost",size:"sm",onClick:a,children:e.jsx(K,{className:"h-4 w-4"})})]})}),e.jsxs(M,{className:"space-y-6",children:[r&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Ne,{className:"h-20 w-20",children:[e.jsx(we,{src:o||m.avatar_url||void 0,alt:"Profile avatar"}),e.jsx(_e,{className:"text-lg",children:((v=m.display_name)==null?void 0:v.charAt(0))||((S=m.first_name)==null?void 0:S.charAt(0))||"U"})]}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-primary text-primary-foreground rounded-full p-1 cursor-pointer hover:bg-primary/90",children:[e.jsx(Pe,{className:"h-3 w-3"}),e.jsx("input",{type:"file",accept:"image/*",onChange:L,className:"hidden"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Profile Photo"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a new profile photo. Recommended size: 400x400 pixels."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"first_name",children:"First Name *"}),e.jsx(k,{id:"first_name",value:i.first_name||"",onChange:u=>j("first_name",u.target.value),placeholder:"Enter your first name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(k,{id:"last_name",value:i.last_name||"",onChange:u=>j("last_name",u.target.value),placeholder:"Enter your last name"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"display_name",children:"Display Name"}),e.jsx(k,{id:"display_name",value:i.display_name||"",onChange:u=>j("display_name",u.target.value),placeholder:"Enter your display name"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This is the name that will be shown to other users."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"bio",children:"Bio"}),e.jsx($,{id:"bio",value:i.bio||"",onChange:u=>j("bio",u.target.value),placeholder:"Tell us about yourself, your interests, and what you do...",rows:4}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Share a bit about yourself with the community."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"phone_number",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(k,{id:"phone_number",value:i.phone_number||"",onChange:u=>j("phone_number",u.target.value),placeholder:"Enter your phone number",className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"website_url",children:"Website"}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(k,{id:"website_url",value:i.website_url||"",onChange:u=>j("website_url",u.target.value),placeholder:"https://yourwebsite.com",className:"pl-10"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(k,{id:"email",type:"email",value:i.email||"",disabled:!0,className:"pl-10"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Email address cannot be changed here. Go to Settings → Security to change your email."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Location"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"location_city",children:"City"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(k,{id:"location_city",value:i.location_city||"",onChange:u=>j("location_city",u.target.value),placeholder:"Enter your city",className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"location_state",children:"State/Province"}),e.jsx(k,{id:"location_state",value:i.location_state||"",onChange:u=>j("location_state",u.target.value),placeholder:"Enter your state"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"location_country",children:"Country"}),e.jsx(k,{id:"location_country",value:i.location_country||"",onChange:u=>j("location_country",u.target.value),placeholder:"Enter your country"})]})]})]}),m.user_type==="artist"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Professional Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"experience_years",children:"Years of Experience"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(k,{id:"experience_years",type:"number",min:"0",value:i.experience_years||"",onChange:u=>j("experience_years",parseInt(u.target.value)||0),placeholder:"0",className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"education",children:"Education"}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(k,{id:"education",value:i.education||"",onChange:u=>j("education",u.target.value),placeholder:"e.g., Bachelor's in Fine Arts",className:"pl-10"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"artist_skills",children:"Skills & Specialties"}),e.jsx($,{id:"artist_skills",value:Array.isArray(i.artist_skills)?i.artist_skills.join(", "):"",onChange:u=>j("artist_skills",u.target.value.split(",").map(c=>c.trim()).filter(Boolean)),placeholder:"Enter your skills and specialties, separated by commas",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"hourly_rate_min",children:"Minimum Hourly Rate ($)"}),e.jsx(k,{id:"hourly_rate_min",type:"number",min:"0",step:"0.01",value:i.hourly_rate_min||"",onChange:u=>j("hourly_rate_min",parseFloat(u.target.value)||0),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"hourly_rate_max",children:"Maximum Hourly Rate ($)"}),e.jsx(k,{id:"hourly_rate_max",type:"number",min:"0",step:"0.01",value:i.hourly_rate_max||"",onChange:u=>j("hourly_rate_max",parseFloat(u.target.value)||0),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"portfolio_urls",children:"Portfolio URLs"}),e.jsx($,{id:"portfolio_urls",value:Array.isArray(i.portfolio_urls)?i.portfolio_urls.join(`
`):"",onChange:u=>j("portfolio_urls",u.target.value.split(`
`).map(c=>c.trim()).filter(Boolean)),placeholder:"Enter your portfolio URLs, one per line",rows:3})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[a&&e.jsx(E,{variant:"outline",onClick:p,children:"Cancel"}),e.jsxs(E,{onClick:D,disabled:!b||h,className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),h?"Saving...":"Save Changes"]})]})]})]})},ls=({onClose:a,compact:r=!1})=>{const{toast:s}=W(),{settings:t,saving:m,updateNotificationSettings:h}=J(),[n,i]=x.useState(t),[g,b]=x.useState(!1);x.useEffect(()=>{i(t)},[t]),x.useEffect(()=>{const l=JSON.stringify(n)!==JSON.stringify(t);b(l)},[n,t]);const f=(l,j)=>{i(L=>A(C({},L),{[l]:j}))},N=()=>_(void 0,null,function*(){try{(yield h(n)).success&&(s({title:"Success",description:"Notification settings updated successfully"}),a&&a())}catch(l){s({title:"Error",description:"Failed to update notification settings",variant:"destructive"})}}),P=()=>{i(t),a&&a()},o=()=>{const l={email_notifications:!0,push_notifications:!0,booking_notifications:!0,message_notifications:!0,follower_notifications:!0,event_notifications:!0,discussion_notifications:!0,payment_notifications:!0,system_notifications:!0,marketing_notifications:!1,quiet_hours_enabled:!1,quiet_hours_start:"22:00",quiet_hours_end:"08:00"};i(j=>C(C({},j),l))};return e.jsxs(q,{className:r?"":"w-full",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Notification Preferences"]}),e.jsx(I,{children:"Choose what notifications you want to receive and when."})]}),a&&e.jsx(E,{variant:"ghost",size:"sm",onClick:a,children:e.jsx(K,{className:"h-4 w-4"})})]})}),e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"General Notifications"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive updates and announcements via email."})]}),e.jsx(y,{checked:n.email_notifications!==!1,onCheckedChange:l=>f("email_notifications",l)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Push Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about new messages and activity."})]}),e.jsx(y,{checked:n.push_notifications!==!1,onCheckedChange:l=>f("push_notifications",l)})]})]}),e.jsx(F,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Specific Notifications"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsxs(d,{className:"text-sm flex items-center gap-2",children:[e.jsx(X,{className:"h-3 w-3"}),"Booking Updates"]})}),e.jsx(y,{checked:n.booking_notifications!==!1,onCheckedChange:l=>f("booking_notifications",l)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsxs(d,{className:"text-sm flex items-center gap-2",children:[e.jsx(Te,{className:"h-3 w-3"}),"New Messages"]})}),e.jsx(y,{checked:n.message_notifications!==!1,onCheckedChange:l=>f("message_notifications",l)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsxs(d,{className:"text-sm flex items-center gap-2",children:[e.jsx(Le,{className:"h-3 w-3"}),"New Followers"]})}),e.jsx(y,{checked:n.follower_notifications!==!1,onCheckedChange:l=>f("follower_notifications",l)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsxs(d,{className:"text-sm flex items-center gap-2",children:[e.jsx(X,{className:"h-3 w-3"}),"Event Updates"]})}),e.jsx(y,{checked:n.event_notifications!==!1,onCheckedChange:l=>f("event_notifications",l)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsxs(d,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ue,{className:"h-3 w-3"}),"Discussion Activity"]})}),e.jsx(y,{checked:n.discussion_notifications!==!1,onCheckedChange:l=>f("discussion_notifications",l)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsxs(d,{className:"text-sm flex items-center gap-2",children:[e.jsx(ts,{className:"h-3 w-3"}),"Payment Updates"]})}),e.jsx(y,{checked:n.payment_notifications!==!1,onCheckedChange:l=>f("payment_notifications",l)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsxs(d,{className:"text-sm flex items-center gap-2",children:[e.jsx(Y,{className:"h-3 w-3"}),"System Messages"]})}),e.jsx(y,{checked:n.system_notifications!==!1,onCheckedChange:l=>f("system_notifications",l)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsxs(d,{className:"text-sm flex items-center gap-2",children:[e.jsx(qe,{className:"h-3 w-3"}),"Marketing"]})}),e.jsx(y,{checked:n.marketing_notifications||!1,onCheckedChange:l=>f("marketing_notifications",l)})]})]})]}),e.jsx(F,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Quiet Hours"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Enable Quiet Hours"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pause notifications during specific hours."})]}),e.jsx(y,{checked:n.quiet_hours_enabled||!1,onCheckedChange:l=>f("quiet_hours_enabled",l)})]}),n.quiet_hours_enabled&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Start Time"}),e.jsx(k,{type:"time",value:n.quiet_hours_start||"22:00",onChange:l=>f("quiet_hours_start",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"End Time"}),e.jsx(k,{type:"time",value:n.quiet_hours_end||"08:00",onChange:l=>f("quiet_hours_end",l.target.value)})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(E,{variant:"outline",onClick:o,disabled:m,className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Reset to Defaults"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[a&&e.jsx(E,{variant:"outline",onClick:P,children:"Cancel"}),e.jsxs(E,{onClick:N,disabled:!g||m,className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),m?"Saving...":"Save Changes"]})]})]})]})]})},ds=({onClose:a,compact:r=!1})=>{const{toast:s}=W(),{settings:t,saving:m,updateProfileSettings:h}=J(),[n,i]=x.useState(t),[g,b]=x.useState(!1);x.useEffect(()=>{i(t)},[t]),x.useEffect(()=>{const o=JSON.stringify(n)!==JSON.stringify(t);b(o)},[n,t]);const f=(o,l)=>{i(j=>A(C({},j),{[o]:l}))},N=()=>_(void 0,null,function*(){try{(yield h(n)).success&&(s({title:"Success",description:"Privacy settings updated successfully"}),a&&a())}catch(o){s({title:"Error",description:"Failed to update privacy settings",variant:"destructive"})}}),P=()=>{i(t),a&&a()};return e.jsxs(q,{className:r?"":"w-full",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Privacy Controls"]}),e.jsx(I,{children:"Manage your privacy and data sharing preferences."})]}),a&&e.jsx(E,{variant:"ghost",size:"sm",onClick:a,children:e.jsx(K,{className:"h-4 w-4"})})]})}),e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Profile Privacy"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Private Profile"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Make your profile visible only to approved followers."})]}),e.jsx(y,{checked:n.privacy_profile||!1,onCheckedChange:o=>f("privacy_profile",o)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Who can send you messages"}),e.jsxs(Ie,{value:n.allow_messages_from||"followers",onValueChange:o=>f("allow_messages_from",o),children:[e.jsx(Me,{children:e.jsx(ze,{})}),e.jsxs(We,{children:[e.jsx(V,{value:"all",children:"Everyone"}),e.jsx(V,{value:"followers",children:"Followers Only"}),e.jsx(V,{value:"none",children:"No One"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Control who can send you direct messages."})]})]}),e.jsx(F,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Information Visibility"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Show Location"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow others to see your general location."})]}),e.jsx(y,{checked:n.show_location!==!1,onCheckedChange:o=>f("show_location",o)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Show Contact Info"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow others to see your contact information."})]}),e.jsx(y,{checked:n.show_contact_info!==!1,onCheckedChange:o=>f("show_contact_info",o)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Show Phone Number"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Display your phone number on your profile."})]}),e.jsx(y,{checked:n.show_phone_number!==!1,onCheckedChange:o=>f("show_phone_number",o)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Show Website"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Display your website URL on your profile."})]}),e.jsx(y,{checked:n.show_website!==!1,onCheckedChange:o=>f("show_website",o)})]})]}),e.jsx(F,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Data Sharing"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Analytics & Improvement"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Help improve the app by sharing anonymous usage data."})]}),e.jsx(y,{checked:n.analytics_enabled!==!1,onCheckedChange:o=>f("analytics_enabled",o)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Personalized Recommendations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow the app to provide personalized content and suggestions."})]}),e.jsx(y,{checked:n.personalization_enabled!==!1,onCheckedChange:o=>f("personalization_enabled",o)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Social Features"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enable social features like following, sharing, and community interactions."})]}),e.jsx(y,{checked:n.social_features_enabled!==!1,onCheckedChange:o=>f("social_features_enabled",o)})]})]}),e.jsx(F,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Search & Discovery"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Appear in Search Results"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow others to find you through search."})]}),e.jsx(y,{checked:n.searchable!==!1,onCheckedChange:o=>f("searchable",o)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Show in Recommendations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow the app to suggest your profile to others."})]}),e.jsx(y,{checked:n.recommendable!==!1,onCheckedChange:o=>f("recommendable",o)})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[a&&e.jsx(E,{variant:"outline",onClick:P,children:"Cancel"}),e.jsxs(E,{onClick:N,disabled:!g||m,className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),m?"Saving...":"Save Changes"]})]})]})]})},ms=({onClose:a,compact:r=!1})=>{const{toast:s}=W(),{settings:t,saving:m,changePassword:h,updateProfileSettings:n}=J(),[i,g]=x.useState(t),[b,f]=x.useState(!1),[N,P]=x.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[o,l]=x.useState(!1),[j,L]=x.useState({score:0,feedback:"",color:"text-gray-400"});x.useEffect(()=>{g(t)},[t]),x.useEffect(()=>{const c=JSON.stringify(i)!==JSON.stringify(t);f(c)},[i,t]);const D=(c,w)=>{g(T=>A(C({},T),{[c]:w}))},p=c=>{let w=0,T="";c.length>=8&&w++,c.length>=12&&w++,/[a-z]/.test(c)&&w++,/[A-Z]/.test(c)&&w++,/[0-9]/.test(c)&&w++,/[^A-Za-z0-9]/.test(c)&&w++,w<=2?(T="Weak",L({score:w,feedback:T,color:"text-red-500"})):w<=4?(T="Fair",L({score:w,feedback:T,color:"text-yellow-500"})):w<=5?(T="Good",L({score:w,feedback:T,color:"text-blue-500"})):(T="Strong",L({score:w,feedback:T,color:"text-green-500"}))},v=()=>_(void 0,null,function*(){if(N.newPassword!==N.confirmPassword){s({title:"Error",description:"New password and confirmation password do not match.",variant:"destructive"});return}if(N.newPassword.length<8){s({title:"Error",description:"Password must be at least 8 characters long.",variant:"destructive"});return}(yield h(N)).success&&(P({currentPassword:"",newPassword:"",confirmPassword:""}),s({title:"Success",description:"Password changed successfully"}))}),S=()=>_(void 0,null,function*(){try{(yield n(i)).success&&(s({title:"Success",description:"Security settings updated successfully"}),a&&a())}catch(c){s({title:"Error",description:"Failed to update security settings",variant:"destructive"})}}),u=()=>{g(t),P({currentPassword:"",newPassword:"",confirmPassword:""}),a&&a()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(q,{children:[e.jsxs(O,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-5 w-5"}),"Change Password"]}),e.jsx(I,{children:"Update your account password for enhanced security."})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"currentPassword",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{id:"currentPassword",type:o?"text":"password",value:N.currentPassword,onChange:c=>P(w=>A(C({},w),{currentPassword:c.target.value})),placeholder:"Enter current password"}),e.jsx(E,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>l(!o),children:o?e.jsx(Be,{className:"h-4 w-4"}):e.jsx(de,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"newPassword",children:"New Password"}),e.jsx("div",{className:"relative",children:e.jsx(k,{id:"newPassword",type:o?"text":"password",value:N.newPassword,onChange:c=>{P(w=>A(C({},w),{newPassword:c.target.value})),p(c.target.value)},placeholder:"Enter new password"})}),N.newPassword&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm ${j.color}`,children:j.feedback}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(c=>e.jsx("div",{className:`h-2 w-8 rounded ${c<=j.score?j.color.replace("text-","bg-"):"bg-gray-200"}`},c))})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Password must be at least 8 characters long."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx("div",{className:"relative",children:e.jsx(k,{id:"confirmPassword",type:o?"text":"password",value:N.confirmPassword,onChange:c=>P(w=>A(C({},w),{confirmPassword:c.target.value})),placeholder:"Confirm new password"})}),N.confirmPassword&&e.jsxs("div",{className:"flex items-center gap-2",children:[N.newPassword===N.confirmPassword?e.jsx(Ge,{className:"h-4 w-4 text-green-500"}):e.jsx(He,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:`text-sm ${N.newPassword===N.confirmPassword?"text-green-600":"text-red-600"}`,children:N.newPassword===N.confirmPassword?"Passwords match":"Passwords do not match"})]})]}),e.jsx(E,{onClick:v,disabled:!N.currentPassword||!N.newPassword||!N.confirmPassword||m,className:"w-full",children:"Update Password"})]})]}),e.jsxs(q,{children:[e.jsxs(O,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Security Features"]}),e.jsx(I,{children:"Additional security features for your account."})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add an extra layer of security to your account."})]}),e.jsx(y,{checked:i.two_factor_enabled||!1,onCheckedChange:c=>D("two_factor_enabled",c)})]}),e.jsx(F,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Login Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified when someone logs into your account."})]}),e.jsx(y,{checked:i.login_notifications!==!1,onCheckedChange:c=>D("login_notifications",c)})]}),e.jsx(F,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Session Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow you to manage active sessions across devices."})]}),e.jsx(y,{checked:i.session_management_enabled!==!1,onCheckedChange:c=>D("session_management_enabled",c)})]}),e.jsx(F,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Account Recovery"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enable account recovery options for lost access."})]}),e.jsx(y,{checked:i.account_recovery_enabled!==!1,onCheckedChange:c=>D("account_recovery_enabled",c)})]})]})]}),e.jsxs(q,{children:[e.jsxs(O,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Security Alerts"]}),e.jsx(I,{children:"Configure security alerts and notifications."})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Suspicious Activity Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about unusual account activity."})]}),e.jsx(y,{checked:i.suspicious_activity_alerts!==!1,onCheckedChange:c=>D("suspicious_activity_alerts",c)})]}),e.jsx(F,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Password Change Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications when your password is changed."})]}),e.jsx(y,{checked:i.password_change_alerts!==!1,onCheckedChange:c=>D("password_change_alerts",c)})]}),e.jsx(F,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"New Device Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified when your account is accessed from a new device."})]}),e.jsx(y,{checked:i.new_device_alerts!==!1,onCheckedChange:c=>D("new_device_alerts",c)})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[a&&e.jsx(E,{variant:"outline",onClick:u,children:"Cancel"}),e.jsxs(E,{onClick:S,disabled:!b||m,className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),m?"Saving...":"Save Changes"]})]})]})},dt=()=>{const{user:a,signOut:r}=Z(),{toast:s}=W(),{deleteAccount:t,testEdgeFunction:m,isDeleting:h}=is(),{loading:n,saving:i,hasChanges:g,saveAllChanges:b,changeEmail:f,resetSettingsToDefaults:N}=J(),[P,o]=x.useState(""),[l,j]=x.useState({newEmail:"",currentPassword:""}),L=()=>_(void 0,null,function*(){try{yield r(),s({title:"Signed Out",description:"You have been signed out successfully."})}catch(u){s({title:"Error",description:"Failed to sign out.",variant:"destructive"})}}),D=()=>_(void 0,null,function*(){if(!l.newEmail||!l.currentPassword){s({title:"Error",description:"Please fill in all fields.",variant:"destructive"});return}(yield f(l)).success&&j({newEmail:"",currentPassword:""})}),p=()=>_(void 0,null,function*(){if(P!=="DELETE"){s({title:"Invalid Confirmation",description:"Please type 'DELETE' to confirm account deletion.",variant:"destructive"});return}(yield t()).success&&o("")}),v=()=>_(void 0,null,function*(){(yield b())&&s({title:"Success",description:"All settings have been saved successfully."})}),S=()=>_(void 0,null,function*(){(yield N()).success&&s({title:"Success",description:"Settings have been reset to defaults."})});return n?e.jsx(te,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsx(te,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Settings"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings and preferences."}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(E,{onClick:v,disabled:!g||i,className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),i?"Saving...":"Save All Changes"]}),e.jsxs(E,{variant:"outline",onClick:S,disabled:i,className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Reset to Defaults"]}),g&&e.jsx("span",{className:"text-sm text-amber-600 font-medium",children:"You have unsaved changes"})]})]}),e.jsxs(ve,{defaultValue:"account",className:"space-y-6",children:[e.jsxs(ye,{className:"grid w-full grid-cols-5",children:[e.jsx(G,{value:"account",children:"Account"}),e.jsx(G,{value:"location",children:"Location"}),e.jsx(G,{value:"privacy",children:"Privacy"}),e.jsx(G,{value:"notifications",children:"Notifications"}),e.jsx(G,{value:"security",children:"Security"})]}),e.jsxs(H,{value:"account",className:"space-y-6",children:[e.jsx(os,{showAvatar:!0,compact:!1}),e.jsxs(q,{children:[e.jsxs(O,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),"Email Settings"]}),e.jsx(I,{children:"Change your email address or manage email preferences."})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"currentEmail",children:"Current Email"}),e.jsx(k,{id:"currentEmail",type:"email",value:(a==null?void 0:a.email)||"",disabled:!0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your current email address."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"newEmail",children:"New Email Address"}),e.jsx(k,{id:"newEmail",type:"email",value:l.newEmail,onChange:u=>j(c=>A(C({},c),{newEmail:u.target.value})),placeholder:"Enter new email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"emailPassword",children:"Current Password"}),e.jsx(k,{id:"emailPassword",type:"password",value:l.currentPassword,onChange:u=>j(c=>A(C({},c),{currentPassword:u.target.value})),placeholder:"Enter your current password"})]}),e.jsx(E,{onClick:D,disabled:!l.newEmail||!l.currentPassword||i,className:"w-full",children:"Change Email Address"})]})]})]}),e.jsx(H,{value:"location",className:"space-y-6",children:e.jsx(cs,{})}),e.jsx(H,{value:"privacy",className:"space-y-6",children:e.jsx(ds,{})}),e.jsx(H,{value:"notifications",className:"space-y-6",children:e.jsx(ls,{})}),e.jsxs(H,{value:"security",className:"space-y-6",children:[e.jsx(ms,{}),e.jsxs(q,{children:[e.jsxs(O,{children:[e.jsx(R,{className:"text-destructive",children:"Danger Zone"}),e.jsx(I,{children:"Irreversible and destructive actions."})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border border-destructive/20 rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{children:"Sign Out"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sign out of your account on this device."})]}),e.jsxs(E,{variant:"outline",onClick:L,children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-destructive/20 rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(d,{className:"text-destructive",children:"Delete Account"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Permanently delete your account and all associated data."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{variant:"outline",onClick:m,className:"text-xs",children:"Test Function"}),e.jsxs(Je,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(E,{variant:"destructive",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Delete Account"]})}),e.jsxs($e,{children:[e.jsxs(Ve,{children:[e.jsxs(Xe,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5 text-destructive"}),"Delete Account"]}),e.jsx(Ze,{children:"This action cannot be undone. This will permanently delete your account and remove all your data from our servers including:"})]}),e.jsx("div",{className:"space-y-2 text-sm text-muted-foreground",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Your profile and personal information"}),e.jsx("li",{children:"All your posts and comments"}),e.jsx("li",{children:"Chat conversations and messages"}),e.jsx("li",{children:"Event bookings and artist profiles"}),e.jsx("li",{children:"Follow relationships and notifications"}),e.jsx("li",{children:"All other account data"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"deleteConfirmation",className:"text-sm font-medium",children:'Type "DELETE" to confirm'}),e.jsx(k,{id:"deleteConfirmation",value:P,onChange:u=>o(u.target.value),placeholder:"DELETE",className:"border-destructive/50 focus:border-destructive"})]}),e.jsxs(Ke,{children:[e.jsx(Qe,{onClick:()=>o(""),children:"Cancel"}),e.jsx(es,{onClick:p,disabled:P!=="DELETE"||h,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:h?"Deleting...":"Delete Account"})]})]})]})]})]})]})]})]})]})]})})};export{dt as default};
