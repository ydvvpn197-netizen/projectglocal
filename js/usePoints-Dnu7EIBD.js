var o=(r,g,c)=>new Promise((k,l)=>{var P=n=>{try{u(c.next(n))}catch(d){l(d)}},b=n=>{try{u(c.throw(n))}catch(d){l(d)}},u=n=>n.done?k(n.value):Promise.resolve(n.value).then(P,b);u((c=c.apply(r,g)).next())});import{c as w,u as j,r as a,s as x}from"./main-jfCIwKxb.js";import{P as i}from"./pointsService-BEnKQBdP.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=w("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=w("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=w("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Q=()=>{const{user:r}=j(),[g,c]=a.useState(null),[k,l]=a.useState(!0),[P,b]=a.useState(null),[u,n]=a.useState([]),[d,C]=a.useState(!1),[U,m]=a.useState(null),[_,v]=a.useState([]),[q,L]=a.useState(!1),[z,M]=a.useState(null),[f,H]=a.useState(null),s=a.useCallback(()=>o(void 0,null,function*(){if(!r){c(null),l(!1);return}try{l(!0),b(null);const t=yield i.getCurrentUserPoints();c(t)}catch(t){b(t instanceof Error?t.message:"Failed to load user points")}finally{l(!1)}}),[r]),h=a.useCallback((t=5)=>o(void 0,null,function*(){try{C(!0),m(null);const e=yield i.getLeaderboard({limit:t});n(e)}catch(e){m(e instanceof Error?e.message:"Failed to load leaderboard")}finally{C(!1)}}),[]),E=a.useCallback(t=>o(void 0,null,function*(){if(r)try{L(!0),M(null);const e=yield i.getCurrentUserPointHistory(t);v(e)}catch(e){M(e instanceof Error?e.message:"Failed to load point history")}finally{L(!1)}}),[r]),T=a.useCallback((t,e,y,Z,$)=>o(void 0,null,function*(){if(!r)return!1;try{const p=yield i.addPoints(r.id,t,e,y,Z,$);return p&&(yield s()),p}catch(p){return console.error("Error adding points:",p),!1}}),[r,s]),A=a.useCallback(t=>o(void 0,null,function*(){if(!r)return!1;try{const e=yield i.handleEventAttendance(t,r.id);return e&&(yield s()),e}catch(e){return console.error("Error handling event attendance points:",e),!1}}),[r,s]),F=a.useCallback(t=>o(void 0,null,function*(){if(!r)return!1;try{const e=yield i.handleEventOrganization(t,r.id);return e&&(yield s()),e}catch(e){return console.error("Error handling event organization points:",e),!1}}),[r,s]),V=a.useCallback(t=>o(void 0,null,function*(){if(!r)return!1;try{const e=yield i.handlePollCreation(t,r.id);return e&&(yield s()),e}catch(e){return console.error("Error handling poll creation points:",e),!1}}),[r,s]),O=a.useCallback(t=>o(void 0,null,function*(){if(!r)return!1;try{const e=yield i.handlePostSharing(t,r.id);return e&&(yield s()),e}catch(e){return console.error("Error handling post sharing points:",e),!1}}),[r,s]),I=a.useCallback(()=>{if(!r)return;const t=x.channel("user_points_changes").on("postgres_changes",{event:"*",schema:"public",table:"user_points",filter:`user_id=eq.${r.id}`},y=>{console.log("User points updated:",y),s()}).subscribe(),e=x.channel("leaderboard_changes").on("postgres_changes",{event:"*",schema:"public",table:"community_leaderboard"},y=>{console.log("Leaderboard updated:",y),h()}).subscribe();H({userPointsSubscription:t,leaderboardSubscription:e})},[r,s,h]),S=a.useCallback(()=>{var t,e;f&&((t=f.userPointsSubscription)==null||t.unsubscribe(),(e=f.leaderboardSubscription)==null||e.unsubscribe(),H(null))},[f]);return a.useEffect(()=>{r?(s(),h(),E()):(c(null),n([]),v([]),l(!1))},[r,s,h,E]),a.useEffect(()=>()=>{S()},[S]),{userPoints:g,loading:k,error:P,leaderboard:u,leaderboardLoading:d,leaderboardError:U,pointHistory:_,historyLoading:q,historyError:z,refreshUserPoints:s,refreshLeaderboard:h,refreshPointHistory:E,addPoints:T,handleEventAttendance:A,handleEventOrganization:F,handlePollCreation:V,handlePostSharing:O,subscribeToPointsUpdates:I,unsubscribeFromPointsUpdates:S}};export{J as M,N as T,K as a,Q as u};
