var ge=Object.defineProperty,ve=Object.defineProperties;var Ne=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var q=(t,r,s)=>r in t?ge(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,p=(t,r)=>{for(var s in r||(r={}))U.call(r,s)&&q(t,s,r[s]);if(O)for(var s of O(r))V.call(r,s)&&q(t,s,r[s]);return t},h=(t,r)=>ve(t,Ne(r));var j=(t,r)=>{var s={};for(var a in t)U.call(t,a)&&r.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&O)for(var a of O(t))r.indexOf(a)<0&&V.call(t,a)&&(s[a]=t[a]);return s};var E=(t,r,s)=>new Promise((a,n)=>{var o=c=>{try{l(s.next(c))}catch(m){n(m)}},i=c=>{try{l(s.throw(c))}catch(m){n(m)}},l=c=>c.done?a(c.value):Promise.resolve(c.value).then(o,i);l((s=s.apply(t,r)).next())});import{r as d,_ as K,h as je,j as e,$ as be,i as Ce,Z as _e,k as Z,P as J,l as k,a0 as Q,n as X,a1 as we,a3 as Pe,a4 as ye,a5 as ke,a6 as Re,R as Ae,b as Me,u as Y,f as ee,B as v,S as Oe,s as Ee}from"./main-B2Z1A0fl.js";import{B as G}from"./badge-CdNeXDip.js";import{h as De,R as Se,u as Te,F as Ie}from"./index-DJ86sh13.js";import{S as $}from"./scroll-area-BhRuPQbm.js";import{D as Fe,b as $e,c as Be,e as W,M as ze,T as Le,f as Ge}from"./index-BccyXWdq.js";import{T as He,a as qe,b as B,c as z}from"./tabs-WXu0DGF3.js";import{u as Ue}from"./useNotifications-BC0Dj2vc.js";import{B as L}from"./bell-BrPt3aXG.js";import{C as Ve}from"./check-DuTiAf7C.js";import{U as We}from"./user-etsi-1kT.js";var S="Popover",[te,Ct]=Ce(S,[K]),R=K(),[Ke,b]=te(S),se=t=>{const{__scopePopover:r,children:s,open:a,defaultOpen:n,onOpenChange:o,modal:i=!1}=t,l=R(r),c=d.useRef(null),[m,C]=d.useState(!1),[x,g]=je({prop:a,defaultProp:n!=null?n:!1,onChange:o,caller:S});return e.jsx(be,h(p({},l),{children:e.jsx(Ke,{scope:r,contentId:_e(),triggerRef:c,open:x,onOpenChange:g,onOpenToggle:d.useCallback(()=>g(_=>!_),[g]),hasCustomAnchor:m,onCustomAnchorAdd:d.useCallback(()=>C(!0),[]),onCustomAnchorRemove:d.useCallback(()=>C(!1),[]),modal:i,children:s})}))};se.displayName=S;var re="PopoverAnchor",Ze=d.forwardRef((t,r)=>{const c=t,{__scopePopover:s}=c,a=j(c,["__scopePopover"]),n=b(re,s),o=R(s),{onCustomAnchorAdd:i,onCustomAnchorRemove:l}=n;return d.useEffect(()=>(i(),()=>l()),[i,l]),e.jsx(Q,h(p(p({},o),a),{ref:r}))});Ze.displayName=re;var oe="PopoverTrigger",ae=d.forwardRef((t,r)=>{const c=t,{__scopePopover:s}=c,a=j(c,["__scopePopover"]),n=b(oe,s),o=R(s),i=Z(r,n.triggerRef),l=e.jsx(J.button,h(p({type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":de(n.open)},a),{ref:i,onClick:k(t.onClick,n.onOpenToggle)}));return n.hasCustomAnchor?l:e.jsx(Q,h(p({asChild:!0},o),{children:l}))});ae.displayName=oe;var H="PopoverPortal",[Je,Qe]=te(H,{forceMount:void 0}),ne=t=>{const{__scopePopover:r,forceMount:s,children:a,container:n}=t,o=b(H,r);return e.jsx(Je,{scope:r,forceMount:s,children:e.jsx(X,{present:s||o.open,children:e.jsx(we,{asChild:!0,container:n,children:a})})})};ne.displayName=H;var P="PopoverContent",ie=d.forwardRef((t,r)=>{const s=Qe(P,t.__scopePopover),i=t,{forceMount:a=s.forceMount}=i,n=j(i,["forceMount"]),o=b(P,t.__scopePopover);return e.jsx(X,{present:a||o.open,children:o.modal?e.jsx(Ye,h(p({},n),{ref:r})):e.jsx(et,h(p({},n),{ref:r}))})});ie.displayName=P;var Xe=Pe("PopoverContent.RemoveScroll"),Ye=d.forwardRef((t,r)=>{const s=b(P,t.__scopePopover),a=d.useRef(null),n=Z(r,a),o=d.useRef(!1);return d.useEffect(()=>{const i=a.current;if(i)return De(i)},[]),e.jsx(Se,{as:Xe,allowPinchZoom:!0,children:e.jsx(le,h(p({},t),{ref:n,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:k(t.onCloseAutoFocus,i=>{var l;i.preventDefault(),o.current||(l=s.triggerRef.current)==null||l.focus()}),onPointerDownOutside:k(t.onPointerDownOutside,i=>{const l=i.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,m=l.button===2||c;o.current=m},{checkForDefaultPrevented:!1}),onFocusOutside:k(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})}))})}),et=d.forwardRef((t,r)=>{const s=b(P,t.__scopePopover),a=d.useRef(!1),n=d.useRef(!1);return e.jsx(le,h(p({},t),{ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,l;(i=t.onCloseAutoFocus)==null||i.call(t,o),o.defaultPrevented||(a.current||(l=s.triggerRef.current)==null||l.focus(),o.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:o=>{var c,m;(c=t.onInteractOutside)==null||c.call(t,o),o.defaultPrevented||(a.current=!0,o.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const i=o.target;((m=s.triggerRef.current)==null?void 0:m.contains(i))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&n.current&&o.preventDefault()}}))}),le=d.forwardRef((t,r)=>{const y=t,{__scopePopover:s,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:o,disableOutsidePointerEvents:i,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:m,onInteractOutside:C}=y,x=j(y,["__scopePopover","trapFocus","onOpenAutoFocus","onCloseAutoFocus","disableOutsidePointerEvents","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside"]),g=b(P,s),_=R(s);return Te(),e.jsx(Ie,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:o,children:e.jsx(ye,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:C,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:m,onDismiss:()=>g.onOpenChange(!1),children:e.jsx(ke,h(p(p({"data-state":de(g.open),role:"dialog",id:g.contentId},_),x),{ref:r,style:h(p({},x.style),{"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"})}))})})}),ce="PopoverClose",tt=d.forwardRef((t,r)=>{const o=t,{__scopePopover:s}=o,a=j(o,["__scopePopover"]),n=b(ce,s);return e.jsx(J.button,h(p({type:"button"},a),{ref:r,onClick:k(t.onClick,()=>n.onOpenChange(!1))}))});tt.displayName=ce;var st="PopoverArrow",rt=d.forwardRef((t,r)=>{const o=t,{__scopePopover:s}=o,a=j(o,["__scopePopover"]),n=R(s);return e.jsx(Re,h(p(p({},n),a),{ref:r}))});rt.displayName=st;function de(t){return t?"open":"closed"}var ot=se,at=ae,nt=ne,ue=ie;const it=ot,lt=at,me=Ae.forwardRef((o,n)=>{var i=o,{className:t,align:r="center",sideOffset:s=4}=i,a=j(i,["className","align","sideOffset"]);return e.jsx(nt,{children:e.jsx(ue,p({ref:n,align:r,sideOffset:s,className:Me("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t)},a))})});me.displayName=ue.displayName;const pe=d.memo(({type:t,isGeneral:r})=>{const s=()=>r?{announcement:"📢",event:"📅",community:"👥",system:"⚙️"}[t]||"📢":{booking_request:"🎯",booking_accepted:"✅",booking_declined:"❌",message_request:"💬",new_follower:"👥",event_reminder:"📅",poll_result:"📊",review_reply:"💭",group_invite:"👋",event_update:"🔄",discussion_request:"💭",discussion_approved:"✅",discussion_rejected:"❌",event_created:"📅",event_updated:"🔄",event_cancelled:"❌",payment_received:"💰",payment_failed:"⚠️",system_announcement:"📢"}[t]||"🔔";return e.jsx("span",{className:"text-2xl",children:s()})});pe.displayName="NotificationIcon";const D=d.memo(({notification:t,onMarkAsRead:r,onDelete:s,onNavigate:a,isGeneral:n=!1,isAuthenticated:o=!1})=>{const i=()=>{a(t)},l=m=>{m.stopPropagation(),!n&&o&&s(t.id)},c=m=>{switch(m){case"urgent":return"border-l-red-500";case"high":return"border-l-orange-500";case"medium":return"border-l-yellow-500";case"low":return"border-l-blue-500";default:return"border-l-primary"}};return e.jsx("div",{className:`p-3 rounded-lg mb-2 cursor-pointer transition-all hover:bg-accent/50 ${n?`bg-card ${c(t.priority)} border-l-4`:t.read?"bg-muted/50":"bg-primary/5 border-l-4 border-l-primary"}`,onClick:i,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pe,{type:t.type,isGeneral:n}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-1",children:[!n&&!t.read&&o&&e.jsx(G,{variant:"default",className:"text-xs px-1 py-0",children:"New"}),!n&&o&&e.jsx(v,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:l,children:e.jsx(Le,{className:"h-3 w-3"})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:t.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:Ge(new Date(t.created_at),"MMM dd • HH:mm")}),t.action_text&&e.jsx(v,{variant:"outline",size:"sm",className:"h-6 text-xs",onClick:m=>{m.stopPropagation(),a(t)},children:t.action_text})]})]})]})})});D.displayName="NotificationItem";const ct=d.memo(()=>{const{user:t}=Y(),r=ee(),[s,a]=d.useState(!1),[n,o]=d.useState(!1),{generalNotifications:i,personalNotifications:l,counts:c,loading:m,error:C,markAsRead:x,markAllAsRead:g,deleteNotification:_,refresh:y,refreshCounts:A,isAuthenticated:f}=Ue(),T=d.useCallback(u=>E(void 0,null,function*(){if(!u.isGeneral&&f)try{yield x(u.id)}catch(xe){console.warn("Error marking notification as read:",xe)}if(u.action_url){r(u.action_url),a(!1);return}const M={booking_request:"/artist-dashboard",booking_accepted:"/artist-dashboard",booking_declined:"/artist-dashboard",message_request:"/messages",new_follower:"/profile",event_reminder:"/events",event_update:"/events",event_created:"/events",event_updated:"/events",event_cancelled:"/events",poll_result:"/community",review_reply:"/community",group_invite:"/community",discussion_request:"/artist-dashboard",discussion_approved:"/community",discussion_rejected:"/community",payment_received:"/artist-dashboard",payment_failed:"/artist-dashboard",system_announcement:"/",announcement:"/",event:"/events",community:"/community",system:"/"}[u.type];M&&r(M),a(!1)}),[x,r,f]),I=d.useCallback(u=>{if(!f){console.warn("Cannot delete notification: user not authenticated");return}try{_(u)}catch(N){console.warn("Error deleting notification:",N)}},[_,f]),F=d.useMemo(()=>{try{return[...i.map(N=>h(p({},N),{isGeneral:!0,read:!1})),...l.map(N=>h(p({},N),{isGeneral:!1}))].sort((N,M)=>new Date(M.created_at).getTime()-new Date(N.created_at).getTime())}catch(u){return console.warn("Error combining notifications:",u),[]}},[i,l]),w={general:Math.max(0,c.general||0),personal:Math.max(0,c.personal||0),total:Math.max(0,c.total||0)},he=d.useCallback(u=>{a(u),u&&f&&(o(!0),A().finally(()=>o(!1)))},[f,A]),fe=d.useCallback(()=>E(void 0,null,function*(){if(f){o(!0);try{yield A()}finally{o(!1)}}}),[f,A]);return f?e.jsxs(it,{open:s,onOpenChange:he,children:[e.jsx(lt,{asChild:!0,children:e.jsxs(v,{variant:"ghost",size:"sm",className:"relative",children:[e.jsx(L,{className:"h-4 w-4"}),w.personal>0&&e.jsx(G,{variant:"destructive",className:`absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs ${n?"animate-pulse":""}`,children:w.personal>99?"99+":w.personal})]})}),e.jsxs(me,{className:"w-80 p-0",align:"end",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Notifications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:y,disabled:m,className:"h-8 w-8 p-0",title:"Refresh notifications and counts",children:[e.jsx("span",{className:"sr-only",children:"Refresh"}),e.jsx("svg",{className:`h-4 w-4 ${m?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]}),f&&w.personal>0&&e.jsx(v,{variant:"ghost",size:"sm",onClick:g,className:"h-8 w-8 p-0",title:"Mark all as read",children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:fe,disabled:n,className:"h-8 w-8 p-0",title:"Sync notification counts",children:e.jsx("svg",{className:`h-4 w-4 ${n?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),e.jsxs(Fe,{children:[e.jsx($e,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Oe,{className:"h-4 w-4"})})}),e.jsxs(Be,{align:"end",children:[e.jsx(W,{onClick:()=>r("/notification-settings"),children:"Settings"}),e.jsx(W,{onClick:()=>r("/notifications"),children:"View All"})]})]})]})]})}),e.jsxs(He,{defaultValue:"all",className:"w-full",children:[e.jsxs(qe,{className:"grid w-full grid-cols-3",children:[e.jsxs(B,{value:"all",className:"text-xs",children:["All (",F.length,")"]}),e.jsxs(B,{value:"personal",className:"text-xs",children:["Personal (",w.personal,")"]}),e.jsxs(B,{value:"general",className:"text-xs",children:["General (",w.general,")"]})]}),e.jsx(z,{value:"all",className:"p-4",children:m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})]}):C?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Unable to load notifications"}),e.jsx(v,{variant:"outline",size:"sm",onClick:y,children:"Try Again"})]}):F.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No notifications"})]}):e.jsx($,{className:"h-64",children:F.map(u=>e.jsx(D,{notification:u,onMarkAsRead:x,onDelete:I,onNavigate:T,isGeneral:u.isGeneral,isAuthenticated:f},`${u.isGeneral?"general":"personal"}-${u.id}`))})}),e.jsx(z,{value:"personal",className:"p-4",children:l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(We,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No personal notifications"})]}):e.jsx($,{className:"h-64",children:l.map(u=>e.jsx(D,{notification:u,onMarkAsRead:x,onDelete:I,onNavigate:T,isGeneral:!1,isAuthenticated:f},u.id))})}),e.jsx(z,{value:"general",className:"p-4",children:i.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ze,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No general notifications"})]}):e.jsx($,{className:"h-64",children:i.map(u=>e.jsx(D,{notification:u,onMarkAsRead:x,onDelete:I,onNavigate:T,isGeneral:!0,isAuthenticated:f},u.id))})})]})]})]}):null});ct.displayName="NotificationBell";const dt=d.memo(({notifications:t=0,className:r="",variant:s="ghost",size:a="sm",onClick:n})=>{const{user:o}=Y(),i=ee(),l=()=>{n?n():i(o?"/notifications":"/signin")},c=o&&t>0;return e.jsxs(v,{variant:s,size:a,className:`relative ${r}`,onClick:l,children:[e.jsx(L,{className:"h-4 w-4"}),c&&e.jsx(G,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:t>99?"99+":t})]})});dt.displayName="NotificationButton";function _t(t){return E(this,null,function*(){try{const{data:r,error:s}=yield Ee.from(t).select("*").limit(1);return s?s.message.includes("relation")&&s.message.includes("does not exist")?{exists:!1,error:s.message}:{exists:!0,error:s.message}:{exists:!0}}catch(r){return{exists:!1,error:r.message}}})}function wt(){return{campaigns:[],referralCode:null,socialShares:[],promotionalCodes:[]}}function Pt(){return{location_radius_km:50,location_notifications:!0,email_notifications:!0,push_notifications:!0,theme:"light",language:"en",timezone:"UTC",category:"general"}}export{ct as N,it as P,dt as a,lt as b,me as c,_t as d,wt as e,Pt as f};
