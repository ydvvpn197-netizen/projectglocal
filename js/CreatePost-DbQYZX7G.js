var K=Object.defineProperty,X=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var H=(n,d,o)=>d in n?K(n,d,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[d]=o,B=(n,d)=>{for(var o in d||(d={}))Q.call(d,o)&&H(n,o,d[o]);if(U)for(var o of U(d))Z.call(d,o)&&H(n,o,d[o]);return n},R=(n,d)=>X(n,J(d));var w=(n,d,o)=>new Promise((y,a)=>{var p=x=>{try{v(o.next(x))}catch(N){a(N)}},m=x=>{try{v(o.throw(x))}catch(N){a(N)}},v=x=>x.done?y(x.value):Promise.resolve(x.value).then(p,m);v((o=o.apply(n,d)).next())});import{r as f,u as $,g as ee,s as S,f as se,j as e,ae as te,C as T,p as _,q as E,t as P,v as D,B as b,X as ie}from"./main-B2Z1A0fl.js";import{I as h}from"./index-yZSPA8A-.js";import{L as r}from"./label-naFpKG2V.js";import{T as C}from"./textarea-DgIPQeWX.js";import{S as k,a as q,b as L,c as A,d as s}from"./select-BMFlvWAC.js";import{S as re}from"./switch-CXwgEgoS.js";import{B as ae}from"./badge-CdNeXDip.js";import{T as le,a as ce,b as M,c as O}from"./tabs-WXu0DGF3.js";import{R as ne}from"./ResponsiveLayout-CYnOsYqc.js";import{u as oe}from"./useEvents-4C-ORCiD.js";import{s as g,b as de}from"./sanitize-D3jFosXZ.js";import{M as W}from"./map-pin-CZucSvvB.js";import{P as me}from"./plus-B4gpjJdq.js";import{C as he}from"./calendar-Cawp_lnB.js";import{C as ue}from"./clock-DJLknj0F.js";import{D as Y}from"./dollar-sign-h3mQyYN-.js";import{U as pe}from"./alert-DX9hSffn.js";import{T as xe}from"./tag-DwIldzkq.js";import"./index-DJ86sh13.js";import"./index-DENeMT3x.js";import"./chevron-up-CetLqit9.js";import"./check-DuTiAf7C.js";import"./separator-DjSuCMYj.js";import"./index-oNALVX6M.js";import"./databaseUtils-EE95jGy-.js";import"./scroll-area-BhRuPQbm.js";import"./index-BccyXWdq.js";import"./useNotifications-BC0Dj2vc.js";import"./notificationService-BphN-zZk.js";import"./bell-BrPt3aXG.js";import"./user-etsi-1kT.js";import"./search-DJSs7YT2.js";import"./zap-BDCYOuKc.js";import"./message-square-B_GUjDSs.js";import"./wifi-BixKGM4R.js";import"./log-out-wiSeNNbg.js";import"./useLocation-legApM8g.js";import"./locationService-DtReVENb.js";import"./pointsService-8dRo0Ufj.js";const ve=()=>{const[n,d]=f.useState([]),[o,y]=f.useState(!0),{user:a}=$(),{toast:p}=ee(),m=f.useCallback(()=>w(void 0,null,function*(){if(!a){console.log("No user found, skipping fetchPosts"),y(!1);return}console.log("Fetching posts for user:",a.id),console.log("User session:",a);try{console.log("Attempting direct query to posts table...");const{data:l,error:t}=yield S.from("posts").select(`
          *,
          profiles:user_id (
            display_name,
            username,
            avatar_url
          )
        `).order("created_at",{ascending:!1});if(t)throw console.error("Direct query failed:",t),t;console.log("Direct query successful, posts found:",(l==null?void 0:l.length)||0);const u=(l==null?void 0:l.map(j=>R(B({},j),{contact_info:j.user_id===(a==null?void 0:a.id)?j.contact_info:null})))||[];d(u)}catch(l){const t=l instanceof Error?l.message:"Failed to load posts";console.error("Error fetching posts:",l),p({title:"Error loading posts",description:t,variant:"destructive"})}finally{y(!1)}}),[a,p]),v=l=>w(void 0,null,function*(){if(!a)return{error:new Error("Not authenticated")};try{const{data:t,error:u}=yield S.from("posts").insert(R(B({},l),{user_id:a.id,type:l.type})).select().single();if(u)throw u;return p({title:"Post created",description:"Your post has been shared with the community."}),m(),{data:t,error:null}}catch(t){const u=t instanceof Error?t.message:"Failed to create post";return p({title:"Error creating post",description:u,variant:"destructive"}),{error:t}}}),x=l=>w(void 0,null,function*(){if(a)try{const{data:t}=yield S.from("likes").select("id").eq("post_id",l).eq("user_id",a.id).maybeSingle();t?yield S.from("likes").delete().eq("post_id",l).eq("user_id",a.id):yield S.from("likes").insert({post_id:l,user_id:a.id}),m()}catch(t){const u=t instanceof Error?t.message:"Failed to update like";p({title:"Error updating like",description:u,variant:"destructive"})}}),N=l=>w(void 0,null,function*(){if(!a)return{error:new Error("Not authenticated")};try{const{error:t}=yield S.from("posts").delete().eq("id",l).eq("user_id",a.id);if(t)throw t;return p({title:"Post deleted",description:"Your post has been deleted successfully."}),m(),{error:null}}catch(t){const u=t instanceof Error?t.message:"Failed to delete post";return p({title:"Error deleting post",description:u,variant:"destructive"}),{error:t}}});return f.useEffect(()=>{a&&m()},[a,m]),{posts:n,loading:o,createPost:v,toggleLike:x,deletePost:N,refetch:m}},is=()=>{const[n,d]=f.useState([]),[o,y]=f.useState(""),[a,p]=f.useState(!1),[m,v]=f.useState(!1),{createPost:x}=ve(),{createEvent:N}=oe(),l=se(),t=()=>{const i=g(o,50);i&&!n.includes(i)&&(d([...n,i]),y(""))},u=i=>{d(n.filter(F=>F!==i))},j=(i,F)=>w(void 0,null,function*(){i.preventDefault();const G=i.target,c=new FormData(G);v(!0);try{if(F==="event"){const z={title:g(c.get("title")||"",200),description:g(c.get("content")||"",5e3),event_date:c.get("event_date"),event_time:c.get("event_time"),location_name:g(c.get("location_name")||"",500),category:c.get("category")||void 0,max_attendees:c.get("max_attendees")?parseInt(c.get("max_attendees")):void 0,price:c.get("price")?parseFloat(c.get("price")):0,image_url:c.get("image_url")||void 0,tags:c.get("tags")?c.get("tags").split(",").map(V=>V.trim()):void 0};(yield N(z))&&l("/events")}else{const z={type:F,title:g(c.get("title")||"",200),content:g(c.get("content")||"",5e3),event_date:c.get("eventDate")?new Date(c.get("eventDate")).toISOString():void 0,event_location:g(c.get("eventLocation")||c.get("serviceArea")||"",500),price_range:g(c.get("eventPrice")||c.get("servicePrice")||"",100),tags:n.length>0?de(n):void 0},{error:I}=yield x(z);I||l("/feed")}}finally{v(!1)}});return e.jsx(te,{children:e.jsx(ne,{children:e.jsxs("div",{className:"container max-w-3xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Create New Post"}),e.jsx("p",{className:"text-muted-foreground",children:"Share with your local community"})]}),e.jsxs(le,{defaultValue:"post",className:"space-y-6",children:[e.jsxs(ce,{className:"grid w-full grid-cols-4",children:[e.jsx(M,{value:"post",children:"Post"}),e.jsx(M,{value:"event",children:"Event"}),e.jsx(M,{value:"service",children:"Service"}),e.jsx(M,{value:"discussion",children:"Discussion"})]}),e.jsx(O,{value:"post",children:e.jsxs(T,{children:[e.jsxs(_,{children:[e.jsx(E,{children:"Share Your Thoughts"}),e.jsx(P,{children:"Post updates, photos, or thoughts with your local community"})]}),e.jsx(D,{className:"space-y-6",children:e.jsxs("form",{onSubmit:i=>j(i,"post"),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"post-title",children:"Title"}),e.jsx(h,{id:"post-title",name:"title",placeholder:"What's on your mind?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"post-content",children:"Content"}),e.jsx(C,{id:"post-content",name:"content",placeholder:"Share your thoughts, experiences, or updates...",className:"min-h-32",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"post-location",children:"Location (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"post-location",placeholder:"Add a location",className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{value:o,onChange:i=>y(i.target.value),placeholder:"Add a tag",onKeyPress:i=>i.key==="Enter"&&(i.preventDefault(),t())}),e.jsx(b,{onClick:t,size:"icon",variant:"outline",children:e.jsx(me,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(i=>e.jsxs(ae,{variant:"secondary",className:"gap-1",children:[i,e.jsx("button",{onClick:()=>u(i),children:e.jsx(ie,{className:"h-3 w-3"})})]},i))})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{children:"Privacy Setting"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?"Only followers can see this post":"Public to local community"})]}),e.jsx(re,{checked:a,onCheckedChange:p})]}),e.jsx(b,{className:"w-full",size:"lg",type:"submit",disabled:m,children:m?"Creating...":"Share Post"})]})})]})}),e.jsx(O,{value:"event",children:e.jsxs(T,{children:[e.jsxs(_,{children:[e.jsx(E,{children:"Create Event"}),e.jsx(P,{children:"Organize local events and gatherings"})]}),e.jsx(D,{className:"space-y-6",children:e.jsxs("form",{onSubmit:i=>j(i,"event"),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"event-title",children:"Event Title *"}),e.jsx(h,{id:"event-title",name:"title",placeholder:"Enter event title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"event-category",children:"Category"}),e.jsxs(k,{name:"category",children:[e.jsx(q,{children:e.jsx(L,{placeholder:"Select category"})}),e.jsxs(A,{children:[e.jsx(s,{value:"Art & Culture",children:"Art & Culture"}),e.jsx(s,{value:"Music",children:"Music"}),e.jsx(s,{value:"Food & Drink",children:"Food & Drink"}),e.jsx(s,{value:"Sports & Fitness",children:"Sports & Fitness"}),e.jsx(s,{value:"Technology",children:"Technology"}),e.jsx(s,{value:"Business",children:"Business"}),e.jsx(s,{value:"Education",children:"Education"}),e.jsx(s,{value:"Health & Wellness",children:"Health & Wellness"}),e.jsx(s,{value:"Community",children:"Community"}),e.jsx(s,{value:"Entertainment",children:"Entertainment"}),e.jsx(s,{value:"Other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"event-description",children:"Description"}),e.jsx(C,{id:"event-description",name:"content",placeholder:"Describe your event...",className:"min-h-24",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"event-date",className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Date *"]}),e.jsx(h,{id:"event-date",name:"event_date",type:"date",min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"event-time",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Time *"]}),e.jsx(h,{id:"event-time",name:"event_time",type:"time",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"event-location",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Location *"]}),e.jsx(h,{id:"event-location",name:"location_name",placeholder:"Event venue or address",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"event-price",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Price (USD)"]}),e.jsx(h,{id:"event-price",name:"price",placeholder:"0 for free events",type:"number",min:"0",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"event-capacity",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Max Attendees"]}),e.jsx(h,{id:"event-capacity",name:"max_attendees",placeholder:"Optional",type:"number",min:"1"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"event-image",children:"Image URL"}),e.jsx(h,{id:"event-image",name:"image_url",type:"url",placeholder:"Optional event image"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"event-tags",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Tags"]}),e.jsx(h,{id:"event-tags",name:"tags",placeholder:"photography, outdoor, beginner (comma separated)"})]})]}),e.jsx(b,{className:"w-full",size:"lg",type:"submit",disabled:m,children:m?"Creating...":"Create Event"})]})})]})}),e.jsx(O,{value:"service",children:e.jsxs(T,{children:[e.jsxs(_,{children:[e.jsx(E,{children:"Offer a Service"}),e.jsx(P,{children:"Share your skills and services with the local community"})]}),e.jsx(D,{className:"space-y-6",children:e.jsxs("form",{onSubmit:i=>j(i,"service"),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"service-title",children:"Service Title"}),e.jsx(h,{id:"service-title",name:"title",placeholder:"What service do you offer?",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"service-category",children:"Category"}),e.jsxs(k,{children:[e.jsx(q,{children:e.jsx(L,{placeholder:"Select category"})}),e.jsxs(A,{children:[e.jsx(s,{value:"photography",children:"Photography"}),e.jsx(s,{value:"music",children:"Music & Performance"}),e.jsx(s,{value:"design",children:"Design & Art"}),e.jsx(s,{value:"fitness",children:"Fitness & Wellness"}),e.jsx(s,{value:"education",children:"Education & Tutoring"}),e.jsx(s,{value:"handyman",children:"Home & Repair"}),e.jsx(s,{value:"beauty",children:"Beauty & Style"}),e.jsx(s,{value:"tech",children:"Technology"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"service-description",children:"Description"}),e.jsx(C,{id:"service-description",name:"content",placeholder:"Describe your service, experience, and what you offer...",className:"min-h-24",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"service-price",children:"Price Range"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"service-price",name:"servicePrice",placeholder:"50 - 150",className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"service-availability",children:"Availability"}),e.jsxs(k,{children:[e.jsx(q,{children:e.jsx(L,{placeholder:"Select availability"})}),e.jsxs(A,{children:[e.jsx(s,{value:"immediate",children:"Available Now"}),e.jsx(s,{value:"this-week",children:"This Week"}),e.jsx(s,{value:"this-month",children:"This Month"}),e.jsx(s,{value:"flexible",children:"Flexible"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"service-area",children:"Service Area"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"service-area",name:"serviceArea",placeholder:"Within 15km of current location",className:"pl-10"})]})]}),e.jsx(b,{className:"w-full",size:"lg",type:"submit",disabled:m,children:m?"Creating...":"List Service"})]})})]})}),e.jsx(O,{value:"discussion",children:e.jsxs(T,{children:[e.jsxs(_,{children:[e.jsx(E,{children:"Start a Discussion"}),e.jsx(P,{children:"Create a topic for community discussion and engagement"})]}),e.jsx(D,{className:"space-y-6",children:e.jsxs("form",{onSubmit:i=>j(i,"discussion"),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"discussion-title",children:"Discussion Topic"}),e.jsx(h,{id:"discussion-title",name:"title",placeholder:"What would you like to discuss?",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"discussion-category",children:"Category"}),e.jsxs(k,{children:[e.jsx(q,{children:e.jsx(L,{placeholder:"Select category"})}),e.jsxs(A,{children:[e.jsx(s,{value:"general",children:"General Discussion"}),e.jsx(s,{value:"local-news",children:"Local News"}),e.jsx(s,{value:"recommendations",children:"Recommendations"}),e.jsx(s,{value:"events",children:"Community Events"}),e.jsx(s,{value:"safety",children:"Safety & Security"}),e.jsx(s,{value:"environment",children:"Environment"}),e.jsx(s,{value:"business",children:"Local Business"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"discussion-content",children:"Discussion Starter"}),e.jsx(C,{id:"discussion-content",name:"content",placeholder:"Share your thoughts, ask questions, or provide context for the discussion...",className:"min-h-32",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"discussion-rules",children:"Discussion Guidelines (Optional)"}),e.jsx(C,{id:"discussion-rules",placeholder:"Set any specific guidelines or rules for this discussion...",className:"min-h-20"})]}),e.jsx(b,{className:"w-full",size:"lg",type:"submit",disabled:m,children:m?"Creating...":"Start Discussion"})]})})]})})]})]})})})};export{is as default};
