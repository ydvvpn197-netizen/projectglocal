var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,o,n)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,l=(e,t)=>{for(var o in t||(t={}))a.call(t,o)&&i(e,o,t[o]);if(n)for(var o of n(t))r.call(t,o)&&i(e,o,t[o]);return e},c=(e,n)=>t(e,o(n)),s=(e,t,o)=>new Promise((n,a)=>{var r=e=>{try{l(o.next(e))}catch(t){a(t)}},i=e=>{try{l(o.throw(e))}catch(t){a(t)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,i);l((o=o.apply(e,t)).next())});import{u as d,d as u,r as g}from"./main-u5iDOJMZ.js";import{L as b}from"./locationService-DDZ4T3aM.js";const p=()=>{const{user:e}=d(),{toast:t}=u(),[o,n]=g.useState({currentLocation:null,isEnabled:!1,isLoading:!1,error:null,lastUpdated:null});g.useEffect(()=>{(()=>{s(void 0,null,function*(){if(e)try{const e=yield b.getCurrentUserLocation(),t=yield b.getLocationSettings();n(e?o=>c(l({},o),{isEnabled:t.enabled,currentLocation:{latitude:e.lat,longitude:e.lng},lastUpdated:new Date}):e=>c(l({},e),{isEnabled:t.enabled,currentLocation:null}))}catch(t){}})})()},[e]);const a=g.useCallback(()=>new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy})},e=>{t(new Error(`Location error: ${e.message}`))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5}):t(new Error("Geolocation is not supported by this browser"))}),[]),r=g.useCallback(t=>s(void 0,null,function*(){if(e)try{const e={lat:t.latitude,lng:t.longitude};yield b.setManualLocation(e)}catch(o){throw o}}),[e]),i=g.useCallback(()=>s(void 0,null,function*(){if(e){n(e=>c(l({},e),{isLoading:!0,error:null}));try{if(!o.isEnabled){const e=yield a();e.latitude,e.longitude;yield b.detectAndSaveLocation(),n(t=>c(l({},t),{isEnabled:!0,currentLocation:e,lastUpdated:new Date,isLoading:!1})),t({title:"Location sharing enabled",description:"Your location will be used to show relevant local content."})}else yield b.toggleLocationServices(!1),n(e=>c(l({},e),{isEnabled:!1,currentLocation:null,lastUpdated:null,isLoading:!1})),t({title:"Location sharing disabled",description:"Location data has been cleared."})}catch(r){const e=r instanceof Error?r.message:"Unknown error";n(t=>c(l({},t),{error:e,isLoading:!1})),t({title:"Location error",description:e,variant:"destructive"})}}}),[e,o.isEnabled,a,t]),p=g.useCallback(()=>s(void 0,null,function*(){if(e&&o.isEnabled){n(e=>c(l({},e),{isLoading:!0,error:null}));try{const e=yield a();yield r(e),n(t=>c(l({},t),{currentLocation:e,lastUpdated:new Date,isLoading:!1})),t({title:"Location updated",description:"Your current location has been refreshed."})}catch(i){const e=i instanceof Error?i.message:"Location update failed";n(t=>c(l({},t),{error:e,isLoading:!1})),t({title:"Location update failed",description:e,variant:"destructive"})}}}),[e,o.isEnabled,a,r,t]);return g.useEffect(()=>{if(!o.isEnabled)return;const e=setInterval(()=>{p()},9e5);return()=>clearInterval(e)},[o.isEnabled,p]),c(l({},o),{toggleLocationSharing:i,updateCurrentLocation:p})};export{p as u};
