var e=(e,s,a)=>new Promise((t,i)=>{var r=e=>{try{n(a.next(e))}catch(s){i(s)}},l=e=>{try{n(a.throw(e))}catch(s){i(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,l);n((a=a.apply(e,s)).next())});import{r as s,j as a,B as t,b as i,u as r,d as l,L as n}from"./index-B5IYdG7F.js";import{S as o,R as c}from"./ResponsiveLayout-BzUw0buI.js";import{I as m}from"./input-C4_QhDnm.js";import{C as d,d as x,a as h,b as u,c as j}from"./card-Bm1jiGt-.js";import{B as p}from"./badge-Dh5Uj8vN.js";import{S as g,a as N,b as f,c as v,d as b}from"./select-DME_qdt9.js";import{A as y,a as w,b as C,i as _,P as k}from"./sheet-CgDUfSpi.js";import{u as S,T as P,a as L,M as T}from"./usePoints-CMVXcg0x.js";import{T as A}from"./trending-up-B5v9qFws.js";import{Z as F}from"./zap-DPSXpNso.js";import{U as M}from"./users-Dh-Bdb-k.js";import"./label-BIAuZBUP.js";import"./textarea-DnhiZrYB.js";import"./tabs-DPPBWbFC.js";import{u as J}from"./useCommunityGroups-Ba-CfyX8.js";import{u as z}from"./useLocation-BN9qq_uk.js";import{C as $}from"./communityService-ebNKPOD3.js";import{L as G}from"./loader-2-DMKXv0ZB.js";import{M as I}from"./more-horizontal-h1dCe7B5.js";import{M as U}from"./message-circle-CZlRU4gv.js";import{S as D}from"./search-Co_OHmlK.js";import{G as E,L as R}from"./list-D73zimS9.js";import{M as B}from"./map-pin-BwnggLrZ.js";import{C as V}from"./index-DD_J5sPn.js";import"./separator-BZYZTYLW.js";import"./NotificationBell-DtnEojo4.js";import"./Combination-BxRIZ8rt.js";import"./scroll-area-Beiyt5Kx.js";import"./index-9msbY5CZ.js";import"./index-jVOyRz7F.js";import"./useNotifications-C0wifgqF.js";import"./check-C9wwFfOs.js";import"./bell-qeMkXRtc.js";import"./settings-DSEWn2wM.js";import"./user-UOowhO7W.js";import"./index-DWtoKlrM.js";import"./NotificationButton-CqXjP_LK.js";import"./message-square-j4RxGxzk.js";import"./alert-CQybxmNr.js";import"./log-out-DchhrZ8K.js";import"./index-_KG4atBu.js";import"./chevron-up-DvjQ7ry8.js";import"./pointsService-D9LdhHSC.js";import"./locationService-BBE-Ay-I.js";const q=[{value:"5",label:"Top 5"},{value:"20",label:"Top 20"},{value:"50",label:"Top 50"},{value:"100",label:"Top 100"},{value:"1000",label:"Top 1000"}],H=e=>{switch(e){case 1:return a.jsx(P,{className:"w-5 h-5 text-yellow-500"});case 2:return a.jsx(T,{className:"w-5 h-5 text-gray-400"});case 3:return a.jsx(T,{className:"w-5 h-5 text-amber-600"});default:return a.jsx(_,{className:"w-4 h-4 text-blue-500"})}},K=e=>{switch(e){case 1:return"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white";case 2:return"bg-gradient-to-r from-gray-300 to-gray-500 text-white";case 3:return"bg-gradient-to-r from-amber-500 to-amber-700 text-white";default:return"bg-blue-100 text-blue-800"}},O=e=>e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString(),W=({className:e="",showTitle:i=!0,defaultLimit:r=5,showFilters:l=!0,showUserPosition:n=!0})=>{const{leaderboard:c,leaderboardLoading:m,leaderboardError:_,userPoints:k,refreshLeaderboard:T}=S(),[J,z]=s.useState(r.toString()),[$,G]=s.useState(!1);s.useEffect(()=>{T(parseInt(J))},[J,T]);const I=$?c:c.slice(0,5);return _?a.jsx(d,{className:`community-leaderboard ${e}`,children:a.jsx(x,{className:"p-6",children:a.jsxs("div",{className:"text-center text-red-500",children:[a.jsx(A,{className:"w-8 h-8 mx-auto mb-2"}),a.jsx("p",{children:"Failed to load leaderboard"}),a.jsx(t,{variant:"outline",size:"sm",onClick:()=>T(parseInt(J)),className:"mt-2",children:"Try Again"})]})})}):a.jsxs(d,{className:`community-leaderboard ${e}`,children:[a.jsx(h,{className:"pb-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"p-2 bg-gradient-to-r from-orange-500 to-red-500 rounded-lg",children:a.jsx(P,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx(u,{className:"text-lg",children:"Community Leaderboard"}),a.jsx(j,{children:"Top contributors this month"})]})]}),l&&a.jsxs(g,{value:J,onValueChange:e=>{z(e)},children:[a.jsx(N,{className:"w-32",children:a.jsx(f,{})}),a.jsx(v,{children:q.map(e=>a.jsx(b,{value:e.value,children:e.label},e.value))})]})]})}),a.jsx(x,{className:"space-y-4",children:m?a.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,s)=>a.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border",children:[a.jsx(o,{className:"w-8 h-8 rounded-full"}),a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsx(o,{className:"h-4 w-32"}),a.jsx(o,{className:"h-3 w-20"})]}),a.jsx(o,{className:"w-16 h-6"})]},s))}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"space-y-2",children:I.map((e,s)=>{var t,i;return a.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border transition-all duration-200 hover:shadow-md "+(s<3?"bg-gradient-to-r from-orange-50 to-red-50 border-orange-200":"hover:bg-gray-50"),children:[a.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:H(e.rank)}),a.jsxs(y,{className:"w-10 h-10",children:[a.jsx(w,{src:e.avatar_url||"",alt:e.display_name||"User"}),a.jsx(C,{className:"bg-gradient-to-r from-orange-400 to-red-400 text-white font-semibold",children:(null==(i=null==(t=e.display_name)?void 0:t.charAt(0))?void 0:i.toUpperCase())||"U"})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:e.display_name||"Anonymous User"}),s<3&&a.jsxs(p,{className:`text-xs ${K(e.rank)}`,children:["#",e.rank]})]}),a.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[a.jsx(F,{className:"w-3 h-3"}),a.jsxs("span",{children:[O(e.total_points)," points"]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"font-bold text-lg text-orange-600",children:O(e.total_points)}),a.jsx("div",{className:"text-xs text-muted-foreground",children:"points"})]})]},e.user_id)})}),c.length>5&&a.jsx("div",{className:"text-center pt-2",children:a.jsx(t,{variant:"outline",size:"sm",onClick:()=>{G(!$)},className:"text-orange-600 border-orange-200 hover:bg-orange-50",children:$?"Show Less":`Show More (${c.length-5} more)`})}),n&&k&&a.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:a.jsx(L,{className:"w-4 h-4 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-sm text-blue-900",children:"Your Position"}),a.jsxs("p",{className:"text-xs text-blue-700",children:["Rank #",k.rank]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"font-bold text-lg text-blue-600",children:O(k.total_points)}),a.jsx("div",{className:"text-xs text-blue-700",children:"your points"})]})]})}),!m&&0===c.length&&a.jsxs("div",{className:"text-center py-8",children:[a.jsx(M,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),a.jsx("p",{className:"text-gray-500",children:"No leaderboard data available"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Start engaging to earn points!"})]})]})})]})},Y=["All Categories","Arts & Culture","Technology","Food & Dining","Outdoors","Education","Business","Health & Wellness","Sports","Music","Photography","General"],Z=()=>{const o=i(),{groups:h,loading:u,fetchGroups:j,joinGroup:y}=J();z();const{user:w}=r(),{toast:C}=l(),[S,P]=s.useState(""),[L,T]=s.useState("All Categories"),[A,F]=s.useState("grid"),[q,H]=s.useState("recent"),[K,O]=s.useState(null);s.useEffect(()=>{(()=>{e(void 0,null,function*(){try{yield j()}catch(e){C({title:"Error",description:"Failed to load communities. Please try again.",variant:"destructive"})}})})()},[j,C]);const Z=[...h.filter(e=>{const s=e.name.toLowerCase().includes(S.toLowerCase())||e.description&&e.description.toLowerCase().includes(S.toLowerCase()),a="All Categories"===L||e.category===L;return s&&a})].sort((e,s)=>{switch(q){case"members":return(s.member_count||0)-(e.member_count||0);case"recent":return new Date(s.created_at).getTime()-new Date(e.created_at).getTime();case"activity":return(s.post_count||0)-(e.post_count||0);default:return 0}}),Q=h.filter(e=>(e.member_count||0)>10),X=s=>e(void 0,null,function*(){if(w){if(K!==s)try{O(s);const e=yield $.validateGroupForJoining(s,w.id);if(!e.isValid)return void C({title:"Cannot Join Community",description:e.errors.join(", "),variant:"destructive"});(yield y(s))&&(yield j())}catch(e){let s="Failed to join community. Please try again.";(null==e?void 0:e.message)&&(s=e.message.includes("Group not found")?"This community no longer exists.":e.message.includes("Invalid group or user ID")?"Invalid community or user information.":e.message.includes("Cannot join private group")?"This is a private community.":e.message.includes("already a member")?"You are already a member of this community.":e.message),C({title:"Error",description:s,variant:"destructive"})}finally{O(null)}}else C({title:"Authentication Required",description:"Please log in to join communities",variant:"destructive"})});return u?a.jsx(c,{children:a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(G,{className:"h-6 w-6 animate-spin"}),a.jsx("span",{children:"Loading communities..."})]})})}):a.jsx(c,{children:a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"Communities"}),a.jsx("p",{className:"text-muted-foreground mt-2",children:"Discover and join communities that match your interests"})]}),a.jsx(t,{className:"btn-community",asChild:!0,children:a.jsxs(n,{to:"/community/create-group",onClick:()=>{j()},children:[a.jsx(k,{className:"w-4 h-4 mr-2"}),"Create Community"]})})]}),a.jsx("section",{className:"space-y-4",children:a.jsx(W,{className:"mb-8",showTitle:!0,defaultLimit:5,showFilters:!0,showUserPosition:!0})}),!1,Q.length>0&&a.jsxs("section",{className:"space-y-4",children:[a.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[a.jsx(_,{className:"w-5 h-5 text-yellow-500"}),"Featured Communities"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Q.map(e=>a.jsxs(d,{className:"community-card-featured group cursor-pointer hover:shadow-community transition-all duration-300",onClick:()=>o(`/community/${e.id}`),children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-blue-500 to-purple-600 rounded-t-lg flex items-center justify-center",children:a.jsx(M,{className:"w-16 h-16 text-white opacity-80"})}),a.jsx("div",{className:"absolute top-3 right-3 flex gap-2",children:a.jsxs(p,{className:"bg-yellow-500 text-white",children:[a.jsx(_,{className:"w-3 h-3 mr-1"}),"Featured"]})})]}),a.jsxs(x,{className:"p-4",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("h3",{className:"font-semibold text-lg",children:e.name}),a.jsx(t,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>{e.stopPropagation()},children:a.jsx(I,{className:"w-4 h-4"})})]}),a.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.description||"No description available"}),a.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(M,{className:"w-4 h-4"}),e.member_count||0," members"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(U,{className:"w-4 h-4"}),e.post_count||0," posts"]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(p,{variant:"secondary",className:"text-xs",children:["#",e.category]}),a.jsxs(t,{className:"w-full btn-community",onClick:s=>{s.stopPropagation(),X(e.id)},disabled:K===e.id,children:[K===e.id?a.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}):a.jsx(M,{className:"w-4 h-4 mr-2"}),K===e.id?"Joining...":"Join Community"]})]})]})]},e.id))})]}),a.jsx("section",{className:"space-y-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),a.jsx(m,{placeholder:"Search communities...",value:S,onChange:e=>P(e.target.value),className:"pl-10"})]})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(g,{value:L,onValueChange:T,children:[a.jsx(N,{className:"w-[180px]",children:a.jsx(f,{})}),a.jsx(v,{children:Y.map(e=>a.jsx(b,{value:e,children:e},e))})]}),a.jsxs(g,{value:q,onValueChange:H,children:[a.jsx(N,{className:"w-[140px]",children:a.jsx(f,{})}),a.jsxs(v,{children:[a.jsx(b,{value:"recent",children:"Most Recent"}),a.jsx(b,{value:"members",children:"Most Members"}),a.jsx(b,{value:"activity",children:"Most Active"})]})]}),a.jsxs("div",{className:"flex border rounded-md",children:[a.jsx(t,{variant:"grid"===A?"default":"ghost",size:"sm",onClick:()=>F("grid"),className:"rounded-r-none",children:a.jsx(E,{className:"w-4 h-4"})}),a.jsx(t,{variant:"list"===A?"default":"ghost",size:"sm",onClick:()=>F("list"),className:"rounded-l-none",children:a.jsx(R,{className:"w-4 h-4"})})]})]})]})}),a.jsxs("section",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"All Communities"}),a.jsxs("div",{className:"text-sm text-muted-foreground",children:[Z.length," communities found"]})]}),"grid"===A?a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Z.map(e=>a.jsxs(d,{className:"community-card group cursor-pointer hover:shadow-community transition-all duration-300",onClick:()=>o(`/community/${e.id}`),children:[a.jsx("div",{className:"relative",children:a.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-blue-500 to-purple-600 rounded-t-lg flex items-center justify-center",children:a.jsx(M,{className:"w-16 h-16 text-white opacity-80"})})}),a.jsxs(x,{className:"p-4",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("h3",{className:"font-semibold text-lg",children:e.name}),a.jsx(t,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>{e.stopPropagation()},children:a.jsx(I,{className:"w-4 h-4"})})]}),a.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.description||"No description available"}),a.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(M,{className:"w-4 h-4"}),e.member_count||0," members"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(U,{className:"w-4 h-4"}),e.post_count||0," posts"]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(p,{variant:"secondary",className:"text-xs",children:["#",e.category]}),a.jsxs(t,{className:"w-full btn-community",onClick:s=>{s.stopPropagation(),X(e.id)},disabled:K===e.id,children:[K===e.id?a.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}):a.jsx(M,{className:"w-4 h-4 mr-2"}),K===e.id?"Joining...":"Join Community"]})]})]})]},e.id))}):a.jsx("div",{className:"space-y-4",children:Z.map(e=>a.jsx(d,{className:"community-card group cursor-pointer hover:shadow-community transition-all duration-300",onClick:()=>o(`/community/${e.id}`),children:a.jsx(x,{className:"p-6",children:a.jsxs("div",{className:"flex gap-6",children:[a.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:a.jsx(M,{className:"w-12 h-12 text-white opacity-80"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg flex items-center gap-2",children:e.name}),a.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:e.description||"No description available"})]}),a.jsx(t,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>{e.stopPropagation()},children:a.jsx(I,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"flex items-center gap-6 text-sm text-muted-foreground mb-3",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(M,{className:"w-4 h-4"}),e.member_count||0," members"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(U,{className:"w-4 h-4"}),e.post_count||0," posts"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(B,{className:"w-4 h-4"}),e.location_city||"Local"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(V,{className:"w-4 h-4"}),new Date(e.created_at).toLocaleDateString()]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex gap-2",children:a.jsxs(p,{variant:"secondary",className:"text-xs",children:["#",e.category]})}),a.jsxs(t,{className:"btn-community",onClick:s=>{s.stopPropagation(),X(e.id)},disabled:K===e.id,children:[K===e.id?a.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}):a.jsx(M,{className:"w-4 h-4 mr-2"}),K===e.id?"Joining...":"Join Community"]})]})]})]})})},e.id))})]}),0===Z.length&&a.jsx(d,{className:"text-center py-12",children:a.jsxs(x,{children:[a.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(D,{className:"w-8 h-8 text-muted-foreground"})}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No communities found"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your search criteria or create a new community"}),a.jsx(t,{className:"btn-community",asChild:!0,children:a.jsxs(n,{to:"/community/create-group",children:[a.jsx(k,{className:"w-4 h-4 mr-2"}),"Create Community"]})})]})})]})})};export{Z as default};
