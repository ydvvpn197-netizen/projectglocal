var w=(n,o,i)=>new Promise((s,d)=>{var l=a=>{try{m(i.next(a))}catch(x){d(x)}},g=a=>{try{m(i.throw(a))}catch(x){d(x)}},m=a=>a.done?s(a.value):Promise.resolve(a.value).then(l,g);m((i=i.apply(n,o)).next())});import{u as A,g as q,f as B,r as D,j as e,C as j,p,q as u,t as k,G as R,v as T,B as v,s as N}from"./main-B2Z1A0fl.js";import{C as S}from"./chatService-ChjNDZXa.js";import{M as b}from"./message-circle-_vsuaFG3.js";import{X as L}from"./x-circle-B1e_uF_b.js";import{C as h}from"./check-circle-DcEt0i5B.js";const G=()=>{const{user:n}=A(),{toast:o}=q(),i=B(),[s,d]=D.useState(null),[l,g]=D.useState(!1),m=()=>w(void 0,null,function*(){if(!(n!=null&&n.id)){o({title:"Authentication Required",description:"Please log in to run debug test",variant:"destructive"});return}g(!0);const t={};try{const{data:r,error:f}=yield N.from("artist_bookings").select("*").eq("user_id",n.id).eq("status","accepted");if(t.bookings=r,t.bookingsError=f,f||!r||r.length===0){t.error="No accepted bookings found",d(t),g(!1);return}const C=r[0];t.testBooking=C;const c=yield S.getOrCreateConversationForBooking(C.id);if(t.conversationId=c,c){const{data:I,error:_}=yield N.from("chat_conversations").select("*").eq("id",c).single();t.conversation=I,t.conversationError=_;const{data:E,error:y}=yield N.from("chat_messages").select("*").eq("conversation_id",c).order("created_at",{ascending:!0});t.messages=E,t.messagesError=y}t.navigationTest={canNavigate:!!c,targetUrl:c?`/chat/${c}`:null}}catch(r){t.error=r instanceof Error?r.message:"Unknown error"}d(t),g(!1)}),a=()=>{s!=null&&s.conversationId&&(i(`/chat/${s.conversationId}`),o({title:"Navigation Test",description:"Attempting to navigate to chat..."}))},x=()=>{i("/chat/9fd226c7-f2f3-48f9-b910-79b065fbdec9"),o({title:"Direct Chat Test",description:"Attempting direct navigation to known conversation..."})};return n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(j,{children:[e.jsxs(p,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Chat Debug Test"]}),e.jsx(k,{children:"Comprehensive debugging of the chat system"})]}),e.jsx(T,{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:m,disabled:l,className:"flex items-center gap-2",children:[l?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(b,{className:"h-4 w-4"}),l?"Running Debug...":"Run Debug Test"]}),(s==null?void 0:s.conversationId)&&e.jsxs(v,{onClick:a,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),"Test Navigation"]}),e.jsxs(v,{onClick:x,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),"Test Direct Chat"]})]})})]}),s&&e.jsxs(j,{children:[e.jsx(p,{children:e.jsx(u,{children:"Debug Results"})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[s.error&&e.jsxs("div",{className:"p-3 bg-red-100 border border-red-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"font-medium text-red-800",children:"Error:"})]}),e.jsx("p",{className:"text-red-700 mt-1",children:s.error})]}),s.bookings&&e.jsxs("div",{className:"p-3 bg-blue-100 border border-blue-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Accepted Bookings:"})]}),e.jsxs("p",{className:"text-blue-700 mt-1",children:["Found ",s.bookings.length," accepted booking(s)"]}),s.bookings.map((t,r)=>e.jsxs("div",{className:"mt-2 p-2 bg-white rounded border",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"ID:"})," ",t.id]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Event:"})," ",t.event_description]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Chat ID:"})," ",t.chat_id||"None"]})]},r))]}),s.conversationId&&e.jsxs("div",{className:"p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium text-green-800",children:"Conversation ID:"})]}),e.jsx("p",{className:"text-green-700 mt-1 font-mono",children:s.conversationId})]}),s.conversation&&e.jsxs("div",{className:"p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium text-green-800",children:"Conversation Details:"})]}),e.jsxs("div",{className:"text-green-700 mt-1 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",s.conversation.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Client ID:"})," ",s.conversation.client_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Artist ID:"})," ",s.conversation.artist_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created:"})," ",new Date(s.conversation.created_at).toLocaleString()]})]})]}),s.messages&&e.jsxs("div",{className:"p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium text-green-800",children:"Messages:"})]}),e.jsxs("p",{className:"text-green-700 mt-1",children:["Found ",s.messages.length," message(s)"]}),s.messages.map((t,r)=>e.jsxs("div",{className:"mt-2 p-2 bg-white rounded border",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"From:"})," ",t.sender_id]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Message:"})," ",t.message]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Time:"})," ",new Date(t.created_at).toLocaleString()]})]},r))]}),s.navigationTest&&e.jsxs("div",{className:"p-3 bg-purple-100 border border-purple-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"font-medium text-purple-800",children:"Navigation Test:"})]}),e.jsxs("div",{className:"text-purple-700 mt-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Can Navigate:"})," ",s.navigationTest.canNavigate?"Yes":"No"]}),s.navigationTest.targetUrl&&e.jsxs("p",{children:[e.jsx("strong",{children:"Target URL:"})," ",s.navigationTest.targetUrl]})]})]})]})})]})]}):e.jsx(j,{children:e.jsxs(p,{children:[e.jsx(u,{children:"Chat Debug Test"}),e.jsx(k,{children:"Please log in to run debug test"})]})})};export{G as ChatDebugTest};
