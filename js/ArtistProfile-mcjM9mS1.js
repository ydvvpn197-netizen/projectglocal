var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(s,t,i)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,n=(e,s)=>{for(var t in s||(s={}))a.call(s,t)&&l(e,t,s[t]);if(i)for(var t of i(s))r.call(s,t)&&l(e,t,s[t]);return e},o=(e,i)=>s(e,t(i)),d=(e,s,t)=>new Promise((i,a)=>{var r=e=>{try{n(t.next(e))}catch(s){a(s)}},l=e=>{try{n(t.throw(e))}catch(s){a(s)}},n=e=>e.done?i(e.value):Promise.resolve(e.value).then(r,l);n((t=t.apply(e,s)).next())});import{U as c,u,d as m,b as x,r as h,s as f,j as p,B as j,C as v,v as g,w as y,y as _}from"./main-u5iDOJMZ.js";import{R as b,H as N}from"./ResponsiveLayout-CaFEj6Sr.js";import{B as w}from"./badge-k0SsuPwB.js";import{A as k,a as q,b as S,i as C}from"./sheet-BES5Q-Ko.js";import{T as A,a as B,b as P,c as D}from"./tabs-Dn7YRzvT.js";import{T as E}from"./textarea-44C4KWaW.js";import{I as O}from"./input-d0wpgTJ2.js";import{D as F,e as M,a as T,b as Y,c as $}from"./dialog-D7WpG6pZ.js";import{u as I,F as R}from"./FollowButton-DhP7k6Id.js";import{n as z}from"./useNotifications-DNCpc7NU.js";import{M as L}from"./map-pin-CcmxiK6P.js";import{C as U}from"./clock-k4Wuy6bB.js";import{U as V}from"./users-BKDXsamp.js";import{C as W}from"./index-B7-3ofi9.js";import{M as H}from"./message-circle-nfkvwkJk.js";import"./separator-BdZu64Yb.js";import"./NotificationBell-4ukuyDx4.js";import"./Combination-D3NAapk3.js";import"./scroll-area-DANvZfFy.js";import"./index-Dy-VqNBB.js";import"./index-jVOyRz7F.js";import"./bell-wBykza9e.js";import"./check-CT-bNmTi.js";import"./user-DlaYKRnl.js";import"./index-azXaBhbR.js";import"./NotificationButton-QcrDLMMB.js";import"./search-BsWmJlwB.js";import"./zap-BrBeKdrO.js";import"./message-square-DQ5316cR.js";import"./alert-7nHfBPfv.js";import"./wifi-DNTf1l7S.js";import"./log-out-CGc8M4_-.js";import"./user-check-B1BXaw6U.js";import"./user-plus-D9OGdHdJ.js";const K=()=>{var e,s,t;const{artistId:i}=c(),{user:a}=u(),{toast:r}=m(),l=x(),K=x(),[Q,X]=h.useState(null),[Z,G]=h.useState([]),[J,ee]=h.useState(!0),[se,te]=h.useState("about"),[ie,ae]=h.useState(""),[re,le]=h.useState(""),[ne,oe]=h.useState(!1),[de,ce]=h.useState(!1),[ue,me]=h.useState(""),[xe,he]=h.useState(""),[fe,pe]=h.useState(""),[je,ve]=h.useState(""),[ge,ye]=h.useState(""),[_e,be]=h.useState(""),{followersCount:Ne,followingCount:we}=I(i);h.useEffect(()=>{i&&(ke(),qe())},[i,a,ke,qe]);const ke=h.useCallback(()=>d(void 0,null,function*(){try{const{data:e,error:s}=yield f.from("profiles").select("*").eq("user_id",i).single();if(s)throw s;const{data:t,error:a}=yield f.from("artists").select("*").eq("user_id",i).single();if(a){const{data:s,error:t}=yield f.from("artists").insert({user_id:i,specialty:e.artist_skills||[],experience_years:0,hourly_rate_min:e.hourly_rate_min||0,hourly_rate_max:e.hourly_rate_max||0,bio:e.bio||"",is_available:!0}).select().single();return t?void X(o(n({},e),{id:e.user_id,experience_years:0,is_available:!1,hourly_rate_min:e.hourly_rate_min||0,hourly_rate_max:e.hourly_rate_max||0})):void X(o(n(n({},e),s),{id:s.id}))}X(o(n(n({},e),t),{id:t.id}))}catch(e){r({title:"Error",description:"Failed to load artist profile",variant:"destructive"})}}),[i,r]),qe=h.useCallback(()=>d(void 0,null,function*(){try{const{data:e,error:s}=yield f.from("artists").select("id").eq("user_id",i).single();if(s)return void G([]);const{data:t,error:a}=yield f.from("artist_discussions").select("*").eq("artist_id",e.id).eq("status","approved").order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1});if(a)throw a;const r=(t||[]).map(e=>e.user_id);let l={};if(r.length>0){const{data:e}=yield f.from("profiles").select("user_id, display_name, avatar_url").in("user_id",r);l=Object.fromEntries((e||[]).map(e=>[e.user_id,e]))}const d=(t||[]).map(e=>{var s,t;return o(n({},e),{user_display_name:(null==(s=l[e.user_id])?void 0:s.display_name)||"Anonymous",user_avatar_url:(null==(t=l[e.user_id])?void 0:t.avatar_url)||""})});G(d)}catch(e){}finally{ee(!1)}}),[i]);return J?p.jsx(b,{children:p.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):Q?p.jsx(b,{children:p.jsxs("div",{className:"space-y-8 max-w-4xl mx-auto",children:[p.jsx(v,{children:p.jsx(g,{children:p.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[p.jsxs(k,{className:"h-32 w-32 mx-auto md:mx-0",children:[p.jsx(q,{src:Q.avatar_url}),p.jsx(S,{className:"text-2xl",children:(null==(e=Q.display_name)?void 0:e.charAt(0))||"A"})]}),p.jsxs("div",{className:"flex-1 text-center md:text-left",children:[p.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 md:gap-4 mb-2",children:[p.jsx("h1",{className:"text-3xl font-bold",children:Q.display_name}),Q.is_verified&&p.jsx(w,{variant:"secondary",children:"Verified"}),Q.is_available&&p.jsx(w,{variant:"outline",className:"text-green-600 border-green-600",children:"Available"})]}),p.jsxs("div",{className:"flex flex-col md:flex-row gap-2 md:gap-4 mb-4 text-muted-foreground",children:[p.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-1",children:[p.jsx(L,{className:"h-4 w-4"}),p.jsxs("span",{children:[Q.location_city,", ",Q.location_state]})]}),p.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-1",children:[p.jsx(U,{className:"h-4 w-4"}),p.jsxs("span",{children:["$",Q.hourly_rate_min,"-$",Q.hourly_rate_max,"/hr"]})]}),p.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-1",children:[p.jsx(C,{className:"h-4 w-4"}),p.jsxs("span",{children:[Q.experience_years," years experience"]})]})]}),p.jsx("div",{className:"flex flex-wrap gap-2 mb-4 justify-center md:justify-start",children:null==(s=Q.artist_skills)?void 0:s.map(e=>p.jsx(w,{variant:"outline",children:e},e))}),p.jsxs("div",{className:"flex items-center gap-6 mb-4 justify-center md:justify-start text-sm text-muted-foreground",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(V,{className:"h-4 w-4"}),p.jsxs("span",{children:[p.jsx("span",{className:"font-medium text-foreground",children:Ne})," followers"]})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(V,{className:"h-4 w-4"}),p.jsxs("span",{children:[p.jsx("span",{className:"font-medium text-foreground",children:we})," following"]})]})]}),p.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center md:justify-start",children:[p.jsxs(F,{open:de,onOpenChange:ce,children:[p.jsx(M,{asChild:!0,children:p.jsxs(j,{size:"lg",className:"w-full sm:w-auto",children:[p.jsx(W,{className:"h-4 w-4 mr-2"}),"Book Now"]})}),p.jsxs(T,{className:"max-w-md",children:[p.jsx(Y,{children:p.jsxs($,{children:["Book ",Q.display_name]})}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium",children:"Event Date"}),p.jsx(O,{type:"datetime-local",value:ue,onChange:e=>me(e.target.value)})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium",children:"Event Location"}),p.jsx(O,{placeholder:"Event location",value:xe,onChange:e=>he(e.target.value)})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium",children:"Event Description"}),p.jsx(E,{placeholder:"Describe your event...",value:fe,onChange:e=>pe(e.target.value)})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium",children:"Min Budget ($)"}),p.jsx(O,{type:"number",placeholder:"500",value:je,onChange:e=>ve(e.target.value)})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium",children:"Max Budget ($)"}),p.jsx(O,{type:"number",placeholder:"1000",value:ge,onChange:e=>ye(e.target.value)})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium",children:"Contact Information"}),p.jsx(E,{placeholder:"Your phone number, email, or other contact details",value:_e,onChange:e=>be(e.target.value)})]}),p.jsx(j,{onClick:()=>d(void 0,null,function*(){if(!a)return void r({title:"Sign in required",description:"Please sign in to book artists",variant:"destructive"});if(!(null==Q?void 0:Q.id)||Q.id===i||!Q.is_available)return void r({title:"Artist not available",description:"This artist is not available for booking at the moment",variant:"destructive"});if(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(Q.id))if(ue&&xe&&fe&&je&&_e)try{const{data:e}=yield f.from("artist_bookings").select("id").eq("user_id",a.id).eq("artist_id",null==Q?void 0:Q.id).eq("event_date",ue).single();if(e)return void r({title:"Booking already exists",description:"You have already sent a booking request for this date and artist.",variant:"destructive"});const{error:s}=yield f.from("artist_bookings").insert({user_id:a.id,artist_id:null==Q?void 0:Q.id,event_date:ue,event_location:xe,event_description:fe,budget_min:parseFloat(je),budget_max:ge?parseFloat(ge):null,contact_info:_e,status:"pending"});if(s){if("23505"===s.code)return void r({title:"Booking already exists",description:"You have already sent a booking request for this date and artist.",variant:"destructive"});if("23503"===s.code)return void r({title:"Artist not available",description:"This artist is not available for booking at the moment.",variant:"destructive"});throw s}r({title:"Booking request sent",description:"Your booking request has been sent to the artist"}),ce(!1),me(""),he(""),pe(""),ve(""),ye(""),be("")}catch(e){let s="Failed to send booking request";"23503"===(null==e?void 0:e.code)?s="Artist profile is not properly set up for bookings":"23505"===(null==e?void 0:e.code)?s="You have already sent a booking request for this date and artist":(null==e?void 0:e.message)&&(s=e.message),r({title:"Error",description:s,variant:"destructive"})}else r({title:"Missing information",description:"Please fill in all required fields",variant:"destructive"});else r({title:"Artist not available",description:"This artist profile is not properly set up for bookings",variant:"destructive"})}),className:"w-full",children:"Send Booking Request"})]})]})]}),p.jsx(R,{userId:i,size:"lg",className:"w-full sm:w-auto"}),a&&a.id!==i&&p.jsxs(j,{variant:"outline",size:"lg",className:"w-full sm:w-auto",onClick:()=>d(void 0,null,function*(){try{const{data:e}=yield f.from("chat_conversations").select("id, status, client_id, artist_id").eq("client_id",a.id).eq("artist_id",i).not("status","eq","closed").maybeSingle(),{data:s}=yield f.from("chat_conversations").select("id, status, client_id, artist_id").eq("client_id",i).eq("artist_id",a.id).not("status","eq","closed").maybeSingle(),t=e||s;let r=null==t?void 0:t.id;if(!r){const{data:e,error:s}=yield f.from("chat_conversations").insert({booking_id:null,client_id:a.id,artist_id:i,status:"active"}).select().single();if(s)throw s;r=e.id}K(`/chat/${r}`)}catch(e){r({title:"Error",description:"Failed to start chat conversation",variant:"destructive"})}}),children:[p.jsx(H,{className:"h-4 w-4 mr-2"})," Message"]})]})]})]})})}),p.jsxs(A,{value:se,onValueChange:te,children:[p.jsxs(B,{className:"grid w-full grid-cols-3",children:[p.jsx(P,{value:"about",children:"About"}),p.jsx(P,{value:"portfolio",children:"Portfolio"}),p.jsx(P,{value:"discussions",children:"Discussions"})]}),p.jsx(D,{value:"about",className:"space-y-6",children:p.jsxs(v,{children:[p.jsx(g,{children:p.jsx(y,{children:"About"})}),p.jsx(_,{children:p.jsx("p",{className:"text-muted-foreground",children:Q.bio||"No bio available."})})]})}),p.jsx(D,{value:"portfolio",className:"space-y-6",children:p.jsxs(v,{children:[p.jsx(g,{children:p.jsx(y,{children:"Portfolio"})}),p.jsx(_,{children:(null==(t=Q.portfolio_urls)?void 0:t.length)>0?p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Q.portfolio_urls.map((e,s)=>p.jsx("div",{className:"aspect-video bg-muted rounded-lg flex items-center justify-center",children:p.jsx("img",{src:e,alt:`Portfolio ${s+1}`,className:"w-full h-full object-cover rounded-lg"})},s))}):p.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No portfolio items available."})})]})}),p.jsxs(D,{value:"discussions",className:"space-y-6",children:[a&&p.jsxs(v,{children:[p.jsxs(g,{children:[p.jsx(y,{children:"Start a Discussion"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"Your discussion will be sent to the artist for approval before being visible to others."})]}),p.jsxs(_,{className:"space-y-4",children:[p.jsx(O,{placeholder:"Discussion title",value:ie,onChange:e=>ae(e.target.value)}),p.jsx(E,{placeholder:"What would you like to discuss?",value:re,onChange:e=>le(e.target.value),rows:4}),p.jsx(j,{onClick:()=>d(void 0,null,function*(){if(a)if(ie.trim()&&re.trim()){oe(!0);try{const{data:s,error:t}=yield f.from("artists").select("id").eq("user_id",i).single();if(t)throw new Error("Artist profile not found");const{data:l,error:n}=yield f.from("artist_discussions").insert({user_id:a.id,artist_id:s.id,title:ie,content:re,status:"pending"}).select().single();if(n)throw n;try{yield z.createDiscussionRequestNotification(i,l)}catch(e){}r({title:"Discussion submitted",description:"Your discussion request has been sent to the artist for approval"}),ae(""),le("")}catch(s){let e="Failed to submit discussion request";"23503"===(null==s?void 0:s.code)?e="Artist profile not found or invalid":(null==s?void 0:s.message)&&(e=s.message),r({title:"Error",description:e,variant:"destructive"})}finally{oe(!1)}}else r({title:"Missing information",description:"Please fill in both title and content",variant:"destructive"});else r({title:"Sign in required",description:"Please sign in to post discussions",variant:"destructive"})}),disabled:ne,className:"w-full",children:ne?"Submitting...":"Submit for Approval"})]})]}),p.jsx("div",{className:"space-y-4",children:Z.length>0?Z.map(e=>{var s;return p.jsxs(v,{children:[p.jsx(g,{children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsxs(k,{className:"h-8 w-8",children:[p.jsx(q,{src:e.user_avatar_url}),p.jsx(S,{children:(null==(s=e.user_display_name)?void 0:s.charAt(0))||"U"})]}),p.jsxs("div",{children:[p.jsx(y,{className:"text-lg",children:e.title}),p.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",e.user_display_name," • ",new Date(e.created_at).toLocaleDateString()]})]})]}),e.is_pinned&&p.jsx(w,{variant:"secondary",children:"Pinned"})]})}),p.jsxs(_,{children:[p.jsx("p",{className:"text-muted-foreground mb-4",children:e.content}),p.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(N,{className:"h-4 w-4"}),p.jsx("span",{children:e.likes_count})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(H,{className:"h-4 w-4"}),p.jsxs("span",{children:[e.replies_count," replies"]})]})]})]})]},e.id)}):p.jsx(v,{children:p.jsx(_,{className:"text-center py-8",children:p.jsx("p",{className:"text-muted-foreground",children:"No discussions yet. Be the first to start one!"})})})})]})]})]})}):p.jsx(b,{children:p.jsxs("div",{className:"text-center py-16",children:[p.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Artist not found"}),p.jsx(j,{onClick:()=>l("/book-artist"),children:"Browse Artists"})]})})};export{K as default};
