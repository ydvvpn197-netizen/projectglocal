var e=Object.defineProperty,s=Object.defineProperties,i=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(s,i,t)=>i in s?e(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t,c=(e,s)=>{for(var i in s||(s={}))r.call(s,i)&&l(e,i,s[i]);if(t)for(var i of t(s))a.call(s,i)&&l(e,i,s[i]);return e},n=(e,t)=>s(e,i(t)),o=(e,s,i)=>new Promise((t,r)=>{var a=e=>{try{c(i.next(e))}catch(s){r(s)}},l=e=>{try{c(i.throw(e))}catch(s){r(s)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(a,l);c((i=i.apply(e,s)).next())});import{r as d,u as m,d as h,s as u,b as p,j,z as x,B as v,X as g}from"./index-B5IYdG7F.js";import{C as y,a as f,b as N,c as b,d as w}from"./card-Bm1jiGt-.js";import{I as S}from"./input-C4_QhDnm.js";import{L as _}from"./label-BIAuZBUP.js";import{T as F}from"./textarea-DnhiZrYB.js";import{S as P,a as C,b as D,c as E,d as O}from"./select-DME_qdt9.js";import{S as k}from"./switch-1GU9K-FH.js";import{B as T}from"./badge-Dh5Uj8vN.js";import{T as q,a as A,b as L,c as z}from"./tabs-DPPBWbFC.js";import{R as B}from"./ResponsiveLayout-BzUw0buI.js";import{u as W}from"./useEvents-CUKPPFr-.js";import{s as I,b as M}from"./sanitize-D4fpKnsd.js";import{M as R}from"./map-pin-BwnggLrZ.js";import{P as H}from"./sheet-CgDUfSpi.js";import{C as U}from"./index-DD_J5sPn.js";import{C as K}from"./clock-BZvZzp4Q.js";import{D as Y}from"./dollar-sign-DW2P0OIR.js";import{U as G}from"./users-Dh-Bdb-k.js";import{T as V}from"./tag-Dx1_YTf2.js";import"./index-jVOyRz7F.js";import"./index-9msbY5CZ.js";import"./Combination-BxRIZ8rt.js";import"./index-_KG4atBu.js";import"./chevron-up-DvjQ7ry8.js";import"./check-C9wwFfOs.js";import"./separator-BZYZTYLW.js";import"./NotificationBell-DtnEojo4.js";import"./scroll-area-Beiyt5Kx.js";import"./useNotifications-C0wifgqF.js";import"./bell-qeMkXRtc.js";import"./settings-DSEWn2wM.js";import"./user-UOowhO7W.js";import"./index-DWtoKlrM.js";import"./NotificationButton-CqXjP_LK.js";import"./search-Co_OHmlK.js";import"./zap-DPSXpNso.js";import"./message-square-j4RxGxzk.js";import"./alert-CQybxmNr.js";import"./log-out-DchhrZ8K.js";import"./useLocation-BN9qq_uk.js";import"./locationService-BBE-Ay-I.js";import"./pointsService-D9LdhHSC.js";const J=()=>{const[e,s]=d.useState([]),[i,t]=d.useState(""),[r,a]=d.useState(!1),[l,J]=d.useState(!1),{createPost:$}=(()=>{const[e,s]=d.useState([]),[i,t]=d.useState(!0),{user:r}=m(),{toast:a}=h(),l=()=>o(void 0,null,function*(){if(r)try{const{data:e,error:i}=yield u.from("posts").select("\n          *,\n          profiles:user_id (\n            display_name,\n            username,\n            avatar_url\n          )\n        ").order("created_at",{ascending:!1});if(i)throw i;const t=(null==e?void 0:e.map(e=>n(c({},e),{contact_info:e.user_id===(null==r?void 0:r.id)?e.contact_info:null})))||[];s(t)}catch(e){a({title:"Error loading posts",description:e.message,variant:"destructive"})}finally{t(!1)}else t(!1)});return d.useEffect(()=>{r&&l()},[r]),{posts:e,loading:i,createPost:e=>o(void 0,null,function*(){if(!r)return{error:new Error("Not authenticated")};try{const{data:s,error:i}=yield u.from("posts").insert(n(c({},e),{user_id:r.id,type:e.type})).select().single();if(i)throw i;return a({title:"Post created",description:"Your post has been shared with the community."}),l(),{data:s,error:null}}catch(s){return a({title:"Error creating post",description:s.message,variant:"destructive"}),{error:s}}}),toggleLike:e=>o(void 0,null,function*(){if(r)try{const{data:s}=yield u.from("likes").select("id").eq("post_id",e).eq("user_id",r.id).maybeSingle();s?yield u.from("likes").delete().eq("post_id",e).eq("user_id",r.id):yield u.from("likes").insert({post_id:e,user_id:r.id}),l()}catch(s){a({title:"Error updating like",description:s.message,variant:"destructive"})}}),deletePost:e=>o(void 0,null,function*(){if(!r)return{error:new Error("Not authenticated")};try{const{error:s}=yield u.from("posts").delete().eq("id",e).eq("user_id",r.id);if(s)throw s;return a({title:"Post deleted",description:"Your post has been deleted successfully."}),l(),{error:null}}catch(s){return a({title:"Error deleting post",description:s.message,variant:"destructive"}),{error:s}}}),refetch:l}})(),{createEvent:Q}=W(),X=p(),Z=()=>{const r=I(i,50);r&&!e.includes(r)&&(s([...e,r]),t(""))},ee=(s,i)=>o(void 0,null,function*(){s.preventDefault();const t=s.target,r=new FormData(t);J(!0);try{if("event"===i){const e={title:I(r.get("title")||"",200),description:I(r.get("content")||"",5e3),event_date:r.get("event_date"),event_time:r.get("event_time"),location_name:I(r.get("location_name")||"",500),category:r.get("category")||void 0,max_attendees:r.get("max_attendees")?parseInt(r.get("max_attendees")):void 0,price:r.get("price")?parseFloat(r.get("price")):0,image_url:r.get("image_url")||void 0,tags:r.get("tags")?r.get("tags").split(",").map(e=>e.trim()):void 0};(yield Q(e))&&X("/events")}else{const s={type:i,title:I(r.get("title")||"",200),content:I(r.get("content")||"",5e3),event_date:r.get("eventDate")?new Date(r.get("eventDate")).toISOString():void 0,event_location:I(r.get("eventLocation")||r.get("serviceArea")||"",500),price_range:I(r.get("eventPrice")||r.get("servicePrice")||"",100),tags:e.length>0?M(e):void 0},{error:t}=yield $(s);t||X("/feed")}}finally{J(!1)}});return j.jsx(x,{children:j.jsx(B,{children:j.jsxs("div",{className:"container max-w-3xl mx-auto p-6",children:[j.jsxs("div",{className:"mb-6",children:[j.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Create New Post"}),j.jsx("p",{className:"text-muted-foreground",children:"Share with your local community"})]}),j.jsxs(q,{defaultValue:"post",className:"space-y-6",children:[j.jsxs(A,{className:"grid w-full grid-cols-4",children:[j.jsx(L,{value:"post",children:"Post"}),j.jsx(L,{value:"event",children:"Event"}),j.jsx(L,{value:"service",children:"Service"}),j.jsx(L,{value:"discussion",children:"Discussion"})]}),j.jsx(z,{value:"post",children:j.jsxs(y,{children:[j.jsxs(f,{children:[j.jsx(N,{children:"Share Your Thoughts"}),j.jsx(b,{children:"Post updates, photos, or thoughts with your local community"})]}),j.jsx(w,{className:"space-y-6",children:j.jsxs("form",{onSubmit:e=>ee(e,"post"),className:"space-y-6",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"post-title",children:"Title"}),j.jsx(S,{id:"post-title",name:"title",placeholder:"What's on your mind?"})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"post-content",children:"Content"}),j.jsx(F,{id:"post-content",name:"content",placeholder:"Share your thoughts, experiences, or updates...",className:"min-h-32",required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"post-location",children:"Location (Optional)"}),j.jsxs("div",{className:"relative",children:[j.jsx(R,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),j.jsx(S,{id:"post-location",placeholder:"Add a location",className:"pl-10"})]})]}),j.jsxs("div",{className:"space-y-4",children:[j.jsx(_,{children:"Tags"}),j.jsxs("div",{className:"flex gap-2",children:[j.jsx(S,{value:i,onChange:e=>t(e.target.value),placeholder:"Add a tag",onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),Z())}),j.jsx(v,{onClick:Z,size:"icon",variant:"outline",children:j.jsx(H,{className:"h-4 w-4"})})]}),j.jsx("div",{className:"flex flex-wrap gap-2",children:e.map(i=>j.jsxs(T,{variant:"secondary",className:"gap-1",children:[i,j.jsx("button",{onClick:()=>(i=>{s(e.filter(e=>e!==i))})(i),children:j.jsx(g,{className:"h-3 w-3"})})]},i))})]}),j.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[j.jsxs("div",{className:"space-y-1",children:[j.jsx(_,{children:"Privacy Setting"}),j.jsx("p",{className:"text-sm text-muted-foreground",children:r?"Only followers can see this post":"Public to local community"})]}),j.jsx(k,{checked:r,onCheckedChange:a})]}),j.jsx(v,{className:"w-full",size:"lg",type:"submit",disabled:l,children:l?"Creating...":"Share Post"})]})})]})}),j.jsx(z,{value:"event",children:j.jsxs(y,{children:[j.jsxs(f,{children:[j.jsx(N,{children:"Create Event"}),j.jsx(b,{children:"Organize local events and gatherings"})]}),j.jsx(w,{className:"space-y-6",children:j.jsxs("form",{onSubmit:e=>ee(e,"event"),className:"space-y-6",children:[j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"event-title",children:"Event Title *"}),j.jsx(S,{id:"event-title",name:"title",placeholder:"Enter event title",required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"event-category",children:"Category"}),j.jsxs(P,{name:"category",children:[j.jsx(C,{children:j.jsx(D,{placeholder:"Select category"})}),j.jsxs(E,{children:[j.jsx(O,{value:"Art & Culture",children:"Art & Culture"}),j.jsx(O,{value:"Music",children:"Music"}),j.jsx(O,{value:"Food & Drink",children:"Food & Drink"}),j.jsx(O,{value:"Sports & Fitness",children:"Sports & Fitness"}),j.jsx(O,{value:"Technology",children:"Technology"}),j.jsx(O,{value:"Business",children:"Business"}),j.jsx(O,{value:"Education",children:"Education"}),j.jsx(O,{value:"Health & Wellness",children:"Health & Wellness"}),j.jsx(O,{value:"Community",children:"Community"}),j.jsx(O,{value:"Entertainment",children:"Entertainment"}),j.jsx(O,{value:"Other",children:"Other"})]})]})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"event-description",children:"Description"}),j.jsx(F,{id:"event-description",name:"content",placeholder:"Describe your event...",className:"min-h-24",rows:3})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsxs(_,{htmlFor:"event-date",className:"flex items-center gap-2",children:[j.jsx(U,{className:"h-4 w-4"}),"Date *"]}),j.jsx(S,{id:"event-date",name:"event_date",type:"date",min:(new Date).toISOString().split("T")[0],required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsxs(_,{htmlFor:"event-time",className:"flex items-center gap-2",children:[j.jsx(K,{className:"h-4 w-4"}),"Time *"]}),j.jsx(S,{id:"event-time",name:"event_time",type:"time",required:!0})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsxs(_,{htmlFor:"event-location",className:"flex items-center gap-2",children:[j.jsx(R,{className:"h-4 w-4"}),"Location *"]}),j.jsx(S,{id:"event-location",name:"location_name",placeholder:"Event venue or address",required:!0})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsxs(_,{htmlFor:"event-price",className:"flex items-center gap-2",children:[j.jsx(Y,{className:"h-4 w-4"}),"Price (USD)"]}),j.jsx(S,{id:"event-price",name:"price",placeholder:"0 for free events",type:"number",min:"0",step:"0.01"})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsxs(_,{htmlFor:"event-capacity",className:"flex items-center gap-2",children:[j.jsx(G,{className:"h-4 w-4"}),"Max Attendees"]}),j.jsx(S,{id:"event-capacity",name:"max_attendees",placeholder:"Optional",type:"number",min:"1"})]})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"event-image",children:"Image URL"}),j.jsx(S,{id:"event-image",name:"image_url",type:"url",placeholder:"Optional event image"})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsxs(_,{htmlFor:"event-tags",className:"flex items-center gap-2",children:[j.jsx(V,{className:"h-4 w-4"}),"Tags"]}),j.jsx(S,{id:"event-tags",name:"tags",placeholder:"photography, outdoor, beginner (comma separated)"})]})]}),j.jsx(v,{className:"w-full",size:"lg",type:"submit",disabled:l,children:l?"Creating...":"Create Event"})]})})]})}),j.jsx(z,{value:"service",children:j.jsxs(y,{children:[j.jsxs(f,{children:[j.jsx(N,{children:"Offer a Service"}),j.jsx(b,{children:"Share your skills and services with the local community"})]}),j.jsx(w,{className:"space-y-6",children:j.jsxs("form",{onSubmit:e=>ee(e,"service"),className:"space-y-6",children:[j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"service-title",children:"Service Title"}),j.jsx(S,{id:"service-title",name:"title",placeholder:"What service do you offer?",required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"service-category",children:"Category"}),j.jsxs(P,{children:[j.jsx(C,{children:j.jsx(D,{placeholder:"Select category"})}),j.jsxs(E,{children:[j.jsx(O,{value:"photography",children:"Photography"}),j.jsx(O,{value:"music",children:"Music & Performance"}),j.jsx(O,{value:"design",children:"Design & Art"}),j.jsx(O,{value:"fitness",children:"Fitness & Wellness"}),j.jsx(O,{value:"education",children:"Education & Tutoring"}),j.jsx(O,{value:"handyman",children:"Home & Repair"}),j.jsx(O,{value:"beauty",children:"Beauty & Style"}),j.jsx(O,{value:"tech",children:"Technology"})]})]})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"service-description",children:"Description"}),j.jsx(F,{id:"service-description",name:"content",placeholder:"Describe your service, experience, and what you offer...",className:"min-h-24",required:!0})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"service-price",children:"Price Range"}),j.jsxs("div",{className:"relative",children:[j.jsx(Y,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),j.jsx(S,{id:"service-price",name:"servicePrice",placeholder:"50 - 150",className:"pl-10"})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"service-availability",children:"Availability"}),j.jsxs(P,{children:[j.jsx(C,{children:j.jsx(D,{placeholder:"Select availability"})}),j.jsxs(E,{children:[j.jsx(O,{value:"immediate",children:"Available Now"}),j.jsx(O,{value:"this-week",children:"This Week"}),j.jsx(O,{value:"this-month",children:"This Month"}),j.jsx(O,{value:"flexible",children:"Flexible"})]})]})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"service-area",children:"Service Area"}),j.jsxs("div",{className:"relative",children:[j.jsx(R,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),j.jsx(S,{id:"service-area",name:"serviceArea",placeholder:"Within 15km of current location",className:"pl-10"})]})]}),j.jsx(v,{className:"w-full",size:"lg",type:"submit",disabled:l,children:l?"Creating...":"List Service"})]})})]})}),j.jsx(z,{value:"discussion",children:j.jsxs(y,{children:[j.jsxs(f,{children:[j.jsx(N,{children:"Start a Discussion"}),j.jsx(b,{children:"Create a topic for community discussion and engagement"})]}),j.jsx(w,{className:"space-y-6",children:j.jsxs("form",{onSubmit:e=>ee(e,"discussion"),className:"space-y-6",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"discussion-title",children:"Discussion Topic"}),j.jsx(S,{id:"discussion-title",name:"title",placeholder:"What would you like to discuss?",required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"discussion-category",children:"Category"}),j.jsxs(P,{children:[j.jsx(C,{children:j.jsx(D,{placeholder:"Select category"})}),j.jsxs(E,{children:[j.jsx(O,{value:"general",children:"General Discussion"}),j.jsx(O,{value:"local-news",children:"Local News"}),j.jsx(O,{value:"recommendations",children:"Recommendations"}),j.jsx(O,{value:"events",children:"Community Events"}),j.jsx(O,{value:"safety",children:"Safety & Security"}),j.jsx(O,{value:"environment",children:"Environment"}),j.jsx(O,{value:"business",children:"Local Business"})]})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"discussion-content",children:"Discussion Starter"}),j.jsx(F,{id:"discussion-content",name:"content",placeholder:"Share your thoughts, ask questions, or provide context for the discussion...",className:"min-h-32",required:!0})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(_,{htmlFor:"discussion-rules",children:"Discussion Guidelines (Optional)"}),j.jsx(F,{id:"discussion-rules",placeholder:"Set any specific guidelines or rules for this discussion...",className:"min-h-20"})]}),j.jsx(v,{className:"w-full",size:"lg",type:"submit",disabled:l,children:l?"Creating...":"Start Discussion"})]})})]})})]})]})})})};export{J as default};
