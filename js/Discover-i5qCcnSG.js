var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,l=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&r(e,s,t[s]);if(a)for(var s of a(t))i.call(t,s)&&r(e,s,t[s]);return e},o=(e,a)=>t(e,s(a)),c=(e,t,s)=>r(e,"symbol"!=typeof t?t+"":t,s),d=(e,t,s)=>new Promise((a,n)=>{var i=e=>{try{l(s.next(e))}catch(t){n(t)}},r=e=>{try{l(s.throw(e))}catch(t){n(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,r);l((s=s.apply(e,t)).next())});import{c as u,s as m,r as h,u as g,j as f,B as p,X as x,C as y,v,w as j,y as w,k as N,e as S,d as b,x as _}from"./main-6fHUpRzT.js";import{B as C}from"./badge-Bj-CyBpD.js";import{T as k,a as D,b as F,c as M}from"./tabs-BNobDGc4.js";import{H as R,R as T}from"./ResponsiveLayout-Bc2JEU4o.js";import{u as I}from"./useLocation-Bl6dvRZN.js";import{I as A}from"./input-C0XSs2D-.js";import{S as E}from"./slider-CF_4YnSu.js";import{S as P,a as q,b as O,c as U,d as L}from"./select-CsS9Kpur.js";import{C as $}from"./checkbox-nU9JBj1_.js";import{L as z}from"./label-B5VpaZlr.js";import{A as V,a as B,b as H,i as W,S as G}from"./sheet-D2smYKYW.js";import{S as Q}from"./search-CeL_nYcN.js";import{F as J}from"./filter-B-r7EgVz.js";import{M as Y}from"./map-pin-DJOBTPKn.js";import{D as X}from"./dollar-sign-Dc936s2v.js";import{f as K}from"./index-GQUAIkZv.js";import{C as Z}from"./index-YNlOS8aM.js";import{T as ee}from"./trending-up-EJ6gDKFP.js";import{U as te}from"./users-Czby48qY.js";import{C as se}from"./clock-CuUFWr0o.js";import{M as ae}from"./message-circle-clGX_rmg.js";import{S as ne}from"./share-2-D3j1vOAy.js";import{E as ie}from"./eye-B6Cx85SJ.js";import{U as re}from"./user-plus-Bi9Uv9Tf.js";import{E as le}from"./EnhancedUserProfileCard-DoQwlJWF.js";import{G as oe,L as ce}from"./list-BKTfrDzq.js";import{C as de}from"./check-circle-Bfeu-Ke9.js";import{A as ue}from"./award-DpYF0-Hz.js";import{S as me}from"./scroll-area-DRpKKhsW.js";import{C as he,a as ge}from"./chevron-up-k-AfHmE-.js";import{B as fe}from"./bar-chart-3-D93qNHMu.js";import"./index-BlbmBgSN.js";import"./separator-55ip2E4B.js";import"./NotificationBell-C-odGad4.js";import"./Combination-Bb2n9b59.js";import"./useNotifications-DlOFbLc9.js";import"./check-BVB7WkBF.js";import"./bell-DFXHEubE.js";import"./user-DoINJrqZ.js";import"./NotificationButton-CnmvsVP-.js";import"./zap-Dyj-3m1T.js";import"./message-square-BNIlY-fX.js";import"./alert-BCcU8rrr.js";import"./wifi-D7M5OVnX.js";import"./log-out-B3lkkfQi.js";import"./locationService-BtZ0rgoF.js";import"./index-jVOyRz7F.js";import"./index-WEre3Vep.js";import"./mail-BnzztWu8.js";import"./pen-square-CXs4EIjz.js";import"./globe-BcuJ5ITU.js";import"./phone-B5y4ncfk.js";import"./shield-CcNVjYJS.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=u("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),xe=u("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]),ye=u("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */class ve{static calculateRelevanceScore(e,t){const s=this.calculateTextRelevance(e,t),a=this.calculateLocationRelevance(e,t),n=this.calculateCategoryRelevance(e,t),i=this.calculateEngagementScore(e),r=this.calculateFreshnessScore(e);return{textRelevance:s,locationRelevance:a,categoryRelevance:n,engagementScore:i,freshnessScore:r,totalScore:.35*s+.25*a+.15*n+.15*i+.1*r}}static calculateTextRelevance(e,t){var s,a;const n=t.query.toLowerCase(),i=e.title.toLowerCase(),r=(null==(s=e.description)?void 0:s.toLowerCase())||"",l=(null==(a=e.tags)?void 0:a.map(e=>e.toLowerCase()))||[];let o=0;return i.includes(n)?o+=10:i.split(" ").some(e=>e.includes(n))&&(o+=7),r.includes(n)?o+=5:r.split(" ").some(e=>e.includes(n))&&(o+=3),l.forEach(e=>{e.includes(n)&&(o+=3)}),i===n&&(o+=5),Math.min(o,20)}static calculateLocationRelevance(e,t){var s,a,n;if(!t.location||!e.location)return 0;let i=0;void 0!==e.distance&&(e.distance<=5?i+=10:e.distance<=15?i+=7:e.distance<=30?i+=4:e.distance<=50&&(i+=2));const r=t.query.toLowerCase(),l=(null==(s=e.location.name)?void 0:s.toLowerCase())||"",o=(null==(a=e.location.city)?void 0:a.toLowerCase())||"",c=(null==(n=e.location.state)?void 0:n.toLowerCase())||"";return(l.includes(r)||o.includes(r)||c.includes(r))&&(i+=5),Math.min(i,15)}static calculateCategoryRelevance(e,t){return t.category&&t.category,5}static calculateEngagementScore(e){if(!e.engagement)return 0;const{likes:t,comments:s,shares:a,views:n}=e.engagement,i=1*t+2*s+3*a+.1*n;return Math.min(i/100,10)}static calculateFreshnessScore(e){const t=new Date,s=new Date(e.createdAt),a=(t.getTime()-s.getTime())/36e5;return a<=1?10:a<=24?8:a<=168?6:a<=720?4:2}static rankSearchResults(e,t){return e.map(e=>{const s=this.calculateRelevanceScore(e,t);return o(l({},e),{relevanceScore:s.totalScore})}).sort((e,s)=>{switch(t.sortBy){case"relevance":default:return(s.relevanceScore||0)-(e.relevanceScore||0);case"distance":return(e.distance||0)-(s.distance||0);case"date":return new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime();case"popularity":{const t=e.engagement?e.engagement.likes+e.engagement.comments:0;return(s.engagement?s.engagement.likes+s.engagement.comments:0)-t}case"rating":return(s.rating||0)-(e.rating||0)}})}static generateSearchSuggestions(e,t=[]){const s=new Set;t.forEach(t=>{t.toLowerCase().includes(e.toLowerCase())&&s.add(t)});["music","art","food","sports","business","education","concert","exhibition","restaurant","gym","workshop","local","nearby","today","this week","free","paid"].forEach(t=>{t.toLowerCase().includes(e.toLowerCase())&&s.add(t)});return["music","art","food","sports","business","education","entertainment","health","technology","fashion","travel"].forEach(t=>{t.toLowerCase().includes(e.toLowerCase())&&s.add(t)}),Array.from(s).slice(0,10)}static calculateDistance(e,t,s,a){const n=this.deg2rad(s-e),i=this.deg2rad(a-t),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(s))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}static deg2rad(e){return e*(Math.PI/180)}}const je=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}search(e){return d(this,null,function*(){const t=[];try{const s=[];"all"!==e.type&&"artist"!==e.type||s.push(this.searchArtists(e)),"all"!==e.type&&"event"!==e.type||s.push(this.searchEvents(e)),"all"!==e.type&&"post"!==e.type||s.push(this.searchPosts(e)),"all"!==e.type&&"group"!==e.type||s.push(this.searchGroups(e));(yield Promise.all(s)).forEach(e=>{t.push(...e)});const a=this.scoreAndSortResults(t,e),n=(e.page||0)*(e.limit||20),i=n+(e.limit||20);return a.slice(n,i)}catch(s){throw new Error("Failed to perform search")}})}searchArtists(e){return d(this,null,function*(){const{data:t}=yield m.from("artists").select("\n        id,\n        user_id,\n        specialty,\n        hourly_rate_min,\n        hourly_rate_max,\n        bio,\n        is_available\n      ").or(`specialty.cs.{${e.query}},bio.ilike.%${e.query}%`).eq("is_available",!0);if(!t)return[];const s=[];for(const a of t){const{data:t}=yield m.from("profiles").select("display_name, avatar_url, location_city, location_state, latitude, longitude").eq("user_id",a.user_id).single();if(t){const n=e.location?this.calculateDistance(e.location.latitude,e.location.longitude,t.latitude,t.longitude):void 0;(!e.location||n&&n<=e.location.radius)&&s.push({id:a.id,type:"artist",title:t.display_name||"Anonymous",description:a.bio,image:t.avatar_url,price:a.hourly_rate_min,location:{name:t.location_city||"",city:t.location_city||"",state:t.location_state||"",latitude:t.latitude,longitude:t.longitude},distance:n,tags:a.specialty,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})}}return s})}searchEvents(e){return d(this,null,function*(){let t=m.from("events").select("\n        id,\n        title,\n        description,\n        event_date,\n        event_time,\n        location_name,\n        location_city,\n        location_state,\n        category,\n        price,\n        image_url,\n        tags,\n        created_at\n      ").or(`title.ilike.%${e.query}%,description.ilike.%${e.query}%,category.ilike.%${e.query}%`);t=e.dateRange?t.gte("event_date",e.dateRange.start).lte("event_date",e.dateRange.end):t.gte("event_date",(new Date).toISOString().split("T")[0]);const{data:s}=yield t;return s?s.map(e=>({id:e.id,type:"event",title:e.title,description:e.description,image:e.image_url,price:e.price,location:{name:e.location_name||"",city:e.location_city||"",state:e.location_state||""},date:`${e.event_date} ${e.event_time}`,tags:e.tags,createdAt:e.created_at,updatedAt:e.created_at})):[]})}searchPosts(e){return d(this,null,function*(){const{data:t}=yield m.from("posts").select("\n        id,\n        user_id,\n        title,\n        content,\n        type,\n        likes_count,\n        comments_count,\n        created_at\n      ").or(`title.ilike.%${e.query}%,content.ilike.%${e.query}%`).eq("status","active");if(!t)return[];const s=[];for(const e of t){const{data:t}=yield m.from("profiles").select("display_name, avatar_url").eq("user_id",e.user_id).single();t&&s.push({id:e.id,type:"post",title:e.title||"Untitled Post",description:e.content.substring(0,100)+"...",image:t.avatar_url,date:e.created_at,tags:e.type?[e.type]:[],engagement:{likes:e.likes_count||0,comments:e.comments_count||0,shares:0,views:0},createdAt:e.created_at,updatedAt:e.created_at})}return s})}searchGroups(e){return d(this,null,function*(){const{data:t}=yield m.from("community_groups").select("\n        id,\n        name,\n        description,\n        category,\n        created_at\n      ").or(`name.ilike.%${e.query}%,description.ilike.%${e.query}%,category.ilike.%${e.query}%`);return t?t.map(e=>({id:e.id,type:"group",title:e.name,description:e.description,date:e.created_at,tags:e.category?[e.category]:[],createdAt:e.created_at,updatedAt:e.created_at})):[]})}calculateDistance(e,t,s,a){return e&&t&&s&&a?ve.calculateDistance(e,t,s,a):0}scoreAndSortResults(e,t){return ve.rankSearchResults(e,t)}getSearchSuggestions(e){return d(this,null,function*(){if(!e.trim())return[];const{data:t}=yield m.from("search_history").select("query").ilike("query",`%${e}%`).order("created_at",{ascending:!1}).limit(5),s=t?t.map(e=>e.query):[];return ve.generateSearchSuggestions(e,s)})}saveSearchHistory(e,t,s,a){return d(this,null,function*(){yield m.from("search_history").insert({user_id:e,query:t,filters:JSON.stringify(s),results_count:a,created_at:(new Date).toISOString()})})}};c(je,"instance");const we=je.getInstance(),Ne=h.memo(({result:e})=>{const t=h.useCallback(e=>({artist:f.jsx(W,{className:"h-4 w-4"}),event:f.jsx(Z,{className:"h-4 w-4"}),post:f.jsx(te,{className:"h-4 w-4"}),group:f.jsx(te,{className:"h-4 w-4"}),business:f.jsx(xe,{className:"h-4 w-4"})}[e]||f.jsx(Q,{className:"h-4 w-4"})),[]);return f.jsx(y,{className:"hover:shadow-md transition-shadow",children:f.jsx(w,{className:"p-4",children:f.jsxs("div",{className:"flex items-start gap-4",children:[f.jsxs(V,{className:"h-12 w-12",children:[f.jsx(B,{src:e.image}),f.jsx(H,{children:e.title.charAt(0)})]}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t(e.type),f.jsx(C,{variant:"secondary",className:"text-xs",children:e.type}),f.jsx("h3",{className:"font-semibold truncate",children:e.title}),e.relevanceScore&&f.jsxs(C,{variant:"outline",className:"text-xs",children:[Math.round(e.relevanceScore),"% match"]})]}),e.description&&f.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:e.description}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.location&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Y,{className:"h-3 w-3"}),e.location.name||`${e.location.city}, ${e.location.state}`]}),e.distance&&f.jsxs("span",{children:[e.distance.toFixed(1),"km away"]}),e.price&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(X,{className:"h-3 w-3"}),"$",e.price]}),e.date&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Z,{className:"h-3 w-3"}),K(new Date(e.date),"MMM dd, yyyy")]}),e.engagement&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ee,{className:"h-3 w-3"}),e.engagement.likes+e.engagement.comments]})]}),e.tags&&e.tags.length>0&&f.jsx("div",{className:"flex gap-1 mt-2",children:e.tags.slice(0,3).map((e,t)=>f.jsx(C,{variant:"outline",className:"text-xs",children:e},t))})]}),f.jsx(p,{variant:"outline",size:"sm",children:"View"})]})})})});Ne.displayName="SearchResultItem";const Se=h.memo(({filters:e,updateFilters:t,resetFilters:s,categories:a})=>{var n;return f.jsxs(y,{children:[f.jsx(v,{children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx(j,{children:"Search Filters"}),f.jsxs(p,{variant:"outline",size:"sm",onClick:s,children:[f.jsx(x,{className:"h-4 w-4 mr-2"}),"Reset"]})]})}),f.jsxs(w,{className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx(z,{className:"text-sm font-medium",children:"Content Type"}),f.jsxs(P,{value:e.type,onValueChange:e=>t({type:e}),children:[f.jsx(q,{children:f.jsx(O,{})}),f.jsxs(U,{children:[f.jsx(L,{value:"all",children:"All Types"}),f.jsx(L,{value:"artist",children:"Artists"}),f.jsx(L,{value:"event",children:"Events"}),f.jsx(L,{value:"post",children:"Posts"}),f.jsx(L,{value:"group",children:"Groups"}),f.jsx(L,{value:"business",children:"Businesses"})]})]})]}),f.jsxs("div",{children:[f.jsx(z,{className:"text-sm font-medium",children:"Category"}),f.jsxs(P,{value:e.category,onValueChange:e=>t({category:e}),children:[f.jsx(q,{children:f.jsx(O,{})}),f.jsxs(U,{children:[f.jsx(L,{value:"all",children:"All Categories"}),"all"!==e.type&&(null==(n=a[e.type])?void 0:n.map(e=>f.jsx(L,{value:e.toLowerCase(),children:e},e)))]})]})]}),f.jsxs("div",{children:[f.jsx(z,{className:"text-sm font-medium",children:"Sort By"}),f.jsxs(P,{value:e.sortBy,onValueChange:e=>t({sortBy:e}),children:[f.jsx(q,{children:f.jsx(O,{})}),f.jsxs(U,{children:[f.jsx(L,{value:"relevance",children:"Relevance"}),f.jsx(L,{value:"distance",children:"Distance"}),f.jsx(L,{value:"date",children:"Date"}),f.jsx(L,{value:"popularity",children:"Popularity"}),f.jsx(L,{value:"rating",children:"Rating"})]})]})]})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx($,{id:"location-filter",checked:e.location.enabled,onCheckedChange:s=>t({location:o(l({},e.location),{enabled:s})})}),f.jsx(z,{htmlFor:"location-filter",children:"Filter by location"})]}),e.location.enabled&&f.jsxs("div",{children:[f.jsxs(z,{className:"text-sm font-medium",children:["Max Distance: ",e.location.radius,"km"]}),f.jsx(E,{value:[e.location.radius],onValueChange:([s])=>t({location:o(l({},e.location),{radius:s})}),max:100,min:1,step:1})]})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx($,{id:"date-filter",checked:e.dateRange.enabled,onCheckedChange:s=>t({dateRange:o(l({},e.dateRange),{enabled:s})})}),f.jsx(z,{htmlFor:"date-filter",children:"Filter by date range"})]}),e.dateRange.enabled&&f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx(z,{className:"text-sm font-medium",children:"Start Date"}),f.jsx(A,{type:"date",value:e.dateRange.start,onChange:s=>t({dateRange:o(l({},e.dateRange),{start:s.target.value})})})]}),f.jsxs("div",{children:[f.jsx(z,{className:"text-sm font-medium",children:"End Date"}),f.jsx(A,{type:"date",value:e.dateRange.end,onChange:s=>t({dateRange:o(l({},e.dateRange),{end:s.target.value})})})]})]})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx($,{id:"price-filter",checked:e.priceRange.enabled,onCheckedChange:s=>t({priceRange:o(l({},e.priceRange),{enabled:s})})}),f.jsx(z,{htmlFor:"price-filter",children:"Filter by price range"})]}),e.priceRange.enabled&&f.jsxs("div",{children:[f.jsxs(z,{className:"text-sm font-medium",children:["Price Range: $",e.priceRange.min," - $",e.priceRange.max]}),f.jsx(E,{value:[e.priceRange.min,e.priceRange.max],onValueChange:s=>t({priceRange:o(l({},e.priceRange),{min:s[0],max:s[1]})}),max:1e3,min:0,step:10})]})]})]})]})});Se.displayName="SearchFilters";const be=()=>{const{query:e,setQuery:t,results:s,loading:a,error:n,filters:i,updateFilters:r,resetFilters:o,suggestions:c,hasMore:u,loadMore:m}=(()=>{const[e,t]=h.useState(""),[s,a]=h.useState([]),[n,i]=h.useState(!1),[r,o]=h.useState(null),[c,u]=h.useState({type:"all",category:"all",location:{enabled:!1,radius:50},dateRange:{enabled:!1,start:"",end:""},priceRange:{enabled:!1,min:0,max:1e3},tags:[],rating:0,sortBy:"relevance"}),[m,f]=h.useState([]),[p,x]=h.useState(0),[y,v]=h.useState(!0),{user:j}=g(),{currentLocation:w}=I(),N=h.useCallback((t,s,n)=>d(void 0,null,function*(){const r=t||e,l=s||c,d=n||0;if(!r.trim())return a([]),void v(!1);i(!0),o(null);try{const e={query:r,type:"all"===l.type?void 0:l.type,category:"all"===l.category?void 0:l.category,location:l.location.enabled&&w?{latitude:w.latitude,longitude:w.longitude,radius:l.location.radius}:void 0,dateRange:l.dateRange.enabled?{start:l.dateRange.start,end:l.dateRange.end}:void 0,priceRange:l.priceRange.enabled?{min:l.priceRange.min,max:l.priceRange.max}:void 0,tags:l.tags.length>0?l.tags:void 0,sortBy:l.sortBy,page:d,limit:20},t=yield we.search(e);a(0===d?t:e=>[...e,...t]),v(20===t.length),x(d),j&&(yield we.saveSearchHistory(j.id,r,l,t.length))}catch(u){o(u instanceof Error?u.message:"Search failed")}finally{i(!1)}}),[e,c,w,j]),S=h.useCallback(e=>d(void 0,null,function*(){if(e.trim())try{const t=yield we.getSearchSuggestions(e);f(t)}catch(t){}else f([])}),[]),b=h.useCallback(e=>{u(t=>l(l({},t),e)),x(0)},[]),_=h.useCallback(()=>{u({type:"all",category:"all",location:{enabled:!1,radius:50},dateRange:{enabled:!1,start:"",end:""},priceRange:{enabled:!1,min:0,max:1e3},tags:[],rating:0,sortBy:"relevance"}),x(0)},[]),C=h.useCallback(()=>{!n&&y&&N(e,c,p+1)},[n,y,N,e,c,p]),k=h.useCallback(()=>{a([]),x(0),v(!0),o(null)},[]);return h.useEffect(()=>{const t=setTimeout(()=>{e.trim()?(N(),S(e)):(k(),f([]))},500);return()=>clearTimeout(t)},[e,N,S,k]),h.useEffect(()=>{e.trim()&&N()},[c,N,e]),{query:e,setQuery:t,results:s,loading:n,error:r,filters:c,updateFilters:b,resetFilters:_,suggestions:m,hasMore:y,loadMore:C,clearResults:k,search:()=>N()}})(),[y,v]=h.useState(!1),[j,w]=h.useState(!1),N=h.useMemo(()=>({artist:["Photographer","Musician","DJ","Chef","Designer","Writer","Performer"],event:["Music","Food","Art","Sports","Business","Education","Entertainment"],post:["News","Discussion","Question","Announcement","Review"],group:["Hobby","Professional","Community","Interest","Location-based"],business:["Restaurant","Shop","Service","Entertainment","Health","Education"]}),[]);return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("div",{className:"relative flex-1",children:[f.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),f.jsx(A,{placeholder:"Search artists, events, posts, groups, businesses...",value:e,onChange:e=>{t(e.target.value),w(e.target.value.length>0)},onFocus:()=>w(e.length>0),className:"pl-10"}),e&&f.jsx(p,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",onClick:()=>{t(""),w(!1)},children:f.jsx(x,{className:"h-3 w-3"})})]}),f.jsxs(p,{variant:"outline",onClick:()=>v(!y),children:[f.jsx(J,{className:"h-4 w-4 mr-2"}),"Filters"]})]}),j&&c.length>0&&f.jsx("div",{className:"absolute top-full left-0 right-0 bg-background border rounded-md shadow-lg z-10 mt-1",children:c.map((e,s)=>f.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-muted flex items-center gap-2",onClick:()=>{t(e),w(!1)},children:[f.jsx(Q,{className:"h-3 w-3 text-muted-foreground"}),e]},s))})]}),y&&f.jsx(Se,{filters:i,updateFilters:r,resetFilters:o,categories:N}),n&&f.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:f.jsx("p",{className:"text-destructive text-sm",children:n})}),f.jsxs("div",{className:"space-y-4",children:[a&&f.jsxs("div",{className:"text-center py-8",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),f.jsx("p",{className:"mt-2 text-muted-foreground",children:"Searching..."})]}),!a&&0===s.length&&e&&f.jsxs("div",{className:"text-center py-8",children:[f.jsx(Q,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),f.jsx("h3",{className:"text-lg font-semibold",children:"No results found"}),f.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search terms or filters"})]}),s.map(e=>f.jsx(Ne,{result:e},`${e.type}-${e.id}`)),u&&s.length>0&&f.jsx("div",{className:"text-center pt-4",children:f.jsx(p,{variant:"outline",onClick:m,disabled:a,children:a?"Loading...":"Load More"})})]})]})};class _e{static calculateTrendingScore(e,t="day"){const s=this.calculateEngagementScore(e),a=this.calculateVelocityScore(e),n=this.calculateTimeDecayScore(e),i=this.calculateCategoryWeight(e),r=this.calculateLocationRelevance(e),l=this.calculateQualityScore(e),o=this.getPeriodWeights(t);return{engagementScore:s,velocityScore:a,timeDecayScore:n,categoryWeight:i,locationRelevance:r,qualityScore:l,finalScore:s*o.engagement+a*o.velocity+n*o.timeDecay+i*o.category+r*o.location+l*o.quality}}static calculateEngagementScore(e){const{likes:t,comments:s,shares:a,views:n}=e.engagement,i=1*t+2*s+3*a+.1*n;return Math.min(i/10,100)}static calculateVelocityScore(e){const{velocity:t}=e.engagement;return Math.min(10*t,100)}static calculateTimeDecayScore(e){const t=new Date,s=new Date(e.createdAt),a=(t.getTime()-s.getTime())/36e5,n=100*Math.exp(-.1*a);return Math.max(n,1)}static calculateCategoryWeight(e){return 100*({music:1.2,art:1.1,food:1,sports:1.3,business:.9,education:1,entertainment:1.2,health:1.1,technology:1,fashion:1.1,travel:1}[e.category.toLowerCase()]||1)}static calculateLocationRelevance(e){return 80}static calculateQualityScore(e){let t=50;if(e.title&&e.title.length>10&&(t+=10),e.description&&e.description.length>50&&(t+=10),e.image&&(t+=10),e.engagement.views>0){const s=e.engagement.likes/e.engagement.views;t+=Math.min(100*s,20)}return Math.min(t,100)}static getPeriodWeights(e){return{hour:{engagement:.25,velocity:.35,timeDecay:.2,category:.1,location:.05,quality:.05},day:{engagement:.3,velocity:.25,timeDecay:.25,category:.1,location:.05,quality:.05},week:{engagement:.35,velocity:.15,timeDecay:.2,category:.15,location:.1,quality:.05},month:{engagement:.4,velocity:.1,timeDecay:.15,category:.2,location:.1,quality:.05}}[e]}static rankTrendingContent(e,t="day"){return e.map(e=>{const s=this.calculateTrendingScore(e,t);return o(l({},e),{trendingScore:s.finalScore})}).sort((e,t)=>t.trendingScore-e.trendingScore)}static calculateTrendingVelocity(e){if(e.length<2)return 0;const t=e.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),s=(new Date(t[t.length-1].timestamp).getTime()-new Date(t[0].timestamp).getTime())/36e5,a=t[t.length-1].engagement-t[0].engagement;return s>0?a/s:0}static detectTrendingPattern(e){const t=e.engagement.velocity;return t>10?"rising":t>2?"stable":"declining"}static calculateTrendingMomentum(e){if(e.length<3)return 0;const t=[];for(let s=1;s<e.length;s++){const a=(new Date(e[s].timestamp).getTime()-new Date(e[s-1].timestamp).getTime())/36e5,n=e[s].engagement-e[s-1].engagement;t.push(a>0?n/a:0)}return t.length<2?0:t[t.length-1]-t[0]}static filterByQuality(e,t=30){return e.filter(e=>this.calculateTrendingScore(e).qualityScore>=t)}static getTrendingInsights(e){const t=this.detectTrendingPattern(e),s=e.engagement.velocity;let a="stable";s>20?a="strong":s>10?a="moderate":s<2&&(a="weak");let n="stable";n=s>15&&"rising"===t?"likely to trend higher":s<5&&"declining"===t?"likely to decline":"expected to remain stable";const i=[];return"rising"===t?(i.push("Consider promoting this content"),i.push("Monitor engagement closely")):"declining"===t&&(i.push("Consider refreshing content"),i.push("Analyze engagement patterns")),{pattern:t,momentum:a,prediction:n,recommendations:i}}}const Ce=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}getTrendingContent(e="day",t=20){return d(this,null,function*(){try{const s=[],a=yield this.getTrendingEvents(e,t/4);s.push(...a);const n=yield this.getTrendingPosts(e,t/4);s.push(...n);const i=yield this.getTrendingArtists(e,t/4);s.push(...i);const r=yield this.getTrendingGroups(e,t/4);return s.push(...r),_e.rankTrendingContent(s,e).slice(0,t)}catch(s){return[]}})}getTrendingEvents(e,t){return d(this,null,function*(){const s=this.getTimeFilter(e),{data:a}=yield m.from("events").select("\n        id,\n        title,\n        description,\n        category,\n        event_date,\n        location_name,\n        location_city,\n        location_state,\n        image_url,\n        max_attendees,\n        created_at\n      ").gte("event_date",(new Date).toISOString().split("T")[0]).gte("created_at",s).order("max_attendees",{ascending:!1}).limit(t);return a?a.map(t=>({id:t.id,type:"event",title:t.title,description:t.description,image:t.image_url,engagement:{likes:0,comments:0,shares:0,views:0,velocity:t.max_attendees||0},trendingScore:this.calculateTrendingScore(t.max_attendees||0,t.created_at),category:t.category,location:{name:t.location_name||"",city:t.location_city||"",state:t.location_state||""},createdAt:t.created_at,trendingPeriod:e})):[]})}getTrendingPosts(e,t){return d(this,null,function*(){const s=this.getTimeFilter(e),{data:a}=yield m.from("posts").select("\n        id,\n        user_id,\n        title,\n        content,\n        type,\n        likes_count,\n        comments_count,\n        created_at\n      ").eq("status","active").gte("created_at",s).order("likes_count",{ascending:!1}).limit(t);if(!a)return[];const n=[];for(const t of a){const{data:s}=yield m.from("profiles").select("display_name, avatar_url").eq("user_id",t.user_id).single();if(s){const a=(t.likes_count||0)+2*(t.comments_count||0);n.push({id:t.id,type:"post",title:t.title||"Untitled Post",description:t.content.substring(0,100)+"...",image:s.avatar_url,engagement:{likes:t.likes_count||0,comments:t.comments_count||0,shares:0,views:0,velocity:a},trendingScore:this.calculateTrendingScore(a,t.created_at),category:t.type||"general",createdAt:t.created_at,trendingPeriod:e})}}return n})}getTrendingArtists(e,t){return d(this,null,function*(){var s;this.getTimeFilter(e);const{data:a}=yield m.from("artists").select("\n        id,\n        user_id,\n        specialty,\n        bio,\n        hourly_rate_min,\n        is_available\n      ").eq("is_available",!0).limit(t);if(!a)return[];const n=[];for(const t of a){const{data:a}=yield m.from("profiles").select("display_name, avatar_url, location_city, location_state").eq("user_id",t.user_id).single();if(a){const i=Math.floor(100*Math.random())+10;n.push({id:t.id,type:"artist",title:a.display_name||"Anonymous",description:t.bio,image:a.avatar_url,engagement:{likes:0,comments:0,shares:0,views:i,velocity:i},trendingScore:this.calculateTrendingScore(i,(new Date).toISOString()),category:(null==(s=t.specialty)?void 0:s[0])||"artist",location:{name:a.location_city||"",city:a.location_city||"",state:a.location_state||""},createdAt:(new Date).toISOString(),trendingPeriod:e})}}return n})}getTrendingGroups(e,t){return d(this,null,function*(){const s=this.getTimeFilter(e),{data:a}=yield m.from("community_groups").select("\n        id,\n        name,\n        description,\n        category,\n        created_at\n      ").gte("created_at",s).limit(t);return a?a.map(t=>{const s=Math.floor(50*Math.random())+5;return{id:t.id,type:"group",title:t.name,description:t.description,engagement:{likes:0,comments:0,shares:0,views:s,velocity:s},trendingScore:this.calculateTrendingScore(s,t.created_at),category:t.category,createdAt:t.created_at,trendingPeriod:e}}):[]})}getTimeFilter(e){const t=new Date;let s;switch(e){case"hour":s=new Date(t.getTime()-36e5);break;case"day":default:s=new Date(t.getTime()-864e5);break;case"week":s=new Date(t.getTime()-6048e5);break;case"month":s=new Date(t.getTime()-2592e6)}return s.toISOString()}calculateTrendingScore(e,t){const s=new Date,a=new Date(t),n=(s.getTime()-a.getTime())/36e5,i=Math.max(.1,1-n/168);return 100*(.4*e+.4*(e/Math.max(1,n))+.2*i)}getDiscoverContent(e,t=20){return d(this,null,function*(){try{const s=yield this.getUserPreferences(e),r=yield this.getTrendingContent("day",2*t);return r.map(e=>o(l({},e),{personalizationScore:this.calculatePersonalizationScore(e,s)})).sort((e,t)=>t.personalizationScore-e.personalizationScore).slice(0,t).map(e=>{var t=e,{personalizationScore:s}=t;return((e,t)=>{var s={};for(var r in e)n.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&a)for(var r of a(e))t.indexOf(r)<0&&i.call(e,r)&&(s[r]=e[r]);return s})(t,["personalizationScore"])})}catch(s){return this.getTrendingContent("day",t)}})}getUserPreferences(e){return d(this,null,function*(){const{data:t}=yield m.from("posts").select("type, category").eq("user_id",e).gte("created_at",new Date(Date.now()-2592e6).toISOString()).limit(50);if(!t)return[];const s=new Set;return t.forEach(e=>{e.type&&s.add(e.type),e.category&&s.add(e.category)}),Array.from(s)})}calculatePersonalizationScore(e,t){if(0===t.length)return.5;let s=0,a=0;return t.includes(e.category)&&(s+=.4,a++),e.tags&&e.tags.forEach(e=>{t.includes(e)&&(s+=.2,a++)}),a>0?s/a:.5}};c(Ce,"instance");const ke=Ce.getInstance(),De=({content:e})=>{var t;return f.jsx(y,{className:"hover:shadow-md transition-shadow",children:f.jsx(w,{className:"p-4",children:f.jsxs("div",{className:"flex items-start gap-4",children:[f.jsxs(V,{className:"h-12 w-12",children:[f.jsx(B,{src:e.image}),f.jsx(H,{children:e.title.charAt(0)})]}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[(e=>({artist:f.jsx(W,{className:"h-4 w-4"}),event:f.jsx(Z,{className:"h-4 w-4"}),post:f.jsx(te,{className:"h-4 w-4"}),group:f.jsx(te,{className:"h-4 w-4"}),business:f.jsx(xe,{className:"h-4 w-4"})}[e]||f.jsx(ee,{className:"h-4 w-4"})))(e.type),f.jsx(C,{variant:"secondary",className:"text-xs",children:e.type}),f.jsxs(C,{variant:"outline",className:"text-xs text-green-600",children:[(e=>e>=1e3?`${(e/1e3).toFixed(1)}k`:Math.round(e).toString())(e.trendingScore)," trending"]}),f.jsx("h3",{className:"font-semibold truncate",children:e.title})]}),e.description&&f.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:e.description}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[e.location&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(xe,{className:"h-3 w-3"}),e.location.name||`${e.location.city}, ${e.location.state}`]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(se,{className:"h-3 w-3"}),K(new Date(e.createdAt),"MMM dd, yyyy")]})]}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(R,{className:"h-3 w-3"}),e.engagement.likes]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ae,{className:"h-3 w-3"}),e.engagement.comments]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ne,{className:"h-3 w-3"}),e.engagement.shares]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ie,{className:"h-3 w-3"}),e.engagement.views]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ee,{className:"h-3 w-3"}),e.engagement.velocity,"/hr"]})]}),(null==(t=e.metadata)?void 0:t.tags)&&Array.isArray(e.metadata.tags)&&f.jsx("div",{className:"flex gap-1 mt-2",children:e.metadata.tags.slice(0,3).map((e,t)=>f.jsx(C,{variant:"outline",className:"text-xs",children:e},t))})]}),f.jsx(p,{variant:"outline",size:"sm",children:"View"})]})})})},Fe=()=>{const{trendingContent:e,loading:t,error:s,period:a,changePeriod:n,refreshTrendingContent:i}=(()=>{const[e,t]=h.useState([]),[s,a]=h.useState(!1),[n,i]=h.useState(null),[r,l]=h.useState("day"),[o,c]=h.useState(20),u=h.useCallback(()=>d(void 0,null,function*(){a(!0),i(null);try{const e=yield ke.getTrendingContent(r,o);t(e)}catch(e){i(e instanceof Error?e.message:"Failed to fetch trending content")}finally{a(!1)}}),[r,o]),m=h.useCallback(()=>{u()},[u]),g=h.useCallback(e=>{l(e)},[]),f=h.useCallback(e=>{c(e)},[]);return h.useEffect(()=>{u()},[u]),{trendingContent:e,loading:s,error:n,period:r,limit:o,fetchTrendingContent:u,refreshTrendingContent:m,changePeriod:g,changeLimit:f}})();return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold",children:"Trending Content"}),f.jsx("p",{className:"text-muted-foreground",children:"Discover what's popular in your area"})]}),f.jsx(p,{variant:"outline",onClick:i,disabled:t,children:"Refresh"})]}),f.jsxs(k,{value:a,onValueChange:e=>n(e),children:[f.jsx(D,{children:[{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}].map(e=>f.jsx(F,{value:e.value,children:e.label},e.value))}),f.jsxs(M,{value:a,className:"space-y-4",children:[s&&f.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:f.jsx("p",{className:"text-destructive text-sm",children:s})}),t&&f.jsxs("div",{className:"text-center py-8",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),f.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading trending content..."})]}),!t&&0===e.length&&f.jsxs("div",{className:"text-center py-8",children:[f.jsx(ee,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),f.jsx("h3",{className:"text-lg font-semibold",children:"No trending content"}),f.jsx("p",{className:"text-muted-foreground",children:"Check back later for trending content in your area"})]}),f.jsx("div",{className:"grid gap-4",children:e.map(e=>f.jsx(De,{content:e},`${e.type}-${e.id}`))})]})]})]})};class Me{static generateRecommendations(e,t,s=20){const a=t.map(t=>{const s=this.calculateRecommendationScores(e,t);return o(l({},t),{scores:s})}).sort((e,t)=>t.scores.finalScore-e.scores.finalScore);return this.applyDiversityFilter(a,s).map((t,s)=>({id:`rec_${t.id}_${s}`,userId:e.userId,contentId:t.id,contentType:t.type,score:t.scores.finalScore,reason:this.generateRecommendationReason(e,t,t.scores),algorithm:"hybrid",metadata:{collaborativeScore:t.scores.collaborativeScore,contentBasedScore:t.scores.contentBasedScore,locationScore:t.scores.locationScore,freshnessScore:t.scores.freshnessScore,diversityScore:t.scores.diversityScore},createdAt:(new Date).toISOString(),expiresAt:new Date(Date.now()+864e5).toISOString()}))}static calculateRecommendationScores(e,t){const s=this.calculateCollaborativeScore(e,t),a=this.calculateContentBasedScore(e,t),n=this.calculateLocationScore(e,t),i=this.calculateFreshnessScore(t),r=this.calculateDiversityScore(t);return{collaborativeScore:s,contentBasedScore:a,locationScore:n,freshnessScore:i,diversityScore:r,finalScore:.3*s+.25*a+.2*n+.15*i+.1*r}}static calculateCollaborativeScore(e,t){const s=this.findSimilarUsers(e);if(0===s.length)return.5;const a=s.map(e=>{const s=e.preferences.find(e=>e.category===t.category);return s?s.weight:.5}),n=a.reduce((e,t)=>e+t,0)/a.length;return Math.min(n,1)}static calculateContentBasedScore(e,t){const s=e.preferences;if(0===s.length)return.5;const a=s.find(e=>e.category===t.category);if(a)return a.weight;const n=this.extractContentFeatures(t),i=this.extractUserInterests(e),r=this.calculateFeatureSimilarity(n,i);return Math.min(r,1)}static calculateLocationScore(e,t){if(!e.location||!t.location)return.5;const s=this.calculateDistance(e.location.latitude,e.location.longitude,t.location.latitude,t.location.longitude);return Math.max(0,1-s/50)}static calculateFreshnessScore(e){const t=new Date,s=new Date(e.createdAt),a=(t.getTime()-s.getTime())/36e5,n=Math.exp(-.05*a);return Math.max(n,.1)}static calculateDiversityScore(e){return.8}static findSimilarUsers(e){return[]}static extractContentFeatures(e){const t={};if(t[`category_${e.category}`]=1,e.tags&&e.tags.forEach(e=>{t[`tag_${e}`]=1}),e.price&&(t.price_low=e.price<50?1:0,t.price_medium=e.price>=50&&e.price<200?1:0,t.price_high=e.price>=200?1:0),e.date){const s=new Date(e.date),a=new Date,n=(s.getTime()-a.getTime())/864e5;t.time_soon=n<=7?1:0,t.time_medium=n>7&&n<=30?1:0,t.time_far=n>30?1:0}return t}static extractUserInterests(e){const t={};e.preferences.forEach(e=>{t[`category_${e.category}`]=e.weight});const s={};e.behaviorHistory.forEach(e=>{const t=`${e.action}_${e.contentType}`;s[t]=(s[t]||0)+1});const a=Math.max(...Object.values(s),1);return Object.entries(s).forEach(([e,s])=>{t[e]=s/a}),t}static calculateFeatureSimilarity(e,t){const s=new Set([...Object.keys(e),...Object.keys(t)]);let a=0,n=0,i=0;return s.forEach(s=>{const r=e[s]||0,l=t[s]||0;a+=r*l,n+=r*r,i+=l*l}),0===n||0===i?0:a/(Math.sqrt(n)*Math.sqrt(i))}static applyDiversityFilter(e,t){const s=[],a=new Set,n=new Set;for(const i of e){if(s.length>=t)break;const e=!a.has(i.category)||a.size>=3,r=!n.has(i.type)||n.size>=2;e&&r&&(s.push(i),a.add(i.category),n.add(i.type))}if(s.length<t)for(const i of e){if(s.length>=t)break;s.find(e=>e.id===i.id)||s.push(i)}return s}static generateRecommendationReason(e,t,s){const a=[];if(s.contentBasedScore>.7){e.preferences.find(e=>e.category===t.category)&&a.push(`Based on your interest in ${t.category}`)}return s.locationScore>.7&&a.push("Happening near you"),s.freshnessScore>.8&&a.push("Recently added"),s.collaborativeScore>.7&&a.push("Popular with similar users"),0===a.length&&a.push("Recommended for you"),a.join(", ")}static calculateDistance(e,t,s,a){const n=this.deg2rad(s-e),i=this.deg2rad(a-t),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(s))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}static deg2rad(e){return e*(Math.PI/180)}static updateUserPreferences(e,t,s,a){const n=[...e.preferences];let i=n.find(e=>e.category===s);i||(i={id:`pref_${s}`,userId:e.userId,category:s,weight:.5,source:"behavioral",lastUpdated:(new Date).toISOString()},n.push(i));const r=this.getWeightChangeForAction(t);return i.weight=Math.max(0,Math.min(1,i.weight+r)),i.lastUpdated=(new Date).toISOString(),n}static getWeightChangeForAction(e){return{like:.1,comment:.15,share:.2,bookmark:.1,follow:.25,view:.02,search:.05}[e]||0}}const Re=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}getRecommendations(e,t=20){return d(this,null,function*(){try{const s=yield this.getUserProfile(e),a=yield this.getAvailableContent(e);return Me.generateRecommendations(s,a,t)}catch(s){return[]}})}getUserProfile(e){return d(this,null,function*(){try{const{data:t}=yield m.from("user_preferences").select("*").eq("user_id",e).single(),{data:s}=yield m.from("user_behavior").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(100);return{userId:e,preferences:t||{},behavior:s||[],interests:(null==t?void 0:t.interests)||[],location:(null==t?void 0:t.location)||null}}catch(t){return{userId:e,preferences:{},behavior:[],interests:[],location:null}}})}getAvailableContent(e){return d(this,null,function*(){try{const{data:t}=yield m.from("posts").select("*").neq("user_id",e).order("created_at",{ascending:!1}).limit(100),{data:s}=yield m.from("events").select("*").order("created_at",{ascending:!1}).limit(50),{data:a}=yield m.from("profiles").select("*").eq("is_artist",!0).neq("id",e).limit(50);return[...(t||[]).map(e=>o(l({},e),{type:"post"})),...(s||[]).map(e=>o(l({},e),{type:"event"})),...(a||[]).map(e=>o(l({},e),{type:"artist"}))]}catch(t){return[]}})}generatePreferencesFromBehavior(e){return d(this,null,function*(){const t=[],{data:s}=yield m.from("posts").select("type, category").eq("user_id",e).limit(100);if(s){const a=new Map;s.forEach(e=>{e.type&&a.set(e.type,(a.get(e.type)||0)+1),e.category&&a.set(e.category,(a.get(e.category)||0)+1)}),a.forEach((s,a)=>{t.push({id:`${e}-${a}`,userId:e,category:a,weight:Math.min(1,s/10),source:"behavioral",lastUpdated:(new Date).toISOString()})})}const{data:a}=yield m.from("post_likes").select("post_id").eq("user_id",e).limit(100);if(a)for(const n of a){const{data:s}=yield m.from("posts").select("type, category").eq("id",n.post_id).single();if(s){const a=t.find(e=>e.category===(s.type||s.category));a?a.weight+=.1:t.push({id:`${e}-${s.type||s.category}`,userId:e,category:s.type||s.category||"general",weight:.1,source:"behavioral",lastUpdated:(new Date).toISOString()})}}return t})}getContentScores(e,t){return d(this,null,function*(){const s=[],{data:a}=yield m.from("posts").select("\n        id,\n        user_id,\n        title,\n        content,\n        type,\n        category,\n        likes_count,\n        comments_count,\n        created_at\n      ").eq("status","active").neq("user_id",e).order("created_at",{ascending:!1}).limit(200);if(!a)return s;for(const n of a){const a=yield this.calculateContentScore(n,t,e);s.push(a)}return s})}calculateContentScore(e,t,s){return d(this,null,function*(){let a=0,n=0,i=0,r=0;t.forEach(t=>{e.type!==t.category&&e.category!==t.category||(a+=t.weight)});const l=(e.likes_count||0)+2*(e.comments_count||0);n=Math.min(1,l/100);const o=(Date.now()-new Date(e.created_at).getTime())/36e5;i=Math.max(0,1-o/168);const{data:c}=yield m.from("profiles").select("latitude, longitude").eq("user_id",s).single();(null==c?void 0:c.latitude)&&(null==c?void 0:c.longitude)&&(r=.5);const d=.4*a+.3*n+.2*i+.1*r;return{contentId:e.id,contentType:"post",relevanceScore:a,popularityScore:n,freshnessScore:i,locationScore:r,overallScore:d,factors:{userInterest:a,contentQuality:n,engagement:n,recency:i,proximity:r}}})}generateRecommendations(e,t,s){return d(this,null,function*(){const a=[],n=t.sort((e,t)=>t.overallScore-e.overallScore).slice(0,s);for(const t of n){const s=this.generateRecommendationReason(t);a.push({id:`${e}-${t.contentId}`,userId:e,contentId:t.contentId,contentType:t.contentType,score:t.overallScore,reason:s,algorithm:"hybrid",metadata:{relevanceScore:t.relevanceScore,popularityScore:t.popularityScore,freshnessScore:t.freshnessScore,locationScore:t.locationScore},createdAt:(new Date).toISOString(),expiresAt:new Date(Date.now()+864e5).toISOString()})}return a})}generateRecommendationReason(e){const t=[];return e.factors.userInterest>.5&&t.push("matches your interests"),e.factors.contentQuality>.7&&t.push("highly engaging content"),e.factors.recency>.8&&t.push("fresh content"),e.factors.proximity>.6&&t.push("local to you"),0===t.length?"trending in your area":t.join(", ")}updateUserPreferences(e,t,s){return d(this,null,function*(){yield m.from("user_preferences").upsert({user_id:e,category:t,weight:s,source:"explicit",last_updated:(new Date).toISOString()})})}trackUserBehavior(e,t,s,a){return d(this,null,function*(){yield m.from("user_behavior").insert({user_id:e,action:t,content_type:s,content_id:a,metadata:{},timestamp:(new Date).toISOString(),session_id:`session-${Date.now()}`})})}};c(Re,"instance");const Te=Re.getInstance(),Ie=({recommendation:e})=>f.jsx(y,{className:"hover:shadow-md transition-shadow border-l-4 border-l-primary",children:f.jsx(w,{className:"p-4",children:f.jsxs("div",{className:"flex items-start gap-4",children:[f.jsx(V,{className:"h-12 w-12",children:f.jsx(H,{children:e.contentType.charAt(0).toUpperCase()})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[(e=>({artist:f.jsx(W,{className:"h-4 w-4"}),event:f.jsx(Z,{className:"h-4 w-4"}),post:f.jsx(te,{className:"h-4 w-4"}),group:f.jsx(te,{className:"h-4 w-4"}),business:f.jsx(xe,{className:"h-4 w-4"})}[e]||f.jsx(G,{className:"h-4 w-4"})))(e.contentType),f.jsx(C,{variant:"secondary",className:"text-xs",children:e.contentType}),f.jsxs(C,{variant:"outline",className:"text-xs text-blue-600",children:[(e=>Math.round(100*e))(e.score),"% match"]}),f.jsx("h3",{className:"font-semibold truncate",children:"Recommended Content"})]}),f.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:e.reason}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(G,{className:"h-3 w-3"}),e.algorithm]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(se,{className:"h-3 w-3"}),K(new Date(e.createdAt),"MMM dd, yyyy")]})]}),e.metadata&&f.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.metadata.relevanceScore&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(R,{className:"h-3 w-3"}),Math.round(100*e.metadata.relevanceScore),"% relevant"]}),e.metadata.popularityScore&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ae,{className:"h-3 w-3"}),Math.round(100*e.metadata.popularityScore),"% popular"]}),e.metadata.freshnessScore&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(se,{className:"h-3 w-3"}),Math.round(100*e.metadata.freshnessScore),"% fresh"]})]})]}),f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsx(p,{variant:"outline",size:"sm",children:"View"}),f.jsx(p,{variant:"ghost",size:"sm",children:f.jsx(R,{className:"h-3 w-3"})})]})]})})}),Ae=()=>{const{recommendations:e,loading:t,error:s,refreshRecommendations:a}=(()=>{const[e,t]=h.useState([]),[s,a]=h.useState(!1),[n,i]=h.useState(null),[r,l]=h.useState(20),{user:o}=g(),c=h.useCallback(()=>d(void 0,null,function*(){if(o){a(!0),i(null);try{const e=yield Te.getRecommendations(o.id,r);t(e)}catch(e){i(e instanceof Error?e.message:"Failed to fetch recommendations")}finally{a(!1)}}else t([])}),[o,r]),u=h.useCallback(()=>{c()},[c]),m=h.useCallback((e,t)=>d(void 0,null,function*(){if(o)try{yield Te.updateUserPreferences(o.id,e,t),yield c()}catch(s){}}),[o,c]),f=h.useCallback((e,t,s)=>d(void 0,null,function*(){if(o)try{yield Te.trackUserBehavior(o.id,e,t,s)}catch(a){}}),[o]),p=h.useCallback(e=>{l(e)},[]);return h.useEffect(()=>{c()},[c]),{recommendations:e,loading:s,error:n,limit:r,fetchRecommendations:c,refreshRecommendations:u,updateUserPreference:m,trackUserBehavior:f,changeLimit:p}})();return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold",children:"Recommended for You"}),f.jsx("p",{className:"text-muted-foreground",children:"Personalized content based on your interests and behavior"})]}),f.jsxs(p,{variant:"outline",onClick:a,disabled:t,children:[f.jsx(N,{className:"h-4 w-4 mr-2 "+(t?"animate-spin":"")}),"Refresh"]})]}),s&&f.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:f.jsx("p",{className:"text-destructive text-sm",children:s})}),t&&f.jsxs("div",{className:"text-center py-8",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),f.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading recommendations..."})]}),!t&&0===e.length&&f.jsxs("div",{className:"text-center py-8",children:[f.jsx(G,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),f.jsx("h3",{className:"text-lg font-semibold",children:"No recommendations yet"}),f.jsx("p",{className:"text-muted-foreground",children:"Start exploring content to get personalized recommendations"})]}),f.jsx("div",{className:"grid gap-4",children:e.map(e=>f.jsx(Ie,{recommendation:e},e.id))})]})};class Ee{static generateFollowSuggestions(e,t,s,a,n,i=20){return n.filter(t=>t.id!==e&&!a.includes(t.id)).map(a=>{const i=this.calculateFollowRecommendationScores(e,t,s,a,n);return o(l({},a),{scores:i})}).sort((e,t)=>t.scores.finalScore-e.scores.finalScore).slice(0,i).map((s,a)=>({id:`suggestion_${s.id}_${a}`,userId:s.id,displayName:s.display_name||s.username||"Anonymous",avatarUrl:s.avatar_url,bio:s.bio||"",score:s.scores.finalScore,commonInterests:this.findCommonInterests(t,s.interests||[]),mutualFollowers:this.countMutualFollowers(e,s.id,n),location:s.location?{city:s.location.city||"",state:s.location.state||""}:null,reason:this.generateFollowReason(s.scores,s),createdAt:(new Date).toISOString()}))}static calculateFollowRecommendationScores(e,t,s,a,n){const i=this.calculateSimilarityScore(t,a.interests||[]),r=this.calculateMutualConnectionsScore(e,a.id,n),l=this.calculateActivityScore(a),o=this.calculateLocationScore(s,a.location),c=this.calculateInterestOverlapScore(t,a.interests||[]);return{similarityScore:i,mutualConnectionsScore:r,activityScore:l,locationScore:o,interestOverlapScore:c,finalScore:.25*i+.3*r+.2*l+.15*o+.1*c}}static calculateSimilarityScore(e,t){if(0===e.length||0===t.length)return.5;const s=this.findCommonInterests(e,t).length/Math.max(e.length,t.length);return Math.min(s,1)}static calculateMutualConnectionsScore(e,t,s){const a=this.countMutualFollowers(e,t,s);return Math.min(a/50,1)}static calculateActivityScore(e){let t=.5;if(e.posts_count){t+=.2*Math.min(e.posts_count/100,1)}if(e.events_created_count){t+=.2*Math.min(e.events_created_count/20,1)}if(e.last_activity){const s=((new Date).getTime()-new Date(e.last_activity).getTime())/864e5;s<=7?t+=.3:s<=30?t+=.2:s<=90&&(t+=.1)}return Math.min(t,1)}static calculateLocationScore(e,t){if(!e||!t)return.5;if(e.city===t.city)return 1;if(e.state===t.state)return.7;if(t.latitude&&t.longitude){const s=this.calculateDistance(e.latitude,e.longitude,t.latitude,t.longitude),a=100;return Math.max(0,1-s/a)}return.3}static calculateInterestOverlapScore(e,t){if(0===e.length||0===t.length)return.5;const s=this.findCommonInterests(e,t).length/Math.min(e.length,t.length);return Math.min(s,1)}static findCommonInterests(e,t){const s=e.map(e=>e.toLowerCase()),a=t.map(e=>e.toLowerCase());return s.filter(e=>a.includes(e))}static countMutualFollowers(e,t,s){const a=s.find(t=>t.id===e),n=s.find(e=>e.id===t);if(!a||!n)return 0;const i=a.followers_count||0,r=n.followers_count||0,l=Math.min(i,r);return Math.floor(.1*l)}static calculateDistance(e,t,s,a){const n=this.deg2rad(s-e),i=this.deg2rad(a-t),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(s))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}static deg2rad(e){return e*(Math.PI/180)}static generateFollowReason(e,t){const s=[];if(e.similarityScore>.7&&s.push("Similar interests"),e.mutualConnectionsScore>.5){const t=Math.floor(50*e.mutualConnectionsScore);s.push(`${t} mutual connections`)}return e.activityScore>.7?s.push("Very active"):e.activityScore>.5&&s.push("Active user"),e.locationScore>.8?s.push("Same city"):e.locationScore>.6&&s.push("Nearby"),e.interestOverlapScore>.6&&s.push("Shared interests"),0===s.length&&s.push("Recommended for you"),s.join(", ")}static getPopularUsers(e,t=10){return e.filter(e=>e.followers_count>0).sort((e,t)=>(t.followers_count||0)-(e.followers_count||0)).slice(0,t)}static getUsersByInterest(e,t,s=10){const a=t.toLowerCase();return e.filter(e=>(e.interests||[]).some(e=>e.toLowerCase().includes(a))).sort((e,t)=>(t.followers_count||0)-(e.followers_count||0)).slice(0,s)}static calculateFollowStats(e,t,s){const a=t.length,n=s.length,i=t.filter(e=>s.some(t=>t.id===e.id)).length,r=t.reduce((e,t)=>e+(t.engagement_count||0),0),l=a>0?r/a:0,o=new Date(Date.now()-2592e6),c=t.filter(e=>new Date(e.followed_at||e.created_at)>o).length;return{userId:e,totalFollowers:a,totalFollowing:n,mutualFollowers:i,engagementRate:l,growthRate:a>0?c/a:0,lastUpdated:(new Date).toISOString()}}static analyzeFollowNetwork(e,t,s){const a=new Set([...t.map(e=>e.id),...s.map(e=>e.id)]).size,n=a*(a-1)/2,i=t.length+s.length,r=n>0?i/n:0,l=[...t,...s].filter(e=>(e.followers_count||0)>1e3).length,o=[...t,...s].flatMap(e=>e.interests||[]),c={};o.forEach(e=>{c[e]=(c[e]||0)+1});const d=Object.entries(c).filter(([e,t])=>t>1).sort(([e,t],[s,a])=>a-t).slice(0,5).map(([e,t])=>e),u=[];return r<.1&&u.push("Consider following more people to expand your network"),l<5&&u.push("Connect with more influential users in your field"),d.length<3&&u.push("Diversify your interests to connect with more people"),{networkSize:a,networkDensity:r,influentialConnections:l,commonInterests:d,recommendations:u}}}const Pe=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}followUser(e,t){return d(this,null,function*(){const{data:s,error:a}=yield m.from("user_follows").insert({follower_id:e,following_id:t,status:"active",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).select().single();if(a)throw new Error(`Failed to follow user: ${a.message}`);return s})}unfollowUser(e,t){return d(this,null,function*(){const{error:s}=yield m.from("user_follows").delete().eq("follower_id",e).eq("following_id",t);if(s)throw new Error(`Failed to unfollow user: ${s.message}`)})}getFollowStatus(e,t){return d(this,null,function*(){const{data:s}=yield m.from("user_follows").select("status").eq("follower_id",e).eq("following_id",t).single();return s?s.status:"not_following"})}getFollowers(e,t=20){return d(this,null,function*(){const{data:s}=yield m.from("user_follows").select("\n        *,\n        follower:profiles!user_follows_follower_id_fkey(\n          user_id,\n          display_name,\n          avatar_url,\n          bio\n        )\n      ").eq("following_id",e).eq("status","active").order("created_at",{ascending:!1}).limit(t);return s||[]})}getFollowing(e,t=20){return d(this,null,function*(){const{data:s}=yield m.from("user_follows").select("\n        *,\n        following:profiles!user_follows_following_id_fkey(\n          user_id,\n          display_name,\n          avatar_url,\n          bio\n        )\n      ").eq("follower_id",e).eq("status","active").order("created_at",{ascending:!1}).limit(t);return s||[]})}getFollowStats(e){return d(this,null,function*(){const{count:t}=yield m.from("user_follows").select("*",{count:"exact",head:!0}).eq("following_id",e).eq("status","active"),{count:s}=yield m.from("user_follows").select("*",{count:"exact",head:!0}).eq("follower_id",e).eq("status","active"),{data:a}=yield m.from("user_follows").select("follower_id").eq("following_id",e).eq("status","active"),{data:n}=yield m.from("user_follows").select("following_id").eq("follower_id",e).eq("status","active");return Ee.calculateFollowStats(e,a||[],n||[])})}getFollowSuggestions(e,t=10){return d(this,null,function*(){try{const s=yield this.getUserProfile(e),a=yield this.getAllUsers(e);return Ee.generateFollowSuggestions(e,s.interests,s.location,this.getExistingFollows(e),a,t)}catch(s){return[]}})}getPopularUsers(e=10){return d(this,null,function*(){try{const{data:t}=yield m.from("profiles").select("\n          user_id,\n          display_name,\n          avatar_url,\n          bio,\n          location_city,\n          location_state\n        ").order("created_at",{ascending:!1}).limit(2*e);if(!t)return[];const s=[];for(const e of t){const{count:t}=yield m.from("user_follows").select("*",{count:"exact",head:!0}).eq("following_id",e.user_id).eq("status","active");t&&t>5&&s.push({userId:e.user_id,displayName:e.display_name||"Anonymous",avatarUrl:e.avatar_url,bio:e.bio,mutualFollowers:0,commonInterests:[],location:e.location_city?{city:e.location_city,state:e.location_state||""}:void 0,score:t,reason:"Popular in your area"})}return s.sort((e,t)=>t.score-e.score).slice(0,e)}catch(t){return[]}})}getUsersByInterest(e,t=10){return d(this,null,function*(){try{const{data:s}=yield m.from("posts").select("user_id").or(`content.ilike.%${e}%,title.ilike.%${e}%`).eq("status","active").limit(100);if(!s)return[];const a=[...new Set(s.map(e=>e.user_id))];if(0===a.length)return[];const{data:n}=yield m.from("profiles").select("\n          user_id,\n          display_name,\n          avatar_url,\n          bio,\n          location_city,\n          location_state\n        ").in("user_id",a).limit(t);return n?n.map(t=>({userId:t.user_id,displayName:t.display_name||"Anonymous",avatarUrl:t.avatar_url,bio:t.bio,mutualFollowers:0,commonInterests:[e],location:t.location_city?{city:t.location_city,state:t.location_state||""}:void 0,score:1,reason:`Interested in ${e}`})):[]}catch(s){return[]}})}getUserProfile(e){return d(this,null,function*(){try{const{data:t}=yield m.from("profiles").select("*").eq("id",e).single(),{data:s}=yield m.from("user_preferences").select("*").eq("user_id",e).single();return{id:e,interests:(null==s?void 0:s.interests)||[],location:(null==t?void 0:t.location)||null,skills:(null==t?void 0:t.skills)||[],bio:(null==t?void 0:t.bio)||""}}catch(t){return{id:e,interests:[],location:null,skills:[],bio:""}}})}getAllUsers(e){return d(this,null,function*(){try{const{data:t}=yield m.from("user_follows").select("following_id").eq("follower_id",e).eq("status","active"),s=(null==t?void 0:t.map(e=>e.following_id))||[],{data:a}=yield m.from("profiles").select("*").neq("id",e).not("id","in",`(${s.join(",")})`);return a||[]}catch(t){return[]}})}getExistingFollows(e){return[]}};c(Pe,"instance");const qe=Pe.getInstance(),Oe=()=>{const[e,t]=h.useState([]),[s,a]=h.useState([]),[n,i]=h.useState(null),[r,l]=h.useState([]),[o,c]=h.useState(!1),[u,m]=h.useState(null),{user:f}=g(),p=h.useCallback(e=>d(void 0,null,function*(){if(!f&&!e)return;const s=e||f.id;c(!0),m(null);try{const e=yield qe.getFollowers(s);t(e)}catch(a){m(a instanceof Error?a.message:"Failed to fetch followers")}finally{c(!1)}}),[f]),x=h.useCallback(e=>d(void 0,null,function*(){if(!f&&!e)return;const t=e||f.id;c(!0),m(null);try{const e=yield qe.getFollowing(t);a(e)}catch(s){m(s instanceof Error?s.message:"Failed to fetch following")}finally{c(!1)}}),[f]),y=h.useCallback(e=>d(void 0,null,function*(){if(!f&&!e)return;const t=e||f.id;c(!0),m(null);try{const e=yield qe.getFollowStats(t);i(e)}catch(s){m(s instanceof Error?s.message:"Failed to fetch follow stats")}finally{c(!1)}}),[f]),v=h.useCallback(()=>d(void 0,null,function*(){if(f){c(!0),m(null);try{const e=yield qe.getFollowSuggestions(f.id);l(e)}catch(e){m(e instanceof Error?e.message:"Failed to fetch suggestions")}finally{c(!1)}}}),[f]),j=h.useCallback(e=>d(void 0,null,function*(){if(f){c(!0),m(null);try{yield qe.followUser(f.id,e),a(t=>[...t,{id:`${f.id}-${e}`,followerId:f.id,followingId:e,status:"active",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}]),yield y()}catch(t){m(t instanceof Error?t.message:"Failed to follow user")}finally{c(!1)}}}),[f,y]),w=h.useCallback(e=>d(void 0,null,function*(){if(f){c(!0),m(null);try{yield qe.unfollowUser(f.id,e),a(t=>t.filter(t=>t.followingId!==e)),yield y()}catch(t){m(t instanceof Error?t.message:"Failed to unfollow user")}finally{c(!1)}}}),[f,y]),N=h.useCallback(e=>d(void 0,null,function*(){if(!f)return"not_following";try{return yield qe.getFollowStatus(f.id,e)}catch(t){return"not_following"}}),[f]),S=h.useCallback((e=10)=>d(void 0,null,function*(){c(!0),m(null);try{return yield qe.getPopularUsers(e)}catch(t){return m(t instanceof Error?t.message:"Failed to fetch popular users"),[]}finally{c(!1)}}),[]),b=h.useCallback((e,t=10)=>d(void 0,null,function*(){c(!0),m(null);try{return yield qe.getUsersByInterest(e,t)}catch(s){return m(s instanceof Error?s.message:"Failed to fetch users by interest"),[]}finally{c(!1)}}),[]),_=h.useCallback(e=>d(void 0,null,function*(){if(!f&&!e)return;const t=e||f.id;yield Promise.all([p(t),x(t),y(t)]),e||(yield v())}),[f,p,x,y,v]);return h.useEffect(()=>{f&&_()},[f,_]),{followers:e,following:s,followStats:n,suggestions:r,loading:o,error:u,fetchFollowers:p,fetchFollowing:x,fetchFollowStats:y,fetchSuggestions:v,followUser:j,unfollowUser:w,getFollowStatus:N,getPopularUsers:S,getUsersByInterest:b,refreshAll:_}},Ue=({suggestion:e})=>{const{followUser:t,loading:s}=Oe();return f.jsx(y,{className:"hover:shadow-md transition-shadow",children:f.jsx(w,{className:"p-4",children:f.jsxs("div",{className:"flex items-start gap-4",children:[f.jsxs(V,{className:"h-12 w-12",children:[f.jsx(B,{src:e.avatarUrl}),f.jsx(H,{children:e.displayName.charAt(0)})]}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("h3",{className:"font-semibold truncate",children:e.displayName}),f.jsxs(C,{variant:"outline",className:"text-xs",children:[Math.round(e.score),"% match"]})]}),e.bio&&f.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:e.bio}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[e.location&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Y,{className:"h-3 w-3"}),e.location.city,", ",e.location.state]}),e.mutualFollowers>0&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(te,{className:"h-3 w-3"}),e.mutualFollowers," mutual"]})]}),e.commonInterests.length>0&&f.jsx("div",{className:"flex gap-1 mb-2",children:e.commonInterests.slice(0,3).map((e,t)=>f.jsx(C,{variant:"outline",className:"text-xs",children:e},t))}),f.jsx("p",{className:"text-xs text-muted-foreground",children:e.reason})]}),f.jsxs(p,{variant:"outline",size:"sm",onClick:()=>d(void 0,null,function*(){yield t(e.userId)}),disabled:s,children:[f.jsx(re,{className:"h-3 w-3 mr-1"}),"Follow"]})]})})})},Le=()=>{const{suggestions:e,loading:t,error:s,fetchSuggestions:a}=Oe();return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold",children:"People to Follow"}),f.jsx("p",{className:"text-muted-foreground",children:"Discover people with similar interests"})]}),f.jsxs(p,{variant:"outline",onClick:a,disabled:t,children:[f.jsx(N,{className:"h-4 w-4 mr-2 "+(t?"animate-spin":"")}),"Refresh"]})]}),s&&f.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:f.jsx("p",{className:"text-destructive text-sm",children:s})}),t&&f.jsxs("div",{className:"text-center py-8",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),f.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading suggestions..."})]}),!t&&0===e.length&&f.jsxs("div",{className:"text-center py-8",children:[f.jsx(te,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),f.jsx("h3",{className:"text-lg font-semibold",children:"No suggestions yet"}),f.jsx("p",{className:"text-muted-foreground",children:"Start following people to get personalized suggestions"})]}),f.jsx("div",{className:"grid gap-4",children:e.map(e=>f.jsx(Ue,{suggestion:e},e.userId))})]})},$e=({users:e,variant:t="default",layout:s="grid",showSearch:a=!0,showFilters:n=!0,showTabs:i=!0,className:r,loading:l=!1,error:o=null,onUserAction:c,onFollow:u,onMessage:m,onViewProfile:g,onShare:x,onEdit:N,onContact:b})=>{const[_,C]=h.useState(""),[R,T]=h.useState("all"),[I,E]=h.useState("name"),[P,q]=h.useState(!1),[O,U]=h.useState(!1),[L,$]=h.useState(!1),z=h.useMemo(()=>{let t=e;switch(_.trim()&&(t=t.filter(e=>{var t,s;return e.name.toLowerCase().includes(_.toLowerCase())||(null==(t=e.bio)?void 0:t.toLowerCase().includes(_.toLowerCase()))||(null==(s=e.location)?void 0:s.toLowerCase().includes(_.toLowerCase()))})),R){case"verified":t=t.filter(e=>e.verified);break;case"online":t=t.filter(e=>e.isOnline);break;case"premium":t=t.filter(e=>e.isPremium);break;case"trending":t=t.filter(e=>{var t;return null==(t=e.badges)?void 0:t.includes("trending")});break;case"featured":t=t.filter(e=>e.isFeatured)}return P&&(t=t.filter(e=>e.verified)),O&&(t=t.filter(e=>e.isOnline)),L&&(t=t.filter(e=>e.isPremium)),t.sort((e,t)=>{switch(I){case"name":return e.name.localeCompare(t.name);case"followers":return(t.followersCount||0)-(e.followersCount||0);case"rating":return(t.rating||0)-(e.rating||0);case"recent":return new Date(t.joinDate||"").getTime()-new Date(e.joinDate||"").getTime();default:return 0}}),t},[e,_,R,I,P,O,L]),V=h.useCallback((e,t,s)=>d(void 0,null,function*(){if(c)try{yield c(e,t,s)}catch(a){}}),[c]),B=h.useCallback(e=>d(void 0,null,function*(){u&&(yield u(e)),yield V(e,"follow")}),[u,V]),H=h.useCallback(e=>d(void 0,null,function*(){m&&(yield m(e)),yield V(e,"message")}),[m,V]),G=h.useCallback(e=>d(void 0,null,function*(){g&&(yield g(e)),yield V(e,"view_profile")}),[g,V]),J=h.useCallback(e=>d(void 0,null,function*(){x&&(yield x(e)),yield V(e,"share")}),[x,V]),Y=h.useCallback(e=>d(void 0,null,function*(){N&&(yield N(e)),yield V(e,"edit")}),[N,V]),X=h.useCallback(e=>d(void 0,null,function*(){b&&(yield b(e)),yield V(e,"contact")}),[b,V]);if(l)return f.jsx("div",{className:S("space-y-4",r),children:f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((e,t)=>f.jsxs(y,{className:"animate-pulse",children:[f.jsx(v,{className:"pb-4",children:f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsx("div",{className:"w-16 h-16 bg-muted rounded-full"}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("div",{className:"h-4 bg-muted rounded w-32"}),f.jsx("div",{className:"h-3 bg-muted rounded w-24"})]})]})}),f.jsxs(w,{className:"space-y-3",children:[f.jsx("div",{className:"h-3 bg-muted rounded w-full"}),f.jsx("div",{className:"h-3 bg-muted rounded w-3/4"})]})]},t))})});if(o)return f.jsx(y,{className:S("w-full",r),children:f.jsx(w,{className:"p-6 text-center",children:f.jsxs("div",{className:"text-destructive",children:[f.jsx(te,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),f.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Users"}),f.jsx("p",{className:"text-muted-foreground",children:o})]})})});if(0===z.length)return f.jsx(y,{className:S("w-full",r),children:f.jsx(w,{className:"p-6 text-center",children:f.jsxs("div",{className:"text-muted-foreground",children:[f.jsx(te,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),f.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Users Found"}),f.jsx("p",{className:"mb-4",children:_?`No users match "${_}"`:"No users available"}),_&&f.jsx(p,{variant:"outline",onClick:()=>C(""),children:"Clear Search"})]})})});const K=()=>{const a=z.map(e=>f.jsx(le,{user:e,variant:t,onFollow:B,onMessage:H,onViewProfile:G,onShare:J,onEdit:Y,onContact:X,showActions:!0,showStats:"minimal"!==t,showSocialLinks:"detailed"===t||"premium"===t||"featured"===t,showSkills:"detailed"===t||"premium"===t||"featured"===t,showInterests:"featured"===t,animate:!0,interactive:!0},e.id));switch(s){case"grid":return f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:a});case"list":return f.jsx("div",{className:"space-y-3",children:a});case"cards":return f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:a});case"enterprise":return f.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:e.map(e=>f.jsx(le,{user:e,variant:"enterprise",showActions:!0,showStats:!0,showSkills:!0,onFollow:u,onMessage:m,onViewProfile:g,onShare:x,onEdit:N,onContact:b,className:"h-full"},e.id))});case"dark":return f.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:e.map(e=>f.jsx(le,{user:e,variant:"dark",showActions:!0,showStats:!0,showSkills:!0,onFollow:u,onMessage:m,onViewProfile:g,onShare:x,onEdit:N,onContact:b,className:"h-full"},e.id))});default:return f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a})}};return f.jsxs("div",{className:S("space-y-6",r),children:[f.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold",children:"Users"}),f.jsxs("p",{className:"text-muted-foreground",children:[z.length," of ",e.length," users"]})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(p,{variant:"grid"===s?"default":"outline",size:"sm",onClick:()=>E("name"),children:f.jsx(oe,{className:"h-4 w-4"})}),f.jsx(p,{variant:"list"===s?"default":"outline",size:"sm",onClick:()=>E("name"),children:f.jsx(ce,{className:"h-4 w-4"})})]})]}),(a||n)&&f.jsxs(y,{children:[f.jsx(v,{children:f.jsx(j,{className:"text-lg",children:"Search & Filters"})}),f.jsxs(w,{className:"space-y-4",children:[a&&f.jsxs("div",{className:"relative",children:[f.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),f.jsx(A,{placeholder:"Search users by name, bio, or location...",value:_,onChange:e=>C(e.target.value),className:"pl-10"})]}),n&&f.jsxs("div",{className:"flex flex-wrap gap-2",children:[f.jsxs(p,{variant:P?"default":"outline",size:"sm",onClick:()=>q(!P),children:[f.jsx(de,{className:"h-4 w-4 mr-2"}),"Verified"]}),f.jsxs(p,{variant:O?"default":"outline",size:"sm",onClick:()=>U(!O),children:[f.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Online"]}),f.jsxs(p,{variant:L?"default":"outline",size:"sm",onClick:()=>$(!L),children:[f.jsx(W,{className:"h-4 w-4 mr-2"}),"Premium"]})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx("span",{className:"text-sm font-medium",children:"Sort by:"}),f.jsxs("select",{value:I,onChange:e=>E(e.target.value),className:"px-3 py-1 border rounded-md text-sm",children:[f.jsx("option",{value:"name",children:"Name"}),f.jsx("option",{value:"followers",children:"Followers"}),f.jsx("option",{value:"rating",children:"Rating"}),f.jsx("option",{value:"recent",children:"Recently Joined"})]})]})]})]}),i&&f.jsxs(k,{value:R,onValueChange:T,children:[f.jsxs(D,{className:"grid w-full grid-cols-6",children:[f.jsx(F,{value:"all",children:"All"}),f.jsxs(F,{value:"verified",children:[f.jsx(de,{className:"h-4 w-4 mr-2"}),"Verified"]}),f.jsxs(F,{value:"online",children:[f.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Online"]}),f.jsxs(F,{value:"premium",children:[f.jsx(W,{className:"h-4 w-4 mr-2"}),"Premium"]}),f.jsxs(F,{value:"trending",children:[f.jsx(ee,{className:"h-4 w-4 mr-2"}),"Trending"]}),f.jsxs(F,{value:"featured",children:[f.jsx(ue,{className:"h-4 w-4 mr-2"}),"Featured"]})]}),f.jsx(M,{value:"all",className:"mt-6",children:K()}),f.jsx(M,{value:"verified",className:"mt-6",children:K()}),f.jsx(M,{value:"online",className:"mt-6",children:K()}),f.jsx(M,{value:"premium",className:"mt-6",children:K()}),f.jsx(M,{value:"trending",className:"mt-6",children:K()}),f.jsx(M,{value:"featured",className:"mt-6",children:K()})]}),!i&&K()]})};function ze({users:e,variant:t="default",onReorder:s,onUserAction:a,onFollow:n,onMessage:i,onViewProfile:r,onShare:c,onEdit:d,onContact:u,className:m,showDragHandles:g=!0,allowReordering:x=!0}){const[v,j]=h.useState(e),[N,b]=h.useState(null),[_,k]=h.useState(null),D=h.useCallback((e,t)=>{if(!x)return;b(t),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",t.toString()));e.target.style.opacity="0.5"},[x]),F=h.useCallback((e,t)=>{x&&null!==N&&(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move"),_!==t&&k(t))},[x,N,_]),M=h.useCallback(e=>{e.preventDefault(),k(null)},[]),R=h.useCallback((e,t)=>{if(!x||null===N)return;e.preventDefault();const a=[...v],[n]=a.splice(N,1);a.splice(t,0,n),j(a),b(null),k(null);e.target.style.opacity="1",null==s||s(a)},[x,N,v,s]),T=h.useCallback(e=>{b(null),k(null);e.target.style.opacity="1"},[]),I=h.useCallback(()=>{const e=[...v].sort(()=>Math.random()-.5);j(e),null==s||s(e)},[v,s]),A=h.useCallback(()=>{j(e),null==s||s(e)},[e,s]);return f.jsxs("div",{className:S("space-y-4",m),children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(te,{className:"h-5 w-5 text-muted-foreground"}),f.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[v.length," users"]}),x&&f.jsx(C,{variant:"secondary",className:"text-xs",children:"Drag to reorder"})]}),x&&f.jsxs("div",{className:"flex gap-2",children:[f.jsxs(p,{variant:"outline",size:"sm",onClick:I,className:"text-xs",children:[f.jsx(ye,{className:"h-3 w-3 mr-1"}),"Shuffle"]}),f.jsx(p,{variant:"outline",size:"sm",onClick:A,className:"text-xs",children:"Reset"})]})]}),f.jsx("div",{className:"space-y-3",children:v.map((e,s)=>f.jsx(y,o(l({className:S("transition-all duration-200 cursor-move","hover:shadow-md hover:scale-[1.01]",N===s&&"opacity-50 scale-95",_===s&&"ring-2 ring-primary/50 ring-offset-2",!x&&"cursor-default")},x?{draggable:!0}:{}),{onDragStart:e=>D(e,s),onDragOver:e=>F(e,s),onDragLeave:M,onDrop:e=>R(e,s),onDragEnd:T,"data-testid":"user-card",children:f.jsx(w,{className:"p-4",children:f.jsxs("div",{className:"flex items-center gap-3",children:[g&&x&&f.jsx("div",{className:"flex-shrink-0 text-muted-foreground hover:text-foreground transition-colors","data-testid":"drag-handle",children:f.jsx(pe,{className:"h-5 w-5"})}),f.jsx("div",{className:"flex-1",children:f.jsx(le,{user:e,variant:t,showActions:!0,showStats:!1,showSkills:!1,onFollow:n,onMessage:i,onViewProfile:r,onShare:c,onEdit:d,onContact:u,className:"border-0 shadow-none p-0"})}),f.jsx("div",{className:"flex-shrink-0",children:f.jsxs(C,{variant:"outline",className:"text-xs",children:["#",s+1]})})]})})}),e.id))})]})}function Ve({users:e,variant:t="default",height:s=600,itemHeight:a=120,onUserAction:n,onFollow:i,onMessage:r,onViewProfile:l,onShare:o,onEdit:c,onContact:d,className:u,showSearch:m=!0,showFilters:g=!0,showSorting:x=!0,enableVirtualization:v=!0}){const[j,N]=h.useState(e),[b,_]=h.useState(e),[k,D]=h.useState(""),[F,M]=h.useState("name"),[R,T]=h.useState("asc"),[I,E]=h.useState(new Set),P=h.useRef(null),[q,O]=h.useState(0),U=h.useMemo(()=>{let t=[...e];if(k){const e=k.toLowerCase();t=t.filter(t=>{var s,a,n;return t.name.toLowerCase().includes(e)||(null==(s=t.bio)?void 0:s.toLowerCase().includes(e))||(null==(a=t.location)?void 0:a.toLowerCase().includes(e))||(null==(n=t.skills)?void 0:n.some(t=>t.toLowerCase().includes(e)))})}return I.size>0&&(t=t.filter(e=>!(I.has("verified")&&!e.verified)&&(!(I.has("premium")&&!e.isPremium)&&(!(I.has("featured")&&!e.isFeatured)&&!(I.has("online")&&!e.isOnline))))),t.sort((e,t)=>{let s,a;switch(F){case"name":s=e.name.toLowerCase(),a=t.name.toLowerCase();break;case"followers":s=e.followersCount||0,a=t.followersCount||0;break;case"joinDate":s=new Date(e.joinDate||"").getTime(),a=new Date(t.joinDate||"").getTime();break;case"rating":s=e.rating||0,a=t.rating||0;break;default:return 0}return"asc"===R?s>a?1:-1:s<a?1:-1}),t},[e,k,I,F,R]);h.useEffect(()=>{_(U)},[U]);const L=b.length*a,$=Math.ceil(s/a)+2,z=Math.max(0,Math.floor(q/a)),V=Math.min(b.length,z+$),B=v?b.slice(z,V):b,H=h.useCallback(e=>{v&&O(e.currentTarget.scrollTop)},[v]),W=h.useCallback(e=>{D(e)},[]),G=h.useCallback(e=>{E(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),Y=h.useCallback(e=>{F===e?T(e=>"asc"===e?"desc":"asc"):(M(e),T("asc"))},[F]),X=h.useCallback((e,s)=>{const n=v?(v?z+s:s)*a:0;return f.jsx("div",{className:"w-full",style:v?{position:"absolute",top:n,height:a}:void 0,children:f.jsx(y,{className:"h-full mx-2 mb-2 transition-all duration-200 hover:shadow-md",children:f.jsx(w,{className:"p-4",children:f.jsx(le,{user:e,variant:t,showActions:!0,showStats:!1,showSkills:!1,onFollow:i,onMessage:r,onViewProfile:l,onShare:o,onEdit:c,onContact:d,className:"border-0 shadow-none p-0"})})})},e.id)},[z,a,v,t,i,r,l,o,c,d]);return f.jsxs("div",{className:S("space-y-4",u),children:[f.jsxs("div",{className:"space-y-4",children:[f.jsx("div",{className:"flex items-center justify-between",children:f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(te,{className:"h-5 w-5 text-muted-foreground"}),f.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[b.length," of ",e.length," users"]}),v&&f.jsx(C,{variant:"secondary",className:"text-xs",children:"Virtualized"})]})}),m&&f.jsxs("div",{className:"relative",children:[f.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),f.jsx(A,{placeholder:"Search users by name, bio, location, or skills...",value:k,onChange:e=>W(e.target.value),className:"pl-10"})]}),(g||x)&&f.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[g&&f.jsxs(f.Fragment,{children:[f.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Filters:"}),["verified","premium","featured","online"].map(e=>f.jsxs(p,{variant:I.has(e)?"default":"outline",size:"sm",onClick:()=>G(e),className:"text-xs capitalize",children:[f.jsx(J,{className:"h-3 w-3 mr-1"}),e]},e))]}),x&&f.jsxs(f.Fragment,{children:[f.jsx("span",{className:"text-sm font-medium text-muted-foreground ml-4",children:"Sort by:"}),[{key:"name",label:"Name"},{key:"followers",label:"Followers"},{key:"joinDate",label:"Join Date"},{key:"rating",label:"Rating"}].map(({key:e,label:t})=>f.jsxs(p,{variant:F===e?"default":"outline",size:"sm",onClick:()=>Y(e),className:"text-xs",children:[t,F===e&&("asc"===R?f.jsx(he,{className:"h-3 w-3 ml-1"}):f.jsx(ge,{className:"h-3 w-3 ml-1"}))]},e))]})]})]}),f.jsx("div",{ref:P,className:"border rounded-lg",style:{height:s},children:f.jsx(me,{className:"h-full",onScroll:H,children:f.jsx("div",{className:"relative w-full",style:{height:v?L:"auto"},children:B.map((e,t)=>X(e,t))})})})]})}const Be=()=>{const{toast:e}=b(),{currentLocation:t}=I(),[s,a]=h.useState("search"),[n,i]=h.useState([]),[r,c]=h.useState([]),[u,g]=h.useState([]),[x,N]=h.useState(!0),[S,R]=h.useState([]),A=h.useCallback(()=>d(void 0,null,function*(){try{N(!0);const{data:e,error:a}=yield m.functions.invoke("fetch-local-news",{body:{location:t?"Your Area":"Local Area",latitude:null==t?void 0:t.latitude,longitude:null==t?void 0:t.longitude,radius:50}});a?i([{title:"Local Community Updates",description:"Stay connected with your local community and discover what's happening around you.",url:"#",source:"Local News",publishedAt:(new Date).toISOString(),category:"General"},{title:"Community Events This Week",description:"Find exciting events and activities happening in your neighborhood this week.",url:"#",source:"Community Events",publishedAt:new Date(Date.now()-72e5).toISOString(),category:"Events"}]):e&&e.news?i(e.news.slice(0,5)):i([{title:"Local Community Updates",description:"Stay connected with your local community and discover what's happening around you.",url:"#",source:"Local News",publishedAt:(new Date).toISOString(),category:"General"},{title:"Community Events This Week",description:"Find exciting events and activities happening in your neighborhood this week.",url:"#",source:"Community Events",publishedAt:new Date(Date.now()-72e5).toISOString(),category:"Events"}]);try{const{data:e}=yield m.from("events").select("*").gte("event_date",(new Date).toISOString().split("T")[0]).order("event_date",{ascending:!0}).limit(6);e&&c(e.map(e=>({id:e.id,title:e.title,description:e.description,location:e.location_name,date:e.event_date,category:e.category,price:e.price?`$${e.price}`:"Free"})))}catch(s){c([{id:"1",title:"Community Meetup",description:"Join us for a friendly community gathering",location:"Local Community Center",date:new Date(Date.now()+6048e5).toISOString(),category:"Community",price:"Free"}])}}catch(a){e({title:"Error",description:"Failed to load local content",variant:"destructive"})}finally{N(!1)}}),[t,e]),E=h.useCallback(()=>d(void 0,null,function*(){try{const{data:e}=yield m.from("events").select("\n          id,\n          title,\n          description,\n          category,\n          max_attendees,\n          event_date,\n          image_url\n        ").gte("event_date",(new Date).toISOString().split("T")[0]).order("max_attendees",{ascending:!1}).limit(3),{data:t}=yield m.from("artists").select("\n          id,\n          user_id,\n          specialty,\n          bio\n        ").eq("is_available",!0).limit(3),{data:s}=yield m.from("posts").select("\n          id,\n          user_id,\n          title,\n          content,\n          type,\n          likes_count\n        ").eq("status","active").order("likes_count",{ascending:!1}).limit(3),a=[...(null==e?void 0:e.map(e=>({id:e.id,type:"event",title:e.title,description:e.description,engagement:e.max_attendees||0,image:e.image_url})))||[],...(null==t?void 0:t.map(e=>{var t;return{id:e.id,type:"artist",title:"Artist Profile",description:e.bio||(null==(t=e.specialty)?void 0:t.join(", "))||"",engagement:0,image:void 0}}))||[],...(null==s?void 0:s.map(e=>({id:e.id,type:"post",title:e.title||"Untitled Post",description:e.content.substring(0,100)+"...",engagement:e.likes_count||0,image:void 0})))||[]];g(a)}catch(e){}}),[]),P=h.useCallback(()=>d(void 0,null,function*(){try{R([{id:"user-1",name:"Sarah Johnson",email:"sarah@example.com",avatar:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=200&h=200&fit=crop&crop=face",bio:"Event organizer and community builder passionate about bringing people together",location:"San Francisco, CA",verified:!0,followersCount:2341,followingCount:189,isFollowing:!1,isOnline:!0,badges:["trending"],skills:["Event Planning","Community Management","Marketing"],interests:["Community","Events","Networking"],joinDate:"2021-08-15",eventsCount:23,projectsCount:12,isPremium:!0,isFeatured:!1},{id:"user-2",name:"Michael Chen",email:"michael@example.com",avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face",bio:"Tech entrepreneur and startup mentor helping others build successful businesses",location:"Austin, TX",verified:!0,followersCount:5678,followingCount:234,isFollowing:!0,isOnline:!1,badges:["trending"],skills:["Startup Strategy","Product Development","Investor Relations"],interests:["Technology","Business","Innovation"],joinDate:"2020-12-01",eventsCount:45,projectsCount:18,isPremium:!0,isFeatured:!0},{id:"user-3",name:"Emma Rodriguez",email:"emma@example.com",avatar:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop&crop=face",bio:"Creative designer and artist exploring the intersection of art and technology",location:"Portland, OR",verified:!1,followersCount:892,followingCount:456,isFollowing:!1,isOnline:!0,badges:[],skills:["UI/UX Design","Digital Art","Creative Direction"],interests:["Art","Design","Technology"],joinDate:"2023-01-20",eventsCount:8,projectsCount:5,isPremium:!1,isFeatured:!1},{id:"user-4",name:"David Kim",email:"david@example.com",avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop&crop=face",bio:"Fitness coach and wellness advocate promoting healthy lifestyles",location:"Miami, FL",verified:!0,followersCount:3456,followingCount:123,isFollowing:!1,isOnline:!1,badges:["trending"],skills:["Personal Training","Nutrition","Wellness Coaching"],interests:["Fitness","Health","Wellness"],joinDate:"2022-06-10",eventsCount:32,projectsCount:14,isPremium:!0,isFeatured:!1}])}catch(t){e({title:"Error",description:"Failed to load discovered users",variant:"destructive"})}}),[e]);h.useEffect(()=>{A(),E(),P()},[A,E,P]);const q=h.useCallback((t,s,a)=>d(void 0,null,function*(){switch(s){case"follow":e({title:"Success",description:"You are now following this user"});break;case"message":e({title:"Message",description:"Opening message composer..."});break;case"view_profile":e({title:"Profile",description:"Navigating to user profile..."});break;case"share":e({title:"Share",description:"Sharing user profile..."});break;case"edit":e({title:"Edit",description:"Opening profile editor..."});break;case"contact":e({title:"Contact",description:"Opening contact options..."})}}),[e]),O=h.useCallback(t=>d(void 0,null,function*(){try{R(e=>e.map(e=>e.id===t?o(l({},e),{isFollowing:!e.isFollowing}):e)),e({title:"Success",description:"Follow status updated"})}catch(s){e({title:"Error",description:"Failed to update follow status",variant:"destructive"})}}),[e]),U=h.useCallback(t=>d(void 0,null,function*(){e({title:"Message",description:"Opening message composer..."})}),[e]),L=h.useCallback(t=>d(void 0,null,function*(){e({title:"Profile",description:"Navigating to user profile..."})}),[e]),$=h.useCallback(t=>d(void 0,null,function*(){e({title:"Share",description:"Sharing user profile..."})}),[e]),z=h.useCallback(t=>d(void 0,null,function*(){e({title:"Edit",description:"Opening profile editor..."})}),[e]),V=h.useCallback(t=>d(void 0,null,function*(){e({title:"Contact",description:"Opening contact options..."})}),[e]);return f.jsx(T,{children:f.jsxs("div",{className:"container mx-auto px-4 py-8",children:[f.jsxs("div",{className:"mb-8",children:[f.jsx("h1",{className:"text-4xl font-bold text-center mb-4",children:"Discover Your Community"}),f.jsx("p",{className:"text-xl text-center text-muted-foreground max-w-3xl mx-auto",children:"Connect with amazing people, discover local events, and explore trending content in your area"})]}),f.jsxs(k,{value:s,onValueChange:a,className:"w-full",children:[f.jsxs(D,{className:"grid w-full grid-cols-7",children:[f.jsx(F,{value:"overview",children:"Overview"}),f.jsx(F,{value:"users",children:"People"}),f.jsx(F,{value:"events",children:"Events"}),f.jsx(F,{value:"trending",children:"Trending"}),f.jsx(F,{value:"recommendations",children:"Recommendations"}),f.jsx(F,{value:"draggable",children:"Draggable"}),f.jsx(F,{value:"virtualized",children:"Virtualized"})]}),f.jsx(M,{value:"search",className:"space-y-6",children:f.jsx(be,{})}),f.jsxs(M,{value:"users",className:"space-y-6",children:[f.jsxs("div",{className:"mb-6",children:[f.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Discover Amazing People"}),f.jsx("p",{className:"text-muted-foreground",children:"Connect with verified professionals, creators, and community leaders"})]}),f.jsxs(y,{children:[f.jsxs(v,{children:[f.jsxs(j,{className:"flex items-center gap-2",children:[f.jsx(W,{className:"h-5 w-5 text-yellow-500"}),"Featured Users"]}),f.jsx(_,{children:"Premium and verified users you might want to connect with"})]}),f.jsx(w,{children:f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:S.filter(e=>e.isPremium||e.isFeatured).map(e=>f.jsx(le,{user:e,variant:e.isFeatured?"featured":"premium",onFollow:O,onMessage:U,onViewProfile:L,onShare:$,onEdit:z,onContact:V,showActions:!0,showStats:!0,showSocialLinks:!0,showSkills:!0,showInterests:!0,animate:!0,interactive:!0},e.id))})})]}),f.jsxs(y,{children:[f.jsxs(v,{children:[f.jsxs(j,{className:"flex items-center gap-2",children:[f.jsx(te,{className:"h-5 w-5"}),"All Users"]}),f.jsx(_,{children:"Browse and discover users in your community"})]}),f.jsx(w,{children:f.jsx($e,{users:S,variant:"compact",layout:"grid",showSearch:!0,showFilters:!0,showTabs:!0,onUserAction:q,onFollow:O,onMessage:U,onViewProfile:L,onShare:$,onEdit:z,onContact:V})})]})]}),f.jsxs(M,{value:"events",className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("h2",{className:"text-2xl font-semibold",children:"Nearby Events"}),f.jsx(p,{variant:"outline",onClick:()=>window.location.href="/events",children:"View All Events"})]}),x?f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,t)=>f.jsxs(y,{className:"animate-pulse",children:[f.jsx(v,{children:f.jsx("div",{className:"h-4 bg-muted rounded w-3/4"})}),f.jsxs(w,{children:[f.jsx("div",{className:"h-3 bg-muted rounded w-full mb-2"}),f.jsx("div",{className:"h-3 bg-muted rounded w-2/3"})]})]},t))}):f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(e=>f.jsxs(y,{className:"hover:shadow-md transition-shadow",children:[f.jsxs(v,{children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx(C,{variant:"outline",children:e.category}),f.jsx("span",{className:"text-sm font-medium text-green-600",children:e.price})]}),f.jsx(j,{className:"text-lg",children:e.title})]}),f.jsxs(w,{children:[f.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.description}),f.jsxs("div",{className:"space-y-2 text-sm",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),f.jsx("span",{children:e.location})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),f.jsx("span",{children:K(new Date(e.date),"MMM dd, yyyy")})]})]})]})]},e.id))})]}),f.jsx(M,{value:"trending",className:"space-y-6",children:f.jsx(Fe,{})}),f.jsxs(M,{value:"recommendations",className:"space-y-6",children:[f.jsx(Ae,{}),f.jsx(Le,{})]}),f.jsx(M,{value:"draggable",className:"space-y-6",children:f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Interactive User List"}),f.jsx("p",{className:"text-muted-foreground",children:"Drag and drop users to reorder them. Use the shuffle button to randomize the order."})]}),f.jsxs(y,{children:[f.jsxs(v,{children:[f.jsxs(j,{className:"flex items-center gap-2",children:[f.jsx(pe,{className:"h-5 w-5 text-blue-500"}),"Draggable Users"]}),f.jsx(_,{children:"Drag users to reorder them. Click shuffle to randomize the order."})]}),f.jsx(w,{children:f.jsx(ze,{users:S,variant:"compact",onReorder:t=>{R(t),e({title:"Users Reordered",description:"The user list has been updated with the new order."})},onFollow:O,onMessage:U,onViewProfile:L,onShare:$,onEdit:z,onContact:V,showDragHandles:!0,allowReordering:!0})})]})]})}),f.jsx(M,{value:"virtualized",className:"space-y-6",children:f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold mb-2",children:"High-Performance User List"}),f.jsx("p",{className:"text-muted-foreground",children:"This list uses virtualization to handle large datasets efficiently. Only visible items are rendered."})]}),f.jsxs(y,{children:[f.jsxs(v,{children:[f.jsxs(j,{className:"flex items-center gap-2",children:[f.jsx(fe,{className:"h-5 w-5 text-green-500"}),"Virtualized Users"]}),f.jsx(_,{children:"High-performance list with search, filtering, and sorting capabilities."})]}),f.jsx(w,{children:f.jsx(Ve,{users:S,variant:"dark",height:600,itemHeight:120,onFollow:O,onMessage:U,onViewProfile:L,onShare:$,onEdit:z,onContact:V,showSearch:!0,showFilters:!0,showSorting:!0,enableVirtualization:!0})})]})]})})]})]})})};export{Be as default};
