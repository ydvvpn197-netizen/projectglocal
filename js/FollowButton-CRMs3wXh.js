var o=(o,e,l)=>new Promise((t,i)=>{var r=o=>{try{n(l.next(o))}catch(e){i(e)}},s=o=>{try{n(l.throw(o))}catch(e){i(e)}},n=o=>o.done?t(o.value):Promise.resolve(o.value).then(r,s);n((l=l.apply(o,e)).next())});import{u as e,d as l,r as t,s as i,j as r,B as s}from"./index-B5IYdG7F.js";import{n}from"./useNotifications-C0wifgqF.js";import{U as a}from"./user-check-CtFDHM0C.js";import{U as c}from"./user-plus-BRSjM2Wl.js";const u=r=>{const{user:s}=e(),{toast:a}=l(),[c,u]=t.useState(!1),[d,f]=t.useState(0),[w,m]=t.useState(0),[g,h]=t.useState(!0);t.useEffect(()=>{r&&(v(),p())},[r,s]);const v=()=>o(void 0,null,function*(){if(s&&r)try{const{data:o,error:e}=yield i.from("follows").select("id").eq("follower_id",s.id).eq("following_id",r).single();u(!(!o||e))}catch(o){u(!1)}}),p=()=>o(void 0,null,function*(){if(r)try{const[o,e]=yield Promise.all([i.from("follows").select("id",{count:"exact"}).eq("following_id",r),i.from("follows").select("id",{count:"exact"}).eq("follower_id",r)]);f(o.count||0),m(e.count||0)}catch(o){}finally{h(!1)}});return{isFollowing:c,followersCount:d,followingCount:w,loading:g,toggleFollow:()=>o(void 0,null,function*(){if(!s||!r)return a({title:"Sign in required",description:"Please sign in to follow users",variant:"destructive"}),!1;if(s.id===r)return a({title:"Cannot follow yourself",description:"You cannot follow your own profile",variant:"destructive"}),!1;try{if(c){const{error:o}=yield i.from("follows").delete().eq("follower_id",s.id).eq("following_id",r);if(o)throw o;u(!1),f(o=>o-1),a({title:"Unfollowed",description:"You have unfollowed this user"})}else{const{error:e}=yield i.from("follows").insert({follower_id:s.id,following_id:r});if(e)throw e;try{yield n.createNewFollowerNotification(s.id,r)}catch(o){}u(!0),f(o=>o+1),a({title:"Following",description:"You are now following this user"})}return!0}catch(e){return a({title:"Error",description:"Failed to update follow status",variant:"destructive"}),!1}}),refetch:()=>{v(),p()}}},d=({userId:o,variant:l="outline",size:t="default",className:i})=>{const{user:n}=e(),{isFollowing:d,toggleFollow:f}=u(o);return(null==n?void 0:n.id)===o?null:r.jsx(s,{variant:l,size:t,onClick:f,className:i,children:d?r.jsxs(r.Fragment,{children:[r.jsx(a,{className:"h-4 w-4 mr-2"}),"Following"]}):r.jsxs(r.Fragment,{children:[r.jsx(c,{className:"h-4 w-4 mr-2"}),"Follow"]})})};export{d as F,u};
