var ne=Object.defineProperty,ie=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var O=(i,l,n)=>l in i?ne(i,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[l]=n,C=(i,l)=>{for(var n in l||(l={}))oe.call(l,n)&&O(i,n,l[n]);if(X)for(var n of X(l))de.call(l,n)&&O(i,n,l[n]);return i},R=(i,l)=>ie(i,ce(l));var E=(i,l,n)=>new Promise((y,g)=>{var f=o=>{try{t(n.next(o))}catch(h){g(h)}},v=o=>{try{t(n.throw(o))}catch(h){g(h)}},t=o=>o.done?y(o.value):Promise.resolve(o.value).then(f,v);t((n=n.apply(i,l)).next())});import{r as x,j as e,C as U,p as G,q as W,v as J,t as me,B as d,X as xe}from"./main-jfCIwKxb.js";import{B as j}from"./badge-Cxniq3nT.js";import{I as he}from"./index-DGobKVbi.js";import{S,a as T,b as A,c as D,d as r}from"./select-BK9ujtwJ.js";import{T as je,a as pe,b as K,c as p,d as ue,e as u}from"./table-CffYG2bb.js";import{D as ge,a as ve,b as Ne,c as ye,d as fe}from"./dialog-Db9VuKsi.js";import{A as be,a as we}from"./alert-f_BC70aV.js";import{T as Ce,a as Re,b as F,c as I}from"./tabs-Bho2AISw.js";import{u as Se,A as Te,a as Ae,b as De,F as Q}from"./AdminLayout-CnjN1zMu.js";import{F as ke}from"./filter-IFAci8Bw.js";import{S as _e}from"./search-DIpOLffQ.js";import{S as Ee}from"./shield-C-Scp_5m.js";import{C as Y}from"./clock-CT2ky6hG.js";import{U as Fe}from"./user-cZSM4iEh.js";import{C as Z}from"./calendar-CXbnSY_4.js";import{E as Ie}from"./eye-CYa_iGA4.js";import{C as Me}from"./check-CWeqS_MX.js";import{C as $}from"./check-circle-DlKkeJkD.js";import{X as Pe}from"./x-circle-kobPzj2Z.js";import{A as ee}from"./alert-triangle-DO8UyvKH.js";import{F as M}from"./file-text-C_1z4c-s.js";import{M as Be}from"./message-square-oWFCH1Pi.js";import"./index-CaL9moq2.js";import"./index-BqrjOP3n.js";import"./chevron-up-DhaGujCg.js";import"./index-D6sgUugm.js";import"./label-BhjyL16S.js";import"./eye-off-BZA63c1R.js";import"./loader-2-iBg9Stez.js";import"./scroll-area-Bsyy6uVd.js";import"./bar-chart-3-C2V0ogLU.js";import"./log-out-CxjypOOW.js";const gs=()=>{var L;Se();const i=x.useMemo(()=>new Te,[]),[l,n]=x.useState([]),[y,g]=x.useState(!0),[f,v]=x.useState(null),[t,o]=x.useState({search:"",contentType:"all",reportStatus:"all",reportReason:"all",dateRange:"all",page:1,limit:20}),[h,se]=x.useState(0),[c,P]=x.useState(null),[ae,b]=x.useState(!1);x.useEffect(()=>{k()},[t,k]);const k=x.useCallback(()=>E(void 0,null,function*(){try{g(!0),v(null);const s=yield i.getContentReports(t);n(s.data||[]),se(s.total||0)}catch(s){v(s instanceof Error?s.message:"Failed to load reports")}finally{g(!1)}}),[t,i]),te=s=>{o(a=>R(C({},a),{search:s,page:1}))},w=(s,a)=>{o(m=>R(C({},m),{[s]:a,page:1}))},B=s=>{o(a=>R(C({},a),{page:s}))},N=(s,a,m)=>E(void 0,null,function*(){try{yield i.resolveContentReport(s,a,m),k(),b(!1),P(null)}catch(q){v(q instanceof Error?q.message:"Failed to perform moderation action")}}),V=s=>{switch(s){case"pending":return e.jsx(j,{className:"bg-yellow-100 text-yellow-800",children:"Pending Review"});case"resolved":return e.jsx(j,{className:"bg-green-100 text-green-800",children:"Resolved"});case"dismissed":return e.jsx(j,{className:"bg-gray-100 text-gray-800",children:"Dismissed"});case"escalated":return e.jsx(j,{className:"bg-red-100 text-red-800",children:"Escalated"});default:return e.jsx(j,{variant:"secondary",children:s})}},re=s=>{switch(s){case"post":return e.jsx(M,{className:"h-4 w-4"});case"comment":return e.jsx(Be,{className:"h-4 w-4"});case"event":return e.jsx(Z,{className:"h-4 w-4"});case"review":return e.jsx(M,{className:"h-4 w-4"});default:return e.jsx(M,{className:"h-4 w-4"})}},z=s=>{switch(s){case"spam":return"bg-yellow-100 text-yellow-800";case"inappropriate":return"bg-red-100 text-red-800";case"harassment":return"bg-red-100 text-red-800";case"misinformation":return"bg-orange-100 text-orange-800";case"copyright":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},H=s=>new Date(s).toLocaleDateString(),_=s=>{let a=0;switch(s.report_reason){case"harassment":a+=5;break;case"inappropriate":a+=4;break;case"misinformation":a+=3;break;case"spam":a+=2;break;case"copyright":a+=3;break;default:a+=1}const m=(Date.now()-new Date(s.created_at).getTime())/(1e3*60*60);return m<1?a+=3:m<24?a+=2:m<72&&(a+=1),a},le=[...l].sort((s,a)=>_(a)-_(s));return y&&l.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"})}):e.jsx(Ae,{requiredPermission:"moderation:manage",children:e.jsxs(De,{children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Content Moderation"}),e.jsx("p",{className:"text-gray-600",children:"Review and take action on reported content"})]}),f&&e.jsx(be,{className:"mb-6",children:e.jsx(we,{children:f})}),e.jsxs(U,{className:"mb-6",children:[e.jsx(G,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),"Filters"]})}),e.jsx(J,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(he,{placeholder:"Search reports...",value:t.search,onChange:s=>te(s.target.value),className:"pl-10"})]}),e.jsxs(S,{value:t.contentType,onValueChange:s=>w("contentType",s),children:[e.jsx(T,{children:e.jsx(A,{placeholder:"All Content Types"})}),e.jsxs(D,{children:[e.jsx(r,{value:"all",children:"All Content Types"}),e.jsx(r,{value:"post",children:"Posts"}),e.jsx(r,{value:"comment",children:"Comments"}),e.jsx(r,{value:"event",children:"Events"}),e.jsx(r,{value:"review",children:"Reviews"})]})]}),e.jsxs(S,{value:t.reportStatus,onValueChange:s=>w("reportStatus",s),children:[e.jsx(T,{children:e.jsx(A,{placeholder:"All Status"})}),e.jsxs(D,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"resolved",children:"Resolved"}),e.jsx(r,{value:"dismissed",children:"Dismissed"}),e.jsx(r,{value:"escalated",children:"Escalated"})]})]}),e.jsxs(S,{value:t.reportReason,onValueChange:s=>w("reportReason",s),children:[e.jsx(T,{children:e.jsx(A,{placeholder:"All Reasons"})}),e.jsxs(D,{children:[e.jsx(r,{value:"all",children:"All Reasons"}),e.jsx(r,{value:"spam",children:"Spam"}),e.jsx(r,{value:"inappropriate",children:"Inappropriate"}),e.jsx(r,{value:"harassment",children:"Harassment"}),e.jsx(r,{value:"misinformation",children:"Misinformation"}),e.jsx(r,{value:"copyright",children:"Copyright"})]})]}),e.jsxs(S,{value:t.dateRange,onValueChange:s=>w("dateRange",s),children:[e.jsx(T,{children:e.jsx(A,{placeholder:"Date Range"})}),e.jsxs(D,{children:[e.jsx(r,{value:"all",children:"All Time"}),e.jsx(r,{value:"today",children:"Today"}),e.jsx(r,{value:"week",children:"This Week"}),e.jsx(r,{value:"month",children:"This Month"})]})]})]})})]}),e.jsxs(U,{children:[e.jsx(G,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(W,{children:["Content Reports (",h,")"]}),e.jsx(me,{children:"Reported content requiring review"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(d,{variant:"outline",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Export Reports"]}),e.jsxs(d,{children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Bulk Actions"]})]})]})}),e.jsxs(J,{children:[e.jsxs(je,{children:[e.jsx(pe,{children:e.jsxs(K,{children:[e.jsx(p,{children:"Priority"}),e.jsx(p,{children:"Content"}),e.jsx(p,{children:"Reporter"}),e.jsx(p,{children:"Reason"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Reported"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(ue,{children:le.map(s=>{var m;const a=_(s);return e.jsxs(K,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[a>=7&&e.jsx(ee,{className:"h-4 w-4 text-red-500"}),a>=4&&a<7&&e.jsx(Y,{className:"h-4 w-4 text-yellow-500"}),a<4&&e.jsx(Y,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:a})]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[re(s.content_type),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.content_type}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.content_id.slice(0,8),"..."]})]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:((m=s.reporter)==null?void 0:m.full_name)||"Anonymous"})]})}),e.jsx(u,{children:e.jsx(j,{className:z(s.report_reason),children:s.report_reason})}),e.jsx(u,{children:V(s.report_status)}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:H(s.created_at)})]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>{P(s),b(!0)},children:e.jsx(Ie,{className:"h-4 w-4"})}),s.report_status==="pending"&&e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>N(s.id,"approve"),className:"text-green-600 hover:text-green-700",children:e.jsx(Me,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>N(s.id,"reject"),className:"text-red-600 hover:text-red-700",children:e.jsx(xe,{className:"h-4 w-4"})})]})]})})]},s.id)})})]}),l.length===0&&!y&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No reports found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"All content reports have been reviewed or try adjusting your filters."})]})]})]}),h>t.limit&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(t.page-1)*t.limit+1," to ",Math.min(t.page*t.limit,h)," of ",h," reports"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{variant:"outline",size:"sm",disabled:t.page===1,onClick:()=>B(t.page-1),children:"Previous"}),e.jsx(d,{variant:"outline",size:"sm",disabled:t.page*t.limit>=h,onClick:()=>B(t.page+1),children:"Next"})]})]})]}),e.jsx(ge,{open:ae,onOpenChange:b,children:e.jsxs(ve,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"Report Details"}),e.jsx(fe,{children:"Review the reported content and take appropriate action"})]}),c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ce,{defaultValue:"details",className:"w-full",children:[e.jsxs(Re,{children:[e.jsx(F,{value:"details",children:"Report Details"}),e.jsx(F,{value:"content",children:"Reported Content"}),e.jsx(F,{value:"actions",children:"Actions"})]}),e.jsxs(I,{value:"details",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Report ID"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Status"}),e.jsx("div",{className:"mt-1",children:V(c.report_status)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Content Type"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.content_type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Report Reason"}),e.jsx("div",{className:"mt-1",children:e.jsx(j,{className:z(c.report_reason),children:c.report_reason})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Reporter"}),e.jsx("p",{className:"text-sm text-gray-900",children:((L=c.reporter)==null?void 0:L.full_name)||"Anonymous"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Reported At"}),e.jsx("p",{className:"text-sm text-gray-900",children:H(c.created_at)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Report Details"}),e.jsx("p",{className:"text-sm text-gray-900 mt-1 p-3 bg-gray-50 rounded",children:c.report_details||"No additional details provided"})]})]}),e.jsx(I,{value:"content",className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Content Preview"}),e.jsxs("div",{className:"mt-2 p-4 border rounded-lg bg-gray-50",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Content preview would be displayed here based on the content type and ID."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Content ID: ",c.content_id]})]})]})}),e.jsx(I,{value:"actions",className:"space-y-4",children:c.report_status==="pending"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Take Action"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs(d,{onClick:()=>N(c.id,"approve"),className:"bg-green-600 hover:bg-green-700",children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Approve Report"]}),e.jsxs(d,{onClick:()=>N(c.id,"reject"),variant:"outline",children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Dismiss Report"]}),e.jsxs(d,{onClick:()=>N(c.id,"escalate"),variant:"outline",className:"text-orange-600 border-orange-600 hover:bg-orange-50",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Escalate"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Resolution Notes (Optional)"}),e.jsx("textarea",{className:"mt-1 w-full p-2 border rounded-md",rows:3,placeholder:"Add notes about your decision..."})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"mx-auto h-12 w-12 text-green-500"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Report Already Resolved"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This report has already been reviewed and resolved."})]})})]}),e.jsx("div",{className:"flex justify-end space-x-2",children:e.jsx(d,{variant:"outline",onClick:()=>b(!1),children:"Close"})})]})]})})]})})};export{gs as default};
