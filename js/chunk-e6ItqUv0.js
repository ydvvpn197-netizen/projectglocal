var q=Object.defineProperty,M=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var k=(a,e,c)=>e in a?q(a,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[e]=c,w=(a,e)=>{for(var c in e||(e={}))j.call(e,c)&&k(a,c,e[c]);if(A)for(var c of A(e))x.call(e,c)&&k(a,c,e[c]);return a},C=(a,e)=>M(a,L(e));var v=(a,e,c)=>new Promise((_,n)=>{var d=l=>{try{p(c.next(l))}catch(y){n(y)}},f=l=>{try{p(c.throw(l))}catch(y){n(y)}},p=l=>l.done?_(l.value):Promise.resolve(l.value).then(d,f);p((c=c.apply(a,e)).next())});import{r as m}from"./chunk-V8Tq47hD.js";import{u as P,e as F,s as g}from"./main-nj8_qmr1.js";const Y=()=>{const[a,e]=m.useState([]),[c,_]=m.useState(!0),{user:n}=P(),{toast:d}=F(),f=m.useCallback(()=>v(null,null,function*(){if(!n){console.log("No user found, skipping fetchPosts"),_(!1);return}console.log("Fetching posts for user:",n.id),console.log("User session:",n);try{console.log("Attempting direct query to posts table...");const{data:r,error:i}=yield g.from("social_posts").select("*").order("created_at",{ascending:!1});if(i)throw console.error("Direct query failed:",i),i;console.log("Direct query successful, posts found:",(r==null?void 0:r.length)||0);const t=(r==null?void 0:r.map(s=>C(w({},s),{contact_info:s.user_id===(n==null?void 0:n.id)?s.contact_info:null})))||[];e(t)}catch(r){const i=r instanceof Error?r.message:"Failed to load posts";console.error("Error fetching posts:",r),d({title:"Error loading posts",description:i,variant:"destructive"})}finally{_(!1)}}),[n,d]),p=r=>v(null,null,function*(){if(!n)return console.error("User not authenticated"),{error:new Error("Not authenticated")};console.log("Creating post with data:",r);try{const i={user_id:n.id,title:r.title||null,content:r.content,post_type:r.type,event_date:r.event_date||null,event_location:r.event_location||null,price_range:r.price_range||null,tags:r.tags||null};console.log("Insert data:",i);const{data:t,error:s}=yield g.from("community_posts").insert(i).select().single();if(s)throw console.error("Supabase error:",s),s;return console.log("Post created successfully:",t),d({title:"Post created",description:"Your post has been shared with the community."}),f(),{data:t,error:null}}catch(i){console.error("Error in createPost:",i);const t=i instanceof Error?i.message:"Failed to create post";return d({title:"Error creating post",description:t,variant:"destructive"}),{error:i}}}),l=r=>v(null,null,function*(){if(n)try{const{data:i}=yield g.from("likes").select("id").eq("post_id",r).eq("user_id",n.id).maybeSingle();i?yield g.from("likes").delete().eq("post_id",r).eq("user_id",n.id):yield g.from("likes").insert({post_id:r,user_id:n.id}),f()}catch(i){const t=i instanceof Error?i.message:"Failed to update like";d({title:"Error updating like",description:t,variant:"destructive"})}}),y=r=>v(null,null,function*(){if(!n)return{error:new Error("Not authenticated")};try{const{error:i}=yield g.from("posts").delete().eq("id",r).eq("user_id",n.id);if(i)throw i;return d({title:"Post deleted",description:"Your post has been deleted successfully."}),f(),{error:null}}catch(i){const t=i instanceof Error?i.message:"Failed to delete post";return d({title:"Error deleting post",description:t,variant:"destructive"}),{error:i}}});return m.useEffect(()=>{n&&f()},[n,f]),{posts:a,loading:c,createPost:p,toggleLike:l,deletePost:y,refetch:f}},I=()=>{const{user:a}=P(),{toast:e}=F(),[c,_]=m.useState([]),[n,d]=m.useState(!0),[f,p]=m.useState(null),l=m.useCallback(()=>v(null,null,function*(){try{d(!0),p(null);const{data:t,error:s}=yield g.from("community_groups").select(`
          *,
          creator:profiles!profiles_user_id_fkey(
            display_name,
            avatar_url
          )
        `).order("created_at",{ascending:!1});if(s)throw s;const u=(t==null?void 0:t.map(o=>{var h,b,E,S;return{id:o.id,name:o.name,description:o.description,image_url:null,image:null,category:"Community",location:o.location_city,member_count:o.member_count||0,members:o.member_count||0,creator_id:o.created_by,creator_name:((h=o.creator)==null?void 0:h.display_name)||"Community Creator",creator_avatar:(b=o.creator)==null?void 0:b.avatar_url,creator:{name:((E=o.creator)==null?void 0:E.display_name)||"Community Creator",avatar:((S=o.creator)==null?void 0:S.avatar_url)||""},is_verified:!1,activity_level:"Active",activity_score:0,created_at:o.created_at,createdAt:o.created_at,tags:[],is_private:!1,is_featured:!1,rules:[],guidelines:[],contact_info:{}}}))||[];_(u)}catch(t){console.error("Error fetching communities:",t),p(t instanceof Error?t.message:"Failed to fetch communities");const s=[{id:"1",name:"Local Music Enthusiasts",description:"A community for music lovers to discover local artists, share recommendations, and attend concerts together.",image_url:null,category:"Music",location:"Downtown",member_count:1250,creator_name:"Music Lover",creator_avatar:null,is_verified:!0,activity_level:"Very Active",activity_score:95,created_at:new Date().toISOString(),tags:["music","concerts","local","artists"],is_private:!1,is_featured:!0},{id:"2",name:"Art & Culture Collective",description:"Connecting artists, art lovers, and cultural enthusiasts to explore local galleries, exhibitions, and creative events.",image_url:null,category:"Art",location:"Arts District",member_count:890,creator_name:"Art Curator",creator_avatar:null,is_verified:!0,activity_level:"Active",activity_score:78,created_at:new Date().toISOString(),tags:["art","culture","galleries","exhibitions"],is_private:!1,is_featured:!1},{id:"3",name:"Tech Entrepreneurs Network",description:"A professional network for tech entrepreneurs, startup founders, and innovators to share ideas and collaborate.",image_url:null,category:"Technology",location:"Innovation Hub",member_count:567,creator_name:"Tech Founder",creator_avatar:null,is_verified:!0,activity_level:"Active",activity_score:82,created_at:new Date().toISOString(),tags:["tech","startup","entrepreneurs","innovation"],is_private:!1,is_featured:!0},{id:"4",name:"Wellness & Mindfulness",description:"A supportive community focused on mental health, wellness practices, and mindful living.",image_url:null,category:"Health & Wellness",location:"Wellness Center",member_count:432,creator_name:"Wellness Coach",creator_avatar:null,is_verified:!1,activity_level:"Moderate",activity_score:65,created_at:new Date().toISOString(),tags:["wellness","mindfulness","health","meditation"],is_private:!1,is_featured:!1},{id:"5",name:"Local Food Enthusiasts",description:"Food lovers sharing recipes, restaurant recommendations, and organizing culinary events.",image_url:null,category:"Food",location:"Food District",member_count:789,creator_name:"Food Blogger",creator_avatar:null,is_verified:!0,activity_level:"Very Active",activity_score:88,created_at:new Date().toISOString(),tags:["food","cooking","restaurants","recipes"],is_private:!1,is_featured:!0}];_(s)}finally{d(!1)}}),[]),y=m.useCallback(t=>v(null,null,function*(){if(!a){e({title:"Authentication Required",description:"Please sign in to join communities.",variant:"destructive"});return}try{const{error:s}=yield g.from("community_members").insert({community_id:t,user_id:a.id,joined_at:new Date().toISOString()});if(s)throw s;_(u=>u.map(o=>o.id===t?C(w({},o),{member_count:(o.member_count||0)+1}):o)),e({title:"Joined Community",description:"You've successfully joined this community!"})}catch(s){console.error("Error joining community:",s),e({title:"Join Failed",description:"Unable to join community. Please try again.",variant:"destructive"})}}),[a,e]),r=m.useCallback(t=>v(null,null,function*(){if(!a){e({title:"Authentication Required",description:"Please sign in to leave communities.",variant:"destructive"});return}try{const{error:s}=yield g.from("community_members").delete().eq("community_id",t).eq("user_id",a.id);if(s)throw s;_(u=>u.map(o=>o.id===t?C(w({},o),{member_count:Math.max(0,(o.member_count||0)-1)}):o)),e({title:"Left Community",description:"You've successfully left this community."})}catch(s){console.error("Error leaving community:",s),e({title:"Leave Failed",description:"Unable to leave community. Please try again.",variant:"destructive"})}}),[a,e]),i=m.useCallback(t=>v(null,null,function*(){var s;if(!a){e({title:"Authentication Required",description:"Please sign in to create communities.",variant:"destructive"});return}try{const{data:u,error:o}=yield g.from("community_groups").insert({name:t.name,description:t.description,location_city:t.location,created_by:a.id}).select().single();if(o)throw o;const h={id:u.id,name:u.name,description:u.description,image_url:null,category:"Community",location:u.location_city,member_count:1,creator_id:a.id,creator_name:((s=a.email)==null?void 0:s.split("@")[0])||"Community Creator",is_verified:!1,activity_level:"New",activity_score:0,created_at:u.created_at,tags:[],is_private:!1,is_featured:!1};return _(b=>[h,...b]),e({title:"Community Created",description:"Your community has been created successfully!"}),h}catch(u){console.error("Error creating community:",u),e({title:"Creation Failed",description:"Unable to create community. Please try again.",variant:"destructive"})}}),[a,e]);return m.useEffect(()=>{l()},[l]),{communities:c,loading:n,error:f,fetchCommunities:l,joinCommunity:y,leaveCommunity:r,createCommunity:i}};export{I as a,Y as u};
