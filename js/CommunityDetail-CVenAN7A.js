var e=(e,s,t)=>new Promise((r,o)=>{var i=e=>{try{n(t.next(e))}catch(s){o(s)}},a=e=>{try{n(t.throw(e))}catch(s){o(s)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,a);n((t=t.apply(e,s)).next())});import{c as s,R as React,j as t,e as r,B as o,s as i,r as a,d as n,u as l,b as c,C as d,v as m,y as u,U as x,S as h,w as p}from"./main-u5iDOJMZ.js";import{R as v}from"./ResponsiveLayout-CaFEj6Sr.js";import{B as j}from"./badge-k0SsuPwB.js";import{A as f,a as y,b as g,i as _,P as N}from"./sheet-BES5Q-Ko.js";import{T as w,a as b,b as C,c as S}from"./tabs-Dn7YRzvT.js";import{I as P}from"./input-d0wpgTJ2.js";import{u as k}from"./useCommunityGroups-C3Ohi84x.js";import{C as q,a as O}from"./chevron-up-MfWNy2Yr.js";import{D as V,a as E,b as U,e as D}from"./useNotifications-DNCpc7NU.js";import{f as A}from"./index-K1pFGRvZ.js";import{P as L}from"./pin-BC7Otq98.js";import{L as M}from"./lock-BH4cQa9v.js";import{M as T}from"./map-pin-CcmxiK6P.js";import{S as R}from"./share-2-Dgaikjt7.js";import{M as I}from"./message-circle-nfkvwkJk.js";import{E as F}from"./eye-rgHTj3H0.js";import{C as G}from"./index-B7-3ofi9.js";import{L as z}from"./loader-2-BaQ9JvXw.js";import{A as W}from"./arrow-left-C3YI5YUq.js";import{U as Y}from"./users-BKDXsamp.js";import{M as B}from"./message-square-DQ5316cR.js";import{C as $}from"./crown-ChiUtgJw.js";import{S as H}from"./search-BsWmJlwB.js";import{G as J,L as K}from"./list-ClGqLm1G.js";import{S as Q}from"./shield-sCmGbvNz.js";import"./separator-BdZu64Yb.js";import"./NotificationBell-4ukuyDx4.js";import"./Combination-D3NAapk3.js";import"./scroll-area-DANvZfFy.js";import"./index-Dy-VqNBB.js";import"./index-jVOyRz7F.js";import"./bell-wBykza9e.js";import"./check-CT-bNmTi.js";import"./user-DlaYKRnl.js";import"./index-azXaBhbR.js";import"./NotificationButton-QcrDLMMB.js";import"./zap-BrBeKdrO.js";import"./alert-7nHfBPfv.js";import"./wifi-DNTf1l7S.js";import"./log-out-CGc8M4_-.js";import"./communityService-DlpM0krF.js";import"./index-SHjlLhXV.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=s("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),Z=s("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),ee={UP:1,DOWN:-1,NONE:0},se=({score:s,userVote:i,onVote:a,disabled:n=!1,size:l="md",showScore:c=!0,className:d})=>{const[m,u]=React.useState(!1),x=s=>e(void 0,null,function*(){if(!n&&!m){u(!0);try{yield a(s)}catch(e){}finally{u(!1)}}}),h=()=>{switch(l){case"sm":return"h-6 w-6";case"lg":return"h-8 w-8";default:return"h-7 w-7"}},p=i===ee.UP,v=i===ee.DOWN;return t.jsxs("div",{className:r("flex flex-col items-center gap-1",d),children:[t.jsx(o,{variant:"ghost",size:"icon",className:r(h(),"hover:bg-green-50 hover:text-green-600 transition-colors",p&&"text-green-600 bg-green-50",n&&"opacity-50 cursor-not-allowed"),onClick:()=>x(ee.UP),disabled:n||m,"aria-label":"Upvote",children:t.jsx(q,{className:"h-4 w-4"})}),c&&t.jsx("span",{className:r("font-medium select-none",(()=>{switch(l){case"sm":return"text-xs";case"lg":return"text-base";default:return"text-sm"}})(),s>0&&"text-green-600",s<0&&"text-red-600",0===s&&"text-gray-500"),children:s}),t.jsx(o,{variant:"ghost",size:"icon",className:r(h(),"hover:bg-red-50 hover:text-red-600 transition-colors",v&&"text-red-600 bg-red-50",n&&"opacity-50 cursor-not-allowed"),onClick:()=>x(ee.DOWN),disabled:n||m,"aria-label":"Downvote",children:t.jsx(O,{className:"h-4 w-4"})})]})};
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */class te{static voteOnPost(s,t){return e(this,null,function*(){try{const{data:{user:e}}=yield i.auth.getUser();if(!e)throw new Error("User not authenticated");const r=yield this.validateVote(e.id,"post",s,t);if(!r.is_valid)throw new Error(r.reason||"Invalid vote");const{data:o,error:a}=yield i.from("post_votes").select("vote_type").eq("post_id",s).eq("user_id",e.id).single();if(a&&"PGRST116"!==a.code)throw a;let n=t;if(o){o.vote_type===t&&(n=ee.NONE);const{error:r}=yield i.from("post_votes").update({vote_type:n}).eq("post_id",s).eq("user_id",e.id);if(r)throw r}else{const{error:t}=yield i.from("post_votes").insert({post_id:s,user_id:e.id,vote_type:n});if(t)throw t}return yield this.updatePostVoteCounts(s),!0}catch(e){return!1}})}static voteOnComment(s,t){return e(this,null,function*(){try{const{data:{user:e}}=yield i.auth.getUser();if(!e)throw new Error("User not authenticated");const r=yield this.validateVote(e.id,"comment",s,t);if(!r.is_valid)throw new Error(r.reason||"Invalid vote");const{data:o,error:a}=yield i.from("comment_votes").select("vote_type").eq("comment_id",s).eq("user_id",e.id).single();if(a&&"PGRST116"!==a.code)throw a;let n=t;if(o){o.vote_type===t&&(n=ee.NONE);const{error:r}=yield i.from("comment_votes").update({vote_type:n}).eq("comment_id",s).eq("user_id",e.id);if(r)throw r}else{const{error:t}=yield i.from("comment_votes").insert({comment_id:s,user_id:e.id,vote_type:n});if(t)throw t}return yield this.updateCommentVoteCounts(s),!0}catch(e){return!1}})}static getUserPostVote(s){return e(this,null,function*(){try{const{data:{user:e}}=yield i.auth.getUser();if(!e)return ee.NONE;const{data:t,error:r}=yield i.from("post_votes").select("vote_type").eq("post_id",s).eq("user_id",e.id).single();if(r&&"PGRST116"!==r.code)throw r;return(null==t?void 0:t.vote_type)||ee.NONE}catch(e){return ee.NONE}})}static getUserCommentVote(s){return e(this,null,function*(){try{const{data:{user:e}}=yield i.auth.getUser();if(!e)return ee.NONE;const{data:t,error:r}=yield i.from("comment_votes").select("vote_type").eq("comment_id",s).eq("user_id",e.id).single();if(r&&"PGRST116"!==r.code)throw r;return(null==t?void 0:t.vote_type)||ee.NONE}catch(e){return ee.NONE}})}static getPostVoteStats(s){return e(this,null,function*(){try{const{data:e,error:t}=yield i.from("community_posts").select("upvotes, downvotes, score").eq("id",s).single();if(t)throw t;const r=(e.upvotes||0)+(e.downvotes||0),o=r>0?(e.upvotes||0)/r:0;return{upvotes:e.upvotes||0,downvotes:e.downvotes||0,score:e.score||0,upvote_ratio:o}}catch(e){return{upvotes:0,downvotes:0,score:0,upvote_ratio:0}}})}static getCommentVoteStats(s){return e(this,null,function*(){try{const{data:e,error:t}=yield i.from("comments").select("upvotes, downvotes, score").eq("id",s).single();if(t)throw t;const r=(e.upvotes||0)+(e.downvotes||0),o=r>0?(e.upvotes||0)/r:0;return{upvotes:e.upvotes||0,downvotes:e.downvotes||0,score:e.score||0,upvote_ratio:o}}catch(e){return{upvotes:0,downvotes:0,score:0,upvote_ratio:0}}})}static validateVote(s,t,r,o){return e(this,null,function*(){if(![ee.UP,ee.DOWN,ee.NONE].includes(o))return{is_valid:!1,reason:"Invalid vote type"};const e=yield this.checkAntiSpamMeasures(s);if(e.is_rate_limited)return{is_valid:!1,reason:`Rate limited. Please wait ${e.cooldown_remaining} seconds before voting again.`};return(yield this.isOwnContent(s,t,r))?{is_valid:!1,reason:"You cannot vote on your own content"}:{is_valid:!0,user_reputation:1,vote_weight:1}})}static checkAntiSpamMeasures(s){return e(this,null,function*(){try{const e=new Date,t=new Date(e.getTime()-36e5),r=new Date(e.getTime()-864e5),{count:o,error:a}=yield i.from("post_votes").select("*",{count:"exact",head:!0}).eq("user_id",s).gte("created_at",t.toISOString());if(a)throw a;const{count:n,error:l}=yield i.from("post_votes").select("*",{count:"exact",head:!0}).eq("user_id",s).gte("created_at",r.toISOString());if(l)throw l;const c=(o||0)>50||(n||0)>500;return{user_id:s,vote_count_24h:n||0,vote_count_1h:o||0,is_rate_limited:c,cooldown_remaining:c?3600:0}}catch(e){return{user_id:s,vote_count_24h:0,vote_count_1h:0,is_rate_limited:!1,cooldown_remaining:0}}})}static isOwnContent(s,t,r){return e(this,null,function*(){try{if("post"===t){const{data:e,error:t}=yield i.from("community_posts").select("user_id").eq("id",r).single();if(t)throw t;return e.user_id===s}{const{data:e,error:t}=yield i.from("comments").select("user_id").eq("id",r).single();if(t)throw t;return e.user_id===s}}catch(e){return!1}})}static updatePostVoteCounts(s){return e(this,null,function*(){try{const{data:e,error:t}=yield i.from("post_votes").select("*",{count:"exact",head:!0}).eq("post_id",s).eq("vote_type",ee.UP);if(t)throw t;const{data:r,error:o}=yield i.from("post_votes").select("*",{count:"exact",head:!0}).eq("post_id",s).eq("vote_type",ee.DOWN);if(o)throw o;const a=e||0,n=r||0,l=a-n;yield i.from("community_posts").update({upvotes:a,downvotes:n,score:l}).eq("id",s)}catch(e){}})}static updateCommentVoteCounts(s){return e(this,null,function*(){try{const{data:e,error:t}=yield i.from("comment_votes").select("*",{count:"exact",head:!0}).eq("comment_id",s).eq("vote_type",ee.UP);if(t)throw t;const{data:r,error:o}=yield i.from("comment_votes").select("*",{count:"exact",head:!0}).eq("comment_id",s).eq("vote_type",ee.DOWN);if(o)throw o;const a=e||0,n=r||0,l=a-n;yield i.from("comments").update({upvotes:a,downvotes:n,score:l}).eq("id",s)}catch(e){}})}static getUserVoteHistory(s,t=50){return e(this,null,function*(){try{const[e,r]=yield Promise.all([i.from("post_votes").select("*").eq("user_id",s).order("created_at",{ascending:!1}).limit(t),i.from("comment_votes").select("*").eq("user_id",s).order("created_at",{ascending:!1}).limit(t)]);return{post_votes:e.data||[],comment_votes:r.data||[]}}catch(e){return{post_votes:[],comment_votes:[]}}})}}const re=({post:s,onVote:i,onPin:x,onLock:h,onDelete:p,showGroupInfo:v=!0,className:_})=>{var N;const w=c(),{user:b}=l(),{voteOnPost:C,isVotingOn:S}=(()=>{const[s,t]=a.useState(null),{toast:r}=n(),{user:o}=l(),i=a.useCallback((s,i)=>e(void 0,null,function*(){if(!o)return r({title:"Error",description:"You must be logged in to vote",variant:"destructive"}),!1;try{if(t({postId:s,voteType:i}),yield te.voteOnPost(s,i)){const e=i===ee.UP?"upvoted":i===ee.DOWN?"downvoted":"removed vote from";return r({title:"Success",description:`Successfully ${e} post`}),!0}throw new Error("Failed to vote on post")}catch(e){return r({title:"Error",description:e instanceof Error?e.message:"Failed to vote on post",variant:"destructive"}),!1}finally{t(null)}}),[o,r]),c=a.useCallback((s,i)=>e(void 0,null,function*(){if(!o)return r({title:"Error",description:"You must be logged in to vote",variant:"destructive"}),!1;try{if(t({commentId:s,voteType:i}),yield te.voteOnComment(s,i)){const e=i===ee.UP?"upvoted":i===ee.DOWN?"downvoted":"removed vote from";return r({title:"Success",description:`Successfully ${e} comment`}),!0}throw new Error("Failed to vote on comment")}catch(e){return r({title:"Error",description:e instanceof Error?e.message:"Failed to vote on comment",variant:"destructive"}),!1}finally{t(null)}}),[o,r]),d=a.useCallback(s=>e(void 0,null,function*(){if(!o)return ee.NONE;try{return yield te.getUserPostVote(s)}catch(e){return ee.NONE}}),[o]),m=a.useCallback(s=>e(void 0,null,function*(){if(!o)return ee.NONE;try{return yield te.getUserCommentVote(s)}catch(e){return ee.NONE}}),[o]),u=a.useCallback(s=>e(void 0,null,function*(){try{return yield te.getPostVoteStats(s)}catch(e){return{upvotes:0,downvotes:0,score:0,upvote_ratio:0}}}),[]),x=a.useCallback(s=>e(void 0,null,function*(){try{return yield te.getCommentVoteStats(s)}catch(e){return{upvotes:0,downvotes:0,score:0,upvote_ratio:0}}}),[]),h=a.useCallback((s=50)=>e(void 0,null,function*(){if(!o)return{post_votes:[],comment_votes:[]};try{return yield te.getUserVoteHistory(o.id,s)}catch(e){return{post_votes:[],comment_votes:[]}}}),[o]),p=a.useCallback((s,t,r,o="post")=>e(void 0,null,function*(){let e=r;return t===r&&(e=ee.NONE),"post"===o?yield i(s,e):yield c(s,e)}),[i,c]),v=a.useCallback((e,t="post")=>!!s&&("post"===t?s.postId===e:s.commentId===e),[s]),j=a.useCallback(()=>s,[s]);return{voting:s,voteOnPost:i,voteOnComment:c,getUserPostVote:d,getUserCommentVote:m,getPostVoteStats:u,getCommentVoteStats:x,getUserVoteHistory:h,handleVoteToggle:p,isVotingOn:v,getVotingState:j,VOTE_TYPES:ee}})(),P=(null==b?void 0:b.id)===s.user_id,k=S(s.id,"post");return t.jsxs(d,{className:r("hover:shadow-md transition-shadow cursor-pointer",s.is_pinned&&"border-l-4 border-l-blue-500",s.is_locked&&"border-l-4 border-l-red-500",_),onClick:()=>{w(`/post/${s.id}`)},children:[t.jsx(m,{className:"pb-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(se,{score:s.score,userVote:s.user_vote||0,onVote:t=>e(void 0,null,function*(){return i?yield i(s.id,t):yield C(s.id,t)}),disabled:k||s.is_locked,size:"md",className:"flex-shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsxs(f,{className:"h-6 w-6",children:[t.jsx(y,{src:s.author_avatar}),t.jsx(g,{children:null==(N=s.author_name)?void 0:N.charAt(0).toUpperCase()})]}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.author_name}),t.jsx("span",{className:"text-sm text-gray-500",children:A(new Date(s.created_at),{addSuffix:!0})}),s.is_pinned&&t.jsxs(j,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:[t.jsx(L,{className:"h-3 w-3 mr-1"}),"Pinned"]}),s.is_locked&&t.jsxs(j,{variant:"secondary",className:"bg-red-100 text-red-800",children:[t.jsx(M,{className:"h-3 w-3 mr-1"}),"Locked"]}),t.jsx(j,{className:(e=>{switch(e){case"discussion":return"bg-blue-100 text-blue-800";case"question":return"bg-green-100 text-green-800";case"announcement":return"bg-yellow-100 text-yellow-800";case"event":return"bg-purple-100 text-purple-800";case"poll":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}})(s.post_type),children:s.post_type})]}),v&&s.group_name&&t.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"in"}),t.jsxs(o,{variant:"link",className:"h-auto p-0 text-sm text-blue-600 hover:text-blue-800",onClick:e=>{e.stopPropagation(),w(`/group/${s.group_id}`)},children:["r/",s.group_name]})]}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:s.title}),t.jsx("div",{className:"text-sm text-gray-700 line-clamp-3",children:s.content}),s.location_city&&t.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-gray-500",children:[t.jsx(T,{className:"h-3 w-3"}),s.location_city,s.location_state&&`, ${s.location_state}`]})]}),t.jsxs(V,{children:[t.jsx(E,{asChild:!0,children:t.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:e=>e.stopPropagation(),children:t.jsx(Z,{className:"h-4 w-4"})})}),t.jsxs(U,{align:"end",children:[t.jsxs(D,{onClick:e=>{e.stopPropagation()},children:[t.jsx(R,{className:"h-4 w-4 mr-2"}),"Share"]}),P&&t.jsxs(t.Fragment,{children:[t.jsxs(D,{onClick:t=>{t.stopPropagation(),(()=>{e(void 0,null,function*(){x&&(yield x(s.id,!s.is_pinned))})})()},children:[t.jsx(L,{className:"h-4 w-4 mr-2"}),s.is_pinned?"Unpin":"Pin"]}),t.jsxs(D,{onClick:t=>{t.stopPropagation(),(()=>{e(void 0,null,function*(){h&&(yield h(s.id,!s.is_locked))})})()},children:[t.jsx(M,{className:"h-4 w-4 mr-2"}),s.is_locked?"Unlock":"Lock"]}),t.jsx(D,{onClick:t=>{t.stopPropagation(),(()=>{e(void 0,null,function*(){p&&(yield p(s.id))})})()},className:"text-red-600",children:"Delete"})]})]})]})]})}),t.jsx(u,{className:"pt-0",children:t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(I,{className:"h-4 w-4"}),s.comment_count," comments"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(F,{className:"h-4 w-4"}),s.view_count," views"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(G,{className:"h-4 w-4"}),A(new Date(s.created_at),{addSuffix:!0})]})]})})]})},oe=()=>{const{groupId:s}=x(),r=c(),{user:q}=l(),{toast:O}=n(),{joinGroup:V,leaveGroup:E,isGroupMember:U,getUserRole:D}=k(),[A,L]=a.useState(null),[M,I]=a.useState([]),[F,Z]=a.useState([]),[ee,se]=a.useState(!0),[te,oe]=a.useState(!1),[ie,ae]=a.useState(null),[ne,le]=a.useState(!1),[ce,de]=a.useState("overview"),[me,ue]=a.useState(""),[xe,he]=a.useState("grid"),[pe,ve]=a.useState("recent");a.useEffect(()=>{(()=>{e(void 0,null,function*(){if(s)try{se(!0);const{data:e,error:t}=yield i.from("community_groups").select("*").eq("id",s).single();if(t)throw t;if(L(e),q){const[e,t]=yield Promise.all([U(s),D(s)]);oe(e),ae(t)}const{data:r,error:o}=yield i.from("group_members").select("\n            *,\n            profiles:user_id (\n              id,\n              display_name,\n              avatar_url\n            )\n          ").eq("group_id",s).order("joined_at",{ascending:!1});if(o)throw o;const a=r.map(e=>{var s,t;return{id:e.id,user_id:e.user_id,display_name:(null==(s=e.profiles)?void 0:s.display_name)||"Anonymous",avatar_url:null==(t=e.profiles)?void 0:t.avatar_url,role:e.role,joined_at:e.joined_at,total_posts:0,total_points:0}});I(a);const{data:n,error:l}=yield i.from("community_posts").select("\n            *,\n            profiles:user_id (\n              display_name,\n              avatar_url\n            )\n          ").eq("group_id",s).order("created_at",{ascending:!1});if(l)throw l;const c=n.map(e=>{var s,t;return{id:e.id,title:e.title,content:e.content,post_type:e.post_type,user_id:e.user_id,author_name:(null==(s=e.profiles)?void 0:s.display_name)||"Anonymous",author_avatar:null==(t=e.profiles)?void 0:t.avatar_url,score:e.score||0,comment_count:e.comment_count||0,view_count:e.view_count||0,is_pinned:e.is_pinned||!1,is_locked:e.is_locked||!1,created_at:e.created_at,updated_at:e.updated_at}});Z(c)}catch(e){O({title:"Error",description:"Failed to load community details",variant:"destructive"}),r("/community")}finally{se(!1)}})})()},[s,q,U,D,O,r]);const je=[...F.filter(e=>e.title.toLowerCase().includes(me.toLowerCase())||e.content.toLowerCase().includes(me.toLowerCase()))].sort((e,s)=>{switch(pe){case"recent":return new Date(s.created_at).getTime()-new Date(e.created_at).getTime();case"popular":return s.score-e.score;case"comments":return s.comment_count-e.comment_count;case"views":return s.view_count-e.view_count;default:return 0}});return ee?t.jsx(v,{children:t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(z,{className:"h-6 w-6 animate-spin"}),t.jsx("span",{children:"Loading community..."})]})})}):A?t.jsx(v,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(o,{variant:"ghost",onClick:()=>r("/community"),children:[t.jsx(W,{className:"w-4 h-4 mr-2"}),"Back"]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h1",{className:"text-2xl font-bold",children:A.name}),t.jsx("p",{className:"text-muted-foreground",children:A.description})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(o,{variant:"outline",size:"sm",children:[t.jsx(R,{className:"w-4 h-4 mr-2"}),"Share"]}),te&&t.jsxs(o,{variant:"outline",size:"sm",children:[t.jsx(h,{className:"w-4 h-4 mr-2"}),"Settings"]}),t.jsxs(o,{className:te?"bg-red-500 hover:bg-red-600":"btn-community",onClick:()=>e(void 0,null,function*(){if(q&&s)try{if(le(!0),te){(yield E(s))&&(oe(!1),ae(null),O({title:"Success",description:"You have left the community"}))}else{(yield V(s))&&(oe(!0),ae("member"),O({title:"Success",description:"You have joined the community"}))}}catch(e){O({title:"Error",description:"Failed to update membership",variant:"destructive"})}finally{le(!1)}else O({title:"Authentication Required",description:"Please log in to join communities",variant:"destructive"})}),disabled:ne,children:[ne?t.jsx(z,{className:"w-4 h-4 mr-2 animate-spin"}):t.jsx(Y,{className:"w-4 h-4 mr-2"}),ne?"Processing...":te?"Leave Community":"Join Community"]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsx(d,{children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Y,{className:"w-5 h-5 text-blue-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold",children:A.member_count||0}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Members"})]})]})})}),t.jsx(d,{children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(B,{className:"w-5 h-5 text-green-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold",children:A.post_count||0}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Posts"})]})]})})}),t.jsx(d,{children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(T,{className:"w-5 h-5 text-purple-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold",children:A.location_city||"Local"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Location"})]})]})})}),t.jsx(d,{children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(G,{className:"w-5 h-5 text-orange-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold",children:new Date(A.created_at).getFullYear()}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Founded"})]})]})})})]}),t.jsxs(w,{value:ce,onValueChange:de,className:"space-y-4",children:[t.jsxs(b,{className:"grid w-full grid-cols-4",children:[t.jsx(C,{value:"overview",children:"Overview"}),t.jsx(C,{value:"discussions",children:"Discussions"}),t.jsx(C,{value:"members",children:"Members"}),t.jsx(C,{value:"about",children:"About"})]}),t.jsxs(S,{value:"overview",className:"space-y-4",children:[t.jsxs(d,{children:[t.jsx(m,{children:t.jsxs(p,{className:"flex items-center gap-2",children:[t.jsx(_,{className:"w-5 h-5 text-yellow-500"}),"Recent Activity"]})}),t.jsxs(u,{children:[F.slice(0,3).map(e=>{var s;return t.jsxs("div",{className:"flex items-center gap-3 p-3 border-b last:border-b-0",children:[t.jsxs(f,{className:"h-8 w-8",children:[t.jsx(y,{src:e.author_avatar}),t.jsx(g,{children:null==(s=e.author_name)?void 0:s.charAt(0).toUpperCase()})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium text-sm",children:e.title}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:["by ",e.author_name," • ",new Date(e.created_at).toLocaleDateString()]})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.jsxs("span",{children:[e.score," points"]}),t.jsxs("span",{children:[e.comment_count," comments"]})]})]},e.id)}),0===F.length&&t.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No posts yet. Be the first to start a discussion!"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs(d,{children:[t.jsx(m,{children:t.jsxs(p,{className:"flex items-center gap-2",children:[t.jsx($,{className:"w-5 h-5 text-yellow-500"}),"Top Members"]})}),t.jsx(u,{children:M.slice(0,5).map(e=>{var s;return t.jsxs("div",{className:"flex items-center gap-3 p-2",children:[t.jsxs(f,{className:"h-8 w-8",children:[t.jsx(y,{src:e.avatar_url}),t.jsx(g,{children:null==(s=e.display_name)?void 0:s.charAt(0).toUpperCase()})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium text-sm",children:e.display_name}),t.jsx("p",{className:"text-xs text-muted-foreground",children:e.role})]}),t.jsxs(j,{variant:"secondary",className:"text-xs",children:[e.total_points," pts"]})]},e.id)})})]}),t.jsxs(d,{children:[t.jsx(m,{children:t.jsxs(p,{className:"flex items-center gap-2",children:[t.jsx(X,{className:"w-5 h-5 text-blue-500"}),"Community Info"]})}),t.jsxs(u,{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(j,{variant:"secondary",children:["#",A.category]}),t.jsx(j,{variant:A.is_public?"default":"destructive",children:A.is_public?"Public":"Private"})]}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.jsxs("p",{children:["Created by: ",A.created_by]}),t.jsxs("p",{children:["Location: ",A.location_city||"Local"]}),t.jsxs("p",{children:["Posts require approval: ",A.require_approval?"Yes":"No"]}),t.jsxs("p",{children:["Anonymous posts: ",A.allow_anonymous_posts?"Allowed":"Not allowed"]})]})]})]})]})]}),t.jsxs(S,{value:"discussions",className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),t.jsx(P,{placeholder:"Search discussions...",value:me,onChange:e=>ue(e.target.value),className:"pl-10 w-64"})]}),t.jsxs("select",{value:pe,onChange:e=>ve(e.target.value),className:"border rounded-md px-3 py-2",children:[t.jsx("option",{value:"recent",children:"Most Recent"}),t.jsx("option",{value:"popular",children:"Most Popular"}),t.jsx("option",{value:"comments",children:"Most Comments"}),t.jsx("option",{value:"views",children:"Most Views"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(o,{variant:"grid"===xe?"default":"ghost",size:"sm",onClick:()=>he("grid"),children:t.jsx(J,{className:"w-4 h-4"})}),t.jsx(o,{variant:"list"===xe?"default":"ghost",size:"sm",onClick:()=>he("list"),children:t.jsx(K,{className:"w-4 h-4"})}),te&&t.jsxs(o,{className:"btn-community",children:[t.jsx(N,{className:"w-4 h-4 mr-2"}),"New Post"]})]})]}),je.length>0?t.jsx("div",{className:"grid"===xe?"grid grid-cols-1 md:grid-cols-2 gap-4":"space-y-4",children:je.map(e=>t.jsx(re,{post:e,showGroupInfo:!1},e.id))}):t.jsx(d,{className:"text-center py-12",children:t.jsxs(u,{children:[t.jsx(B,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No discussions yet"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:te?"Start the first discussion in this community!":"Join the community to start discussions"}),te&&t.jsxs(o,{className:"btn-community",children:[t.jsx(N,{className:"w-4 h-4 mr-2"}),"Create First Post"]})]})})]}),t.jsxs(S,{value:"members",className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h3",{className:"text-lg font-semibold",children:["Community Members (",M.length,")"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(P,{placeholder:"Search members...",className:"w-64"}),t.jsxs("select",{className:"border rounded-md px-3 py-2",children:[t.jsx("option",{value:"all",children:"All Roles"}),t.jsx("option",{value:"admin",children:"Admins"}),t.jsx("option",{value:"moderator",children:"Moderators"}),t.jsx("option",{value:"member",children:"Members"})]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:M.map(e=>{var s;return t.jsx(d,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs(f,{className:"h-12 w-12",children:[t.jsx(y,{src:e.avatar_url}),t.jsx(g,{children:null==(s=e.display_name)?void 0:s.charAt(0).toUpperCase()})]}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"font-medium",children:e.display_name}),"admin"===e.role&&t.jsx($,{className:"w-4 h-4 text-yellow-500"}),"moderator"===e.role&&t.jsx(Q,{className:"w-4 h-4 text-blue-500"})]}),t.jsx("p",{className:"text-sm text-muted-foreground",children:e.role}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:["Joined ",new Date(e.joined_at).toLocaleDateString()]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"text-sm font-medium",children:[e.total_points," pts"]}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.total_posts," posts"]})]})]})},e.id)})})]}),t.jsx(S,{value:"about",className:"space-y-4",children:t.jsxs(d,{children:[t.jsx(m,{children:t.jsxs(p,{children:["About ",A.name]})}),t.jsxs(u,{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2",children:"Description"}),t.jsx("p",{className:"text-muted-foreground",children:A.description||"No description available."})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2",children:"Community Rules"}),t.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[t.jsx("li",{children:"• Be respectful and kind to other members"}),t.jsx("li",{children:"• Stay on topic and relevant to the community"}),t.jsx("li",{children:"• No spam, advertising, or self-promotion"}),t.jsx("li",{children:"• Follow the community guidelines"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2",children:"Community Settings"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Privacy:"}),t.jsx(j,{variant:A.is_public?"default":"destructive",children:A.is_public?"Public":"Private"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Post Approval:"}),t.jsx("span",{children:A.require_approval?"Required":"Not Required"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Anonymous Posts:"}),t.jsx("span",{children:A.allow_anonymous_posts?"Allowed":"Not Allowed"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2",children:"Statistics"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Total Members:"}),t.jsx("span",{children:A.member_count||0})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Total Posts:"}),t.jsx("span",{children:A.post_count||0})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Created:"}),t.jsx("span",{children:new Date(A.created_at).toLocaleDateString()})]})]})]})]})]})]})})]})]})}):t.jsx(v,{children:t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Community not found"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"The community you're looking for doesn't exist or has been removed."}),t.jsxs(o,{onClick:()=>r("/community"),children:[t.jsx(W,{className:"w-4 h-4 mr-2"}),"Back to Communities"]})]})})})};export{oe as default};
