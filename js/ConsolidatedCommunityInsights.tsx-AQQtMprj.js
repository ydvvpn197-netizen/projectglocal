const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/optimizedSentimentService.ts-BMei3mzh.js","js/chunk-CasIWBEQ.js","js/chunk-C4jjqBrH.js","js/chunk-BlluHz2J.js","js/chunk-DJzzOJWe.js","js/chunk-COTa-BBv.js","js/chunk-DvlvDbdf.js","js/chunk-BA32w1ww.js","js/optimizedTrendService.ts-D4e5j4rG.js","js/sentimentAnalysisService.ts-CTzimCA1.js","js/trendPredictionService.ts-BXW5mY4J.js"])))=>i.map(i=>d[i]);
var be=Object.defineProperty;var W=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var q=(n,s,d)=>s in n?be(n,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[s]=d,M=(n,s)=>{for(var d in s||(s={}))je.call(s,d)&&q(n,d,s[d]);if(W)for(var d of W(s))fe.call(s,d)&&q(n,d,s[d]);return n};var A=(n,s,d)=>new Promise((l,c)=>{var g=h=>{try{x(d.next(h))}catch(i){c(i)}},b=h=>{try{x(d.throw(h))}catch(i){c(i)}},x=h=>h.done?l(h.value):Promise.resolve(h.value).then(g,b);x((d=d.apply(n,s)).next())});import{j as e,r,bC as K,a9 as Q,w as X,t as R,a0 as H,bD as Y,bE as J,aq as P,bF as ee,av as Ne,f as se,aQ as te,bG as ve,W as ye,e as we,a6 as _e,bH as Z,v as Ce,aU as G,U as Se,x as Ae,l as Te,m as Ee}from"./chunk-COTa-BBv.js";import{u as Le,a as Re,b as ae,c as ke}from"./chunk-CvCzjiVP.js";import{a as Ie,B as Pe,C as D,c as U,d as F,b as $}from"./main-BMj1NFFE.js";import{T as De,a as $e,b as O,c as z}from"./chunk-BzTmHFr7.js";import{S as Ue}from"./chunk-qg8sq3rE.js";import{L as Fe}from"./chunk-UbFD0_dp.js";import{s as V}from"./chunk-CasIWBEQ.js";import{W as k,C as re,X as ne,Y as ie,Z as le,$ as ce,a0 as de,a1 as oe,a2 as me,a3 as xe,a4 as ge,a5 as Oe}from"./chunk-BlluHz2J.js";import{m as B}from"./chunk-COG8KeUH.js";import"./chunk-DvlvDbdf.js";import"./chunk-BA32w1ww.js";import"./chunk-DJzzOJWe.js";import"./chunk-C4jjqBrH.js";function ze({children:n,fallback:s=null,loading:d=e.jsx("div",{children:"Loading..."}),requiredRole:l,requiredPermission:c,requireAdmin:g=!1,requireSuperAdmin:b=!1,requireAny:x=!1}){const{loading:h,hasRole:i,hasPermission:N}=Le(),{hasRole:u,loading:w}=Re(l||"user"),{isAdmin:f,loading:_}=ae(),{isSuperAdmin:p,loading:v}=ke();if(h||w||_||v)return e.jsx(e.Fragment,{children:d});if(!i)return e.jsx(e.Fragment,{children:s});const o=[];return l&&o.push(u),c&&o.push(N),g&&o.push(f),b&&o.push(p),o.length===0?e.jsx(e.Fragment,{children:n}):(x?o.some(y=>y):o.every(y=>y))?e.jsx(e.Fragment,{children:n}):e.jsx(e.Fragment,{children:s})}const Be=()=>{const{user:n}=Ie(),s=r.useCallback(c=>A(null,null,function*(){try{const g=navigator.userAgent;let b="unknown";try{b=(yield(yield fetch("https://api.ipify.org?format=json")).json()).ip}catch(h){console.warn("Could not fetch IP address for security audit:",h)}const{error:x}=yield V.from("security_audit").insert({user_id:(n==null?void 0:n.id)||null,event_type:c.event_type,resource:c.resource,action:c.action,success:c.success,details:c.details||{},ip_address:b,user_agent:g,created_at:new Date().toISOString()});x&&console.error("Failed to log security event:",x)}catch(g){console.error("Security audit logging failed:",g)}}),[n]),d=r.useCallback((c,g,b)=>A(null,null,function*(){yield s({event_type:g?"admin_access":"unauthorized_access",resource:c,action:"view",success:g,details:b})}),[s]),l=r.useCallback((c,g,b,x)=>A(null,null,function*(){yield s({event_type:"permission_check",resource:c,action:`check_${g}`,success:b,details:M({permission:g},x)})}),[s]);return{logSecurityEvent:s,logAccessAttempt:d,logPermissionCheck:l}},He=n=>{const[s,d]=r.useState(null),[l,c]=r.useState(!0),[g,b]=r.useState(null),[x,h]=r.useState(!1),i=r.useRef(null),N=r.useRef(null),u=r.useCallback(()=>A(null,null,function*(){try{c(!0),b(null);const[{optimizedSentimentService:m},{optimizedTrendService:o}]=yield Promise.all([k(()=>import("./optimizedSentimentService.ts-BMei3mzh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),k(()=>import("./optimizedTrendService.ts-D4e5j4rG.js"),__vite__mapDeps([8,1,2,3,4,5,6,7]))]),[T,y,C]=yield Promise.all([m.getCommunitySentimentSummary(n.timePeriod),o.analyzeTrends(n.timePeriod),o.generatePredictions("engagement","short")]);d({sentiment:T,trends:y,predictions:C,lastUpdated:new Date})}catch(m){console.error("Error loading real-time insights:",m),b(m instanceof Error?m.message:"Failed to load data")}finally{c(!1)}}),[n.timePeriod]),w=r.useCallback(()=>{const m=V.channel("sentiment-changes").on("postgres_changes",{event:"*",schema:"public",table:"community_sentiment"},o=>{console.log("Sentiment data changed:",o),u()}).on("postgres_changes",{event:"*",schema:"public",table:"community_trends"},o=>{console.log("Trends data changed:",o),u()}).on("postgres_changes",{event:"*",schema:"public",table:"community_predictions"},o=>{console.log("Predictions data changed:",o),u()}).subscribe(o=>{console.log("Realtime subscription status:",o),h(o==="SUBSCRIBED")});N.current=m},[u]),f=r.useCallback(()=>{n.autoRefresh&&n.refreshInterval>0&&(i.current=setInterval(()=>{u()},n.refreshInterval))},[n.autoRefresh,n.refreshInterval,u]),_=r.useCallback(()=>{i.current&&(clearInterval(i.current),i.current=null),N.current&&(N.current.unsubscribe(),N.current=null),h(!1)},[]);r.useEffect(()=>(u(),w(),f(),_),[u,w,f,_]),r.useEffect(()=>{i.current&&clearInterval(i.current),f()},[f]);const p=r.useCallback(()=>{u()},[u]),v=r.useCallback(()=>A(null,null,function*(){try{const{data:m}=yield V.from("community_sentiment").select("id").limit(1);return{healthy:!0,data:m}}catch(m){return{healthy:!1,error:m instanceof Error?m.message:"Connection failed"}}}),[]);return{data:s,loading:l,error:g,isConnected:x,refresh:p,checkConnection:v,lastUpdated:s==null?void 0:s.lastUpdated}};re.register(ne,ie,le,ce,de,oe,me,xe,ge);const Ve=({className:n=""})=>{const[s,d]=r.useState(null),[l,c]=r.useState([]),[g,b]=r.useState([]),[x,h]=r.useState(!0),[i,N]=r.useState(null),[u,w]=r.useState("week"),[f,_]=r.useState(["sentiment","trends","predictions","engagement"]),p=r.useCallback(()=>A(null,null,function*(){try{h(!0),N(null);const[{SentimentAnalysisService:a},{TrendPredictionService:S}]=yield Promise.all([k(()=>import("./sentimentAnalysisService.ts-CTzimCA1.js"),__vite__mapDeps([9,1,2,3,4,5,6,7])),k(()=>import("./trendPredictionService.ts-BXW5mY4J.js"),__vite__mapDeps([10,1,2,3,4,5,6,7]))]),I=a.getInstance(),E=S.getInstance(),L=yield I.getCommunitySentimentSummary(u);d(L);const t=yield E.analyzeTrends(u);c(t);const j=yield E.generatePredictions("engagement","short");b(j)}catch(a){console.error("Error loading insights data:",a),N("Failed to load insights data. Please try again.")}finally{h(!1)}}),[u]);r.useEffect(()=>{p()},[p]);const v=a=>a>.1?"text-green-600":a<-.1?"text-red-600":"text-gray-600",m=a=>{switch(a){case"rising":return e.jsx(R,{className:"w-5 h-5 text-green-600"});case"falling":return e.jsx(ee,{className:"w-5 h-5 text-red-600"});default:return e.jsx(P,{className:"w-5 h-5 text-gray-600"})}},o=a=>{switch(a){case"rising":return"text-green-600 bg-green-50";case"falling":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},T={labels:(s==null?void 0:s.sentiment_evolution.map(a=>new Date(a.date).toLocaleDateString()))||[],datasets:[{label:"Sentiment Score",data:(s==null?void 0:s.sentiment_evolution.map(a=>a.average_sentiment))||[],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]},y={labels:["Positive","Negative","Neutral"],datasets:[{data:s?[s.sentiment_distribution.positive,s.sentiment_distribution.negative,s.sentiment_distribution.neutral]:[],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(239, 68, 68, 0.8)","rgba(107, 114, 128, 0.8)"],borderColor:["rgb(34, 197, 94)","rgb(239, 68, 68)","rgb(107, 114, 128)"],borderWidth:2}]};l.map(a=>a.trend_name),l.map(a=>a.trend_score),l.map(a=>a.trend_direction==="rising"?"rgba(34, 197, 94, 0.8)":a.trend_direction==="falling"?"rgba(239, 68, 68, 0.8)":"rgba(107, 114, 128, 0.8)"),l.map(a=>a.trend_direction==="rising"?"rgb(34, 197, 94)":a.trend_direction==="falling"?"rgb(239, 68, 68)":"rgb(107, 114, 128)");const C={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Community Insights"}},scales:{y:{beginAtZero:!0}}};return x?e.jsx("div",{className:`p-6 ${n}`,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):i?e.jsx("div",{className:`p-6 ${n}`,children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-red-600 mr-2",children:"⚠️"}),e.jsx("p",{className:"text-red-800",children:i})]})})}):e.jsxs("div",{className:`p-6 space-y-6 ${n}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(K,{className:"w-6 h-6 mr-2 text-blue-600"}),"Community Insights Dashboard"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"AI-powered analysis of community sentiment, trends, and predictions"})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:[e.jsxs("select",{value:u,onChange:a=>w(a.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"day",children:"Last 24 Hours"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"})]}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Refresh"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Q,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Analyses"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(s==null?void 0:s.total_analyses)||0})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(X,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Average Sentiment"}),e.jsx("p",{className:`text-2xl font-bold ${v((s==null?void 0:s.average_sentiment)||0)}`,children:s!=null&&s.average_sentiment?(s.average_sentiment*100).toFixed(1)+"%":"0%"})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(R,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Trends"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(H,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Predictions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.length})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Sentiment Evolution"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{data:T,options:C})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Sentiment Distribution"}),e.jsx("div",{className:"h-64",children:e.jsx(J,{data:y,options:C})})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Community Trends"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map((a,S)=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:a.trend_name}),m(a.trend_direction)]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:a.trend_description||`${a.trend_name} analysis`}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${o(a.trend_direction)}`,children:a.trend_direction}),e.jsxs("span",{className:"text-sm text-gray-500",children:[(a.confidence_level*100).toFixed(0),"% confidence"]})]})]},S))})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"AI Predictions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map((a,S)=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:a.prediction_target}),e.jsx("span",{className:"text-xs text-gray-500",children:a.prediction_horizon})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mb-2",children:a.predicted_value.toFixed(2)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Confidence: ",(a.confidence_score*100).toFixed(0),"%"]}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(a.prediction_date).toLocaleDateString()})]})]},S))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Key Insights"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Community Health"}),e.jsx("p",{className:"text-sm text-gray-600",children:s!=null&&s.average_sentiment&&s.average_sentiment>.1?"Community sentiment is positive and healthy":s!=null&&s.average_sentiment&&s.average_sentiment<-.1?"Community sentiment needs attention":"Community sentiment is neutral"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Trend Analysis"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.filter(a=>a.trend_direction==="rising").length," rising trends, "," ",l.filter(a=>a.trend_direction==="falling").length," falling trends"]})]})]})]})]})};re.register(ne,ie,le,ce,de,oe,me,xe,ge,Oe);const We=({className:n=""})=>{var L;const[s,d]=r.useState(null),[l,c]=r.useState([]),[g,b]=r.useState([]),[x,h]=r.useState(!0),[i,N]=r.useState(null),[u,w]=r.useState("week"),[f,_]=r.useState(!1),[p,v]=r.useState(new Date),m=r.useCallback(()=>A(null,null,function*(){try{h(!0),N(null);const[{optimizedSentimentService:t},{optimizedTrendService:j}]=yield Promise.all([k(()=>import("./optimizedSentimentService.ts-BMei3mzh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),k(()=>import("./optimizedTrendService.ts-D4e5j4rG.js"),__vite__mapDeps([8,1,2,3,4,5,6,7]))]),[he,ue,pe]=yield Promise.all([t.getCommunitySentimentSummary(u),j.analyzeTrends(u),j.generatePredictions("engagement","short")]);d(he),c(ue),b(pe),v(new Date)}catch(t){console.error("Error loading insights data:",t),N("Failed to load insights data. Please try again.")}finally{h(!1)}}),[u]);r.useEffect(()=>{if(f){const t=setInterval(m,3e4);return()=>clearInterval(t)}},[f,m]),r.useEffect(()=>{m()},[m]);const o={labels:(s==null?void 0:s.sentiment_evolution.map(t=>new Date(t.date).toLocaleDateString()))||[],datasets:[{label:"Sentiment Score",data:(s==null?void 0:s.sentiment_evolution.map(t=>t.average_sentiment))||[],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0}]},T={labels:["Positive","Negative","Neutral"],datasets:[{data:s?[s.sentiment_distribution.positive,s.sentiment_distribution.negative,s.sentiment_distribution.neutral]:[],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(239, 68, 68, 0.8)","rgba(107, 114, 128, 0.8)"],borderColor:["rgb(34, 197, 94)","rgb(239, 68, 68)","rgb(107, 114, 128)"],borderWidth:2}]},y={labels:l.map(t=>t.trend_name),datasets:[{label:"Trend Score",data:l.map(t=>Math.abs(t.trend_score)),backgroundColor:l.map(t=>t.trend_direction==="rising"?"rgba(34, 197, 94, 0.8)":t.trend_direction==="falling"?"rgba(239, 68, 68, 0.8)":"rgba(107, 114, 128, 0.8)"),borderColor:l.map(t=>t.trend_direction==="rising"?"rgb(34, 197, 94)":t.trend_direction==="falling"?"rgb(239, 68, 68)":"rgb(107, 114, 128)"),borderWidth:2}]},C={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},tooltip:{callbacks:{label:function(t){return`${t.dataset.label}: ${t.parsed.y}`}}}},scales:{y:{beginAtZero:!0}}},a={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(t){return`${t.label}: ${t.parsed}%`}}}}},S=t=>t>.1?"text-green-600":t<-.1?"text-red-600":"text-gray-600",I=t=>{switch(t){case"rising":return e.jsx(R,{className:"w-5 h-5 text-green-600"});case"falling":return e.jsx(ee,{className:"w-5 h-5 text-red-600"});default:return e.jsx(P,{className:"w-5 h-5 text-gray-600"})}},E=t=>{switch(t){case"rising":return"text-green-600 bg-green-50 border-green-200";case"falling":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return x?e.jsx("div",{className:`p-6 ${n}`,children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading community insights..."})]})}):i?e.jsx("div",{className:`p-6 ${n}`,children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-red-600 mr-2",children:"⚠️"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Error Loading Data"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:i}),e.jsx("button",{onClick:m,className:"mt-2 px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:"Try Again"})]})]})})}):e.jsxs("div",{className:`p-6 space-y-6 ${n}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(K,{className:"w-6 h-6 mr-2 text-blue-600"}),"Community Insights Dashboard"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Real-time AI-powered analysis of community sentiment, trends, and predictions"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Last updated: ",p.toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("button",{onClick:()=>_(!f),className:`flex items-center px-3 py-2 text-sm rounded-md border ${f?"bg-green-50 text-green-700 border-green-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:[e.jsx(Ne,{className:`w-4 h-4 mr-1 ${f?"text-green-600":"text-gray-500"}`}),"Auto-refresh"]})}),e.jsxs("select",{value:u,onChange:t=>w(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"day",children:"Last 24 Hours"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"})]}),e.jsxs("button",{onClick:m,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),"Refresh"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Q,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Analyses"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:((L=s==null?void 0:s.total_analyses)==null?void 0:L.toLocaleString())||0})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(X,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Average Sentiment"}),e.jsx("p",{className:`text-2xl font-bold ${S((s==null?void 0:s.average_sentiment)||0)}`,children:s!=null&&s.average_sentiment?(s.average_sentiment*100).toFixed(1)+"%":"0%"})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(R,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Trends"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(H,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"AI Predictions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.length})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(te,{className:"w-5 h-5 mr-2 text-blue-600"}),"Sentiment Evolution"]}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{data:o,options:C})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(P,{className:"w-5 h-5 mr-2 text-green-600"}),"Sentiment Distribution"]}),e.jsx("div",{className:"h-64",children:e.jsx(J,{data:T,options:a})})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(R,{className:"w-5 h-5 mr-2 text-purple-600"}),"Community Trends Analysis"]}),e.jsx("div",{className:"h-64 mb-4",children:e.jsx(ve,{data:y,options:C})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Trend Details"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map((t,j)=>e.jsxs("div",{className:`p-4 border rounded-lg ${E(t.trend_direction)}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.trend_name}),I(t.trend_direction)]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.trend_description||`${t.trend_name} analysis`}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${E(t.trend_direction)}`,children:t.trend_direction}),e.jsxs("span",{className:"text-sm text-gray-500",children:[(t.confidence_level*100).toFixed(0),"% confidence"]})]})]},j))})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(H,{className:"w-5 h-5 mr-2 text-orange-600"}),"AI Predictions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map((t,j)=>e.jsxs("div",{className:"p-4 border rounded-lg bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.prediction_target}),e.jsx("span",{className:"text-xs text-gray-500 bg-white px-2 py-1 rounded",children:t.prediction_horizon})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mb-2",children:typeof t.predicted_value=="number"?t.predicted_value.toFixed(2):t.predicted_value}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Confidence: ",(t.confidence_score*100).toFixed(0),"%"]}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(t.prediction_date).toLocaleDateString()})]})]},j))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Key Insights"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Community Health"}),e.jsx("p",{className:"text-sm text-gray-600",children:s!=null&&s.average_sentiment&&s.average_sentiment>.1?"🟢 Community sentiment is positive and healthy":s!=null&&s.average_sentiment&&s.average_sentiment<-.1?"🔴 Community sentiment needs attention":"🟡 Community sentiment is neutral"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Trend Analysis"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["📈 ",l.filter(t=>t.trend_direction==="rising").length," rising trends, "," ","📉 ",l.filter(t=>t.trend_direction==="falling").length," falling trends, "," ","➡️ ",l.filter(t=>t.trend_direction==="stable").length," stable trends"]})]})]})]})]})},ns=()=>{const{logAccessAttempt:n}=Be(),{isAdmin:s}=ae(),[d,l]=r.useState("overview"),[c,g]=r.useState(!1),[b]=r.useState(3e4),[x,h]=r.useState({isConnected:!1,healthCheck:!1}),[i,N]=r.useState(null),[u,w]=r.useState(!0),[f,_]=r.useState(null),{data:p,loading:v,error:m,isConnected:o,refresh:T,checkConnection:y,lastUpdated:C}=He({timePeriod:"week",autoRefresh:c,refreshInterval:b});r.useEffect(()=>{h({isConnected:o,lastUpdated:C,healthCheck:o&&!m,error:m||void 0})},[o,C,m]),r.useEffect(()=>{if(p){const j={totalUsers:p.totalUsers||0,activeUsers:p.activeUsers||0,totalPosts:p.totalPosts||0,totalEvents:p.totalEvents||0,totalCommunities:p.totalCommunities||0,engagementRate:p.engagementRate||0,growthRate:p.growthRate||0,topCommunities:p.topCommunities||[],recentActivity:p.recentActivity||[]};N(j)}},[p]),r.useEffect(()=>{const j=setTimeout(()=>{w(!1)},1e3);return()=>clearTimeout(j)},[]),r.useEffect(()=>{n("/community-insights",s,{page:"ConsolidatedCommunityInsights",timestamp:new Date().toISOString()})},[n,s]);const a=()=>A(null,null,function*(){const j=yield y();j.healthy?console.log("✅ Connection healthy"):console.error("❌ Connection issues:",j.error)}),S=()=>A(null,null,function*(){try{yield T(),_(null)}catch(j){_("Failed to refresh data")}}),I=j=>{g(j)},E=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(D,{className:"w-full max-w-md mx-4",children:[e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(Te,{className:"w-6 h-6 text-red-600"})}),e.jsx(F,{className:"text-xl font-semibold text-gray-900",children:"Access Restricted"})]}),e.jsx($,{className:"text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"This page contains sensitive community insights and analytics that are only available to administrators and super administrators."}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-500",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Admin privileges required"})]}),e.jsx("p",{className:"text-xs text-gray-400",children:"If you believe you should have access to this page, please contact your system administrator."})]})})]})}),L=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(D,{className:"w-full max-w-md mx-4",children:e.jsxs($,{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Verifying access permissions..."})]})})}),t=()=>e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:`px-4 py-2 text-sm ${x.isConnected?"bg-green-50 text-green-800 border-b border-green-200":"bg-red-50 text-red-800 border-b border-red-200"}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-2",children:x.isConnected?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Real-time connection active"})]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{children:"Real-time connection inactive"})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[x.lastUpdated&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsxs("span",{children:["Last update: ",x.lastUpdated.toLocaleTimeString()]})]}),e.jsxs("button",{onClick:a,className:"flex items-center space-x-1 px-2 py-1 rounded text-xs hover:bg-white hover:bg-opacity-20",children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsx("span",{children:"Check Connection"})]})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-white p-4 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-lg ${x.isConnected?"bg-green-100":"bg-red-100"}`,children:x.isConnected?e.jsx(Ce,{className:"w-5 h-5 text-green-600"}):e.jsx(G,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Connection"}),e.jsx("p",{className:`text-lg font-semibold ${x.isConnected?"text-green-600":"text-red-600"}`,children:x.isConnected?"Connected":"Disconnected"})]})]})}),e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"bg-white p-4 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-lg ${c?"bg-blue-100":"bg-gray-100"}`,children:e.jsx(P,{className:`w-5 h-5 ${c?"text-blue-600":"text-gray-600"}`})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Auto-refresh"}),e.jsx("p",{className:`text-lg font-semibold ${c?"text-blue-600":"text-gray-600"}`,children:c?"Active":"Inactive"})]})]})}),e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"bg-white p-4 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-lg ${i&&!v?"bg-green-100":v?"bg-yellow-100":"bg-red-100"}`,children:e.jsx(Z,{className:`w-5 h-5 ${i&&!v?"text-green-600":v?"text-yellow-600":"text-red-600"}`})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Data Status"}),e.jsx("p",{className:`text-lg font-semibold ${v?"text-yellow-600":i?"text-green-600":"text-red-600"}`,children:v?"Loading...":i?"Ready":"Error"})]})]})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto",children:f?e.jsx("div",{className:"px-4",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"w-6 h-6 text-red-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-800",children:"Error Loading Data"}),e.jsx("p",{className:"text-red-700 mt-1",children:f}),e.jsx("button",{onClick:S,className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Retry"})]})]})})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(De,{value:d,onValueChange:l,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($e,{className:"grid w-full max-w-md grid-cols-3",children:[e.jsxs(O,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(O,{value:"realtime",className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Real-time"]}),e.jsxs(O,{value:"analytics",className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Analytics"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{htmlFor:"auto-refresh",children:"Auto-refresh"}),e.jsx(Ue,{id:"auto-refresh",checked:c,onCheckedChange:I})]}),e.jsxs(Pe,{variant:"outline",size:"sm",onClick:S,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})]}),e.jsx(z,{value:"overview",className:"space-y-6",children:e.jsx(Ve,{})}),e.jsx(z,{value:"realtime",className:"space-y-6",children:e.jsx(We,{className:"max-w-none"})}),e.jsx(z,{value:"analytics",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(D,{children:[e.jsx(U,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),"User Analytics"]})}),e.jsx($,{children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Users"}),e.jsx("span",{className:"text-lg font-bold",children:i.totalUsers.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Active Users"}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:i.activeUsers.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Growth Rate"}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["+",i.growthRate,"%"]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})})]}),e.jsxs(D,{children:[e.jsx(U,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5"}),"Engagement Metrics"]})}),e.jsx($,{children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Posts"}),e.jsx("span",{className:"text-lg font-bold",children:i.totalPosts.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Events"}),e.jsx("span",{className:"text-lg font-bold",children:i.totalEvents.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Engagement Rate"}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:[i.engagementRate,"%"]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading metrics..."})]})})]})]})})]})})})]});return e.jsx(ze,{requireAdmin:!0,fallback:e.jsx(E,{}),loading:e.jsx(L,{}),children:e.jsx(t,{})})};export{ns as default};
