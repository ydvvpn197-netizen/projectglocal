var h=Object.defineProperty,p=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var f=(n,r,t)=>r in n?h(n,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[r]=t,u=(n,r)=>{for(var t in r||(r={}))q.call(r,t)&&f(n,t,r[t]);if(g)for(var t of g(r))w.call(r,t)&&f(n,t,r[t]);return n},m=(n,r)=>p(n,v(r));var c=(n,r,t)=>new Promise((e,s)=>{var a=d=>{try{l(t.next(d))}catch(_){s(_)}},o=d=>{try{l(t.throw(d))}catch(_){s(_)}},l=d=>d.done?e(d.value):Promise.resolve(d.value).then(a,o);l((t=t.apply(n,r)).next())});import{s as i}from"./main-nj8_qmr1.js";class ${static getOrCreateConversation(r,t){return c(this,null,function*(){try{const{data:e,error:s}=yield i.from("chat_conversations").select("id").or(`and(client_id.eq.${r},artist_id.eq.${t}),and(client_id.eq.${t},artist_id.eq.${r})`).single();if(e)return e.id;const{data:a,error:o}=yield i.from("chat_conversations").insert({client_id:r,artist_id:t,status:"pending"}).select("id").single();return o?(console.error("Error creating conversation:",o),null):a.id}catch(e){return console.error("Error in getOrCreateConversation:",e),null}})}static getConversationDetails(r,t){return c(this,null,function*(){try{const{data:e,error:s}=yield i.from("chat_conversations").select(`
          *,
          client:profiles!client_id(id, user_id, display_name, username, avatar_url, is_verified, is_premium),
          artist:profiles!artist_id(id, user_id, display_name, username, avatar_url, is_verified, is_premium)
        `).eq("id",r).single();if(s)throw s;const a=e.client_id===t?e.artist_id:e.client_id,o=e.client_id===t?e.artist:e.client,{data:l}=yield i.from("chat_messages").select("*").eq("conversation_id",r).order("created_at",{ascending:!1}).limit(1).single(),{count:d}=yield i.from("chat_messages").select("*",{count:"exact"}).eq("conversation_id",r).eq("is_read",!1).neq("sender_id",t);return m(u({},e),{other_user:o,last_message:l,unread_count:d||0})}catch(e){return console.error("Error fetching conversation details:",e),null}})}static getUserConversations(r){return c(this,null,function*(){try{const{data:t,error:e}=yield i.from("chat_conversations").select(`
          *,
          client:profiles!client_id(id, user_id, display_name, username, avatar_url, is_verified, is_premium),
          artist:profiles!artist_id(id, user_id, display_name, username, avatar_url, is_verified, is_premium)
        `).or(`client_id.eq.${r},artist_id.eq.${r}`).order("last_message_at",{ascending:!1,nullsFirst:!1});if(e)throw e;return yield Promise.all(t.map(a=>c(null,null,function*(){const o=a.client_id===r?a.artist_id:a.client_id,l=a.client_id===r?a.artist:a.client,[d,_]=yield Promise.all([i.from("chat_messages").select("*").eq("conversation_id",a.id).order("created_at",{ascending:!1}).limit(1).single(),i.from("chat_messages").select("*",{count:"exact"}).eq("conversation_id",a.id).eq("is_read",!1).neq("sender_id",r)]);return m(u({},a),{other_user:l,last_message:d.data,unread_count:_.count||0})})))}catch(t){return console.error("Error fetching user conversations:",t),[]}})}static getConversationMessages(r,t=50,e=0){return c(this,null,function*(){try{const{data:s,error:a}=yield i.from("chat_messages").select("*").eq("conversation_id",r).order("created_at",{ascending:!1}).range(e,e+t-1);if(a)throw a;return s||[]}catch(s){return console.error("Error fetching messages:",s),[]}})}static sendMessage(r,t,e,s="text"){return c(this,null,function*(){try{const{data:a,error:o}=yield i.from("chat_messages").insert({conversation_id:r,sender_id:t,message:e,message_type:s}).select().single();if(o)throw o;return yield i.from("chat_conversations").update({last_message_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",r),a}catch(a){return console.error("Error sending message:",a),null}})}static acceptConversation(r,t){return c(this,null,function*(){try{const{error:e}=yield i.from("chat_conversations").update({status:"active",updated_at:new Date().toISOString()}).eq("id",r).or(`client_id.eq.${t},artist_id.eq.${t}`);if(e)throw e;return!0}catch(e){return console.error("Error accepting conversation:",e),!1}})}static blockConversation(r,t){return c(this,null,function*(){try{const{error:e}=yield i.from("chat_conversations").update({status:"blocked",updated_at:new Date().toISOString()}).eq("id",r).or(`client_id.eq.${t},artist_id.eq.${t}`);if(e)throw e;return!0}catch(e){return console.error("Error blocking conversation:",e),!1}})}static markMessagesAsRead(r,t){return c(this,null,function*(){try{const{error:e}=yield i.from("chat_messages").update({is_read:!0}).eq("conversation_id",r).neq("sender_id",t).eq("is_read",!1);if(e)throw e;return!0}catch(e){return console.error("Error marking messages as read:",e),!1}})}static getPendingRequests(r){return c(this,null,function*(){try{const{data:t,error:e}=yield i.from("chat_conversations").select(`
          *,
          client:profiles!client_id(id, user_id, display_name, username, avatar_url, is_verified, is_premium),
          artist:profiles!artist_id(id, user_id, display_name, username, avatar_url, is_verified, is_premium)
        `).eq("status","pending").or(`client_id.eq.${r},artist_id.eq.${r}`).order("created_at",{ascending:!1});if(e)throw e;return t.map(s=>{const a=s.client_id===r?s.artist_id:s.client_id,o=s.client_id===r?s.artist:s.client;return m(u({},s),{other_user:o})})}catch(t){return console.error("Error fetching pending requests:",t),[]}})}static archiveConversation(r,t){return c(this,null,function*(){try{const{error:e}=yield i.from("chat_conversations").update({status:"archived",updated_at:new Date().toISOString()}).eq("id",r).or(`client_id.eq.${t},artist_id.eq.${t}`);if(e)throw e;return!0}catch(e){return console.error("Error archiving conversation:",e),!1}})}}export{$ as C};
