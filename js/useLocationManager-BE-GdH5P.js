var v=Object.defineProperty,F=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var S=(o,c,t)=>c in o?v(o,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[c]=t,a=(o,c)=>{for(var t in c||(c={}))A.call(c,t)&&S(o,t,c[t]);if(L)for(var t of L(c))M.call(c,t)&&S(o,t,c[t]);return o},n=(o,c)=>F(o,R(c));var g=(o,c,t)=>new Promise((h,d)=>{var b=u=>{try{f(t.next(u))}catch(y){d(y)}},E=u=>{try{f(t.throw(u))}catch(y){d(y)}},f=u=>u.done?h(u.value):Promise.resolve(u.value).then(b,E);f((t=t.apply(o,c)).next())});import{u as P,r as l}from"./main-B2Z1A0fl.js";import{L as i}from"./locationService-DtReVENb.js";function j(){const{user:o}=P(),[c,t]=l.useState({current:null,enabled:!1,auto_detect:!0,loading:!1,error:null}),[h,d]=l.useState({enabled:!1,auto_detect:!0,radius_km:50,categories:[],notifications:!0}),b=l.useRef(c),E=l.useRef(h);l.useEffect(()=>{b.current=c},[c]),l.useEffect(()=>{E.current=h},[h]);const f=l.useCallback(()=>g(this,null,function*(){if(o){t(e=>n(a({},e),{loading:!0,error:null}));try{const[e,r]=yield Promise.all([i.getCurrentUserLocation(),i.getLocationSettings()]);t(s=>n(a({},s),{current:e,enabled:r.enabled,auto_detect:r.auto_detect,loading:!1})),d(r)}catch(e){console.error("Error loading location and settings:",e),t(r=>n(a({},r),{loading:!1,error:e instanceof Error?e.message:"Failed to load location"}))}}}),[o]);l.useEffect(()=>{o&&f()},[o,f]);const u=l.useCallback(()=>g(this,null,function*(){if(o){t(e=>n(a({},e),{loading:!0,error:null}));try{const e=yield i.detectAndSaveLocation();t(s=>n(a({},s),{current:e,enabled:!0,auto_detect:!0,loading:!1}));const r=yield i.getLocationSettings();return d(r),e}catch(e){throw console.error("Error detecting location:",e),t(r=>n(a({},r),{loading:!1,error:e instanceof Error?e.message:"Failed to detect location"})),e}}}),[o]),y=l.useCallback(e=>g(this,null,function*(){if(o){t(r=>n(a({},r),{loading:!0,error:null}));try{yield i.setManualLocation(e),t(s=>n(a({},s),{current:e,enabled:!0,auto_detect:!1,loading:!1}));const r=yield i.getLocationSettings();d(r)}catch(r){throw console.error("Error setting manual location:",r),t(s=>n(a({},s),{loading:!1,error:r instanceof Error?r.message:"Failed to set location"})),r}}}),[o]),w=l.useCallback(e=>g(this,null,function*(){if(o){t(r=>n(a({},r),{loading:!0,error:null}));try{yield i.updateLocationSettings(e);const r=yield i.getLocationSettings();d(r),e.enabled!==void 0?t(s=>n(a({},s),{enabled:e.enabled,loading:!1})):t(s=>n(a({},s),{loading:!1}))}catch(r){throw console.error("Error updating location settings:",r),t(s=>n(a({},s),{loading:!1,error:r instanceof Error?r.message:"Failed to update settings"})),r}}}),[o]),m=l.useCallback(e=>g(this,null,function*(){if(o){t(r=>n(a({},r),{loading:!0,error:null}));try{yield i.toggleLocationServices(e),t(r=>n(a({},r),{enabled:e,loading:!1})),d(r=>n(a({},r),{enabled:e}))}catch(r){throw console.error("Error toggling location services:",r),t(s=>n(a({},s),{loading:!1,error:r instanceof Error?r.message:"Failed to toggle location services"})),r}}}),[o]),C=l.useCallback(()=>g(this,null,function*(){if(o){t(e=>n(a({},e),{loading:!0,error:null}));try{yield i.toggleLocationServices(!1),t(e=>n(a({},e),{current:null,enabled:!1,loading:!1})),d(e=>n(a({},e),{enabled:!1}))}catch(e){throw console.error("Error clearing location:",e),t(r=>n(a({},r),{loading:!1,error:e instanceof Error?e.message:"Failed to clear location"})),e}}}),[o]),k=l.useCallback(()=>g(this,null,function*(){if(!(!o||!b.current.enabled)){t(e=>n(a({},e),{loading:!0,error:null}));try{b.current.auto_detect?yield u():yield f()}catch(e){console.error("Error refreshing location:",e),t(r=>n(a({},r),{loading:!1,error:e instanceof Error?e.message:"Failed to refresh location"}))}}}),[o,u,f]),p=l.useCallback((e,r)=>g(this,null,function*(){if(!o||!b.current.enabled||!b.current.current)return[];try{return yield i.getNearbyContent(e,r)}catch(s){return console.error("Error getting nearby content:",s),[]}}),[o]),_=l.useCallback(e=>g(this,null,function*(){if(!o)return[];try{return yield i.searchPlaces(e,b.current.current||void 0)}catch(r){return console.error("Error searching places:",r),[]}}),[o]);return{location:c.current,enabled:c.enabled,auto_detect:c.auto_detect,loading:c.loading,error:c.error,settings:h,detectLocation:u,setManualLocation:y,updateSettings:w,toggleLocationServices:m,clearLocation:C,refreshLocation:k,getNearbyContent:p,searchPlaces:_,loadLocationAndSettings:f}}export{j as u};
