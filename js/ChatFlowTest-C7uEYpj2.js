var $=Object.defineProperty,P=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var T=(t,a,i)=>a in t?$(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,A=(t,a)=>{for(var i in a||(a={}))G.call(a,i)&&T(t,i,a[i]);if(k)for(var i of k(a))M.call(a,i)&&T(t,i,a[i]);return t},S=(t,a)=>P(t,O(a));var c=(t,a,i)=>new Promise((p,l)=>{var u=o=>{try{h(i.next(o))}catch(d){l(d)}},m=o=>{try{h(i.throw(o))}catch(d){l(d)}},h=o=>o.done?p(o.value):Promise.resolve(o.value).then(u,m);h((i=i.apply(t,a)).next())});import{u as X,g as Y,f as H,r as I,j as e,C as x,p as w,q as j,t as E,v as R,B as b,s as v}from"./main-Dczk40-q.js";import{B as J}from"./badge-iBsRNaSn.js";import{C as g}from"./chatService-Df5PVg4m.js";import{M as f}from"./message-circle-CrqL1ene.js";import{C as N}from"./clock-D-HXAPEh.js";import{X as W}from"./x-circle-DtL0wFqx.js";import{C as z}from"./check-circle-CJSaU0rJ.js";const at=()=>{const{user:t}=X(),{toast:a}=Y(),i=H(),[p,l]=I.useState([]),[u,m]=I.useState(!1),h=[{test:"User Authentication",status:"pending"},{test:"Chat Service Import",status:"pending"},{test:"Database Connection",status:"pending"},{test:"Get User Conversations",status:"pending"},{test:"Chat Permissions Check",status:"pending"},{test:"Conversation Creation",status:"pending"},{test:"Navigation Test",status:"pending"}],o=(s,r,n,y)=>{l(B=>B.map(C=>C.test===s?S(A({},C),{status:r,message:n,data:y}):C))},d=(s,r)=>c(void 0,null,function*(){o(s,"running");try{const n=yield r();return o(s,"passed",`Success: ${JSON.stringify(n)}`,n),n}catch(n){throw o(s,"failed",`Error: ${n instanceof Error?n.message:"Unknown error"}`),n}}),q=()=>c(void 0,null,function*(){if(!(t!=null&&t.id)){a({title:"Authentication Required",description:"Please log in to run chat flow tests",variant:"destructive"});return}m(!0),l(h);try{yield d("User Authentication",()=>c(void 0,null,function*(){if(!(t!=null&&t.id))throw new Error("User not authenticated");return{userId:t.id,email:t.email}})),yield d("Chat Service Import",()=>c(void 0,null,function*(){if(!g)throw new Error("ChatService not imported");return{serviceAvailable:!0}})),yield d("Database Connection",()=>c(void 0,null,function*(){const{data:r,error:n}=yield v.from("chat_conversations").select("count").limit(1);if(n)throw n;return{connected:!0}}));const s=yield d("Get User Conversations",()=>c(void 0,null,function*(){const r=yield g.getUserConversations(t.id);return{conversationCount:r.length,conversations:r}}));yield d("Chat Permissions Check",()=>c(void 0,null,function*(){return{canChat:yield g.canUserChatWithArtist(t.id,"94d1529d-71c1-4179-b0a3-d0311b78a654"),artistId:"94d1529d-71c1-4179-b0a3-d0311b78a654"}})),yield d("Conversation Creation",()=>c(void 0,null,function*(){const{data:r,error:n}=yield v.from("artist_bookings").select("id").eq("user_id",t.id).eq("status","accepted").limit(1).single();return n||!r?{message:"No accepted bookings found for testing",bookingId:null}:{conversationId:yield g.getOrCreateConversationForBooking(r.id),bookingId:r.id}})),yield d("Navigation Test",()=>c(void 0,null,function*(){return{navigationAvailable:!0,navigateFunction:typeof i}}))}catch(s){console.error("Test suite failed:",s)}finally{m(!1)}}),D=()=>c(void 0,null,function*(){if(t!=null&&t.id)try{const{data:s,error:r}=yield v.from("artist_bookings").select("id").eq("user_id",t.id).eq("status","accepted").limit(1).single();if(r||!s){a({title:"No Accepted Bookings",description:"You need an accepted booking to test chat navigation",variant:"destructive"});return}const n=yield g.getOrCreateConversationForBooking(s.id);n?(i(`/chat/${n}`),a({title:"Navigation Test",description:"Successfully navigated to chat!"})):a({title:"Navigation Failed",description:"Could not create or find conversation",variant:"destructive"})}catch(s){console.error("Navigation test failed:",s),a({title:"Navigation Test Failed",description:"Error during navigation test",variant:"destructive"})}}),F=()=>c(void 0,null,function*(){if(t!=null&&t.id)try{const s="9fd226c7-f2f3-48f9-b910-79b065fbdec9",{data:r,error:n}=yield v.from("chat_conversations").select("*").eq("id",s).or(`client_id.eq.${t.id},artist_id.eq.${t.id}`).single();if(n||!r){a({title:"Access Denied",description:"You don't have access to this conversation",variant:"destructive"});return}i(`/chat/${s}`),a({title:"Direct Chat Access",description:"Successfully accessed chat conversation!"})}catch(s){console.error("Direct chat access test failed:",s),a({title:"Direct Chat Access Failed",description:"Error during direct chat access test",variant:"destructive"})}}),U=s=>{switch(s){case"passed":return e.jsx(z,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(W,{className:"h-4 w-4 text-red-500"});case"running":return e.jsx(N,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return e.jsx(N,{className:"h-4 w-4 text-gray-400"})}},_=s=>{switch(s){case"passed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"running":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{children:[e.jsxs(w,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5"}),"Chat Flow Test Suite"]}),e.jsx(E,{children:"Comprehensive testing of the chat system functionality"})]}),e.jsx(R,{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:q,disabled:u,className:"flex items-center gap-2",children:[u?e.jsx(N,{className:"h-4 w-4 animate-spin"}):e.jsx(f,{className:"h-4 w-4"}),u?"Running Tests...":"Run All Tests"]}),e.jsxs(b,{onClick:D,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),"Test Chat Navigation"]}),e.jsxs(b,{onClick:F,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),"Test Direct Chat Access"]})]})})]}),e.jsxs(x,{children:[e.jsx(w,{children:e.jsx(j,{children:"Test Results"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-2",children:p.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[U(s.status),e.jsx("span",{className:"font-medium",children:s.test})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{className:_(s.status),children:s.status})})]},r))})})]})]}):e.jsx(x,{children:e.jsxs(w,{children:[e.jsx(j,{children:"Chat Flow Test"}),e.jsx(E,{children:"Please log in to run chat flow tests"})]})})};export{at as ChatFlowTest};
