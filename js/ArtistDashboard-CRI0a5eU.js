var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(s,t,i)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,l=(e,s)=>{for(var t in s||(s={}))a.call(s,t)&&n(e,t,s[t]);if(i)for(var t of i(s))r.call(s,t)&&n(e,t,s[t]);return e},d=(e,i)=>s(e,t(i)),o=(e,s,t)=>new Promise((i,a)=>{var r=e=>{try{l(t.next(e))}catch(s){a(s)}},n=e=>{try{l(t.throw(e))}catch(s){a(s)}},l=e=>e.done?i(e.value):Promise.resolve(e.value).then(r,n);l((t=t.apply(e,s)).next())});import{c,u as m,d as x,r as u,s as h,j,C as p,v as f,w as g,y as v,x as N,B as _,X as y,b,S as w}from"./main-6fHUpRzT.js";import{R as k}from"./ResponsiveLayout-Bc2JEU4o.js";import{B as q}from"./badge-Bj-CyBpD.js";import{S as C}from"./separator-55ip2E4B.js";import{S as D}from"./scroll-area-DRpKKhsW.js";import{D as E,e as P,a as S,b as B,c as R,d as A}from"./dialog-DM8TTFu4.js";import{n as $}from"./useNotifications-DlOFbLc9.js";import{C as M}from"./index-YNlOS8aM.js";import{C as T}from"./clock-CuUFWr0o.js";import{U as F}from"./user-DoINJrqZ.js";import{f as O}from"./index-GQUAIkZv.js";import{M as L}from"./map-pin-DJOBTPKn.js";import{D as z}from"./dollar-sign-Dc936s2v.js";import{C as U}from"./check-BVB7WkBF.js";import{A as V,a as I,b as Y,i as X}from"./sheet-D2smYKYW.js";import{M as H}from"./message-circle-clGX_rmg.js";import{T as K}from"./trending-up-EJ6gDKFP.js";import{A as Q}from"./award-DpYF0-Hz.js";import{C as W}from"./check-circle-Bfeu-Ke9.js";import{X as G}from"./x-circle-CodQOx23.js";import{P as J}from"./pin-BCmPI7YT.js";import{T as Z,a as ee,b as se,c as te}from"./tabs-BNobDGc4.js";import{C as ie}from"./calendar-days-CZ8WP0oh.js";import"./input-C0XSs2D-.js";import"./NotificationBell-C-odGad4.js";import"./Combination-Bb2n9b59.js";import"./bell-DFXHEubE.js";import"./NotificationButton-CnmvsVP-.js";import"./search-CeL_nYcN.js";import"./users-Czby48qY.js";import"./zap-Dyj-3m1T.js";import"./message-square-BNIlY-fX.js";import"./alert-BCcU8rrr.js";import"./wifi-D7M5OVnX.js";import"./log-out-B3lkkfQi.js";import"./index-BlbmBgSN.js";import"./index-jVOyRz7F.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=c("PinOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h12",key:"13x2n8"}],["path",{d:"M15 9.34V6h1a2 2 0 0 0 0-4H7.89",key:"reo3ki"}]]),re=()=>{const{user:e}=m(),{toast:s}=x(),[t,i]=u.useState([]),[a,r]=u.useState(!0),[n,c]=u.useState(null),b=u.useCallback(()=>o(void 0,null,function*(){if(e)try{const{data:s,error:t}=yield h.from("artists").select("id").eq("user_id",e.id).single();if(t)return void i([]);const{data:a,error:r}=yield h.from("artist_bookings").select("*").eq("artist_id",s.id).eq("status","pending").order("created_at",{ascending:!1});if(r)throw r;const n=yield Promise.all((a||[]).map(e=>o(void 0,null,function*(){const{data:s}=yield h.from("profiles").select("display_name, avatar_url").eq("user_id",e.user_id).single();return d(l({},e),{client_name:(null==s?void 0:s.display_name)||"Unknown User",client_avatar:(null==s?void 0:s.avatar_url)||""})})));i(n)}catch(t){s({title:"Error",description:"Failed to load booking requests",variant:"destructive"})}finally{r(!1)}}),[e,s]);u.useEffect(()=>{if(e){b();(()=>o(void 0,null,function*(){const{data:s,error:t}=yield h.from("artists").select("id").eq("user_id",e.id).single();if(t)return;const i=h.channel("booking-requests").on("postgres_changes",{event:"INSERT",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${s.id}`},()=>{b()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${s.id}`},()=>{b()}).subscribe();return()=>{h.removeChannel(i)}}))()}},[e,b]);const w=(e,a)=>o(void 0,null,function*(){c(e);try{const n=t.find(s=>s.id===e);if(!n)return;const{error:l}=yield h.from("artist_bookings").update({status:"accept"===a?"accepted":"declined",updated_at:(new Date).toISOString()}).eq("id",e);if(l)throw l;try{yield $.createBookingResponseNotification(e,a)}catch(r){}if("accept"===a){const{error:t}=yield h.from("chat_conversations").insert({booking_id:e,client_id:n.user_id,artist_id:n.artist_id});s({title:"Booking Accepted",description:"You've accepted the booking request. A chat has been started with the client."})}else s({title:"Booking Declined",description:"You've declined the booking request."});i(s=>s.filter(s=>s.id!==e))}catch(n){s({title:"Error",description:"Failed to process booking request",variant:"destructive"})}finally{c(null)}});return e?a?j.jsxs(p,{children:[j.jsx(f,{children:j.jsx(g,{children:"Booking Requests"})}),j.jsx(v,{children:j.jsx("div",{className:"flex items-center justify-center py-8",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):j.jsxs(p,{children:[j.jsxs(f,{children:[j.jsxs(g,{className:"flex items-center gap-2",children:[j.jsx(M,{className:"h-5 w-5"}),"Booking Requests"]}),j.jsx(N,{children:"Manage incoming booking requests from clients"})]}),j.jsx(v,{children:0===t.length?j.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[j.jsx(T,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),j.jsx("p",{children:"No booking requests yet"}),j.jsx("p",{className:"text-sm",children:"Requests will appear here when clients book your services"})]}):j.jsx(D,{className:"h-96",children:j.jsx("div",{className:"space-y-4",children:t.map(e=>j.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:j.jsx(F,{className:"h-5 w-5 text-primary"})}),j.jsxs("div",{children:[j.jsx("h4",{className:"font-medium",children:e.client_name}),j.jsx("p",{className:"text-sm text-muted-foreground",children:O(new Date(e.created_at),"PPp")})]})]}),j.jsx(q,{variant:"outline",children:"New Request"})]}),j.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),j.jsx("span",{children:O(new Date(e.event_date),"PPP")})]}),j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(L,{className:"h-4 w-4 text-muted-foreground"}),j.jsx("span",{className:"truncate",children:e.event_location||"Location TBD"})]}),j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),j.jsx("span",{children:e.budget_min&&e.budget_max?`$${e.budget_min} - $${e.budget_max}`:"Budget TBD"})]})]}),j.jsx("div",{className:"space-y-2",children:j.jsx("p",{className:"text-sm text-muted-foreground",children:e.event_description})}),j.jsx(C,{}),j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs(E,{children:[j.jsx(P,{asChild:!0,children:j.jsx(_,{variant:"outline",size:"sm",children:"View Details"})}),j.jsxs(S,{children:[j.jsxs(B,{children:[j.jsx(R,{children:"Booking Request Details"}),j.jsx(A,{children:"Full information about this booking request"})]}),j.jsxs("div",{className:"space-y-4",children:[j.jsxs("div",{children:[j.jsx("h4",{className:"font-medium mb-2",children:"Client Information"}),j.jsxs("p",{children:["Name: ",e.client_name]}),e.contact_info&&j.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:e.contact_info})]}),j.jsxs("div",{children:[j.jsx("h4",{className:"font-medium mb-2",children:"Event Details"}),j.jsxs("div",{className:"space-y-1 text-sm",children:[j.jsxs("p",{children:[j.jsx("strong",{children:"Date:"})," ",O(new Date(e.event_date),"PPP")]}),j.jsxs("p",{children:[j.jsx("strong",{children:"Location:"})," ",e.event_location]}),j.jsxs("p",{children:[j.jsx("strong",{children:"Description:"})," ",e.event_description]}),j.jsxs("p",{children:[j.jsx("strong",{children:"Budget:"}),e.budget_min&&e.budget_max?` $${e.budget_min} - $${e.budget_max}`:" Not specified"]})]})]})]})]})]}),j.jsxs("div",{className:"flex gap-2",children:[j.jsxs(_,{size:"sm",variant:"destructive",onClick:()=>w(e.id,"reject"),disabled:n===e.id,children:[j.jsx(y,{className:"h-4 w-4 mr-1"}),"Reject"]}),j.jsxs(_,{size:"sm",onClick:()=>w(e.id,"accept"),disabled:n===e.id,children:[j.jsx(U,{className:"h-4 w-4 mr-1"}),"Accept & Chat"]})]})]})]},e.id))})})})]}):null},ne=()=>{const{user:e}=m(),{toast:s}=x(),[t,i]=u.useState([]),[a,r]=u.useState(!0),n=b(),c=u.useCallback(()=>o(void 0,null,function*(){if(e)try{const{data:s,error:t}=yield h.from("chat_conversations").select("*").eq("artist_id",e.id).eq("status","active").order("updated_at",{ascending:!1});if(t)throw t;const a=yield Promise.all((s||[]).map(e=>o(void 0,null,function*(){const{data:s}=yield h.from("profiles").select("display_name, avatar_url").eq("user_id",e.client_id).single(),{data:t}=yield h.from("artist_bookings").select("event_date, event_location").eq("id",e.booking_id).single();return d(l({},e),{client_name:(null==s?void 0:s.display_name)||"Unknown User",client_avatar:(null==s?void 0:s.avatar_url)||"",event_date:(null==t?void 0:t.event_date)||"",event_location:(null==t?void 0:t.event_location)||"",unread_count:0})})));i(a)}catch(t){s({title:"Error",description:"Failed to load conversations",variant:"destructive"})}finally{r(!1)}}),[e,s]);u.useEffect(()=>{if(e){c();const s=h.channel("active-conversations").on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_conversations",filter:`artist_id=eq.${e.id}`},()=>{c()}).subscribe();return()=>{h.removeChannel(s)}}},[e,c]);return e?a?j.jsxs(p,{children:[j.jsx(f,{children:j.jsx(g,{children:"Active Conversations"})}),j.jsx(v,{children:j.jsx("div",{className:"flex items-center justify-center py-8",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):j.jsxs(p,{children:[j.jsxs(f,{children:[j.jsxs(g,{className:"flex items-center gap-2",children:[j.jsx(H,{className:"h-5 w-5"}),"Active Conversations"]}),j.jsx(N,{children:"Chat with clients about accepted bookings"})]}),j.jsx(v,{children:0===t.length?j.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[j.jsx(H,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),j.jsx("p",{children:"No active conversations"}),j.jsx("p",{className:"text-sm",children:"Conversations will appear here when you accept booking requests"})]}):j.jsx(D,{className:"h-96",children:j.jsx("div",{className:"space-y-4",children:t.map(e=>j.jsxs("div",{className:"border rounded-lg p-4 hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>(e=>{n(`/chat/${e}`)})(e.id),children:[j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs(V,{className:"h-10 w-10",children:[j.jsx(I,{src:e.client_avatar}),j.jsx(Y,{children:e.client_name.charAt(0)})]}),j.jsxs("div",{children:[j.jsx("h4",{className:"font-medium",children:e.client_name}),j.jsxs("p",{className:"text-sm text-muted-foreground",children:["Started ",O(new Date(e.created_at),"PPp")]})]})]}),e.unread_count>0&&j.jsx(q,{variant:"destructive",className:"ml-2",children:e.unread_count})]}),j.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4 text-sm",children:[j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),j.jsx("span",{children:e.event_date?O(new Date(e.event_date),"PPP"):"Date TBD"})]}),j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(L,{className:"h-4 w-4 text-muted-foreground"}),j.jsx("span",{className:"truncate",children:e.event_location||"Location TBD"})]})]}),j.jsx("div",{className:"mt-3 flex justify-end",children:j.jsx(_,{variant:"outline",size:"sm",children:"Open Chat"})})]},e.id))})})})]}):null},le=()=>{const{user:e}=m(),{toast:s}=x(),[t,i]=u.useState([]),[a,r]=u.useState({totalEarnings:0,thisMonthEarnings:0,completedBookings:0,averageBookingValue:0}),[n,l]=u.useState(!0);u.useEffect(()=>{e&&d()},[e,d]);const d=u.useCallback(()=>o(void 0,null,function*(){if(e)try{const{data:s,error:t}=yield h.from("artists").select("id").eq("user_id",e.id).single();if(t)return;const{data:a,error:n}=yield h.from("artist_bookings").select("*").eq("artist_id",s.id).eq("status","completed").order("updated_at",{ascending:!1});if(n)throw n;const l=[];let d=0,o=0;const c=(new Date).getMonth(),m=(new Date).getFullYear();for(let e=0;e<5;e++){const s=Math.floor(500*Math.random())+100,t=new Date;t.setDate(t.getDate()-Math.floor(30*Math.random())),d+=s,t.getMonth()===c&&t.getFullYear()===m&&(o+=s),l.push({id:`earning_${e}`,booking_id:`booking_${e}`,amount:s,status:"paid",completed_at:t.toISOString(),client_name:`Client ${e+1}`,event_location:`Event Location ${e+1}`})}i(l),r({totalEarnings:d,thisMonthEarnings:o,completedBookings:l.length,averageBookingValue:d>0?d/l.length:0})}catch(t){s({title:"Error",description:"Failed to load earnings data",variant:"destructive"})}finally{l(!1)}}),[e,s]);return e?n?j.jsxs(p,{children:[j.jsx(f,{children:j.jsx(g,{children:"Earnings Overview"})}),j.jsx(v,{children:j.jsx("div",{className:"flex items-center justify-center py-8",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):j.jsxs("div",{className:"space-y-6",children:[j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[j.jsxs(p,{children:[j.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(g,{className:"text-sm font-medium",children:"Total Earnings"}),j.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(v,{children:[j.jsxs("div",{className:"text-2xl font-bold",children:["$",a.totalEarnings.toLocaleString()]}),j.jsxs("p",{className:"text-xs text-muted-foreground",children:["From ",a.completedBookings," completed bookings"]})]})]}),j.jsxs(p,{children:[j.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(g,{className:"text-sm font-medium",children:"This Month"}),j.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(v,{children:[j.jsxs("div",{className:"text-2xl font-bold",children:["$",a.thisMonthEarnings.toLocaleString()]}),j.jsxs("p",{className:"text-xs text-muted-foreground",children:[j.jsx("span",{className:"text-green-600",children:"+12%"})," from last month"]})]})]}),j.jsxs(p,{children:[j.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(g,{className:"text-sm font-medium",children:"Completed Bookings"}),j.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(v,{children:[j.jsx("div",{className:"text-2xl font-bold",children:a.completedBookings}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"Successful projects delivered"})]})]}),j.jsxs(p,{children:[j.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(g,{className:"text-sm font-medium",children:"Average Booking"}),j.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(v,{children:[j.jsxs("div",{className:"text-2xl font-bold",children:["$",Math.round(a.averageBookingValue).toLocaleString()]}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"Per completed project"})]})]})]}),j.jsxs(p,{children:[j.jsxs(f,{children:[j.jsxs(g,{className:"flex items-center gap-2",children:[j.jsx(z,{className:"h-5 w-5"}),"Recent Earnings"]}),j.jsx(N,{children:"Your latest completed bookings and payments"})]}),j.jsx(v,{children:0===t.length?j.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[j.jsx(z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),j.jsx("p",{children:"No earnings yet"}),j.jsx("p",{className:"text-sm",children:"Complete bookings to start earning and tracking your income"})]}):j.jsx(D,{className:"h-96",children:j.jsx("div",{className:"space-y-4",children:t.map(e=>j.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:j.jsx(z,{className:"h-5 w-5 text-green-600"})}),j.jsxs("div",{children:[j.jsx("h4",{className:"font-medium",children:e.client_name}),j.jsx("p",{className:"text-sm text-muted-foreground",children:e.event_location}),j.jsxs("p",{className:"text-xs text-muted-foreground",children:[j.jsx(M,{className:"h-3 w-3 inline mr-1"}),O(new Date(e.completed_at),"PPP")]})]})]}),j.jsxs("div",{className:"text-right",children:[j.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["+$",e.amount]}),j.jsx(q,{variant:"paid"===e.status?"default":"secondary",className:"text-xs",children:e.status})]})]},e.id))})})})]})]}):null},de=()=>{const{user:e}=m(),{toast:s}=x(),[t,i]=u.useState([]),[a,r]=u.useState([]),[n,c]=u.useState(!0),[N,y]=u.useState("pending"),b=u.useCallback(()=>o(void 0,null,function*(){if(e)try{const{data:s,error:t}=yield h.from("artists").select("id").eq("user_id",e.id).single();if(t)return i([]),void r([]);const{data:a,error:n}=yield h.from("artist_discussions").select("*").eq("artist_id",s.id).eq("status","pending").order("created_at",{ascending:!1});if(n)throw n;const{data:o,error:c}=yield h.from("artist_discussions").select("*").eq("artist_id",s.id).eq("status","approved").order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1});if(c)throw c;const m=[...(null==a?void 0:a.map(e=>e.user_id))||[],...(null==o?void 0:o.map(e=>e.user_id))||[]];let x={};if(m.length>0){const{data:e}=yield h.from("profiles").select("user_id, display_name, avatar_url").in("user_id",m);x=Object.fromEntries((e||[]).map(e=>[e.user_id,e]))}i((a||[]).map(e=>{var s,t;return d(l({},e),{user_display_name:(null==(s=x[e.user_id])?void 0:s.display_name)||"Anonymous",user_avatar_url:(null==(t=x[e.user_id])?void 0:t.avatar_url)||""})})),r((o||[]).map(e=>{var s,t;return d(l({},e),{user_display_name:(null==(s=x[e.user_id])?void 0:s.display_name)||"Anonymous",user_avatar_url:(null==(t=x[e.user_id])?void 0:t.avatar_url)||""})}))}catch(t){s({title:"Error",description:"Failed to load moderation data",variant:"destructive"})}finally{c(!1)}}),[e,s]);u.useEffect(()=>{e&&b()},[e,b]);return n?j.jsx("div",{className:"flex items-center justify-center py-8",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):j.jsxs("div",{className:"space-y-6",children:[j.jsxs("div",{className:"flex space-x-1 bg-muted p-1 rounded-lg",children:[j.jsxs("button",{onClick:()=>y("pending"),className:"flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors "+("pending"===N?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:["Pending Requests",t.length>0&&j.jsx(q,{variant:"destructive",className:"ml-2 h-5 w-5 rounded-full p-0 text-xs",children:t.length})]}),j.jsxs("button",{onClick:()=>y("approved"),className:"flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors "+("approved"===N?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:["Approved Discussions (",a.length,")"]})]}),"pending"===N&&j.jsx("div",{className:"space-y-4",children:t.length>0?t.map(t=>j.jsxs(p,{children:[j.jsx(f,{children:j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs(V,{className:"h-10 w-10",children:[j.jsx(I,{src:t.user_avatar_url}),j.jsx(Y,{children:t.user_display_name.charAt(0)})]}),j.jsxs("div",{children:[j.jsx(g,{className:"text-lg",children:t.title}),j.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",t.user_display_name," • ",new Date(t.created_at).toLocaleDateString()]})]})]}),j.jsx(q,{variant:"outline",children:"Pending"})]})}),j.jsxs(v,{children:[j.jsx("p",{className:"text-muted-foreground mb-4",children:t.content}),j.jsxs("div",{className:"flex gap-2",children:[j.jsxs(_,{size:"sm",onClick:()=>(t=>o(void 0,null,function*(){try{const{data:i,error:a}=yield h.from("artists").select("id").eq("user_id",null==e?void 0:e.id).single();if(a)throw new Error("Artist profile not found");const{error:r}=yield h.from("artist_discussions").update({status:"approved"}).eq("id",t);if(r)throw r;const{error:n}=yield h.from("artist_discussion_moderation_notifications").insert({artist_id:i.id,discussion_id:t,type:"discussion_approved"});s({title:"Discussion approved",description:"The discussion is now visible to your followers"}),b()}catch(i){s({title:"Error",description:"Failed to approve discussion",variant:"destructive"})}}))(t.id),children:[j.jsx(W,{className:"h-4 w-4 mr-2"}),"Approve"]}),j.jsxs(_,{size:"sm",variant:"outline",onClick:()=>(t=>o(void 0,null,function*(){try{const{data:i,error:a}=yield h.from("artists").select("id").eq("user_id",null==e?void 0:e.id).single();if(a)throw new Error("Artist profile not found");const{error:r}=yield h.from("artist_discussions").update({status:"rejected"}).eq("id",t);if(r)throw r;const{error:n}=yield h.from("artist_discussion_moderation_notifications").insert({artist_id:i.id,discussion_id:t,type:"discussion_rejected"});s({title:"Discussion rejected",description:"The discussion request has been rejected"}),b()}catch(i){s({title:"Error",description:"Failed to reject discussion",variant:"destructive"})}}))(t.id),children:[j.jsx(G,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})]},t.id)):j.jsx(p,{children:j.jsx(v,{className:"text-center py-8",children:j.jsx("p",{className:"text-muted-foreground",children:"No pending discussion requests"})})})}),"approved"===N&&j.jsx("div",{className:"space-y-4",children:a.length>0?a.map(e=>j.jsxs(p,{children:[j.jsx(f,{children:j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs(V,{className:"h-10 w-10",children:[j.jsx(I,{src:e.user_avatar_url}),j.jsx(Y,{children:e.user_display_name.charAt(0)})]}),j.jsxs("div",{children:[j.jsx(g,{className:"text-lg",children:e.title}),j.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",e.user_display_name," • ",new Date(e.created_at).toLocaleDateString()]})]})]}),j.jsxs("div",{className:"flex items-center gap-2",children:[e.is_pinned&&j.jsx(q,{variant:"secondary",children:"Pinned"}),j.jsx(q,{variant:"outline",className:"text-green-600 border-green-600",children:"Approved"})]})]})}),j.jsxs(v,{children:[j.jsx("p",{className:"text-muted-foreground mb-4",children:e.content}),j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[j.jsxs("div",{className:"flex items-center gap-1",children:[j.jsx(H,{className:"h-4 w-4"}),j.jsxs("span",{children:[e.likes_count," likes"]})]}),j.jsxs("div",{className:"flex items-center gap-1",children:[j.jsx(H,{className:"h-4 w-4"}),j.jsxs("span",{children:[e.replies_count," replies"]})]})]}),j.jsx(_,{size:"sm",variant:"outline",onClick:()=>((e,t)=>o(void 0,null,function*(){try{const{error:i}=yield h.from("artist_discussions").update({is_pinned:!t}).eq("id",e);if(i)throw i;s({title:t?"Discussion unpinned":"Discussion pinned",description:t?"The discussion is no longer pinned":"The discussion is now pinned to the top"}),b()}catch(i){s({title:"Error",description:"Failed to update pin status",variant:"destructive"})}}))(e.id,e.is_pinned),children:e.is_pinned?j.jsxs(j.Fragment,{children:[j.jsx(ae,{className:"h-4 w-4 mr-2"}),"Unpin"]}):j.jsxs(j.Fragment,{children:[j.jsx(J,{className:"h-4 w-4 mr-2"}),"Pin"]})})]})]})]},e.id)):j.jsx(p,{children:j.jsx(v,{className:"text-center py-8",children:j.jsx("p",{className:"text-muted-foreground",children:"No approved discussions yet"})})})})]})},oe=()=>{var e,s,t;const{user:i}=m(),a=b(),[r,n]=u.useState({totalBookings:0,pendingRequests:0,totalEarnings:0,averageRating:0}),[l,d]=u.useState(null),[c,x]=u.useState(!0),[N,y]=u.useState("bookings");u.useEffect(()=>{i&&C()},[i,C]);const C=u.useCallback(()=>o(void 0,null,function*(){var e,s,t;if(i)try{const{data:a,error:r}=yield h.from("profiles").select("*").eq("user_id",i.id).single();if(r)throw r;d(a);const{data:l,error:o}=yield h.from("artists").select("id").eq("user_id",i.id).single();if(o)return void n({totalBookings:0,pendingRequests:0,totalEarnings:0,averageRating:0});const[c,m,x]=yield Promise.all([h.from("artist_bookings").select("id, budget_min, budget_max, status").eq("artist_id",l.id).in("status",["accepted","completed"]),h.from("artist_bookings").select("id").eq("artist_id",l.id).eq("status","pending"),h.from("chat_conversations").select("id").eq("artist_id",i.id).eq("status","active")]),u=(null==(e=c.data)?void 0:e.length)||0,j=(null==(s=m.data)?void 0:s.length)||0,p=((null==(t=c.data)?void 0:t.filter(e=>"completed"===e.status))||[]).reduce((e,s)=>e+(s.budget_max||s.budget_min||0),0),f=u>0?4.2+.8*Math.random():0;n({totalBookings:u,pendingRequests:j,totalEarnings:p,averageRating:f})}catch(a){}finally{x(!1)}}),[i]);return i?c?j.jsx(k,{children:j.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):j.jsx(k,{children:j.jsxs("div",{className:"space-y-8",children:[j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx("h1",{className:"text-3xl font-bold",children:"Artist Dashboard"}),j.jsx("p",{className:"text-muted-foreground",children:"Manage your bookings, track earnings, and grow your business"})]}),j.jsx("div",{className:"flex items-center gap-4",children:j.jsxs(_,{variant:"outline",onClick:()=>a("/settings"),children:[j.jsx(w,{className:"h-4 w-4 mr-2"}),"Settings"]})})]}),j.jsx(p,{children:j.jsx(f,{children:j.jsxs("div",{className:"flex items-center gap-4",children:[j.jsxs(V,{className:"h-16 w-16",children:[j.jsx(I,{src:null==l?void 0:l.avatar_url}),j.jsx(Y,{children:(null==(e=null==l?void 0:l.display_name)?void 0:e.charAt(0))||(null==(s=i.email)?void 0:s.charAt(0).toUpperCase())})]}),j.jsxs("div",{className:"flex-1",children:[j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx("h2",{className:"text-2xl font-semibold",children:null==l?void 0:l.display_name}),(null==l?void 0:l.is_verified)&&j.jsx(q,{variant:"secondary",children:"Verified"})]}),j.jsx("p",{className:"text-muted-foreground",children:null==l?void 0:l.bio}),j.jsx("div",{className:"flex items-center gap-4 mt-2",children:(null==(t=null==l?void 0:l.artist_skills)?void 0:t.length)>0&&j.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.artist_skills.slice(0,3).map(e=>j.jsx(q,{variant:"outline",className:"text-xs",children:e},e)),l.artist_skills.length>3&&j.jsxs(q,{variant:"outline",className:"text-xs",children:["+",l.artist_skills.length-3," more"]})]})})]})]})})}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[j.jsxs(p,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>y("bookings"),children:[j.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(g,{className:"text-sm font-medium",children:"Total Bookings"}),j.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(v,{children:[j.jsx("div",{className:"text-2xl font-bold",children:r.totalBookings}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"Click to view all bookings"})]})]}),j.jsxs(p,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>y("bookings"),children:[j.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(g,{className:"text-sm font-medium",children:"Pending Requests"}),j.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(v,{children:[j.jsx("div",{className:"text-2xl font-bold",children:r.pendingRequests}),j.jsx("p",{className:"text-xs text-muted-foreground",children:r.pendingRequests>0?"Awaiting your response":"No pending requests"})]})]}),j.jsxs(p,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>y("earnings"),children:[j.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(g,{className:"text-sm font-medium",children:"Total Earnings"}),j.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(v,{children:[j.jsxs("div",{className:"text-2xl font-bold",children:["$",r.totalEarnings.toLocaleString()]}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"Click for earnings details"})]})]}),j.jsxs(p,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>y("chats"),children:[j.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(g,{className:"text-sm font-medium",children:"Average Rating"}),j.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(v,{children:[j.jsx("div",{className:"text-2xl font-bold",children:r.averageRating>0?r.averageRating.toFixed(1):"N/A"}),j.jsx("p",{className:"text-xs text-muted-foreground",children:r.totalBookings>0?`From ${r.totalBookings} bookings`:"Complete bookings to get rated"})]})]})]}),j.jsxs(Z,{value:N,onValueChange:y,className:"space-y-6",children:[j.jsxs(ee,{children:[j.jsxs(se,{value:"bookings",children:["Booking Requests",r.pendingRequests>0&&j.jsx(q,{variant:"destructive",className:"ml-2 h-5 w-5 rounded-full p-0 text-xs",children:r.pendingRequests})]}),j.jsx(se,{value:"chats",children:"Active Chats"}),j.jsx(se,{value:"earnings",children:"Earnings"}),j.jsx(se,{value:"moderation",children:"Discussion Moderation"})]}),j.jsx(te,{value:"bookings",children:j.jsx(re,{})}),j.jsx(te,{value:"chats",children:j.jsx(ne,{})}),j.jsx(te,{value:"earnings",children:j.jsx(le,{})}),j.jsx(te,{value:"moderation",children:j.jsx(de,{})})]})]})}):(a("/signin"),null)};export{oe as default};
