var e=Object.defineProperty,r=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(r,t,s)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,o=(e,r)=>{for(var t in r||(r={}))n.call(r,t)&&a(e,t,r[t]);if(s)for(var t of s(r))i.call(r,t)&&a(e,t,r[t]);return e},c=(e,s)=>r(e,t(s)),l=(e,r,t)=>a(e,"symbol"!=typeof r?r+"":r,t),d=(e,r,t)=>new Promise((s,n)=>{var i=e=>{try{o(t.next(e))}catch(r){n(r)}},a=e=>{try{o(t.throw(e))}catch(r){n(r)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,a);o((t=t.apply(e,r)).next())});import{z as u,D as h,F as m,u as x,r as y,j as g,T as f,G as p,I as v,J as j,B as w,k as b,i as E,C,v as N,w as k,x as S,y as T,K as O,M as R,N as P,O as A}from"./main-6fHUpRzT.js";import{S as I}from"./separator-55ip2E4B.js";import{B as D}from"./badge-Bj-CyBpD.js";import{W as U,a as F}from"./wifi-D7M5OVnX.js";import{C as B}from"./check-circle-Bfeu-Ke9.js";const H=class e{constructor(){l(this,"errorCount",0),l(this,"lastErrorTime",0),l(this,"maxErrorsPerMinute",10),l(this,"errorCooldownMs",6e4)}static getInstance(){return e.instance||(e.instance=new e),e.instance}handleError(e){return d(this,arguments,function*(e,r={}){const{showToast:t=!0,logToConsole:s=!0,attemptRecovery:n=!0,fallbackValue:i,context:a="Unknown"}=r;if(this.shouldThrottleErrors())return{recovered:!1,fallbackValue:i};const o=this.createErrorInfo(e,a);this.errorCount++,this.lastErrorTime=Date.now(),s&&this.logError(o);let c=!1;return n&&(c=yield this.attemptErrorRecovery(o)),t&&this.showUserFeedback(o,c),this.trackError(o),{recovered:c,fallbackValue:i}})}handleAuthError(e,r="Authentication"){return d(this,null,function*(){const t=this.createErrorInfo(e,r),s=m();if(this.isConnectionError(t)&&"failed"===s)try{if(yield u())return h({title:"Connection Restored",description:"Your connection has been restored. Please try again."}),{recovered:!0,shouldRetry:!0}}catch(i){}const n=this.shouldRetryAuthOperation(t);return h(n?{title:"Authentication Issue",description:"Please try again in a moment.",variant:"destructive"}:{title:"Authentication Failed",description:"Please check your credentials and try again.",variant:"destructive"}),{recovered:!1,shouldRetry:n}})}handleApiError(e,r="API"){return d(this,null,function*(){const t=this.createErrorInfo(e,r),{shouldRetry:s,retryDelay:n}=this.analyzeApiError(t);return h(s?{title:"Service Temporarily Unavailable",description:`Retrying in ${Math.ceil((n||0)/1e3)} seconds...`,variant:"destructive"}:{title:"Service Error",description:"Please try again later or contact support if the problem persists.",variant:"destructive"}),{recovered:!1,shouldRetry:s,retryDelay:n}})}createErrorInfo(e,r){return{message:e instanceof Error?e.message:String(e),code:this.extractErrorCode(e),status:this.extractErrorStatus(e),context:r,timestamp:new Date,userAgent:navigator.userAgent,url:window.location.href,stack:e instanceof Error?e.stack:void 0}}extractErrorCode(e){if(e&&"object"==typeof e){if("code"in e)return String(e.code);if("status"in e)return`HTTP_${e.status}`;if("errorCode"in e)return String(e.errorCode)}}extractErrorStatus(e){if(e&&"object"==typeof e){if("status"in e&&"number"==typeof e.status)return e.status;if("statusCode"in e&&"number"==typeof e.statusCode)return e.statusCode}}isConnectionError(e){return["network","connection","timeout","fetch","supabase","auth","500","502","503","504"].some(r=>{var t,s;return e.message.toLowerCase().includes(r)||(null==(t=e.code)?void 0:t.toLowerCase().includes(r))||(null==(s=e.status)?void 0:s.toString().includes(r))})}shouldRetryAuthOperation(e){return["network","timeout","connection","500","502","503","504"].some(r=>{var t,s;return e.message.toLowerCase().includes(r)||(null==(t=e.code)?void 0:t.toLowerCase().includes(r))||(null==(s=e.status)?void 0:s.toString().includes(r))})}analyzeApiError(e){const r=e.status;return r&&r>=500&&r<600?{shouldRetry:!0,retryDelay:5e3}:429===r?{shouldRetry:!0,retryDelay:1e4}:this.isConnectionError(e)?{shouldRetry:!0,retryDelay:3e3}:{shouldRetry:!1,retryDelay:0}}attemptErrorRecovery(e){return d(this,null,function*(){if(this.isConnectionError(e))try{if(yield u())return!0}catch(r){}return!1})}showUserFeedback(e,r){if(r)h({title:"Issue Resolved",description:"The problem has been automatically resolved. Please try again."});else switch(e.context){case"Authentication":h({title:"Authentication Error",description:"Please check your credentials and try again.",variant:"destructive"});break;case"API":h({title:"Service Error",description:"We're experiencing technical difficulties. Please try again later.",variant:"destructive"});break;case"Network":h({title:"Network Error",description:"Please check your internet connection and try again.",variant:"destructive"});break;default:h({title:"Something went wrong",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}}logError(e){c(o({},e),{timestamp:e.timestamp.toISOString()});e.status&&e.status>=500||e.status&&e.status}trackError(e){}shouldThrottleErrors(){return Date.now()-this.lastErrorTime>this.errorCooldownMs?(this.errorCount=0,!1):this.errorCount>this.maxErrorsPerMinute}resetErrorCount(){this.errorCount=0,this.lastErrorTime=0}getErrorStats(){return{count:this.errorCount,lastErrorTime:this.lastErrorTime}}};l(H,"instance");const M=H.getInstance(),z=()=>{const{connectionStatus:e,isOnline:r}=x(),[t,s]=y.useState(!1),n=(()=>{switch(e){case"connected":return{icon:g.jsx(B,{className:"w-4 h-4"}),label:"Connected",variant:"default",color:"text-green-600",bgColor:"bg-green-100",description:"All services are working properly"};case"connecting":return{icon:g.jsx(b,{className:"w-4 h-4 animate-spin"}),label:"Connecting",variant:"secondary",color:"text-blue-600",bgColor:"bg-blue-100",description:"Establishing connection..."};case"failed":return{icon:g.jsx(E,{className:"w-4 h-4"}),label:"Connection Failed",variant:"destructive",color:"text-red-600",bgColor:"bg-red-100",description:"Unable to connect to services"};case"offline":return{icon:g.jsx(F,{className:"w-4 h-4"}),label:"Offline",variant:"outline",color:"text-gray-600",bgColor:"bg-gray-100",description:"Network connection unavailable"};default:return{icon:g.jsx(E,{className:"w-4 h-4"}),label:"Unknown",variant:"outline",color:"text-gray-600",bgColor:"bg-gray-100",description:"Connection status unknown"}}})();return g.jsx(f,{children:g.jsxs(p,{children:[g.jsx(v,{asChild:!0,children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs(D,{variant:n.variant,className:`${n.bgColor} ${n.color} border-0`,children:[n.icon,g.jsx("span",{className:"ml-1 hidden sm:inline",children:n.label})]}),g.jsx("div",{className:"flex items-center gap-1",children:r?g.jsx(U,{className:"w-3 h-3 text-green-600"}):g.jsx(F,{className:"w-3 h-3 text-red-600"})})]})}),g.jsx(j,{side:"bottom",className:"max-w-xs",children:g.jsxs("div",{className:"space-y-2",children:[g.jsx("div",{className:"font-medium",children:"Connection Status"}),g.jsx("div",{className:"text-sm text-gray-600",children:n.description}),g.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[g.jsxs("div",{children:["Network: ",r?"Online":"Offline"]}),g.jsxs("div",{children:["Service: ",e]})]}),"failed"===e&&r&&g.jsx(w,{size:"sm",onClick:()=>d(void 0,null,function*(){s(!0);try{yield u()}catch(e){}finally{s(!1)}}),disabled:t,className:"w-full mt-2",children:t?g.jsxs(g.Fragment,{children:[g.jsx(b,{className:"w-3 h-3 mr-1 animate-spin"}),"Reconnecting..."]}):g.jsxs(g.Fragment,{children:[g.jsx(b,{className:"w-3 h-3 mr-1"}),"Reconnect"]})})]})})]})})},L=()=>{const{user:e,connectionStatus:r,isOnline:t}=x(),[s,n]=y.useState({}),[i,a]=y.useState(!1);return g.jsx("div",{className:"container mx-auto p-6 max-w-4xl",children:g.jsxs(C,{children:[g.jsxs(N,{children:[g.jsx(k,{className:"flex items-center gap-2",children:"ðŸ§ª Test Router & Error Handling"}),g.jsx(S,{children:"Test various error handling scenarios and connection status"})]}),g.jsxs(T,{className:"space-y-6",children:[g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[g.jsxs(C,{children:[g.jsx(N,{className:"pb-3",children:g.jsx(k,{className:"text-lg",children:"Connection Status"})}),g.jsxs(T,{children:[g.jsx(z,{}),g.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[g.jsxs("div",{children:["User: ",e?e.email:"Not signed in"]}),g.jsxs("div",{children:["Network: ",t?"Online":"Offline"]}),g.jsxs("div",{children:["Status: ",r]})]})]})]}),g.jsxs(C,{children:[g.jsx(N,{className:"pb-3",children:g.jsx(k,{className:"text-lg",children:"Quick Actions"})}),g.jsxs(T,{className:"space-y-2",children:[g.jsx(w,{onClick:()=>d(void 0,null,function*(){a(!0);try{const e=yield O(),r=yield R(),t=P();n({supabaseStatus:e,connectionTest:r,networkStatus:t,connectionStatus:m(),retryCount:A(),timestamp:(new Date).toISOString()})}catch(e){n({error:e instanceof Error?e.message:"Unknown error"})}finally{a(!1)}}),disabled:i,className:"w-full",variant:"outline",children:i?"Testing...":"Test Connection"}),g.jsx(w,{onClick:()=>d(void 0,null,function*(){a(!0);try{const e=yield u();n(r=>c(o({},r),{forceReconnection:e,timestamp:(new Date).toISOString()}))}catch(e){n(r=>c(o({},r),{forceReconnectionError:e instanceof Error?e.message:"Unknown error"}))}finally{a(!1)}}),disabled:i,className:"w-full",variant:"outline",children:i?"Reconnecting...":"Force Reconnect"}),g.jsx(w,{onClick:()=>d(void 0,null,function*(){a(!0);try{const e=yield((e,r)=>M.handleError(e,r))(new Error("Test general error"),{context:"Test",showToast:!1}),r=yield((e,r)=>M.handleAuthError(e,r))(new Error("Test auth error")),t=yield((e,r)=>M.handleApiError(e,r))(new Error("Test API error"));n(s=>c(o({},s),{errorHandling:{general:e,auth:r,api:t},timestamp:(new Date).toISOString()}))}catch(e){n(r=>c(o({},r),{errorHandlingError:e instanceof Error?e.message:"Unknown error"}))}finally{a(!1)}}),disabled:i,className:"w-full",variant:"outline",children:i?"Testing...":"Test Error Handling"})]})]})]}),g.jsx(I,{}),Object.keys(s).length>0&&g.jsxs(C,{children:[g.jsxs(N,{children:[g.jsx(k,{className:"text-lg",children:"Test Results"}),g.jsx(S,{children:"Results from the latest tests"})]}),g.jsx(T,{children:g.jsx("pre",{className:"bg-gray-100 p-4 rounded-lg overflow-auto text-xs",children:JSON.stringify(s,null,2)})})]}),g.jsx(I,{}),g.jsxs(C,{children:[g.jsxs(N,{children:[g.jsx(k,{className:"text-lg",children:"Error Boundary Test"}),g.jsx(S,{children:"Test the ErrorBoundary component by simulating an error"})]}),g.jsxs(T,{children:[g.jsx(w,{onClick:()=>{throw new Error("This is a simulated error to test the ErrorBoundary")},variant:"destructive",className:"w-full",children:"ðŸš¨ Simulate Error (Test ErrorBoundary)"}),g.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"This will trigger the ErrorBoundary to catch and display the error"})]})]}),g.jsxs(C,{children:[g.jsx(N,{children:g.jsx(k,{className:"text-lg",children:"Navigation"})}),g.jsxs(T,{className:"flex flex-wrap gap-2",children:[g.jsx(w,{variant:"outline",onClick:()=>window.location.href="/",children:"Go Home"}),g.jsx(w,{variant:"outline",onClick:()=>window.location.href="/config-status",children:"Config Status"}),g.jsx(w,{variant:"outline",onClick:()=>window.location.href="/community",children:"Community"}),g.jsx(w,{variant:"outline",onClick:()=>window.location.href="/feed",children:"Feed"})]})]})]})]})})};export{L as TestRouter,L as default};
