var X=Object.defineProperty,F=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var E=(s,r,n)=>r in s?X(s,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[r]=n,I=(s,r)=>{for(var n in r||(r={}))J.call(r,n)&&E(s,n,r[n]);if(D)for(var n of D(r))W.call(r,n)&&E(s,n,r[n]);return s},A=(s,r)=>F(s,H(r));var c=(s,r,n)=>new Promise((f,p)=>{var l=d=>{try{u(n.next(d))}catch(j){p(j)}},v=d=>{try{u(n.throw(d))}catch(j){p(j)}},u=d=>d.done?f(d.value):Promise.resolve(d.value).then(l,v);u((n=n.apply(s,r)).next())});import{u as z,r as h,s as x,j as e,C as N,p as _,q as b,t as U,v as S,B as L}from"./main-Dczk40-q.js";import{B as T}from"./badge-iBsRNaSn.js";import{n as G}from"./notificationService-DiBkqnn5.js";import{C as y}from"./calendar-DbYgxsnG.js";import{C as B}from"./clock-D-HXAPEh.js";import{U as q}from"./user-xzPyfs-H.js";import{X as K}from"./x-circle-DtL0wFqx.js";import{C as M}from"./check-circle-CJSaU0rJ.js";const ae=()=>{const{user:s}=z(),[r,n]=h.useState([]),[f,p]=h.useState(!1),[l,v]=h.useState(null),[u,d]=h.useState([]),j=[{test:"User Authentication",status:"pending"},{test:"Artist Profile Check",status:"pending"},{test:"Database Connection",status:"pending"},{test:"RLS Policy Test",status:"pending"},{test:"Booking Request Creation",status:"pending"},{test:"Notification Creation",status:"pending"},{test:"Real-time Subscription",status:"pending"}],k=(t,a,i,o)=>{n(w=>w.map(g=>g.test===t?A(I({},g),{status:a,message:i,data:o}):g))},m=(t,a)=>c(void 0,null,function*(){k(t,"running");try{const i=yield a();return k(t,"passed",`Success: ${JSON.stringify(i)}`,i),i}catch(i){throw k(t,"failed",`Error: ${i instanceof Error?i.message:"Unknown error"}`),i}}),P=()=>c(void 0,null,function*(){if(!(s!=null&&s.id)){alert("Please log in to run tests");return}p(!0),n(j);try{yield m("User Authentication",()=>c(void 0,null,function*(){if(!(s!=null&&s.id))throw new Error("User not authenticated");return{userId:s.id,email:s.email}}));const t=yield m("Artist Profile Check",()=>c(void 0,null,function*(){const{data:i,error:o}=yield x.from("artists").select("id, user_id").eq("user_id",s.id).single();if(o)throw o;if(!i)throw new Error("No artist profile found for current user");return i}));v(t),yield m("Database Connection",()=>c(void 0,null,function*(){const{data:i,error:o}=yield x.from("artist_bookings").select("count").limit(1);if(o)throw o;return{connected:!0}})),yield m("RLS Policy Test",()=>c(void 0,null,function*(){const{data:i,error:o}=yield x.from("artist_bookings").select("*").eq("artist_id",t.id).limit(5);if(o)throw o;return{accessibleBookings:(i==null?void 0:i.length)||0}}));const a=yield m("Booking Request Creation",()=>c(void 0,null,function*(){const{data:i,error:o}=yield x.from("artist_bookings").insert({user_id:s.id,artist_id:t.id,event_date:new Date(Date.now()+6048e5).toISOString(),event_location:"Test Location",event_description:"Test booking request for system verification",budget_min:100,budget_max:200,contact_info:"Test contact info",status:"pending"}).select().single();if(o)throw o;return i}));yield m("Notification Creation",()=>c(void 0,null,function*(){const i=yield G.createBookingRequestNotification(s.id,s.id,{id:a.id,event_type:"Test Event",event_date:a.event_date,event_location:a.event_location,budget_min:a.budget_min,budget_max:a.budget_max});if(!i)throw new Error("Failed to create notification");return{notificationId:i}})),yield m("Real-time Subscription",()=>c(void 0,null,function*(){return new Promise((i,o)=>{const w=setTimeout(()=>{o(new Error("Real-time subscription timeout"))},1e4),g=x.channel("booking_test").on("postgres_changes",{event:"INSERT",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${t.id}`},R=>{clearTimeout(w),g.unsubscribe(),i({realtimeWorking:!0,payload:R})}).subscribe();setTimeout(()=>c(void 0,null,function*(){try{yield x.from("artist_bookings").insert({user_id:s.id,artist_id:t.id,event_date:new Date(Date.now()+14*24*60*60*1e3).toISOString(),event_location:"Real-time Test Location",event_description:"Real-time test booking",budget_min:150,budget_max:250,contact_info:"Real-time test contact",status:"pending"})}catch(R){clearTimeout(w),g.unsubscribe(),o(R)}}),1e3)})}))}catch(t){console.error("Test suite failed:",t)}finally{p(!1)}}),C=h.useCallback(()=>c(void 0,null,function*(){if(l)try{const{data:t,error:a}=yield x.from("artist_bookings").select(`
          *,
          profiles!artist_bookings_user_id_fkey(display_name, avatar_url)
        `).eq("artist_id",l.id).eq("status","pending").order("created_at",{ascending:!1});if(a)throw a;d(t||[])}catch(t){console.error("Error fetching booking requests:",t)}}),[l]);h.useEffect(()=>{l&&C()},[l,C]);const $=t=>{switch(t){case"passed":return e.jsx(M,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(K,{className:"h-4 w-4 text-red-500"});case"running":return e.jsx(B,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return e.jsx(B,{className:"h-4 w-4 text-gray-400"})}},O=t=>{switch(t){case"passed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"running":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsxs(_,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Booking System Test Suite"]}),e.jsx(U,{children:"Comprehensive testing of the artist booking system"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(L,{onClick:P,disabled:f,className:"flex items-center gap-2",children:[f?e.jsx(B,{className:"h-4 w-4 animate-spin"}):e.jsx(y,{className:"h-4 w-4"}),f?"Running Tests...":"Run All Tests"]}),e.jsxs(L,{onClick:C,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Refresh Bookings"]})]}),l&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/50",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Artist Information"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Artist ID: ",l.id]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["User ID: ",l.user_id]})]})]})]}),e.jsxs(N,{children:[e.jsx(_,{children:e.jsx(b,{children:"Test Results"})}),e.jsx(S,{children:e.jsx("div",{className:"space-y-2",children:r.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[$(t.status),e.jsx("span",{className:"font-medium",children:t.test})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(T,{className:O(t.status),children:t.status})})]},a))})})]}),e.jsxs(N,{children:[e.jsx(_,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Current Booking Requests",u.length>0&&e.jsx(T,{variant:"secondary",children:u.length})]})}),e.jsx(S,{children:u.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(y,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No pending booking requests"}),e.jsx("p",{className:"text-sm",children:"Booking requests will appear here"})]}):e.jsx("div",{className:"space-y-4",children:u.map(t=>{var a;return e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(q,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:((a=t.profiles)==null?void 0:a.display_name)||"Unknown User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(t.created_at).toLocaleString()})]})]}),e.jsx(T,{variant:"outline",children:t.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:new Date(t.event_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Budget:"}),e.jsxs("span",{children:["$",t.budget_min," - $",t.budget_max]})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:"Event Description:"}),e.jsx("p",{className:"text-muted-foreground",children:t.event_description})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:"Location:"}),e.jsx("p",{className:"text-muted-foreground",children:t.event_location})]})]},t.id)})})})]})]}):e.jsx(N,{children:e.jsxs(_,{children:[e.jsx(b,{children:"Booking System Test"}),e.jsx(U,{children:"Please log in to run booking system tests"})]})})};export{ae as BookingSystemTest};
