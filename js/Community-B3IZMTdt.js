var F=(t,C,j)=>new Promise((g,f)=>{var c=i=>{try{x(j.next(i))}catch(o){f(o)}},d=i=>{try{x(j.throw(i))}catch(o){f(o)}},x=i=>i.done?g(i.value):Promise.resolve(i.value).then(c,d);x((j=j.apply(t,C)).next())});import{r as p,j as e,C as w,v as y,B as n,p as Z,q as K,t as W,f as X,u as ee,g as se,L as U}from"./main-jfCIwKxb.js";import{d as M,A as ae,b as te,c as re,S as R,R as V}from"./ResponsiveLayout-Dd-U-XTf.js";import{I as ie}from"./index-DGobKVbi.js";import{B as k}from"./badge-Cxniq3nT.js";import{S as $,a as B,b as I,c as z,d as _}from"./select-BK9ujtwJ.js";import{u as le,T as Q,a as ne,M as H}from"./usePoints-Dnu7EIBD.js";import{T as oe}from"./trending-up-XhhBv7nP.js";import{Z as ce}from"./zap-C2TAeX5H.js";import{U as m}from"./alert-f_BC70aV.js";import"./label-BhjyL16S.js";import"./textarea-Dm2RgXBl.js";import"./tabs-Bho2AISw.js";import{u as de}from"./useCommunityGroups-DNpPScZi.js";import{u as me}from"./useLocation-Dro6x-la.js";import{C as xe}from"./communityService-C-z7L7tP.js";import{L as P}from"./loader-2-iBg9Stez.js";import{P as q}from"./plus-Bi3vU8QF.js";import{M as D}from"./more-horizontal-70T_MGi1.js";import{M as G}from"./message-circle-BzbuDOEE.js";import{S as O}from"./search-DIpOLffQ.js";import{G as he,L as ue}from"./list-CP6mcm0D.js";import{M as pe}from"./map-pin-B5hnRU36.js";import{C as je}from"./calendar-CXbnSY_4.js";import"./separator-CQeeh5sy.js";import"./index-D6sgUugm.js";import"./index-CaL9moq2.js";import"./databaseUtils-Cc-GydU0.js";import"./scroll-area-Bsyy6uVd.js";import"./index-DCmZQWeX.js";import"./check-CWeqS_MX.js";import"./useNotifications-DlynYvan.js";import"./notificationService-DPR46Nx3.js";import"./bell-CXNc_0l5.js";import"./user-cZSM4iEh.js";import"./message-square-oWFCH1Pi.js";import"./wifi-Ue5kLFZw.js";import"./log-out-CxjypOOW.js";import"./index-BqrjOP3n.js";import"./chevron-up-DhaGujCg.js";import"./pointsService-BEnKQBdP.js";import"./locationService-D_4XBFWa.js";const ge=[{value:"5",label:"Top 5"},{value:"20",label:"Top 20"},{value:"50",label:"Top 50"},{value:"100",label:"Top 100"},{value:"1000",label:"Top 1000"}],fe=t=>{switch(t){case 1:return e.jsx(Q,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(H,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(H,{className:"w-5 h-5 text-amber-600"});default:return e.jsx(R,{className:"w-4 h-4 text-blue-500"})}},Ne=t=>{switch(t){case 1:return"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white";case 2:return"bg-gradient-to-r from-gray-300 to-gray-500 text-white";case 3:return"bg-gradient-to-r from-amber-500 to-amber-700 text-white";default:return"bg-blue-100 text-blue-800"}},J=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),ve=({className:t="",showTitle:C=!0,defaultLimit:j=5,showFilters:g=!0,showUserPosition:f=!0})=>{const{leaderboard:c,leaderboardLoading:d,leaderboardError:x,userPoints:i,refreshLeaderboard:o}=le(),[N,S]=p.useState(j.toString()),[v,T]=p.useState(!1);p.useEffect(()=>{o(parseInt(N))},[N,o]);const E=r=>{S(r)},l=()=>{T(!v)},A=v?c:c.slice(0,5);return x?e.jsx(w,{className:`community-leaderboard ${t}`,children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx(oe,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{children:"Failed to load leaderboard"}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>o(parseInt(N)),className:"mt-2",children:"Try Again"})]})})}):e.jsxs(w,{className:`community-leaderboard ${t}`,children:[e.jsx(Z,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-orange-500 to-red-500 rounded-lg",children:e.jsx(Q,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-lg",children:"Community Leaderboard"}),e.jsx(W,{children:"Top contributors this month"})]})]}),g&&e.jsxs($,{value:N,onValueChange:E,children:[e.jsx(B,{className:"w-32",children:e.jsx(I,{})}),e.jsx(z,{children:ge.map(r=>e.jsx(_,{value:r.value,children:r.label},r.value))})]})]})}),e.jsx(y,{className:"space-y-4",children:d?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((r,h)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border",children:[e.jsx(M,{className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(M,{className:"h-4 w-32"}),e.jsx(M,{className:"h-3 w-20"})]}),e.jsx(M,{className:"w-16 h-6"})]},h))}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:A.map((r,h)=>{var L,b;return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all duration-200 hover:shadow-md ${h<3?"bg-gradient-to-r from-orange-50 to-red-50 border-orange-200":"hover:bg-gray-50"}`,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:fe(r.rank)}),e.jsxs(ae,{className:"w-10 h-10",children:[e.jsx(te,{src:r.avatar_url||"",alt:r.display_name||"User"}),e.jsx(re,{className:"bg-gradient-to-r from-orange-400 to-red-400 text-white font-semibold",children:((b=(L=r.display_name)==null?void 0:L.charAt(0))==null?void 0:b.toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-sm truncate",children:r.display_name||"Anonymous User"}),h<3&&e.jsxs(k,{className:`text-xs ${Ne(r.rank)}`,children:["#",r.rank]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsxs("span",{children:[J(r.total_points)," points"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-lg text-orange-600",children:J(r.total_points)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"points"})]})]},r.user_id)})}),c.length>5&&e.jsx("div",{className:"text-center pt-2",children:e.jsx(n,{variant:"outline",size:"sm",onClick:l,className:"text-orange-600 border-orange-200 hover:bg-orange-50",children:v?"Show Less":`Show More (${c.length-5} more)`})}),f&&i&&e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:e.jsx(ne,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-blue-900",children:"Your Position"}),e.jsxs("p",{className:"text-xs text-blue-700",children:["Rank #",i.rank]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-lg text-blue-600",children:J(i.total_points)}),e.jsx("div",{className:"text-xs text-blue-700",children:"your points"})]})]})}),!d&&c.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(m,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No leaderboard data available"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Start engaging to earn points!"})]})]})})]})},be=["All Categories","Arts & Culture","Technology","Food & Dining","Outdoors","Education","Business","Health & Wellness","Sports","Music","Photography","General"],ds=()=>{const t=X(),{groups:C,loading:j,fetchGroups:g,joinGroup:f}=de();me();const{user:c}=ee(),{toast:d}=se(),[x,i]=p.useState(""),[o,N]=p.useState("All Categories"),[S,v]=p.useState("grid"),[T,E]=p.useState("recent"),[l,A]=p.useState(null);p.useEffect(()=>{F(void 0,null,function*(){try{yield g()}catch(a){console.error("Error loading communities:",a),d({title:"Error",description:"Failed to load communities. Please try again.",variant:"destructive"})}})},[g,d]);const h=[...C.filter(s=>{const a=s.name.toLowerCase().includes(x.toLowerCase())||s.description&&s.description.toLowerCase().includes(x.toLowerCase()),u=o==="All Categories"||s.category===o;return a&&u})].sort((s,a)=>{switch(T){case"members":return(a.member_count||0)-(s.member_count||0);case"recent":return new Date(a.created_at).getTime()-new Date(s.created_at).getTime();case"activity":return(a.post_count||0)-(s.post_count||0);default:return 0}}),L=C.filter(s=>(s.member_count||0)>10),b=s=>F(void 0,null,function*(){if(!c){d({title:"Authentication Required",description:"Please log in to join communities",variant:"destructive"});return}if(l!==s)try{A(s),console.log("Attempting to join group:",s);const a=yield xe.validateGroupForJoining(s,c.id);if(console.log("Validation result:",a),!a.isValid){console.error("Validation failed:",a.errors),d({title:"Cannot Join Community",description:a.errors.join(", "),variant:"destructive"});return}(yield f(s))&&(yield g())}catch(a){console.error("Error joining community:",a);let u="Failed to join community. Please try again.";a!=null&&a.message&&(a.message.includes("Group not found")?u="This community no longer exists.":a.message.includes("Invalid group or user ID")?u="Invalid community or user information.":a.message.includes("Cannot join private group")?u="This is a private community.":a.message.includes("already a member")?u="You are already a member of this community.":u=a.message),d({title:"Error",description:u,variant:"destructive"})}finally{A(null)}}),Y=()=>{g()};return j?e.jsx(V,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading communities..."})]})})}):e.jsx(V,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"Communities"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Discover and join communities that match your interests"})]}),e.jsx(n,{className:"btn-community",asChild:!0,children:e.jsxs(U,{to:"/community/create-group",onClick:Y,children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Create Community"]})})]}),e.jsx("section",{className:"space-y-4",children:e.jsx(ve,{className:"mb-8",showTitle:!0,defaultLimit:5,showFilters:!0,showUserPosition:!0})}),!1,L.length>0&&e.jsxs("section",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-yellow-500"}),"Featured Communities"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:L.map(s=>e.jsxs(w,{className:"community-card-featured group cursor-pointer hover:shadow-community transition-all duration-300",onClick:()=>t(`/community/${s.id}`),children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-blue-500 to-purple-600 rounded-t-lg flex items-center justify-center",children:e.jsx(m,{className:"w-16 h-16 text-white opacity-80"})}),e.jsx("div",{className:"absolute top-3 right-3 flex gap-2",children:e.jsxs(k,{className:"bg-yellow-500 text-white",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),"Featured"]})})]}),e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),e.jsx(n,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:a=>{a.stopPropagation()},children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:s.description||"No description available"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(m,{className:"w-4 h-4"}),s.member_count||0," members"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),s.post_count||0," posts"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(k,{variant:"secondary",className:"text-xs",children:["#",s.category]}),e.jsxs(n,{className:"w-full btn-community",onClick:a=>{a.stopPropagation(),b(s.id)},disabled:l===s.id,children:[l===s.id?e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(m,{className:"w-4 h-4 mr-2"}),l===s.id?"Joining...":"Join Community"]})]})]})]},s.id))})]}),e.jsx("section",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(ie,{placeholder:"Search communities...",value:x,onChange:s=>i(s.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{value:o,onValueChange:N,children:[e.jsx(B,{className:"w-[180px]",children:e.jsx(I,{})}),e.jsx(z,{children:be.map(s=>e.jsx(_,{value:s,children:s},s))})]}),e.jsxs($,{value:T,onValueChange:E,children:[e.jsx(B,{className:"w-[140px]",children:e.jsx(I,{})}),e.jsxs(z,{children:[e.jsx(_,{value:"recent",children:"Most Recent"}),e.jsx(_,{value:"members",children:"Most Members"}),e.jsx(_,{value:"activity",children:"Most Active"})]})]}),e.jsxs("div",{className:"flex border rounded-md",children:[e.jsx(n,{variant:S==="grid"?"default":"ghost",size:"sm",onClick:()=>v("grid"),className:"rounded-r-none",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(n,{variant:S==="list"?"default":"ghost",size:"sm",onClick:()=>v("list"),className:"rounded-l-none",children:e.jsx(ue,{className:"w-4 h-4"})})]})]})]})}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"All Communities"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h.length," communities found"]})]}),S==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(s=>e.jsxs(w,{className:"community-card group cursor-pointer hover:shadow-community transition-all duration-300",onClick:()=>t(`/community/${s.id}`),children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-blue-500 to-purple-600 rounded-t-lg flex items-center justify-center",children:e.jsx(m,{className:"w-16 h-16 text-white opacity-80"})})}),e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),e.jsx(n,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:a=>{a.stopPropagation()},children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:s.description||"No description available"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(m,{className:"w-4 h-4"}),s.member_count||0," members"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),s.post_count||0," posts"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(k,{variant:"secondary",className:"text-xs",children:["#",s.category]}),e.jsxs(n,{className:"w-full btn-community",onClick:a=>{a.stopPropagation(),b(s.id)},disabled:l===s.id,children:[l===s.id?e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(m,{className:"w-4 h-4 mr-2"}),l===s.id?"Joining...":"Join Community"]})]})]})]},s.id))}):e.jsx("div",{className:"space-y-4",children:h.map(s=>e.jsx(w,{className:"community-card group cursor-pointer hover:shadow-community transition-all duration-300",onClick:()=>t(`/community/${s.id}`),children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(m,{className:"w-12 h-12 text-white opacity-80"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg flex items-center gap-2",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.description||"No description available"})]}),e.jsx(n,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:a=>{a.stopPropagation()},children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-muted-foreground mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(m,{className:"w-4 h-4"}),s.member_count||0," members"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),s.post_count||0," posts"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-4 h-4"}),s.location_city||"Local"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"w-4 h-4"}),new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{variant:"secondary",className:"text-xs",children:["#",s.category]})}),e.jsxs(n,{className:"btn-community",onClick:a=>{a.stopPropagation(),b(s.id)},disabled:l===s.id,children:[l===s.id?e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(m,{className:"w-4 h-4 mr-2"}),l===s.id?"Joining...":"Join Community"]})]})]})]})})},s.id))})]}),h.length===0&&e.jsx(w,{className:"text-center py-12",children:e.jsxs(y,{children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(O,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No communities found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your search criteria or create a new community"}),e.jsx(n,{className:"btn-community",asChild:!0,children:e.jsxs(U,{to:"/community/create-group",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Create Community"]})})]})})]})})};export{ds as default};
