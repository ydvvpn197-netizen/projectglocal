var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,i=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&l(e,r,t[r]);if(n)for(var r of n(t))a.call(t,r)&&l(e,r,t[r]);return e},c=(e,n)=>t(e,r(n)),s=(e,t,r)=>new Promise((n,o)=>{var a=e=>{try{i(r.next(e))}catch(t){o(t)}},l=e=>{try{i(r.throw(e))}catch(t){o(t)}},i=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,l);i((r=r.apply(e,t)).next())});import{u as d,r as u}from"./index-B5IYdG7F.js";import{L as g}from"./locationService-BBE-Ay-I.js";function b(){const{user:e}=d(),[t,r]=u.useState({current:null,enabled:!1,auto_detect:!0,loading:!1,error:null}),[n,o]=u.useState({enabled:!1,auto_detect:!0,radius_km:50,categories:[],notifications:!0});u.useEffect(()=>{e&&a()},[e]);const a=u.useCallback(()=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{const[e,t]=yield Promise.all([g.getCurrentUserLocation(),g.getLocationSettings()]);r(r=>c(i({},r),{current:e,enabled:t.enabled,auto_detect:t.auto_detect,loading:!1})),o(t)}catch(t){r(e=>c(i({},e),{loading:!1,error:t instanceof Error?t.message:"Failed to load location"}))}}}),[e]),l=u.useCallback(()=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{const e=yield g.detectAndSaveLocation();r(t=>c(i({},t),{current:e,enabled:!0,auto_detect:!0,loading:!1}));const t=yield g.getLocationSettings();return o(t),e}catch(t){throw r(e=>c(i({},e),{loading:!1,error:t instanceof Error?t.message:"Failed to detect location"})),t}}}),[e]),b=u.useCallback(t=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{yield g.setManualLocation(t),r(e=>c(i({},e),{current:t,enabled:!0,auto_detect:!1,loading:!1}));const e=yield g.getLocationSettings();o(e)}catch(n){throw r(e=>c(i({},e),{loading:!1,error:n instanceof Error?n.message:"Failed to set location"})),n}}}),[e]),f=u.useCallback(t=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{yield g.updateLocationSettings(t);const e=yield g.getLocationSettings();o(e),void 0!==t.enabled?r(e=>c(i({},e),{enabled:t.enabled,loading:!1})):r(e=>c(i({},e),{loading:!1}))}catch(n){throw r(e=>c(i({},e),{loading:!1,error:n instanceof Error?n.message:"Failed to update settings"})),n}}}),[e]),y=u.useCallback(t=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{yield g.toggleLocationServices(t),r(e=>c(i({},e),{enabled:t,loading:!1})),o(e=>c(i({},e),{enabled:t}))}catch(n){throw r(e=>c(i({},e),{loading:!1,error:n instanceof Error?n.message:"Failed to toggle location services"})),n}}}),[e]),h=u.useCallback(()=>s(this,null,function*(){if(e){r(e=>c(i({},e),{loading:!0,error:null}));try{yield g.toggleLocationServices(!1),r(e=>c(i({},e),{current:null,enabled:!1,loading:!1})),o(e=>c(i({},e),{enabled:!1}))}catch(t){throw r(e=>c(i({},e),{loading:!1,error:t instanceof Error?t.message:"Failed to clear location"})),t}}}),[e]),p=u.useCallback(()=>s(this,null,function*(){if(e&&t.enabled){r(e=>c(i({},e),{loading:!0,error:null}));try{t.auto_detect?yield l():yield a()}catch(n){r(e=>c(i({},e),{loading:!1,error:n instanceof Error?n.message:"Failed to refresh location"}))}}}),[e,t.enabled,t.auto_detect,l,a]),m=u.useCallback((r,n)=>s(this,null,function*(){if(!e||!t.enabled||!t.current)return[];try{return yield g.getNearbyContent(r,n)}catch(o){return[]}}),[e,t.enabled,t.current]),L=u.useCallback(r=>s(this,null,function*(){if(!e)return[];try{return yield g.searchPlaces(r,t.current||void 0)}catch(n){return[]}}),[e,t.current]);return{location:t.current,enabled:t.enabled,auto_detect:t.auto_detect,loading:t.loading,error:t.error,settings:n,detectLocation:l,setManualLocation:b,updateSettings:f,toggleLocationServices:y,clearLocation:h,refreshLocation:p,getNearbyContent:m,searchPlaces:L,loadLocationAndSettings:a}}export{b as u};
