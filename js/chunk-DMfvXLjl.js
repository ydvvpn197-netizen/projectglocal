var q=Object.defineProperty,M=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var k=(o,r,c)=>r in o?q(o,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[r]=c,b=(o,r)=>{for(var c in r||(r={}))j.call(r,c)&&k(o,c,r[c]);if(A)for(var c of A(r))x.call(r,c)&&k(o,c,r[c]);return o},C=(o,r)=>M(o,L(r));var g=(o,r,c)=>new Promise((m,n)=>{var u=d=>{try{v(c.next(d))}catch(h){n(h)}},_=d=>{try{v(c.throw(d))}catch(h){n(h)}},v=d=>d.done?m(d.value):Promise.resolve(d.value).then(u,_);v((c=c.apply(o,r)).next())});import{r as f}from"./chunk-COTa-BBv.js";import{s as p}from"./chunk-CasIWBEQ.js";import{a as P,u as F}from"./main-BEfTDqLJ.js";const I=()=>{const[o,r]=f.useState([]),[c,m]=f.useState(!0),{user:n}=P(),{toast:u}=F(),_=f.useCallback(()=>g(null,null,function*(){if(!n){console.log("No user found, skipping fetchPosts"),m(!1);return}console.log("Fetching posts for user:",n.id),console.log("User session:",n);try{console.log("Attempting direct query to posts table...");const{data:a,error:i}=yield p.from("social_posts").select("*").order("created_at",{ascending:!1});if(i)throw console.error("Direct query failed:",i),i;console.log("Direct query successful, posts found:",(a==null?void 0:a.length)||0);const t=(a==null?void 0:a.map(s=>C(b({},s),{contact_info:s.user_id===(n==null?void 0:n.id)?s.contact_info:null})))||[];r(t)}catch(a){const i=a instanceof Error?a.message:"Failed to load posts";console.error("Error fetching posts:",a),u({title:"Error loading posts",description:i,variant:"destructive"})}finally{m(!1)}}),[n,u]),v=a=>g(null,null,function*(){if(!n)return console.error("User not authenticated"),{error:new Error("Not authenticated")};console.log("Creating post with data:",a);try{const i={user_id:n.id,title:a.title||null,content:a.content,post_type:a.type,event_date:a.event_date||null,event_location:a.event_location||null,price_range:a.price_range||null,tags:a.tags||null};console.log("Insert data:",i);const{data:t,error:s}=yield p.from("community_posts").insert(i).select().single();if(s)throw console.error("Supabase error:",s),s;return console.log("Post created successfully:",t),u({title:"Post created",description:"Your post has been shared with the community."}),_(),{data:t,error:null}}catch(i){console.error("Error in createPost:",i);const t=i instanceof Error?i.message:"Failed to create post";return u({title:"Error creating post",description:t,variant:"destructive"}),{error:i}}}),d=a=>g(null,null,function*(){if(n)try{const{data:i}=yield p.from("likes").select("id").eq("post_id",a).eq("user_id",n.id).maybeSingle();i?yield p.from("likes").delete().eq("post_id",a).eq("user_id",n.id):yield p.from("likes").insert({post_id:a,user_id:n.id}),_()}catch(i){const t=i instanceof Error?i.message:"Failed to update like";u({title:"Error updating like",description:t,variant:"destructive"})}}),h=a=>g(null,null,function*(){if(!n)return{error:new Error("Not authenticated")};try{const{error:i}=yield p.from("posts").delete().eq("id",a).eq("user_id",n.id);if(i)throw i;return u({title:"Post deleted",description:"Your post has been deleted successfully."}),_(),{error:null}}catch(i){const t=i instanceof Error?i.message:"Failed to delete post";return u({title:"Error deleting post",description:t,variant:"destructive"}),{error:i}}});return f.useEffect(()=>{n&&_()},[n,_]),{posts:o,loading:c,createPost:v,toggleLike:d,deletePost:h,refetch:_}},T=()=>{const{user:o}=P(),{toast:r}=F(),[c,m]=f.useState([]),[n,u]=f.useState(!0),[_,v]=f.useState(null),d=f.useCallback(()=>g(null,null,function*(){try{u(!0),v(null);const{data:t,error:s}=yield p.from("communities").select(`
          *,
          creator:profiles!communities_creator_id_fkey(
            display_name,
            avatar_url
          )
        `).order("created_at",{ascending:!1});if(s)throw s;const l=(t==null?void 0:t.map(e=>{var y,w,E,S;return{id:e.id,name:e.name,description:e.description,image_url:e.image_url,image:e.image_url,category:e.category||"Community",location:e.location,member_count:e.member_count||0,members:e.member_count||0,creator_id:e.creator_id,creator_name:((y=e.creator)==null?void 0:y.display_name)||"Community Creator",creator_avatar:(w=e.creator)==null?void 0:w.avatar_url,creator:{name:((E=e.creator)==null?void 0:E.display_name)||"Community Creator",avatar:((S=e.creator)==null?void 0:S.avatar_url)||""},is_verified:e.is_verified||!1,activity_level:e.activity_level||"Active",activity_score:e.activity_score||0,created_at:e.created_at,createdAt:e.created_at,tags:e.tags||[],is_private:e.is_private||!1,is_featured:e.is_featured||!1,rules:e.rules||[],guidelines:e.guidelines||[],contact_info:e.contact_info||{}}}))||[];m(l)}catch(t){console.error("Error fetching communities:",t),v(t instanceof Error?t.message:"Failed to fetch communities");const s=[{id:"1",name:"Local Music Enthusiasts",description:"A community for music lovers to discover local artists, share recommendations, and attend concerts together.",image_url:"https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800&h=400&fit=crop",category:"Music",location:"Downtown",member_count:1250,creator_name:"Music Lover",creator_avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face",is_verified:!0,activity_level:"Very Active",activity_score:95,created_at:new Date().toISOString(),tags:["music","concerts","local","artists"],is_private:!1,is_featured:!0},{id:"2",name:"Art & Culture Collective",description:"Connecting artists, art lovers, and cultural enthusiasts to explore local galleries, exhibitions, and creative events.",image_url:"https://images.unsplash.com/photo-1541961017774-22349e4a1262?w=800&h=400&fit=crop",category:"Art",location:"Arts District",member_count:890,creator_name:"Art Curator",creator_avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face",is_verified:!0,activity_level:"Active",activity_score:78,created_at:new Date().toISOString(),tags:["art","culture","galleries","exhibitions"],is_private:!1,is_featured:!1},{id:"3",name:"Tech Entrepreneurs Network",description:"A professional network for tech entrepreneurs, startup founders, and innovators to share ideas and collaborate.",image_url:"https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=800&h=400&fit=crop",category:"Technology",location:"Innovation Hub",member_count:567,creator_name:"Tech Founder",creator_avatar:"https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100&h=100&fit=crop&crop=face",is_verified:!0,activity_level:"Active",activity_score:82,created_at:new Date().toISOString(),tags:["tech","startup","entrepreneurs","innovation"],is_private:!1,is_featured:!0},{id:"4",name:"Wellness & Mindfulness",description:"A supportive community focused on mental health, wellness practices, and mindful living.",image_url:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=400&fit=crop",category:"Health & Wellness",location:"Wellness Center",member_count:432,creator_name:"Wellness Coach",creator_avatar:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face",is_verified:!1,activity_level:"Moderate",activity_score:65,created_at:new Date().toISOString(),tags:["wellness","mindfulness","health","meditation"],is_private:!1,is_featured:!1},{id:"5",name:"Local Food Enthusiasts",description:"Food lovers sharing recipes, restaurant recommendations, and organizing culinary events.",image_url:"https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=800&h=400&fit=crop",category:"Food",location:"Food District",member_count:789,creator_name:"Food Blogger",creator_avatar:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face",is_verified:!0,activity_level:"Very Active",activity_score:88,created_at:new Date().toISOString(),tags:["food","cooking","restaurants","recipes"],is_private:!1,is_featured:!0}];m(s)}finally{u(!1)}}),[]),h=f.useCallback(t=>g(null,null,function*(){if(!o){r({title:"Authentication Required",description:"Please sign in to join communities.",variant:"destructive"});return}try{const{error:s}=yield p.from("community_members").insert({community_id:t,user_id:o.id,joined_at:new Date().toISOString()});if(s)throw s;m(l=>l.map(e=>e.id===t?C(b({},e),{member_count:(e.member_count||0)+1}):e)),r({title:"Joined Community",description:"You've successfully joined this community!"})}catch(s){console.error("Error joining community:",s),r({title:"Join Failed",description:"Unable to join community. Please try again.",variant:"destructive"})}}),[o,r]),a=f.useCallback(t=>g(null,null,function*(){if(!o){r({title:"Authentication Required",description:"Please sign in to leave communities.",variant:"destructive"});return}try{const{error:s}=yield p.from("community_members").delete().eq("community_id",t).eq("user_id",o.id);if(s)throw s;m(l=>l.map(e=>e.id===t?C(b({},e),{member_count:Math.max(0,(e.member_count||0)-1)}):e)),r({title:"Left Community",description:"You've successfully left this community."})}catch(s){console.error("Error leaving community:",s),r({title:"Leave Failed",description:"Unable to leave community. Please try again.",variant:"destructive"})}}),[o,r]),i=f.useCallback(t=>g(null,null,function*(){var s;if(!o){r({title:"Authentication Required",description:"Please sign in to create communities.",variant:"destructive"});return}try{const{data:l,error:e}=yield p.from("communities").insert({name:t.name,description:t.description,image_url:t.image_url,category:t.category,location:t.location,creator_id:o.id,is_private:t.is_private||!1,tags:t.tags||[]}).select().single();if(e)throw e;const y={id:l.id,name:l.name,description:l.description,image_url:l.image_url,category:l.category,location:l.location,member_count:1,creator_id:o.id,creator_name:((s=o.email)==null?void 0:s.split("@")[0])||"Community Creator",is_verified:!1,activity_level:"New",activity_score:0,created_at:l.created_at,tags:l.tags||[],is_private:l.is_private||!1,is_featured:!1};return m(w=>[y,...w]),r({title:"Community Created",description:"Your community has been created successfully!"}),y}catch(l){console.error("Error creating community:",l),r({title:"Creation Failed",description:"Unable to create community. Please try again.",variant:"destructive"})}}),[o,r]);return f.useEffect(()=>{d()},[d]),{communities:c,loading:n,error:_,fetchCommunities:d,joinCommunity:h,leaveCommunity:a,createCommunity:i}};export{T as a,I as u};
