var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,l=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&r(e,s,t[s]);if(a)for(var s of a(t))i.call(t,s)&&r(e,s,t[s]);return e},o=(e,a)=>t(e,s(a)),c=(e,t,s)=>r(e,"symbol"!=typeof t?t+"":t,s),d=(e,t,s)=>new Promise((a,n)=>{var i=e=>{try{l(s.next(e))}catch(t){n(t)}},r=e=>{try{l(s.throw(e))}catch(t){n(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,r);l((s=s.apply(e,t)).next())});import{c as u,s as m,r as h,u as g,j as p,B as f,X as x,d as y}from"./index-B5IYdG7F.js";import{C as v,a as j,b as w,d as S}from"./card-Bm1jiGt-.js";import{B as _}from"./badge-Dh5Uj8vN.js";import{T as N,a as b,b as C,c as k}from"./tabs-DPPBWbFC.js";import{H as M,R as D,E as R}from"./ResponsiveLayout-BzUw0buI.js";import{u as F}from"./useLocation-BN9qq_uk.js";import{I}from"./input-C4_QhDnm.js";import{S as T}from"./slider-DR9e0kQZ.js";import{S as q,a as A,b as E,c as P,d as $}from"./select-DME_qdt9.js";import{C as L}from"./checkbox-Cu_S15Df.js";import{L as O}from"./label-BIAuZBUP.js";import{A as U,a as B,b as z,i as V,S as W}from"./sheet-CgDUfSpi.js";import{S as H}from"./search-Co_OHmlK.js";import{F as Q}from"./filter-DejZCL1b.js";import{M as G}from"./map-pin-BwnggLrZ.js";import{D as J}from"./dollar-sign-DW2P0OIR.js";import{f as Y}from"./index-DWtoKlrM.js";import{C as K}from"./index-DD_J5sPn.js";import{T as X}from"./trending-up-B5v9qFws.js";import{U as Z}from"./users-Dh-Bdb-k.js";import{C as ee}from"./clock-BZvZzp4Q.js";import{M as te}from"./message-circle-CZlRU4gv.js";import{S as se}from"./share-2-D7lrZdDw.js";import{E as ae}from"./eye-DAEnomQ6.js";import{R as ne}from"./refresh-cw-B0silJ51.js";import{U as ie}from"./user-plus-BRSjM2Wl.js";import"./index-9msbY5CZ.js";import"./separator-BZYZTYLW.js";import"./NotificationBell-DtnEojo4.js";import"./Combination-BxRIZ8rt.js";import"./scroll-area-Beiyt5Kx.js";import"./index-jVOyRz7F.js";import"./useNotifications-C0wifgqF.js";import"./check-C9wwFfOs.js";import"./bell-qeMkXRtc.js";import"./settings-DSEWn2wM.js";import"./user-UOowhO7W.js";import"./NotificationButton-CqXjP_LK.js";import"./zap-DPSXpNso.js";import"./message-square-j4RxGxzk.js";import"./alert-CQybxmNr.js";import"./log-out-DchhrZ8K.js";import"./locationService-BBE-Ay-I.js";import"./index-_KG4atBu.js";import"./chevron-up-DvjQ7ry8.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=u("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]);class le{static calculateRelevanceScore(e,t){const s=this.calculateTextRelevance(e,t),a=this.calculateLocationRelevance(e,t),n=this.calculateCategoryRelevance(e,t),i=this.calculateEngagementScore(e),r=this.calculateFreshnessScore(e);return{textRelevance:s,locationRelevance:a,categoryRelevance:n,engagementScore:i,freshnessScore:r,totalScore:.35*s+.25*a+.15*n+.15*i+.1*r}}static calculateTextRelevance(e,t){var s,a;const n=t.query.toLowerCase(),i=e.title.toLowerCase(),r=(null==(s=e.description)?void 0:s.toLowerCase())||"",l=(null==(a=e.tags)?void 0:a.map(e=>e.toLowerCase()))||[];let o=0;return i.includes(n)?o+=10:i.split(" ").some(e=>e.includes(n))&&(o+=7),r.includes(n)?o+=5:r.split(" ").some(e=>e.includes(n))&&(o+=3),l.forEach(e=>{e.includes(n)&&(o+=3)}),i===n&&(o+=5),Math.min(o,20)}static calculateLocationRelevance(e,t){var s,a,n;if(!t.location||!e.location)return 0;let i=0;void 0!==e.distance&&(e.distance<=5?i+=10:e.distance<=15?i+=7:e.distance<=30?i+=4:e.distance<=50&&(i+=2));const r=t.query.toLowerCase(),l=(null==(s=e.location.name)?void 0:s.toLowerCase())||"",o=(null==(a=e.location.city)?void 0:a.toLowerCase())||"",c=(null==(n=e.location.state)?void 0:n.toLowerCase())||"";return(l.includes(r)||o.includes(r)||c.includes(r))&&(i+=5),Math.min(i,15)}static calculateCategoryRelevance(e,t){return t.category&&t.category,5}static calculateEngagementScore(e){if(!e.engagement)return 0;const{likes:t,comments:s,shares:a,views:n}=e.engagement,i=1*t+2*s+3*a+.1*n;return Math.min(i/100,10)}static calculateFreshnessScore(e){const t=new Date,s=new Date(e.createdAt),a=(t.getTime()-s.getTime())/36e5;return a<=1?10:a<=24?8:a<=168?6:a<=720?4:2}static rankSearchResults(e,t){return e.map(e=>{const s=this.calculateRelevanceScore(e,t);return o(l({},e),{relevanceScore:s.totalScore})}).sort((e,s)=>{switch(t.sortBy){case"relevance":default:return(s.relevanceScore||0)-(e.relevanceScore||0);case"distance":return(e.distance||0)-(s.distance||0);case"date":return new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime();case"popularity":{const t=e.engagement?e.engagement.likes+e.engagement.comments:0;return(s.engagement?s.engagement.likes+s.engagement.comments:0)-t}case"rating":return(s.rating||0)-(e.rating||0)}})}static generateSearchSuggestions(e,t=[]){const s=new Set;t.forEach(t=>{t.toLowerCase().includes(e.toLowerCase())&&s.add(t)});["music","art","food","sports","business","education","concert","exhibition","restaurant","gym","workshop","local","nearby","today","this week","free","paid"].forEach(t=>{t.toLowerCase().includes(e.toLowerCase())&&s.add(t)});return["music","art","food","sports","business","education","entertainment","health","technology","fashion","travel"].forEach(t=>{t.toLowerCase().includes(e.toLowerCase())&&s.add(t)}),Array.from(s).slice(0,10)}static calculateDistance(e,t,s,a){const n=this.deg2rad(s-e),i=this.deg2rad(a-t),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(s))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}static deg2rad(e){return e*(Math.PI/180)}}const oe=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}search(e){return d(this,null,function*(){const t=[];try{const s=[];"all"!==e.type&&"artist"!==e.type||s.push(this.searchArtists(e)),"all"!==e.type&&"event"!==e.type||s.push(this.searchEvents(e)),"all"!==e.type&&"post"!==e.type||s.push(this.searchPosts(e)),"all"!==e.type&&"group"!==e.type||s.push(this.searchGroups(e));(yield Promise.all(s)).forEach(e=>{t.push(...e)});const a=this.scoreAndSortResults(t,e),n=(e.page||0)*(e.limit||20),i=n+(e.limit||20);return a.slice(n,i)}catch(s){throw new Error("Failed to perform search")}})}searchArtists(e){return d(this,null,function*(){const{data:t}=yield m.from("artists").select("\n        id,\n        user_id,\n        specialty,\n        hourly_rate_min,\n        hourly_rate_max,\n        bio,\n        is_available\n      ").or(`specialty.cs.{${e.query}},bio.ilike.%${e.query}%`).eq("is_available",!0);if(!t)return[];const s=[];for(const a of t){const{data:t}=yield m.from("profiles").select("display_name, avatar_url, location_city, location_state, latitude, longitude").eq("user_id",a.user_id).single();if(t){const n=e.location?this.calculateDistance(e.location.latitude,e.location.longitude,t.latitude,t.longitude):void 0;(!e.location||n&&n<=e.location.radius)&&s.push({id:a.id,type:"artist",title:t.display_name||"Anonymous",description:a.bio,image:t.avatar_url,price:a.hourly_rate_min,location:{name:t.location_city||"",city:t.location_city||"",state:t.location_state||"",latitude:t.latitude,longitude:t.longitude},distance:n,tags:a.specialty,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})}}return s})}searchEvents(e){return d(this,null,function*(){let t=m.from("events").select("\n        id,\n        title,\n        description,\n        event_date,\n        event_time,\n        location_name,\n        location_city,\n        location_state,\n        category,\n        price,\n        image_url,\n        tags,\n        created_at\n      ").or(`title.ilike.%${e.query}%,description.ilike.%${e.query}%,category.ilike.%${e.query}%`);t=e.dateRange?t.gte("event_date",e.dateRange.start).lte("event_date",e.dateRange.end):t.gte("event_date",(new Date).toISOString().split("T")[0]);const{data:s}=yield t;return s?s.map(e=>({id:e.id,type:"event",title:e.title,description:e.description,image:e.image_url,price:e.price,location:{name:e.location_name||"",city:e.location_city||"",state:e.location_state||""},date:`${e.event_date} ${e.event_time}`,tags:e.tags,createdAt:e.created_at,updatedAt:e.created_at})):[]})}searchPosts(e){return d(this,null,function*(){const{data:t}=yield m.from("posts").select("\n        id,\n        user_id,\n        title,\n        content,\n        type,\n        likes_count,\n        comments_count,\n        created_at\n      ").or(`title.ilike.%${e.query}%,content.ilike.%${e.query}%`).eq("status","active");if(!t)return[];const s=[];for(const e of t){const{data:t}=yield m.from("profiles").select("display_name, avatar_url").eq("user_id",e.user_id).single();t&&s.push({id:e.id,type:"post",title:e.title||"Untitled Post",description:e.content.substring(0,100)+"...",image:t.avatar_url,date:e.created_at,tags:e.type?[e.type]:[],engagement:{likes:e.likes_count||0,comments:e.comments_count||0,shares:0,views:0},createdAt:e.created_at,updatedAt:e.created_at})}return s})}searchGroups(e){return d(this,null,function*(){const{data:t}=yield m.from("community_groups").select("\n        id,\n        name,\n        description,\n        category,\n        created_at\n      ").or(`name.ilike.%${e.query}%,description.ilike.%${e.query}%,category.ilike.%${e.query}%`);return t?t.map(e=>({id:e.id,type:"group",title:e.name,description:e.description,date:e.created_at,tags:e.category?[e.category]:[],createdAt:e.created_at,updatedAt:e.created_at})):[]})}calculateDistance(e,t,s,a){return e&&t&&s&&a?le.calculateDistance(e,t,s,a):0}scoreAndSortResults(e,t){return le.rankSearchResults(e,t)}getSearchSuggestions(e){return d(this,null,function*(){if(!e.trim())return[];const{data:t}=yield m.from("search_history").select("query").ilike("query",`%${e}%`).order("created_at",{ascending:!1}).limit(5),s=t?t.map(e=>e.query):[];return le.generateSearchSuggestions(e,s)})}saveSearchHistory(e,t,s,a){return d(this,null,function*(){yield m.from("search_history").insert({user_id:e,query:t,filters:JSON.stringify(s),results_count:a,created_at:(new Date).toISOString()})})}};c(oe,"instance");const ce=oe.getInstance(),de=h.memo(({result:e})=>{const t=h.useCallback(e=>({artist:p.jsx(V,{className:"h-4 w-4"}),event:p.jsx(K,{className:"h-4 w-4"}),post:p.jsx(Z,{className:"h-4 w-4"}),group:p.jsx(Z,{className:"h-4 w-4"}),business:p.jsx(re,{className:"h-4 w-4"})}[e]||p.jsx(H,{className:"h-4 w-4"})),[]);return p.jsx(v,{className:"hover:shadow-md transition-shadow",children:p.jsx(S,{className:"p-4",children:p.jsxs("div",{className:"flex items-start gap-4",children:[p.jsxs(U,{className:"h-12 w-12",children:[p.jsx(B,{src:e.image}),p.jsx(z,{children:e.title.charAt(0)})]}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t(e.type),p.jsx(_,{variant:"secondary",className:"text-xs",children:e.type}),p.jsx("h3",{className:"font-semibold truncate",children:e.title}),e.relevanceScore&&p.jsxs(_,{variant:"outline",className:"text-xs",children:[Math.round(e.relevanceScore),"% match"]})]}),e.description&&p.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:e.description}),p.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.location&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(G,{className:"h-3 w-3"}),e.location.name||`${e.location.city}, ${e.location.state}`]}),e.distance&&p.jsxs("span",{children:[e.distance.toFixed(1),"km away"]}),e.price&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(J,{className:"h-3 w-3"}),"$",e.price]}),e.date&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(K,{className:"h-3 w-3"}),Y(new Date(e.date),"MMM dd, yyyy")]}),e.engagement&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(X,{className:"h-3 w-3"}),e.engagement.likes+e.engagement.comments]})]}),e.tags&&e.tags.length>0&&p.jsx("div",{className:"flex gap-1 mt-2",children:e.tags.slice(0,3).map((e,t)=>p.jsx(_,{variant:"outline",className:"text-xs",children:e},t))})]}),p.jsx(f,{variant:"outline",size:"sm",children:"View"})]})})})});de.displayName="SearchResultItem";const ue=h.memo(({filters:e,updateFilters:t,resetFilters:s,categories:a})=>{var n;return p.jsxs(v,{children:[p.jsx(j,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx(w,{children:"Search Filters"}),p.jsxs(f,{variant:"outline",size:"sm",onClick:s,children:[p.jsx(x,{className:"h-4 w-4 mr-2"}),"Reset"]})]})}),p.jsxs(S,{className:"space-y-6",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[p.jsxs("div",{children:[p.jsx(O,{className:"text-sm font-medium",children:"Content Type"}),p.jsxs(q,{value:e.type,onValueChange:e=>t({type:e}),children:[p.jsx(A,{children:p.jsx(E,{})}),p.jsxs(P,{children:[p.jsx($,{value:"all",children:"All Types"}),p.jsx($,{value:"artist",children:"Artists"}),p.jsx($,{value:"event",children:"Events"}),p.jsx($,{value:"post",children:"Posts"}),p.jsx($,{value:"group",children:"Groups"}),p.jsx($,{value:"business",children:"Businesses"})]})]})]}),p.jsxs("div",{children:[p.jsx(O,{className:"text-sm font-medium",children:"Category"}),p.jsxs(q,{value:e.category,onValueChange:e=>t({category:e}),children:[p.jsx(A,{children:p.jsx(E,{})}),p.jsxs(P,{children:[p.jsx($,{value:"all",children:"All Categories"}),"all"!==e.type&&(null==(n=a[e.type])?void 0:n.map(e=>p.jsx($,{value:e.toLowerCase(),children:e},e)))]})]})]}),p.jsxs("div",{children:[p.jsx(O,{className:"text-sm font-medium",children:"Sort By"}),p.jsxs(q,{value:e.sortBy,onValueChange:e=>t({sortBy:e}),children:[p.jsx(A,{children:p.jsx(E,{})}),p.jsxs(P,{children:[p.jsx($,{value:"relevance",children:"Relevance"}),p.jsx($,{value:"distance",children:"Distance"}),p.jsx($,{value:"date",children:"Date"}),p.jsx($,{value:"popularity",children:"Popularity"}),p.jsx($,{value:"rating",children:"Rating"})]})]})]})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx(L,{id:"location-filter",checked:e.location.enabled,onCheckedChange:s=>t({location:o(l({},e.location),{enabled:s})})}),p.jsx(O,{htmlFor:"location-filter",children:"Filter by location"})]}),e.location.enabled&&p.jsxs("div",{children:[p.jsxs(O,{className:"text-sm font-medium",children:["Max Distance: ",e.location.radius,"km"]}),p.jsx(T,{value:[e.location.radius],onValueChange:([s])=>t({location:o(l({},e.location),{radius:s})}),max:100,min:1,step:1})]})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx(L,{id:"date-filter",checked:e.dateRange.enabled,onCheckedChange:s=>t({dateRange:o(l({},e.dateRange),{enabled:s})})}),p.jsx(O,{htmlFor:"date-filter",children:"Filter by date range"})]}),e.dateRange.enabled&&p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx(O,{className:"text-sm font-medium",children:"Start Date"}),p.jsx(I,{type:"date",value:e.dateRange.start,onChange:s=>t({dateRange:o(l({},e.dateRange),{start:s.target.value})})})]}),p.jsxs("div",{children:[p.jsx(O,{className:"text-sm font-medium",children:"End Date"}),p.jsx(I,{type:"date",value:e.dateRange.end,onChange:s=>t({dateRange:o(l({},e.dateRange),{end:s.target.value})})})]})]})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx(L,{id:"price-filter",checked:e.priceRange.enabled,onCheckedChange:s=>t({priceRange:o(l({},e.priceRange),{enabled:s})})}),p.jsx(O,{htmlFor:"price-filter",children:"Filter by price range"})]}),e.priceRange.enabled&&p.jsxs("div",{children:[p.jsxs(O,{className:"text-sm font-medium",children:["Price Range: $",e.priceRange.min," - $",e.priceRange.max]}),p.jsx(T,{value:[e.priceRange.min,e.priceRange.max],onValueChange:s=>t({priceRange:o(l({},e.priceRange),{min:s[0],max:s[1]})}),max:1e3,min:0,step:10})]})]})]})]})});ue.displayName="SearchFilters";const me=()=>{const{query:e,setQuery:t,results:s,loading:a,error:n,filters:i,updateFilters:r,resetFilters:o,suggestions:c,hasMore:u,loadMore:m}=(()=>{const[e,t]=h.useState(""),[s,a]=h.useState([]),[n,i]=h.useState(!1),[r,o]=h.useState(null),[c,u]=h.useState({type:"all",category:"all",location:{enabled:!1,radius:50},dateRange:{enabled:!1,start:"",end:""},priceRange:{enabled:!1,min:0,max:1e3},tags:[],rating:0,sortBy:"relevance"}),[m,p]=h.useState([]),[f,x]=h.useState(0),[y,v]=h.useState(!0),{user:j}=g(),{currentLocation:w}=F(),S=h.useCallback((t,s,n)=>d(void 0,null,function*(){const r=t||e,l=s||c,d=n||0;if(!r.trim())return a([]),void v(!1);i(!0),o(null);try{const e={query:r,type:"all"===l.type?void 0:l.type,category:"all"===l.category?void 0:l.category,location:l.location.enabled&&w?{latitude:w.latitude,longitude:w.longitude,radius:l.location.radius}:void 0,dateRange:l.dateRange.enabled?{start:l.dateRange.start,end:l.dateRange.end}:void 0,priceRange:l.priceRange.enabled?{min:l.priceRange.min,max:l.priceRange.max}:void 0,tags:l.tags.length>0?l.tags:void 0,sortBy:l.sortBy,page:d,limit:20},t=yield ce.search(e);a(0===d?t:e=>[...e,...t]),v(20===t.length),x(d),j&&(yield ce.saveSearchHistory(j.id,r,l,t.length))}catch(u){o(u instanceof Error?u.message:"Search failed")}finally{i(!1)}}),[e,c,w,j]),_=h.useCallback(e=>d(void 0,null,function*(){if(e.trim())try{const t=yield ce.getSearchSuggestions(e);p(t)}catch(t){}else p([])}),[]),N=h.useCallback(e=>{u(t=>l(l({},t),e)),x(0)},[]),b=h.useCallback(()=>{u({type:"all",category:"all",location:{enabled:!1,radius:50},dateRange:{enabled:!1,start:"",end:""},priceRange:{enabled:!1,min:0,max:1e3},tags:[],rating:0,sortBy:"relevance"}),x(0)},[]),C=h.useCallback(()=>{!n&&y&&S(e,c,f+1)},[n,y,S,e,c,f]),k=h.useCallback(()=>{a([]),x(0),v(!0),o(null)},[]);return h.useEffect(()=>{const t=setTimeout(()=>{e.trim()?(S(),_(e)):(k(),p([]))},500);return()=>clearTimeout(t)},[e,S,_,k]),h.useEffect(()=>{e.trim()&&S()},[c,S]),{query:e,setQuery:t,results:s,loading:n,error:r,filters:c,updateFilters:N,resetFilters:b,suggestions:m,hasMore:y,loadMore:C,clearResults:k,search:()=>S()}})(),[y,v]=h.useState(!1),[j,w]=h.useState(!1),S=h.useMemo(()=>({artist:["Photographer","Musician","DJ","Chef","Designer","Writer","Performer"],event:["Music","Food","Art","Sports","Business","Education","Entertainment"],post:["News","Discussion","Question","Announcement","Review"],group:["Hobby","Professional","Community","Interest","Location-based"],business:["Restaurant","Shop","Service","Entertainment","Health","Education"]}),[]);return p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"relative",children:[p.jsxs("div",{className:"flex gap-2",children:[p.jsxs("div",{className:"relative flex-1",children:[p.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),p.jsx(I,{placeholder:"Search artists, events, posts, groups, businesses...",value:e,onChange:e=>{t(e.target.value),w(e.target.value.length>0)},onFocus:()=>w(e.length>0),className:"pl-10"}),e&&p.jsx(f,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",onClick:()=>{t(""),w(!1)},children:p.jsx(x,{className:"h-3 w-3"})})]}),p.jsxs(f,{variant:"outline",onClick:()=>v(!y),children:[p.jsx(Q,{className:"h-4 w-4 mr-2"}),"Filters"]})]}),j&&c.length>0&&p.jsx("div",{className:"absolute top-full left-0 right-0 bg-background border rounded-md shadow-lg z-10 mt-1",children:c.map((e,s)=>p.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-muted flex items-center gap-2",onClick:()=>{t(e),w(!1)},children:[p.jsx(H,{className:"h-3 w-3 text-muted-foreground"}),e]},s))})]}),y&&p.jsx(ue,{filters:i,updateFilters:r,resetFilters:o,categories:S}),n&&p.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:p.jsx("p",{className:"text-destructive text-sm",children:n})}),p.jsxs("div",{className:"space-y-4",children:[a&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),p.jsx("p",{className:"mt-2 text-muted-foreground",children:"Searching..."})]}),!a&&0===s.length&&e&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx(H,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold",children:"No results found"}),p.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search terms or filters"})]}),s.map(e=>p.jsx(de,{result:e},`${e.type}-${e.id}`)),u&&s.length>0&&p.jsx("div",{className:"text-center pt-4",children:p.jsx(f,{variant:"outline",onClick:m,disabled:a,children:a?"Loading...":"Load More"})})]})]})};class he{static calculateTrendingScore(e,t="day"){const s=this.calculateEngagementScore(e),a=this.calculateVelocityScore(e),n=this.calculateTimeDecayScore(e),i=this.calculateCategoryWeight(e),r=this.calculateLocationRelevance(e),l=this.calculateQualityScore(e),o=this.getPeriodWeights(t);return{engagementScore:s,velocityScore:a,timeDecayScore:n,categoryWeight:i,locationRelevance:r,qualityScore:l,finalScore:s*o.engagement+a*o.velocity+n*o.timeDecay+i*o.category+r*o.location+l*o.quality}}static calculateEngagementScore(e){const{likes:t,comments:s,shares:a,views:n}=e.engagement,i=1*t+2*s+3*a+.1*n;return Math.min(i/10,100)}static calculateVelocityScore(e){const{velocity:t}=e.engagement;return Math.min(10*t,100)}static calculateTimeDecayScore(e){const t=new Date,s=new Date(e.createdAt),a=(t.getTime()-s.getTime())/36e5,n=100*Math.exp(-.1*a);return Math.max(n,1)}static calculateCategoryWeight(e){return 100*({music:1.2,art:1.1,food:1,sports:1.3,business:.9,education:1,entertainment:1.2,health:1.1,technology:1,fashion:1.1,travel:1}[e.category.toLowerCase()]||1)}static calculateLocationRelevance(e){return 80}static calculateQualityScore(e){let t=50;if(e.title&&e.title.length>10&&(t+=10),e.description&&e.description.length>50&&(t+=10),e.image&&(t+=10),e.engagement.views>0){const s=e.engagement.likes/e.engagement.views;t+=Math.min(100*s,20)}return Math.min(t,100)}static getPeriodWeights(e){return{hour:{engagement:.25,velocity:.35,timeDecay:.2,category:.1,location:.05,quality:.05},day:{engagement:.3,velocity:.25,timeDecay:.25,category:.1,location:.05,quality:.05},week:{engagement:.35,velocity:.15,timeDecay:.2,category:.15,location:.1,quality:.05},month:{engagement:.4,velocity:.1,timeDecay:.15,category:.2,location:.1,quality:.05}}[e]}static rankTrendingContent(e,t="day"){return e.map(e=>{const s=this.calculateTrendingScore(e,t);return o(l({},e),{trendingScore:s.finalScore})}).sort((e,t)=>t.trendingScore-e.trendingScore)}static calculateTrendingVelocity(e){if(e.length<2)return 0;const t=e.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),s=(new Date(t[t.length-1].timestamp).getTime()-new Date(t[0].timestamp).getTime())/36e5,a=t[t.length-1].engagement-t[0].engagement;return s>0?a/s:0}static detectTrendingPattern(e){const t=e.engagement.velocity;return t>10?"rising":t>2?"stable":"declining"}static calculateTrendingMomentum(e){if(e.length<3)return 0;const t=[];for(let s=1;s<e.length;s++){const a=(new Date(e[s].timestamp).getTime()-new Date(e[s-1].timestamp).getTime())/36e5,n=e[s].engagement-e[s-1].engagement;t.push(a>0?n/a:0)}return t.length<2?0:t[t.length-1]-t[0]}static filterByQuality(e,t=30){return e.filter(e=>this.calculateTrendingScore(e).qualityScore>=t)}static getTrendingInsights(e){const t=this.detectTrendingPattern(e),s=e.engagement.velocity;let a="stable";s>20?a="strong":s>10?a="moderate":s<2&&(a="weak");let n="stable";n=s>15&&"rising"===t?"likely to trend higher":s<5&&"declining"===t?"likely to decline":"expected to remain stable";const i=[];return"rising"===t?(i.push("Consider promoting this content"),i.push("Monitor engagement closely")):"declining"===t&&(i.push("Consider refreshing content"),i.push("Analyze engagement patterns")),{pattern:t,momentum:a,prediction:n,recommendations:i}}}const ge=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}getTrendingContent(e="day",t=20){return d(this,null,function*(){try{const s=[],a=yield this.getTrendingEvents(e,t/4);s.push(...a);const n=yield this.getTrendingPosts(e,t/4);s.push(...n);const i=yield this.getTrendingArtists(e,t/4);s.push(...i);const r=yield this.getTrendingGroups(e,t/4);return s.push(...r),he.rankTrendingContent(s,e).slice(0,t)}catch(s){return[]}})}getTrendingEvents(e,t){return d(this,null,function*(){const s=this.getTimeFilter(e),{data:a}=yield m.from("events").select("\n        id,\n        title,\n        description,\n        category,\n        event_date,\n        location_name,\n        location_city,\n        location_state,\n        image_url,\n        max_attendees,\n        created_at\n      ").gte("event_date",(new Date).toISOString().split("T")[0]).gte("created_at",s).order("max_attendees",{ascending:!1}).limit(t);return a?a.map(t=>({id:t.id,type:"event",title:t.title,description:t.description,image:t.image_url,engagement:{likes:0,comments:0,shares:0,views:0,velocity:t.max_attendees||0},trendingScore:this.calculateTrendingScore(t.max_attendees||0,t.created_at),category:t.category,location:{name:t.location_name||"",city:t.location_city||"",state:t.location_state||""},createdAt:t.created_at,trendingPeriod:e})):[]})}getTrendingPosts(e,t){return d(this,null,function*(){const s=this.getTimeFilter(e),{data:a}=yield m.from("posts").select("\n        id,\n        user_id,\n        title,\n        content,\n        type,\n        likes_count,\n        comments_count,\n        created_at\n      ").eq("status","active").gte("created_at",s).order("likes_count",{ascending:!1}).limit(t);if(!a)return[];const n=[];for(const t of a){const{data:s}=yield m.from("profiles").select("display_name, avatar_url").eq("user_id",t.user_id).single();if(s){const a=(t.likes_count||0)+2*(t.comments_count||0);n.push({id:t.id,type:"post",title:t.title||"Untitled Post",description:t.content.substring(0,100)+"...",image:s.avatar_url,engagement:{likes:t.likes_count||0,comments:t.comments_count||0,shares:0,views:0,velocity:a},trendingScore:this.calculateTrendingScore(a,t.created_at),category:t.type||"general",createdAt:t.created_at,trendingPeriod:e})}}return n})}getTrendingArtists(e,t){return d(this,null,function*(){var s;this.getTimeFilter(e);const{data:a}=yield m.from("artists").select("\n        id,\n        user_id,\n        specialty,\n        bio,\n        hourly_rate_min,\n        is_available\n      ").eq("is_available",!0).limit(t);if(!a)return[];const n=[];for(const t of a){const{data:a}=yield m.from("profiles").select("display_name, avatar_url, location_city, location_state").eq("user_id",t.user_id).single();if(a){const i=Math.floor(100*Math.random())+10;n.push({id:t.id,type:"artist",title:a.display_name||"Anonymous",description:t.bio,image:a.avatar_url,engagement:{likes:0,comments:0,shares:0,views:i,velocity:i},trendingScore:this.calculateTrendingScore(i,(new Date).toISOString()),category:(null==(s=t.specialty)?void 0:s[0])||"artist",location:{name:a.location_city||"",city:a.location_city||"",state:a.location_state||""},createdAt:(new Date).toISOString(),trendingPeriod:e})}}return n})}getTrendingGroups(e,t){return d(this,null,function*(){const s=this.getTimeFilter(e),{data:a}=yield m.from("community_groups").select("\n        id,\n        name,\n        description,\n        category,\n        created_at\n      ").gte("created_at",s).limit(t);return a?a.map(t=>{const s=Math.floor(50*Math.random())+5;return{id:t.id,type:"group",title:t.name,description:t.description,engagement:{likes:0,comments:0,shares:0,views:s,velocity:s},trendingScore:this.calculateTrendingScore(s,t.created_at),category:t.category,createdAt:t.created_at,trendingPeriod:e}}):[]})}getTimeFilter(e){const t=new Date;let s;switch(e){case"hour":s=new Date(t.getTime()-36e5);break;case"day":default:s=new Date(t.getTime()-864e5);break;case"week":s=new Date(t.getTime()-6048e5);break;case"month":s=new Date(t.getTime()-2592e6)}return s.toISOString()}calculateTrendingScore(e,t){const s=new Date,a=new Date(t),n=(s.getTime()-a.getTime())/36e5,i=Math.max(.1,1-n/168);return 100*(.4*e+.4*(e/Math.max(1,n))+.2*i)}getDiscoverContent(e,t=20){return d(this,null,function*(){try{const s=yield this.getUserPreferences(e),r=yield this.getTrendingContent("day",2*t);return r.map(e=>o(l({},e),{personalizationScore:this.calculatePersonalizationScore(e,s)})).sort((e,t)=>t.personalizationScore-e.personalizationScore).slice(0,t).map(e=>{var t=e,{personalizationScore:s}=t;return((e,t)=>{var s={};for(var r in e)n.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&a)for(var r of a(e))t.indexOf(r)<0&&i.call(e,r)&&(s[r]=e[r]);return s})(t,["personalizationScore"])})}catch(s){return this.getTrendingContent("day",t)}})}getUserPreferences(e){return d(this,null,function*(){const{data:t}=yield m.from("posts").select("type, category").eq("user_id",e).gte("created_at",new Date(Date.now()-2592e6).toISOString()).limit(50);if(!t)return[];const s=new Set;return t.forEach(e=>{e.type&&s.add(e.type),e.category&&s.add(e.category)}),Array.from(s)})}calculatePersonalizationScore(e,t){if(0===t.length)return.5;let s=0,a=0;return t.includes(e.category)&&(s+=.4,a++),e.tags&&e.tags.forEach(e=>{t.includes(e)&&(s+=.2,a++)}),a>0?s/a:.5}};c(ge,"instance");const pe=ge.getInstance(),fe=({content:e})=>{var t;return p.jsx(v,{className:"hover:shadow-md transition-shadow",children:p.jsx(S,{className:"p-4",children:p.jsxs("div",{className:"flex items-start gap-4",children:[p.jsxs(U,{className:"h-12 w-12",children:[p.jsx(B,{src:e.image}),p.jsx(z,{children:e.title.charAt(0)})]}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[(e=>({artist:p.jsx(V,{className:"h-4 w-4"}),event:p.jsx(K,{className:"h-4 w-4"}),post:p.jsx(Z,{className:"h-4 w-4"}),group:p.jsx(Z,{className:"h-4 w-4"}),business:p.jsx(re,{className:"h-4 w-4"})}[e]||p.jsx(X,{className:"h-4 w-4"})))(e.type),p.jsx(_,{variant:"secondary",className:"text-xs",children:e.type}),p.jsxs(_,{variant:"outline",className:"text-xs text-green-600",children:[(e=>e>=1e3?`${(e/1e3).toFixed(1)}k`:Math.round(e).toString())(e.trendingScore)," trending"]}),p.jsx("h3",{className:"font-semibold truncate",children:e.title})]}),e.description&&p.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:e.description}),p.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[e.location&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(re,{className:"h-3 w-3"}),e.location.name||`${e.location.city}, ${e.location.state}`]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(ee,{className:"h-3 w-3"}),Y(new Date(e.createdAt),"MMM dd, yyyy")]})]}),p.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(M,{className:"h-3 w-3"}),e.engagement.likes]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(te,{className:"h-3 w-3"}),e.engagement.comments]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(se,{className:"h-3 w-3"}),e.engagement.shares]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(ae,{className:"h-3 w-3"}),e.engagement.views]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(X,{className:"h-3 w-3"}),e.engagement.velocity,"/hr"]})]}),(null==(t=e.metadata)?void 0:t.tags)&&Array.isArray(e.metadata.tags)&&p.jsx("div",{className:"flex gap-1 mt-2",children:e.metadata.tags.slice(0,3).map((e,t)=>p.jsx(_,{variant:"outline",className:"text-xs",children:e},t))})]}),p.jsx(f,{variant:"outline",size:"sm",children:"View"})]})})})},xe=()=>{const{trendingContent:e,loading:t,error:s,period:a,changePeriod:n,refreshTrendingContent:i}=(()=>{const[e,t]=h.useState([]),[s,a]=h.useState(!1),[n,i]=h.useState(null),[r,l]=h.useState("day"),[o,c]=h.useState(20),u=h.useCallback(()=>d(void 0,null,function*(){a(!0),i(null);try{const e=yield pe.getTrendingContent(r,o);t(e)}catch(e){i(e instanceof Error?e.message:"Failed to fetch trending content")}finally{a(!1)}}),[r,o]),m=h.useCallback(()=>{u()},[u]),g=h.useCallback(e=>{l(e)},[]),p=h.useCallback(e=>{c(e)},[]);return h.useEffect(()=>{u()},[u]),{trendingContent:e,loading:s,error:n,period:r,limit:o,fetchTrendingContent:u,refreshTrendingContent:m,changePeriod:g,changeLimit:p}})();return p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-2xl font-bold",children:"Trending Content"}),p.jsx("p",{className:"text-muted-foreground",children:"Discover what's popular in your area"})]}),p.jsx(f,{variant:"outline",onClick:i,disabled:t,children:"Refresh"})]}),p.jsxs(N,{value:a,onValueChange:e=>n(e),children:[p.jsx(b,{children:[{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}].map(e=>p.jsx(C,{value:e.value,children:e.label},e.value))}),p.jsxs(k,{value:a,className:"space-y-4",children:[s&&p.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:p.jsx("p",{className:"text-destructive text-sm",children:s})}),t&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),p.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading trending content..."})]}),!t&&0===e.length&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx(X,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold",children:"No trending content"}),p.jsx("p",{className:"text-muted-foreground",children:"Check back later for trending content in your area"})]}),p.jsx("div",{className:"grid gap-4",children:e.map(e=>p.jsx(fe,{content:e},`${e.type}-${e.id}`))})]})]})]})};class ye{static generateRecommendations(e,t,s=20){const a=t.map(t=>{const s=this.calculateRecommendationScores(e,t);return o(l({},t),{scores:s})}).sort((e,t)=>t.scores.finalScore-e.scores.finalScore);return this.applyDiversityFilter(a,s).map((t,s)=>({id:`rec_${t.id}_${s}`,userId:e.userId,contentId:t.id,contentType:t.type,score:t.scores.finalScore,reason:this.generateRecommendationReason(e,t,t.scores),algorithm:"hybrid",metadata:{collaborativeScore:t.scores.collaborativeScore,contentBasedScore:t.scores.contentBasedScore,locationScore:t.scores.locationScore,freshnessScore:t.scores.freshnessScore,diversityScore:t.scores.diversityScore},createdAt:(new Date).toISOString(),expiresAt:new Date(Date.now()+864e5).toISOString()}))}static calculateRecommendationScores(e,t){const s=this.calculateCollaborativeScore(e,t),a=this.calculateContentBasedScore(e,t),n=this.calculateLocationScore(e,t),i=this.calculateFreshnessScore(t),r=this.calculateDiversityScore(t);return{collaborativeScore:s,contentBasedScore:a,locationScore:n,freshnessScore:i,diversityScore:r,finalScore:.3*s+.25*a+.2*n+.15*i+.1*r}}static calculateCollaborativeScore(e,t){const s=this.findSimilarUsers(e);if(0===s.length)return.5;const a=s.map(e=>{const s=e.preferences.find(e=>e.category===t.category);return s?s.weight:.5}),n=a.reduce((e,t)=>e+t,0)/a.length;return Math.min(n,1)}static calculateContentBasedScore(e,t){const s=e.preferences;if(0===s.length)return.5;const a=s.find(e=>e.category===t.category);if(a)return a.weight;const n=this.extractContentFeatures(t),i=this.extractUserInterests(e),r=this.calculateFeatureSimilarity(n,i);return Math.min(r,1)}static calculateLocationScore(e,t){if(!e.location||!t.location)return.5;const s=this.calculateDistance(e.location.latitude,e.location.longitude,t.location.latitude,t.location.longitude);return Math.max(0,1-s/50)}static calculateFreshnessScore(e){const t=new Date,s=new Date(e.createdAt),a=(t.getTime()-s.getTime())/36e5,n=Math.exp(-.05*a);return Math.max(n,.1)}static calculateDiversityScore(e){return.8}static findSimilarUsers(e){return[]}static extractContentFeatures(e){const t={};if(t[`category_${e.category}`]=1,e.tags&&e.tags.forEach(e=>{t[`tag_${e}`]=1}),e.price&&(t.price_low=e.price<50?1:0,t.price_medium=e.price>=50&&e.price<200?1:0,t.price_high=e.price>=200?1:0),e.date){const s=new Date(e.date),a=new Date,n=(s.getTime()-a.getTime())/864e5;t.time_soon=n<=7?1:0,t.time_medium=n>7&&n<=30?1:0,t.time_far=n>30?1:0}return t}static extractUserInterests(e){const t={};e.preferences.forEach(e=>{t[`category_${e.category}`]=e.weight});const s={};e.behaviorHistory.forEach(e=>{const t=`${e.action}_${e.contentType}`;s[t]=(s[t]||0)+1});const a=Math.max(...Object.values(s),1);return Object.entries(s).forEach(([e,s])=>{t[e]=s/a}),t}static calculateFeatureSimilarity(e,t){const s=new Set([...Object.keys(e),...Object.keys(t)]);let a=0,n=0,i=0;return s.forEach(s=>{const r=e[s]||0,l=t[s]||0;a+=r*l,n+=r*r,i+=l*l}),0===n||0===i?0:a/(Math.sqrt(n)*Math.sqrt(i))}static applyDiversityFilter(e,t){const s=[],a=new Set,n=new Set;for(const i of e){if(s.length>=t)break;const e=!a.has(i.category)||a.size>=3,r=!n.has(i.type)||n.size>=2;e&&r&&(s.push(i),a.add(i.category),n.add(i.type))}if(s.length<t)for(const i of e){if(s.length>=t)break;s.find(e=>e.id===i.id)||s.push(i)}return s}static generateRecommendationReason(e,t,s){const a=[];if(s.contentBasedScore>.7){e.preferences.find(e=>e.category===t.category)&&a.push(`Based on your interest in ${t.category}`)}return s.locationScore>.7&&a.push("Happening near you"),s.freshnessScore>.8&&a.push("Recently added"),s.collaborativeScore>.7&&a.push("Popular with similar users"),0===a.length&&a.push("Recommended for you"),a.join(", ")}static calculateDistance(e,t,s,a){const n=this.deg2rad(s-e),i=this.deg2rad(a-t),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(s))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}static deg2rad(e){return e*(Math.PI/180)}static updateUserPreferences(e,t,s,a){const n=[...e.preferences];let i=n.find(e=>e.category===s);i||(i={id:`pref_${s}`,userId:e.userId,category:s,weight:.5,source:"behavioral",lastUpdated:(new Date).toISOString()},n.push(i));const r=this.getWeightChangeForAction(t);return i.weight=Math.max(0,Math.min(1,i.weight+r)),i.lastUpdated=(new Date).toISOString(),n}static getWeightChangeForAction(e){return{like:.1,comment:.15,share:.2,bookmark:.1,follow:.25,view:.02,search:.05}[e]||0}}const ve=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}getRecommendations(e,t=20){return d(this,null,function*(){try{const s=yield this.getUserProfile(e),a=yield this.getAvailableContent(e);return ye.generateRecommendations(s,a,t)}catch(s){return[]}})}getUserProfile(e){return d(this,null,function*(){try{const{data:t}=yield m.from("user_preferences").select("*").eq("user_id",e).single(),{data:s}=yield m.from("user_behavior").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(100);return{userId:e,preferences:t||{},behavior:s||[],interests:(null==t?void 0:t.interests)||[],location:(null==t?void 0:t.location)||null}}catch(t){return{userId:e,preferences:{},behavior:[],interests:[],location:null}}})}getAvailableContent(e){return d(this,null,function*(){try{const{data:t}=yield m.from("posts").select("*").neq("user_id",e).order("created_at",{ascending:!1}).limit(100),{data:s}=yield m.from("events").select("*").order("created_at",{ascending:!1}).limit(50),{data:a}=yield m.from("profiles").select("*").eq("is_artist",!0).neq("id",e).limit(50);return[...(t||[]).map(e=>o(l({},e),{type:"post"})),...(s||[]).map(e=>o(l({},e),{type:"event"})),...(a||[]).map(e=>o(l({},e),{type:"artist"}))]}catch(t){return[]}})}generatePreferencesFromBehavior(e){return d(this,null,function*(){const t=[],{data:s}=yield m.from("posts").select("type, category").eq("user_id",e).limit(100);if(s){const a=new Map;s.forEach(e=>{e.type&&a.set(e.type,(a.get(e.type)||0)+1),e.category&&a.set(e.category,(a.get(e.category)||0)+1)}),a.forEach((s,a)=>{t.push({id:`${e}-${a}`,userId:e,category:a,weight:Math.min(1,s/10),source:"behavioral",lastUpdated:(new Date).toISOString()})})}const{data:a}=yield m.from("post_likes").select("post_id").eq("user_id",e).limit(100);if(a)for(const n of a){const{data:s}=yield m.from("posts").select("type, category").eq("id",n.post_id).single();if(s){const a=t.find(e=>e.category===(s.type||s.category));a?a.weight+=.1:t.push({id:`${e}-${s.type||s.category}`,userId:e,category:s.type||s.category||"general",weight:.1,source:"behavioral",lastUpdated:(new Date).toISOString()})}}return t})}getContentScores(e,t){return d(this,null,function*(){const s=[],{data:a}=yield m.from("posts").select("\n        id,\n        user_id,\n        title,\n        content,\n        type,\n        category,\n        likes_count,\n        comments_count,\n        created_at\n      ").eq("status","active").neq("user_id",e).order("created_at",{ascending:!1}).limit(200);if(!a)return s;for(const n of a){const a=yield this.calculateContentScore(n,t,e);s.push(a)}return s})}calculateContentScore(e,t,s){return d(this,null,function*(){let a=0,n=0,i=0,r=0;t.forEach(t=>{e.type!==t.category&&e.category!==t.category||(a+=t.weight)});const l=(e.likes_count||0)+2*(e.comments_count||0);n=Math.min(1,l/100);const o=(Date.now()-new Date(e.created_at).getTime())/36e5;i=Math.max(0,1-o/168);const{data:c}=yield m.from("profiles").select("latitude, longitude").eq("user_id",s).single();(null==c?void 0:c.latitude)&&(null==c?void 0:c.longitude)&&(r=.5);const d=.4*a+.3*n+.2*i+.1*r;return{contentId:e.id,contentType:"post",relevanceScore:a,popularityScore:n,freshnessScore:i,locationScore:r,overallScore:d,factors:{userInterest:a,contentQuality:n,engagement:n,recency:i,proximity:r}}})}generateRecommendations(e,t,s){return d(this,null,function*(){const a=[],n=t.sort((e,t)=>t.overallScore-e.overallScore).slice(0,s);for(const t of n){const s=this.generateRecommendationReason(t);a.push({id:`${e}-${t.contentId}`,userId:e,contentId:t.contentId,contentType:t.contentType,score:t.overallScore,reason:s,algorithm:"hybrid",metadata:{relevanceScore:t.relevanceScore,popularityScore:t.popularityScore,freshnessScore:t.freshnessScore,locationScore:t.locationScore},createdAt:(new Date).toISOString(),expiresAt:new Date(Date.now()+864e5).toISOString()})}return a})}generateRecommendationReason(e){const t=[];return e.factors.userInterest>.5&&t.push("matches your interests"),e.factors.contentQuality>.7&&t.push("highly engaging content"),e.factors.recency>.8&&t.push("fresh content"),e.factors.proximity>.6&&t.push("local to you"),0===t.length?"trending in your area":t.join(", ")}updateUserPreferences(e,t,s){return d(this,null,function*(){yield m.from("user_preferences").upsert({user_id:e,category:t,weight:s,source:"explicit",last_updated:(new Date).toISOString()})})}trackUserBehavior(e,t,s,a){return d(this,null,function*(){yield m.from("user_behavior").insert({user_id:e,action:t,content_type:s,content_id:a,metadata:{},timestamp:(new Date).toISOString(),session_id:`session-${Date.now()}`})})}};c(ve,"instance");const je=ve.getInstance(),we=({recommendation:e})=>p.jsx(v,{className:"hover:shadow-md transition-shadow border-l-4 border-l-primary",children:p.jsx(S,{className:"p-4",children:p.jsxs("div",{className:"flex items-start gap-4",children:[p.jsx(U,{className:"h-12 w-12",children:p.jsx(z,{children:e.contentType.charAt(0).toUpperCase()})}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[(e=>({artist:p.jsx(V,{className:"h-4 w-4"}),event:p.jsx(K,{className:"h-4 w-4"}),post:p.jsx(Z,{className:"h-4 w-4"}),group:p.jsx(Z,{className:"h-4 w-4"}),business:p.jsx(re,{className:"h-4 w-4"})}[e]||p.jsx(W,{className:"h-4 w-4"})))(e.contentType),p.jsx(_,{variant:"secondary",className:"text-xs",children:e.contentType}),p.jsxs(_,{variant:"outline",className:"text-xs text-blue-600",children:[(e=>Math.round(100*e))(e.score),"% match"]}),p.jsx("h3",{className:"font-semibold truncate",children:"Recommended Content"})]}),p.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:e.reason}),p.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(W,{className:"h-3 w-3"}),e.algorithm]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(ee,{className:"h-3 w-3"}),Y(new Date(e.createdAt),"MMM dd, yyyy")]})]}),e.metadata&&p.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.metadata.relevanceScore&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(M,{className:"h-3 w-3"}),Math.round(100*e.metadata.relevanceScore),"% relevant"]}),e.metadata.popularityScore&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(te,{className:"h-3 w-3"}),Math.round(100*e.metadata.popularityScore),"% popular"]}),e.metadata.freshnessScore&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(ee,{className:"h-3 w-3"}),Math.round(100*e.metadata.freshnessScore),"% fresh"]})]})]}),p.jsxs("div",{className:"flex flex-col gap-2",children:[p.jsx(f,{variant:"outline",size:"sm",children:"View"}),p.jsx(f,{variant:"ghost",size:"sm",children:p.jsx(M,{className:"h-3 w-3"})})]})]})})}),Se=()=>{const{recommendations:e,loading:t,error:s,refreshRecommendations:a}=(()=>{const[e,t]=h.useState([]),[s,a]=h.useState(!1),[n,i]=h.useState(null),[r,l]=h.useState(20),{user:o}=g(),c=h.useCallback(()=>d(void 0,null,function*(){if(o){a(!0),i(null);try{const e=yield je.getRecommendations(o.id,r);t(e)}catch(e){i(e instanceof Error?e.message:"Failed to fetch recommendations")}finally{a(!1)}}else t([])}),[o,r]),u=h.useCallback(()=>{c()},[c]),m=h.useCallback((e,t)=>d(void 0,null,function*(){if(o)try{yield je.updateUserPreferences(o.id,e,t),yield c()}catch(s){}}),[o,c]),p=h.useCallback((e,t,s)=>d(void 0,null,function*(){if(o)try{yield je.trackUserBehavior(o.id,e,t,s)}catch(a){}}),[o]),f=h.useCallback(e=>{l(e)},[]);return h.useEffect(()=>{c()},[c]),{recommendations:e,loading:s,error:n,limit:r,fetchRecommendations:c,refreshRecommendations:u,updateUserPreference:m,trackUserBehavior:p,changeLimit:f}})();return p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-2xl font-bold",children:"Recommended for You"}),p.jsx("p",{className:"text-muted-foreground",children:"Personalized content based on your interests and behavior"})]}),p.jsxs(f,{variant:"outline",onClick:a,disabled:t,children:[p.jsx(ne,{className:"h-4 w-4 mr-2 "+(t?"animate-spin":"")}),"Refresh"]})]}),s&&p.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:p.jsx("p",{className:"text-destructive text-sm",children:s})}),t&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),p.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading recommendations..."})]}),!t&&0===e.length&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx(W,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold",children:"No recommendations yet"}),p.jsx("p",{className:"text-muted-foreground",children:"Start exploring content to get personalized recommendations"})]}),p.jsx("div",{className:"grid gap-4",children:e.map(e=>p.jsx(we,{recommendation:e},e.id))})]})};class _e{static generateFollowSuggestions(e,t,s,a,n,i=20){return n.filter(t=>t.id!==e&&!a.includes(t.id)).map(a=>{const i=this.calculateFollowRecommendationScores(e,t,s,a,n);return o(l({},a),{scores:i})}).sort((e,t)=>t.scores.finalScore-e.scores.finalScore).slice(0,i).map((s,a)=>({id:`suggestion_${s.id}_${a}`,userId:s.id,displayName:s.display_name||s.username||"Anonymous",avatarUrl:s.avatar_url,bio:s.bio||"",score:s.scores.finalScore,commonInterests:this.findCommonInterests(t,s.interests||[]),mutualFollowers:this.countMutualFollowers(e,s.id,n),location:s.location?{city:s.location.city||"",state:s.location.state||""}:null,reason:this.generateFollowReason(s.scores,s),createdAt:(new Date).toISOString()}))}static calculateFollowRecommendationScores(e,t,s,a,n){const i=this.calculateSimilarityScore(t,a.interests||[]),r=this.calculateMutualConnectionsScore(e,a.id,n),l=this.calculateActivityScore(a),o=this.calculateLocationScore(s,a.location),c=this.calculateInterestOverlapScore(t,a.interests||[]);return{similarityScore:i,mutualConnectionsScore:r,activityScore:l,locationScore:o,interestOverlapScore:c,finalScore:.25*i+.3*r+.2*l+.15*o+.1*c}}static calculateSimilarityScore(e,t){if(0===e.length||0===t.length)return.5;const s=this.findCommonInterests(e,t).length/Math.max(e.length,t.length);return Math.min(s,1)}static calculateMutualConnectionsScore(e,t,s){const a=this.countMutualFollowers(e,t,s);return Math.min(a/50,1)}static calculateActivityScore(e){let t=.5;if(e.posts_count){t+=.2*Math.min(e.posts_count/100,1)}if(e.events_created_count){t+=.2*Math.min(e.events_created_count/20,1)}if(e.last_activity){const s=((new Date).getTime()-new Date(e.last_activity).getTime())/864e5;s<=7?t+=.3:s<=30?t+=.2:s<=90&&(t+=.1)}return Math.min(t,1)}static calculateLocationScore(e,t){if(!e||!t)return.5;if(e.city===t.city)return 1;if(e.state===t.state)return.7;if(t.latitude&&t.longitude){const s=this.calculateDistance(e.latitude,e.longitude,t.latitude,t.longitude),a=100;return Math.max(0,1-s/a)}return.3}static calculateInterestOverlapScore(e,t){if(0===e.length||0===t.length)return.5;const s=this.findCommonInterests(e,t).length/Math.min(e.length,t.length);return Math.min(s,1)}static findCommonInterests(e,t){const s=e.map(e=>e.toLowerCase()),a=t.map(e=>e.toLowerCase());return s.filter(e=>a.includes(e))}static countMutualFollowers(e,t,s){const a=s.find(t=>t.id===e),n=s.find(e=>e.id===t);if(!a||!n)return 0;const i=a.followers_count||0,r=n.followers_count||0,l=Math.min(i,r);return Math.floor(.1*l)}static calculateDistance(e,t,s,a){const n=this.deg2rad(s-e),i=this.deg2rad(a-t),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(s))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}static deg2rad(e){return e*(Math.PI/180)}static generateFollowReason(e,t){const s=[];if(e.similarityScore>.7&&s.push("Similar interests"),e.mutualConnectionsScore>.5){const t=Math.floor(50*e.mutualConnectionsScore);s.push(`${t} mutual connections`)}return e.activityScore>.7?s.push("Very active"):e.activityScore>.5&&s.push("Active user"),e.locationScore>.8?s.push("Same city"):e.locationScore>.6&&s.push("Nearby"),e.interestOverlapScore>.6&&s.push("Shared interests"),0===s.length&&s.push("Recommended for you"),s.join(", ")}static getPopularUsers(e,t=10){return e.filter(e=>e.followers_count>0).sort((e,t)=>(t.followers_count||0)-(e.followers_count||0)).slice(0,t)}static getUsersByInterest(e,t,s=10){const a=t.toLowerCase();return e.filter(e=>(e.interests||[]).some(e=>e.toLowerCase().includes(a))).sort((e,t)=>(t.followers_count||0)-(e.followers_count||0)).slice(0,s)}static calculateFollowStats(e,t,s){const a=t.length,n=s.length,i=t.filter(e=>s.some(t=>t.id===e.id)).length,r=t.reduce((e,t)=>e+(t.engagement_count||0),0),l=a>0?r/a:0,o=new Date(Date.now()-2592e6),c=t.filter(e=>new Date(e.followed_at||e.created_at)>o).length;return{userId:e,totalFollowers:a,totalFollowing:n,mutualFollowers:i,engagementRate:l,growthRate:a>0?c/a:0,lastUpdated:(new Date).toISOString()}}static analyzeFollowNetwork(e,t,s){const a=new Set([...t.map(e=>e.id),...s.map(e=>e.id)]).size,n=a*(a-1)/2,i=t.length+s.length,r=n>0?i/n:0,l=[...t,...s].filter(e=>(e.followers_count||0)>1e3).length,o=[...t,...s].flatMap(e=>e.interests||[]),c={};o.forEach(e=>{c[e]=(c[e]||0)+1});const d=Object.entries(c).filter(([e,t])=>t>1).sort(([e,t],[s,a])=>a-t).slice(0,5).map(([e,t])=>e),u=[];return r<.1&&u.push("Consider following more people to expand your network"),l<5&&u.push("Connect with more influential users in your field"),d.length<3&&u.push("Diversify your interests to connect with more people"),{networkSize:a,networkDensity:r,influentialConnections:l,commonInterests:d,recommendations:u}}}const Ne=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}followUser(e,t){return d(this,null,function*(){const{data:s,error:a}=yield m.from("user_follows").insert({follower_id:e,following_id:t,status:"active",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).select().single();if(a)throw new Error(`Failed to follow user: ${a.message}`);return s})}unfollowUser(e,t){return d(this,null,function*(){const{error:s}=yield m.from("user_follows").delete().eq("follower_id",e).eq("following_id",t);if(s)throw new Error(`Failed to unfollow user: ${s.message}`)})}getFollowStatus(e,t){return d(this,null,function*(){const{data:s}=yield m.from("user_follows").select("status").eq("follower_id",e).eq("following_id",t).single();return s?s.status:"not_following"})}getFollowers(e,t=20){return d(this,null,function*(){const{data:s}=yield m.from("user_follows").select("\n        *,\n        follower:profiles!user_follows_follower_id_fkey(\n          user_id,\n          display_name,\n          avatar_url,\n          bio\n        )\n      ").eq("following_id",e).eq("status","active").order("created_at",{ascending:!1}).limit(t);return s||[]})}getFollowing(e,t=20){return d(this,null,function*(){const{data:s}=yield m.from("user_follows").select("\n        *,\n        following:profiles!user_follows_following_id_fkey(\n          user_id,\n          display_name,\n          avatar_url,\n          bio\n        )\n      ").eq("follower_id",e).eq("status","active").order("created_at",{ascending:!1}).limit(t);return s||[]})}getFollowStats(e){return d(this,null,function*(){const{count:t}=yield m.from("user_follows").select("*",{count:"exact",head:!0}).eq("following_id",e).eq("status","active"),{count:s}=yield m.from("user_follows").select("*",{count:"exact",head:!0}).eq("follower_id",e).eq("status","active"),{data:a}=yield m.from("user_follows").select("follower_id").eq("following_id",e).eq("status","active"),{data:n}=yield m.from("user_follows").select("following_id").eq("follower_id",e).eq("status","active");return _e.calculateFollowStats(e,a||[],n||[])})}getFollowSuggestions(e,t=10){return d(this,null,function*(){try{const s=yield this.getUserProfile(e),a=yield this.getAllUsers(e);return _e.generateFollowSuggestions(e,s.interests,s.location,this.getExistingFollows(e),a,t)}catch(s){return[]}})}getPopularUsers(e=10){return d(this,null,function*(){try{const{data:t}=yield m.from("profiles").select("\n          user_id,\n          display_name,\n          avatar_url,\n          bio,\n          location_city,\n          location_state\n        ").order("created_at",{ascending:!1}).limit(2*e);if(!t)return[];const s=[];for(const e of t){const{count:t}=yield m.from("user_follows").select("*",{count:"exact",head:!0}).eq("following_id",e.user_id).eq("status","active");t&&t>5&&s.push({userId:e.user_id,displayName:e.display_name||"Anonymous",avatarUrl:e.avatar_url,bio:e.bio,mutualFollowers:0,commonInterests:[],location:e.location_city?{city:e.location_city,state:e.location_state||""}:void 0,score:t,reason:"Popular in your area"})}return s.sort((e,t)=>t.score-e.score).slice(0,e)}catch(t){return[]}})}getUsersByInterest(e,t=10){return d(this,null,function*(){try{const{data:s}=yield m.from("posts").select("user_id").or(`content.ilike.%${e}%,title.ilike.%${e}%`).eq("status","active").limit(100);if(!s)return[];const a=[...new Set(s.map(e=>e.user_id))];if(0===a.length)return[];const{data:n}=yield m.from("profiles").select("\n          user_id,\n          display_name,\n          avatar_url,\n          bio,\n          location_city,\n          location_state\n        ").in("user_id",a).limit(t);return n?n.map(t=>({userId:t.user_id,displayName:t.display_name||"Anonymous",avatarUrl:t.avatar_url,bio:t.bio,mutualFollowers:0,commonInterests:[e],location:t.location_city?{city:t.location_city,state:t.location_state||""}:void 0,score:1,reason:`Interested in ${e}`})):[]}catch(s){return[]}})}getUserProfile(e){return d(this,null,function*(){try{const{data:t}=yield m.from("profiles").select("*").eq("id",e).single(),{data:s}=yield m.from("user_preferences").select("*").eq("user_id",e).single();return{id:e,interests:(null==s?void 0:s.interests)||[],location:(null==t?void 0:t.location)||null,skills:(null==t?void 0:t.skills)||[],bio:(null==t?void 0:t.bio)||""}}catch(t){return{id:e,interests:[],location:null,skills:[],bio:""}}})}getAllUsers(e){return d(this,null,function*(){try{const{data:t}=yield m.from("user_follows").select("following_id").eq("follower_id",e).eq("status","active"),s=(null==t?void 0:t.map(e=>e.following_id))||[],{data:a}=yield m.from("profiles").select("*").neq("id",e).not("id","in",`(${s.join(",")})`);return a||[]}catch(t){return[]}})}getExistingFollows(e){return[]}};c(Ne,"instance");const be=Ne.getInstance(),Ce=()=>{const[e,t]=h.useState([]),[s,a]=h.useState([]),[n,i]=h.useState(null),[r,l]=h.useState([]),[o,c]=h.useState(!1),[u,m]=h.useState(null),{user:p}=g(),f=h.useCallback(e=>d(void 0,null,function*(){if(!p&&!e)return;const s=e||p.id;c(!0),m(null);try{const e=yield be.getFollowers(s);t(e)}catch(a){m(a instanceof Error?a.message:"Failed to fetch followers")}finally{c(!1)}}),[p]),x=h.useCallback(e=>d(void 0,null,function*(){if(!p&&!e)return;const t=e||p.id;c(!0),m(null);try{const e=yield be.getFollowing(t);a(e)}catch(s){m(s instanceof Error?s.message:"Failed to fetch following")}finally{c(!1)}}),[p]),y=h.useCallback(e=>d(void 0,null,function*(){if(!p&&!e)return;const t=e||p.id;c(!0),m(null);try{const e=yield be.getFollowStats(t);i(e)}catch(s){m(s instanceof Error?s.message:"Failed to fetch follow stats")}finally{c(!1)}}),[p]),v=h.useCallback(()=>d(void 0,null,function*(){if(p){c(!0),m(null);try{const e=yield be.getFollowSuggestions(p.id);l(e)}catch(e){m(e instanceof Error?e.message:"Failed to fetch suggestions")}finally{c(!1)}}}),[p]),j=h.useCallback(e=>d(void 0,null,function*(){if(p){c(!0),m(null);try{yield be.followUser(p.id,e),a(t=>[...t,{id:`${p.id}-${e}`,followerId:p.id,followingId:e,status:"active",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}]),yield y()}catch(t){m(t instanceof Error?t.message:"Failed to follow user")}finally{c(!1)}}}),[p,y]),w=h.useCallback(e=>d(void 0,null,function*(){if(p){c(!0),m(null);try{yield be.unfollowUser(p.id,e),a(t=>t.filter(t=>t.followingId!==e)),yield y()}catch(t){m(t instanceof Error?t.message:"Failed to unfollow user")}finally{c(!1)}}}),[p,y]),S=h.useCallback(e=>d(void 0,null,function*(){if(!p)return"not_following";try{return yield be.getFollowStatus(p.id,e)}catch(t){return"not_following"}}),[p]),_=h.useCallback((e=10)=>d(void 0,null,function*(){c(!0),m(null);try{return yield be.getPopularUsers(e)}catch(t){return m(t instanceof Error?t.message:"Failed to fetch popular users"),[]}finally{c(!1)}}),[]),N=h.useCallback((e,t=10)=>d(void 0,null,function*(){c(!0),m(null);try{return yield be.getUsersByInterest(e,t)}catch(s){return m(s instanceof Error?s.message:"Failed to fetch users by interest"),[]}finally{c(!1)}}),[]),b=h.useCallback(e=>d(void 0,null,function*(){if(!p&&!e)return;const t=e||p.id;yield Promise.all([f(t),x(t),y(t)]),e||(yield v())}),[p,f,x,y,v]);return h.useEffect(()=>{p&&b()},[p,b]),{followers:e,following:s,followStats:n,suggestions:r,loading:o,error:u,fetchFollowers:f,fetchFollowing:x,fetchFollowStats:y,fetchSuggestions:v,followUser:j,unfollowUser:w,getFollowStatus:S,getPopularUsers:_,getUsersByInterest:N,refreshAll:b}},ke=({suggestion:e})=>{const{followUser:t,loading:s}=Ce();return p.jsx(v,{className:"hover:shadow-md transition-shadow",children:p.jsx(S,{className:"p-4",children:p.jsxs("div",{className:"flex items-start gap-4",children:[p.jsxs(U,{className:"h-12 w-12",children:[p.jsx(B,{src:e.avatarUrl}),p.jsx(z,{children:e.displayName.charAt(0)})]}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("h3",{className:"font-semibold truncate",children:e.displayName}),p.jsxs(_,{variant:"outline",className:"text-xs",children:[Math.round(e.score),"% match"]})]}),e.bio&&p.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:e.bio}),p.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-2",children:[e.location&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(G,{className:"h-3 w-3"}),e.location.city,", ",e.location.state]}),e.mutualFollowers>0&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(Z,{className:"h-3 w-3"}),e.mutualFollowers," mutual"]})]}),e.commonInterests.length>0&&p.jsx("div",{className:"flex gap-1 mb-2",children:e.commonInterests.slice(0,3).map((e,t)=>p.jsx(_,{variant:"outline",className:"text-xs",children:e},t))}),p.jsx("p",{className:"text-xs text-muted-foreground",children:e.reason})]}),p.jsxs(f,{variant:"outline",size:"sm",onClick:()=>d(void 0,null,function*(){yield t(e.userId)}),disabled:s,children:[p.jsx(ie,{className:"h-3 w-3 mr-1"}),"Follow"]})]})})})},Me=()=>{const{suggestions:e,loading:t,error:s,fetchSuggestions:a}=Ce();return p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-2xl font-bold",children:"People to Follow"}),p.jsx("p",{className:"text-muted-foreground",children:"Discover people with similar interests"})]}),p.jsxs(f,{variant:"outline",onClick:a,disabled:t,children:[p.jsx(ne,{className:"h-4 w-4 mr-2 "+(t?"animate-spin":"")}),"Refresh"]})]}),s&&p.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:p.jsx("p",{className:"text-destructive text-sm",children:s})}),t&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),p.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading suggestions..."})]}),!t&&0===e.length&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx(Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold",children:"No suggestions yet"}),p.jsx("p",{className:"text-muted-foreground",children:"Start following people to get personalized suggestions"})]}),p.jsx("div",{className:"grid gap-4",children:e.map(e=>p.jsx(ke,{suggestion:e},e.userId))})]})},De=()=>{const{toast:e}=y(),{currentLocation:t,isEnabled:s}=F(),[a,n]=h.useState("search"),[i,r]=h.useState([]),[l,o]=h.useState([]),[c,u]=h.useState([]),[g,x]=h.useState(!0);h.useEffect(()=>{M(),I()},[t,s]);const M=()=>d(void 0,null,function*(){try{x(!0);const{data:e,error:a}=yield m.functions.invoke("fetch-local-news",{body:{location:t?"Your Area":"Local Area",latitude:null==t?void 0:t.latitude,longitude:null==t?void 0:t.longitude,radius:50}});a?r([{title:"Local Community Updates",description:"Stay connected with your local community and discover what's happening around you.",url:"#",source:"Local News",publishedAt:(new Date).toISOString(),category:"General"},{title:"Community Events This Week",description:"Find exciting events and activities happening in your neighborhood this week.",url:"#",source:"Community Events",publishedAt:new Date(Date.now()-72e5).toISOString(),category:"Events"}]):e&&e.news?r(e.news.slice(0,5)):r([{title:"Local Community Updates",description:"Stay connected with your local community and discover what's happening around you.",url:"#",source:"Local News",publishedAt:(new Date).toISOString(),category:"General"},{title:"Community Events This Week",description:"Find exciting events and activities happening in your neighborhood this week.",url:"#",source:"Community Events",publishedAt:new Date(Date.now()-72e5).toISOString(),category:"Events"}]);try{const{data:e}=yield m.from("events").select("*").gte("event_date",(new Date).toISOString().split("T")[0]).order("event_date",{ascending:!0}).limit(6);e&&o(e.map(e=>({id:e.id,title:e.title,description:e.description,location:e.location_name,date:e.event_date,category:e.category,price:e.price?`$${e.price}`:"Free"})))}catch(s){o([{id:"1",title:"Community Meetup",description:"Join us for a friendly community gathering",location:"Local Community Center",date:new Date(Date.now()+6048e5).toISOString(),category:"Community",price:"Free"}])}}catch(a){e({title:"Error",description:"Failed to load local content",variant:"destructive"})}finally{x(!1)}}),I=()=>d(void 0,null,function*(){try{const{data:e}=yield m.from("events").select("\n          id,\n          title,\n          description,\n          category,\n          max_attendees,\n          event_date,\n          image_url\n        ").gte("event_date",(new Date).toISOString().split("T")[0]).order("max_attendees",{ascending:!1}).limit(3),{data:t}=yield m.from("artists").select("\n          id,\n          user_id,\n          specialty,\n          bio\n        ").eq("is_available",!0).limit(3),{data:s}=yield m.from("posts").select("\n          id,\n          user_id,\n          title,\n          content,\n          type,\n          likes_count\n        ").eq("status","active").order("likes_count",{ascending:!1}).limit(3),a=[...(null==e?void 0:e.map(e=>({id:e.id,type:"event",title:e.title,description:e.description,engagement:e.max_attendees||0,image:e.image_url})))||[],...(null==t?void 0:t.map(e=>{var t;return{id:e.id,type:"artist",title:"Artist Profile",description:e.bio||(null==(t=e.specialty)?void 0:t.join(", "))||"",engagement:0,image:void 0}}))||[],...(null==s?void 0:s.map(e=>({id:e.id,type:"post",title:e.title||"Untitled Post",description:e.content.substring(0,100)+"...",engagement:e.likes_count||0,image:void 0})))||[]];u(a)}catch(e){}});return p.jsx(D,{children:p.jsxs("div",{className:"container mx-auto px-4 py-6",children:[p.jsxs("div",{className:"mb-8",children:[p.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Discover Local"}),p.jsx("p",{className:"text-muted-foreground",children:"Explore what's happening in your area and connect with your community"})]}),p.jsxs(N,{value:a,onValueChange:n,className:"space-y-6",children:[p.jsxs(b,{className:"grid w-full grid-cols-6",children:[p.jsx(C,{value:"search",children:"Search"}),p.jsx(C,{value:"trending",children:"Trending"}),p.jsx(C,{value:"recommendations",children:"For You"}),p.jsx(C,{value:"follow",children:"People"}),p.jsx(C,{value:"events",children:"Local Events"}),p.jsx(C,{value:"news",children:"Local News"})]}),p.jsx(k,{value:"search",className:"space-y-6",children:p.jsx(me,{})}),p.jsx(k,{value:"trending",className:"space-y-6",children:p.jsx(xe,{})}),p.jsx(k,{value:"recommendations",className:"space-y-6",children:p.jsx(Se,{})}),p.jsx(k,{value:"follow",className:"space-y-6",children:p.jsx(Me,{})}),p.jsxs(k,{value:"events",className:"space-y-6",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h2",{className:"text-2xl font-semibold",children:"Nearby Events"}),p.jsx(f,{variant:"outline",onClick:()=>window.location.href="/events",children:"View All Events"})]}),g?p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,t)=>p.jsxs(v,{className:"animate-pulse",children:[p.jsx(j,{children:p.jsx("div",{className:"h-4 bg-muted rounded w-3/4"})}),p.jsxs(S,{children:[p.jsx("div",{className:"h-3 bg-muted rounded w-full mb-2"}),p.jsx("div",{className:"h-3 bg-muted rounded w-2/3"})]})]},t))}):p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(e=>p.jsxs(v,{className:"hover:shadow-md transition-shadow",children:[p.jsxs(j,{children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx(_,{variant:"outline",children:e.category}),p.jsx("span",{className:"text-sm font-medium text-green-600",children:e.price})]}),p.jsx(w,{className:"text-lg",children:e.title})]}),p.jsxs(S,{children:[p.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.description}),p.jsxs("div",{className:"space-y-2 text-sm",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),p.jsx("span",{children:e.location})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(K,{className:"h-4 w-4 text-muted-foreground"}),p.jsx("span",{children:Y(new Date(e.date),"MMM dd, yyyy")})]})]})]})]},e.id))})]}),p.jsxs(k,{value:"news",className:"space-y-6",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h2",{className:"text-2xl font-semibold",children:"Local News"}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(f,{variant:"outline",onClick:M,disabled:g,size:"sm",children:g?"Loading...":"Refresh"}),p.jsx(f,{variant:"outline",onClick:()=>window.open("https://news.google.com","_blank"),children:"More News"})]})]}),g?p.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,t)=>p.jsx(v,{className:"animate-pulse",children:p.jsx(S,{className:"p-4",children:p.jsx("div",{className:"flex items-start gap-4",children:p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx("div",{className:"h-5 bg-muted rounded w-16"}),p.jsx("div",{className:"h-4 bg-muted rounded w-20"})]}),p.jsx("div",{className:"h-5 bg-muted rounded w-3/4 mb-2"}),p.jsx("div",{className:"h-4 bg-muted rounded w-full mb-3"}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("div",{className:"h-4 bg-muted rounded w-20"}),p.jsx("div",{className:"h-8 bg-muted rounded w-16"})]})]})})})},t))}):i.length>0?p.jsx("div",{className:"space-y-4",children:i.map((e,t)=>p.jsx(v,{className:"hover:shadow-md transition-shadow",children:p.jsx(S,{className:"p-4",children:p.jsx("div",{className:"flex items-start gap-4",children:p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx(_,{variant:"outline",className:"text-xs",children:e.category}),p.jsx("span",{className:"text-xs text-muted-foreground",children:e.source})]}),p.jsx("h3",{className:"font-semibold mb-2",children:e.title}),p.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.description}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-xs text-muted-foreground",children:Y(new Date(e.publishedAt),"MMM dd, yyyy")}),p.jsxs(f,{variant:"outline",size:"sm",onClick:()=>window.open(e.url,"_blank"),children:[p.jsx(R,{className:"h-3 w-3 mr-1"}),"Read"]})]})]})})})},t))}):p.jsx(v,{className:"text-center py-12",children:p.jsxs(S,{children:[p.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:p.jsx(G,{className:"w-8 h-8 text-muted-foreground"})}),p.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Local News Available"}),p.jsx("p",{className:"text-muted-foreground mb-4",children:"Enable location services to get personalized local news, or check back later for updates."}),p.jsx(f,{variant:"outline",onClick:M,disabled:g,children:g?"Loading...":"Refresh News"})]})})]})]})]})})};export{De as default};
