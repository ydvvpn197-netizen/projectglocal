import{K as p,N as v,O as g,P as _,S as m,R as T,T as w}from"./chunk-BlluHz2J.js";const O="2.58.0";let f="";typeof Deno!="undefined"?f="deno":typeof document!="undefined"?f="web":typeof navigator!="undefined"&&navigator.product==="ReactNative"?f="react-native":f="node";const A={"X-Client-Info":`supabase-js-${f}/${O}`},y={headers:A},U={schema:"public"},S={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},E={};var j=function(i,e,t,s){function u(a){return a instanceof t?a:new t(function(r){r(a)})}return new(t||(t=Promise))(function(a,r){function o(n){try{c(s.next(n))}catch(h){r(h)}}function l(n){try{c(s.throw(n))}catch(h){r(h)}}function c(n){n.done?a(n.value):u(n.value).then(o,l)}c((s=s.apply(i,e||[])).next())})};const k=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=v:e=fetch,(...t)=>e(...t)},C=()=>typeof Headers=="undefined"?p:Headers,L=(i,e,t)=>{const s=k(t),u=C();return(a,r)=>j(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:i;let c=new u(r==null?void 0:r.headers);return c.has("apikey")||c.set("apikey",i),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(a,Object.assign(Object.assign({},r),{headers:c}))})};var R=function(i,e,t,s){function u(a){return a instanceof t?a:new t(function(r){r(a)})}return new(t||(t=Promise))(function(a,r){function o(n){try{c(s.next(n))}catch(h){r(h)}}function l(n){try{c(s.throw(n))}catch(h){r(h)}}function c(n){n.done?a(n.value):u(n.value).then(o,l)}c((s=s.apply(i,e||[])).next())})};function D(i){return i.endsWith("/")?i:i+"/"}function I(i,e){var t,s;const{db:u,auth:a,realtime:r,global:o}=i,{db:l,auth:c,realtime:n,global:h}=e,d={db:Object.assign(Object.assign({},l),u),auth:Object.assign(Object.assign({},c),a),realtime:Object.assign(Object.assign({},n),r),storage:{},global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(s=o==null?void 0:o.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>R(this,void 0,void 0,function*(){return""})};return i.accessToken?d.accessToken=i.accessToken:delete d.accessToken,d}function N(i){const e=i==null?void 0:i.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(D(e))}catch(t){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}class F extends g{constructor(e){super(e)}}var H=function(i,e,t,s){function u(a){return a instanceof t?a:new t(function(r){r(a)})}return new(t||(t=Promise))(function(a,r){function o(n){try{c(s.next(n))}catch(h){r(h)}}function l(n){try{c(s.throw(n))}catch(h){r(h)}}function c(n){n.done?a(n.value):u(n.value).then(o,l)}c((s=s.apply(i,e||[])).next())})};class K{constructor(e,t,s){var u,a,r;this.supabaseUrl=e,this.supabaseKey=t;const o=N(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const l=`sb-${o.hostname.split(".")[0]}-auth-token`,c={db:U,realtime:E,auth:Object.assign(Object.assign({},S),{storageKey:l}),global:y},n=I(s!=null?s:{},c);this.storageKey=(u=n.auth.storageKey)!==null&&u!==void 0?u:"",this.headers=(a=n.global.headers)!==null&&a!==void 0?a:{},n.accessToken?(this.accessToken=n.accessToken,this.auth=new Proxy({},{get:(h,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((r=n.auth)!==null&&r!==void 0?r:{},this.headers,n.global.fetch),this.fetch=L(t,this._getAccessToken.bind(this),n.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},n.realtime)),this.rest=new _(new URL("rest/v1",o).href,{headers:this.headers,schema:n.db.schema,fetch:this.fetch}),this.storage=new m(this.storageUrl.href,this.headers,this.fetch,s==null?void 0:s.storage),n.accessToken||this._listenForAuthEvents()}get functions(){return new T(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return H(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:u,userStorage:a,storageKey:r,flowType:o,lock:l,debug:c},n,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new F({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),n),storageKey:r,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:u,userStorage:a,flowType:o,lock:l,debug:c,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(b=>b.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new w(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const P=(i,e,t)=>new K(i,e,t);function $(){if(typeof window!="undefined"||typeof process=="undefined")return!1;const i=process.version;if(i==null)return!1;const e=i.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}$()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");export{P as c};
