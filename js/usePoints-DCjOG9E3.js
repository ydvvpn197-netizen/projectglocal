var e=(e,t,r)=>new Promise((a,n)=>{var l=e=>{try{i(r.next(e))}catch(t){n(t)}},s=e=>{try{i(r.throw(e))}catch(t){n(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,s);i((r=r.apply(e,t)).next())});import{c as t,u as r,r as a,s as n}from"./index-BG6xRDTV.js";import{P as l}from"./pointsService-C20UiP1E.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s=t("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]),i=t("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),o=t("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),u=()=>{const{user:t}=r(),[s,i]=a.useState(null),[o,u]=a.useState(!0),[c,d]=a.useState(null),[h,y]=a.useState([]),[b,p]=a.useState(!1),[f,v]=a.useState(null),[k,g]=a.useState([]),[m,P]=a.useState(!1),[S,C]=a.useState(null),[M,E]=a.useState(null),x=a.useCallback(()=>e(void 0,null,function*(){if(!t)return i(null),void u(!1);try{u(!0),d(null);const e=yield l.getCurrentUserPoints();i(e)}catch(e){d(e instanceof Error?e.message:"Failed to load user points")}finally{u(!1)}}),[t]),_=a.useCallback((t=5)=>e(void 0,null,function*(){try{p(!0),v(null);const e=yield l.getLeaderboard({limit:t});y(e)}catch(e){v(e instanceof Error?e.message:"Failed to load leaderboard")}finally{p(!1)}}),[]),q=a.useCallback(r=>e(void 0,null,function*(){if(t)try{P(!0),C(null);const e=yield l.getCurrentUserPointHistory(r);g(e)}catch(e){C(e instanceof Error?e.message:"Failed to load point history")}finally{P(!1)}}),[t]),H=a.useCallback((r,a,n,s,i)=>e(void 0,null,function*(){if(!t)return!1;try{const e=yield l.addPoints(t.id,r,a,n,s,i);return e&&(yield x()),e}catch(e){return!1}}),[t,x]),L=a.useCallback(r=>e(void 0,null,function*(){if(!t)return!1;try{const e=yield l.handleEventAttendance(r,t.id);return e&&(yield x()),e}catch(e){return!1}}),[t,x]),w=a.useCallback(r=>e(void 0,null,function*(){if(!t)return!1;try{const e=yield l.handleEventOrganization(r,t.id);return e&&(yield x()),e}catch(e){return!1}}),[t,x]),z=a.useCallback(r=>e(void 0,null,function*(){if(!t)return!1;try{const e=yield l.handlePollCreation(r,t.id);return e&&(yield x()),e}catch(e){return!1}}),[t,x]),U=a.useCallback(r=>e(void 0,null,function*(){if(!t)return!1;try{const e=yield l.handlePostSharing(r,t.id);return e&&(yield x()),e}catch(e){return!1}}),[t,x]),F=a.useCallback(()=>{if(!t)return;const e=n.channel("user_points_changes").on("postgres_changes",{event:"*",schema:"public",table:"user_points",filter:`user_id=eq.${t.id}`},e=>{x()}).subscribe(),r=n.channel("leaderboard_changes").on("postgres_changes",{event:"*",schema:"public",table:"community_leaderboard"},e=>{_()}).subscribe();E({userPointsSubscription:e,leaderboardSubscription:r})},[t,x,_]),T=a.useCallback(()=>{var e,t;M&&(null==(e=M.userPointsSubscription)||e.unsubscribe(),null==(t=M.leaderboardSubscription)||t.unsubscribe(),E(null))},[M]);return a.useEffect(()=>{t?(x(),_(),q()):(i(null),y([]),g([]),u(!1))},[t,x,_,q]),a.useEffect(()=>()=>{T()},[T]),{userPoints:s,loading:o,error:c,leaderboard:h,leaderboardLoading:b,leaderboardError:f,pointHistory:k,historyLoading:m,historyError:S,refreshUserPoints:x,refreshLeaderboard:_,refreshPointHistory:q,addPoints:H,handleEventAttendance:L,handleEventOrganization:w,handlePollCreation:z,handlePostSharing:U,subscribeToPointsUpdates:F,unsubscribeFromPointsUpdates:T}};
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{s as M,o as T,i as a,u};
