var M=Object.defineProperty,z=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var T=(s,e,r)=>e in s?M(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r,y=(s,e)=>{for(var r in e||(e={}))$.call(e,r)&&T(s,r,e[r]);if(D)for(var r of D(e))K.call(e,r)&&T(s,r,e[r]);return s},p=(s,e)=>z(s,W(e));var E=(s,e,r)=>T(s,typeof e!="symbol"?e+"":e,r);var g=(s,e,r)=>new Promise((a,n)=>{var o=d=>{try{l(r.next(d))}catch(u){n(u)}},i=d=>{try{l(r.throw(d))}catch(u){n(u)}},l=d=>d.done?a(d.value):Promise.resolve(d.value).then(o,i);l((r=r.apply(s,e)).next())});import{x as N,y as h,z as B,u as H,r as A,j as t,T as G,D as J,E as q,F as Q,B as x,e as k,G as F,C as w,p as C,q as j,t as R,v,H as V,I as Y,J as X,K as Z}from"./main-jfCIwKxb.js";import{S as I}from"./separator-CQeeh5sy.js";import{B as _}from"./badge-Cxniq3nT.js";import{W as ee,a as U}from"./wifi-Ue5kLFZw.js";import{C as te}from"./check-circle-DlKkeJkD.js";const f=class f{constructor(){E(this,"errorCount",0);E(this,"lastErrorTime",0);E(this,"maxErrorsPerMinute",10);E(this,"errorCooldownMs",6e4)}static getInstance(){return f.instance||(f.instance=new f),f.instance}handleError(a){return g(this,arguments,function*(e,r={}){const{showToast:n=!0,logToConsole:o=!0,attemptRecovery:i=!0,fallbackValue:l,context:d="Unknown"}=r;if(this.shouldThrottleErrors())return o&&console.warn("Error handling throttled due to high error rate"),{recovered:!1,fallbackValue:l};const u=this.createErrorInfo(e,d);this.errorCount++,this.lastErrorTime=Date.now(),o&&this.logError(u);let b=!1;return i&&(b=yield this.attemptErrorRecovery(u)),n&&this.showUserFeedback(u,b),this.trackError(u),{recovered:b,fallbackValue:l}})}handleAuthError(e,r="Authentication"){return g(this,null,function*(){const a=this.createErrorInfo(e,r),n=B();if(this.isConnectionError(a)&&n==="failed")try{if(yield N())return h({title:"Connection Restored",description:"Your connection has been restored. Please try again."}),{recovered:!0,shouldRetry:!0}}catch(l){console.error("Failed to reconnect:",l)}const i=this.shouldRetryAuthOperation(a);return i?h({title:"Authentication Issue",description:"Please try again in a moment.",variant:"destructive"}):h({title:"Authentication Failed",description:"Please check your credentials and try again.",variant:"destructive"}),{recovered:!1,shouldRetry:i}})}handleApiError(e,r="API"){return g(this,null,function*(){const a=this.createErrorInfo(e,r),{shouldRetry:n,retryDelay:o}=this.analyzeApiError(a);return n?h({title:"Service Temporarily Unavailable",description:`Retrying in ${Math.ceil((o||0)/1e3)} seconds...`,variant:"destructive"}):h({title:"Service Error",description:"Please try again later or contact support if the problem persists.",variant:"destructive"}),{recovered:!1,shouldRetry:n,retryDelay:o}})}createErrorInfo(e,r){const a=e instanceof Error?e.message:String(e),n=this.extractErrorCode(e),o=this.extractErrorStatus(e);return{message:a,code:n,status:o,context:r,timestamp:new Date,userAgent:navigator.userAgent,url:window.location.href,stack:e instanceof Error?e.stack:void 0}}extractErrorCode(e){if(e&&typeof e=="object"){if("code"in e)return String(e.code);if("status"in e)return`HTTP_${e.status}`;if("errorCode"in e)return String(e.errorCode)}}extractErrorStatus(e){if(e&&typeof e=="object"){if("status"in e&&typeof e.status=="number")return e.status;if("statusCode"in e&&typeof e.statusCode=="number")return e.statusCode}}isConnectionError(e){return["network","connection","timeout","fetch","supabase","auth","500","502","503","504"].some(a=>{var n,o;return e.message.toLowerCase().includes(a)||((n=e.code)==null?void 0:n.toLowerCase().includes(a))||((o=e.status)==null?void 0:o.toString().includes(a))})}shouldRetryAuthOperation(e){return["network","timeout","connection","500","502","503","504"].some(a=>{var n,o;return e.message.toLowerCase().includes(a)||((n=e.code)==null?void 0:n.toLowerCase().includes(a))||((o=e.status)==null?void 0:o.toString().includes(a))})}analyzeApiError(e){const r=e.status;return r&&r>=500&&r<600?{shouldRetry:!0,retryDelay:5e3}:r===429?{shouldRetry:!0,retryDelay:1e4}:this.isConnectionError(e)?{shouldRetry:!0,retryDelay:3e3}:{shouldRetry:!1,retryDelay:0}}attemptErrorRecovery(e){return g(this,null,function*(){if(this.isConnectionError(e))try{if(yield N())return console.log("✅ Error recovery successful: Connection restored"),!0}catch(r){console.error("❌ Error recovery failed:",r)}return!1})}showUserFeedback(e,r){if(r){h({title:"Issue Resolved",description:"The problem has been automatically resolved. Please try again."});return}switch(e.context){case"Authentication":h({title:"Authentication Error",description:"Please check your credentials and try again.",variant:"destructive"});break;case"API":h({title:"Service Error",description:"We're experiencing technical difficulties. Please try again later.",variant:"destructive"});break;case"Network":h({title:"Network Error",description:"Please check your internet connection and try again.",variant:"destructive"});break;default:h({title:"Something went wrong",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}}logError(e){const r=p(y({},e),{timestamp:e.timestamp.toISOString()});e.status&&e.status>=500?console.error("🚨 Server Error:",r):e.status&&e.status>=400?console.warn("⚠️ Client Error:",r):console.error("❌ Application Error:",r)}trackError(e){try{console.log("Error tracked:",e)}catch(r){console.warn("Failed to track error:",r)}}shouldThrottleErrors(){return Date.now()-this.lastErrorTime>this.errorCooldownMs?(this.errorCount=0,!1):this.errorCount>this.maxErrorsPerMinute}resetErrorCount(){this.errorCount=0,this.lastErrorTime=0}getErrorStats(){return{count:this.errorCount,lastErrorTime:this.lastErrorTime}}};E(f,"instance");let O=f;const P=O.getInstance(),re=(s,e)=>P.handleError(s,e),se=(s,e)=>P.handleAuthError(s,e),ne=(s,e)=>P.handleApiError(s,e),oe=()=>{const{connectionStatus:s,isOnline:e}=H(),[r,a]=A.useState(!1),n=()=>g(void 0,null,function*(){a(!0);try{yield N()}catch(l){console.error("Reconnection failed:",l)}finally{a(!1)}}),i=(()=>{switch(s){case"connected":return{icon:t.jsx(te,{className:"w-4 h-4"}),label:"Connected",variant:"default",color:"text-green-600",bgColor:"bg-green-100",description:"All services are working properly"};case"connecting":return{icon:t.jsx(k,{className:"w-4 h-4 animate-spin"}),label:"Connecting",variant:"secondary",color:"text-blue-600",bgColor:"bg-blue-100",description:"Establishing connection..."};case"failed":return{icon:t.jsx(F,{className:"w-4 h-4"}),label:"Connection Failed",variant:"destructive",color:"text-red-600",bgColor:"bg-red-100",description:"Unable to connect to services"};case"offline":return{icon:t.jsx(U,{className:"w-4 h-4"}),label:"Offline",variant:"outline",color:"text-gray-600",bgColor:"bg-gray-100",description:"Network connection unavailable"};default:return{icon:t.jsx(F,{className:"w-4 h-4"}),label:"Unknown",variant:"outline",color:"text-gray-600",bgColor:"bg-gray-100",description:"Connection status unknown"}}})();return t.jsx(G,{children:t.jsxs(J,{children:[t.jsx(q,{asChild:!0,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(_,{variant:i.variant,className:`${i.bgColor} ${i.color} border-0`,children:[i.icon,t.jsx("span",{className:"ml-1 hidden sm:inline",children:i.label})]}),t.jsx("div",{className:"flex items-center gap-1",children:e?t.jsx(ee,{className:"w-3 h-3 text-green-600"}):t.jsx(U,{className:"w-3 h-3 text-red-600"})})]})}),t.jsx(Q,{side:"bottom",className:"max-w-xs",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"font-medium",children:"Connection Status"}),t.jsx("div",{className:"text-sm text-gray-600",children:i.description}),t.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[t.jsxs("div",{children:["Network: ",e?"Online":"Offline"]}),t.jsxs("div",{children:["Service: ",s]})]}),s==="failed"&&e&&t.jsx(x,{size:"sm",onClick:n,disabled:r,className:"w-full mt-2",children:r?t.jsxs(t.Fragment,{children:[t.jsx(k,{className:"w-3 h-3 mr-1 animate-spin"}),"Reconnecting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(k,{className:"w-3 h-3 mr-1"}),"Reconnect"]})})]})})]})})},he=()=>{const{user:s,connectionStatus:e,isOnline:r}=H(),[a,n]=A.useState({}),[o,i]=A.useState(!1),l=()=>g(void 0,null,function*(){i(!0);try{const c=yield V(),m=yield Y(),S=X();n({supabaseStatus:c,connectionTest:m,networkStatus:S,connectionStatus:B(),retryCount:Z(),timestamp:new Date().toISOString()})}catch(c){console.error("Connection test failed:",c),n({error:c instanceof Error?c.message:"Unknown error"})}finally{i(!1)}}),d=()=>g(void 0,null,function*(){i(!0);try{const c=yield N();n(m=>p(y({},m),{forceReconnection:c,timestamp:new Date().toISOString()}))}catch(c){console.error("Force reconnection failed:",c),n(m=>p(y({},m),{forceReconnectionError:c instanceof Error?c.message:"Unknown error"}))}finally{i(!1)}}),u=()=>g(void 0,null,function*(){i(!0);try{const c=yield re(new Error("Test general error"),{context:"Test",showToast:!1}),m=yield se(new Error("Test auth error")),S=yield ne(new Error("Test API error"));n(L=>p(y({},L),{errorHandling:{general:c,auth:m,api:S},timestamp:new Date().toISOString()}))}catch(c){console.error("Error handling test failed:",c),n(m=>p(y({},m),{errorHandlingError:c instanceof Error?c.message:"Unknown error"}))}finally{i(!1)}}),b=()=>{throw new Error("This is a simulated error to test the ErrorBoundary")};return t.jsx("div",{className:"container mx-auto p-6 max-w-4xl",children:t.jsxs(w,{children:[t.jsxs(C,{children:[t.jsx(j,{className:"flex items-center gap-2",children:"🧪 Test Router & Error Handling"}),t.jsx(R,{children:"Test various error handling scenarios and connection status"})]}),t.jsxs(v,{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs(w,{children:[t.jsx(C,{className:"pb-3",children:t.jsx(j,{className:"text-lg",children:"Connection Status"})}),t.jsxs(v,{children:[t.jsx(oe,{}),t.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[t.jsxs("div",{children:["User: ",s?s.email:"Not signed in"]}),t.jsxs("div",{children:["Network: ",r?"Online":"Offline"]}),t.jsxs("div",{children:["Status: ",e]})]})]})]}),t.jsxs(w,{children:[t.jsx(C,{className:"pb-3",children:t.jsx(j,{className:"text-lg",children:"Quick Actions"})}),t.jsxs(v,{className:"space-y-2",children:[t.jsx(x,{onClick:l,disabled:o,className:"w-full",variant:"outline",children:o?"Testing...":"Test Connection"}),t.jsx(x,{onClick:d,disabled:o,className:"w-full",variant:"outline",children:o?"Reconnecting...":"Force Reconnect"}),t.jsx(x,{onClick:u,disabled:o,className:"w-full",variant:"outline",children:o?"Testing...":"Test Error Handling"})]})]})]}),t.jsx(I,{}),Object.keys(a).length>0&&t.jsxs(w,{children:[t.jsxs(C,{children:[t.jsx(j,{className:"text-lg",children:"Test Results"}),t.jsx(R,{children:"Results from the latest tests"})]}),t.jsx(v,{children:t.jsx("pre",{className:"bg-gray-100 p-4 rounded-lg overflow-auto text-xs",children:JSON.stringify(a,null,2)})})]}),t.jsx(I,{}),t.jsxs(w,{children:[t.jsxs(C,{children:[t.jsx(j,{className:"text-lg",children:"Error Boundary Test"}),t.jsx(R,{children:"Test the ErrorBoundary component by simulating an error"})]}),t.jsxs(v,{children:[t.jsx(x,{onClick:b,variant:"destructive",className:"w-full",children:"🚨 Simulate Error (Test ErrorBoundary)"}),t.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"This will trigger the ErrorBoundary to catch and display the error"})]})]}),t.jsxs(w,{children:[t.jsx(C,{children:t.jsx(j,{className:"text-lg",children:"Navigation"})}),t.jsxs(v,{className:"flex flex-wrap gap-2",children:[t.jsx(x,{variant:"outline",onClick:()=>window.location.href="/",children:"Go Home"}),t.jsx(x,{variant:"outline",onClick:()=>window.location.href="/config-status",children:"Config Status"}),t.jsx(x,{variant:"outline",onClick:()=>window.location.href="/community",children:"Community"}),t.jsx(x,{variant:"outline",onClick:()=>window.location.href="/feed",children:"Feed"})]})]})]})]})})};export{he as default};
