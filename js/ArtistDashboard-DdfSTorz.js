var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(s,t,i)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,l=(e,s)=>{for(var t in s||(s={}))r.call(s,t)&&a(e,t,s[t]);if(i)for(var t of i(s))n.call(s,t)&&a(e,t,s[t]);return e},d=(e,i)=>s(e,t(i)),o=(e,s,t)=>new Promise((i,r)=>{var n=e=>{try{l(t.next(e))}catch(s){r(s)}},a=e=>{try{l(t.throw(e))}catch(s){r(s)}},l=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,a);l((t=t.apply(e,s)).next())});import{c,u as m,d as x,r as u,s as h,j,B as p,X as f,b as g}from"./index-BG6xRDTV.js";import{R as v}from"./ResponsiveLayout-Cy8fRDGj.js";import{C as N,a as _,b as y,d as b,c as w}from"./card-CbL4dXrv.js";import{B as k}from"./badge-B2QlhVT_.js";import{S as q}from"./separator-HAFz-71w.js";import{S as C}from"./scroll-area-HbJeSRic.js";import{D,e as E,a as P,b as S,c as B,d as R}from"./dialog-DLasFCgV.js";import{n as A}from"./useNotifications-B1ZtpJoQ.js";import{C as M}from"./index-Dy3819KX.js";import{C as $}from"./clock-zbgmrwZC.js";import{U as T}from"./user-innQK5gL.js";import{f as O}from"./index-DxejKcbp.js";import{M as F}from"./map-pin-Cmdgk16n.js";import{D as L}from"./dollar-sign-djeNKARt.js";import{C as z}from"./check-CF8HR3W6.js";import{A as U,a as V,b as I,i as Y}from"./sheet-D3ubJQDf.js";import{M as H}from"./message-circle-B6r7KIbR.js";import{T as W}from"./trending-up-BXD9ZtNw.js";import{A as X}from"./award-DD9Qk1Er.js";import{C as J}from"./check-circle-IwVTE-WC.js";import{X as K}from"./x-circle-bYxIaXGn.js";import{P as Q}from"./pin-6yaUsILZ.js";import{T as Z,a as G,b as ee,c as se}from"./tabs-DsAJelf8.js";import{S as te}from"./settings-C5hGa_4W.js";import{C as ie}from"./calendar-days-DuxFIfH6.js";import"./input-CK5tWTqm.js";import"./NotificationBell-DnloidrO.js";import"./Combination-Ca6tC3WL.js";import"./bell-9bXVKGDo.js";import"./NotificationButton-BhOs_94_.js";import"./search-B4Ny2Otc.js";import"./users-C0r8Z-ie.js";import"./zap-3-X3ymuv.js";import"./message-square-B4qpNpo_.js";import"./alert-yPy2QlxQ.js";import"./log-out-CsYOYMhW.js";import"./index-B4GyU7fY.js";import"./index-jVOyRz7F.js";
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=c("PinOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h12",key:"13x2n8"}],["path",{d:"M15 9.34V6h1a2 2 0 0 0 0-4H7.89",key:"reo3ki"}]]),ne=()=>{const{user:e}=m(),{toast:s}=x(),[t,i]=u.useState([]),[r,n]=u.useState(!0),[a,c]=u.useState(null);u.useEffect(()=>{if(e){g();(()=>o(void 0,null,function*(){const{data:s,error:t}=yield h.from("artists").select("id").eq("user_id",e.id).single();if(t)return;const i=h.channel("booking-requests").on("postgres_changes",{event:"INSERT",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${s.id}`},()=>{g()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"artist_bookings",filter:`artist_id=eq.${s.id}`},()=>{g()}).subscribe();return()=>{h.removeChannel(i)}}))()}},[e]);const g=()=>o(void 0,null,function*(){if(e)try{const{data:s,error:t}=yield h.from("artists").select("id").eq("user_id",e.id).single();if(t)return void i([]);const{data:r,error:n}=yield h.from("artist_bookings").select("*").eq("artist_id",s.id).eq("status","pending").order("created_at",{ascending:!1});if(n)throw n;const a=yield Promise.all((r||[]).map(e=>o(void 0,null,function*(){const{data:s}=yield h.from("profiles").select("display_name, avatar_url").eq("user_id",e.user_id).single();return d(l({},e),{client_name:(null==s?void 0:s.display_name)||"Unknown User",client_avatar:(null==s?void 0:s.avatar_url)||""})})));i(a)}catch(t){s({title:"Error",description:"Failed to load booking requests",variant:"destructive"})}finally{n(!1)}}),v=(e,r)=>o(void 0,null,function*(){c(e);try{const a=t.find(s=>s.id===e);if(!a)return;const{error:l}=yield h.from("artist_bookings").update({status:"accept"===r?"accepted":"declined",updated_at:(new Date).toISOString()}).eq("id",e);if(l)throw l;try{yield A.createBookingResponseNotification(e,r)}catch(n){}if("accept"===r){const{error:t}=yield h.from("chat_conversations").insert({booking_id:e,client_id:a.user_id,artist_id:a.artist_id});s({title:"Booking Accepted",description:"You've accepted the booking request. A chat has been started with the client."})}else s({title:"Booking Declined",description:"You've declined the booking request."});i(s=>s.filter(s=>s.id!==e))}catch(a){s({title:"Error",description:"Failed to process booking request",variant:"destructive"})}finally{c(null)}});return e?r?j.jsxs(N,{children:[j.jsx(_,{children:j.jsx(y,{children:"Booking Requests"})}),j.jsx(b,{children:j.jsx("div",{className:"flex items-center justify-center py-8",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):j.jsxs(N,{children:[j.jsxs(_,{children:[j.jsxs(y,{className:"flex items-center gap-2",children:[j.jsx(M,{className:"h-5 w-5"}),"Booking Requests"]}),j.jsx(w,{children:"Manage incoming booking requests from clients"})]}),j.jsx(b,{children:0===t.length?j.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[j.jsx($,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),j.jsx("p",{children:"No booking requests yet"}),j.jsx("p",{className:"text-sm",children:"Requests will appear here when clients book your services"})]}):j.jsx(C,{className:"h-96",children:j.jsx("div",{className:"space-y-4",children:t.map(e=>j.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:j.jsx(T,{className:"h-5 w-5 text-primary"})}),j.jsxs("div",{children:[j.jsx("h4",{className:"font-medium",children:e.client_name}),j.jsx("p",{className:"text-sm text-muted-foreground",children:O(new Date(e.created_at),"PPp")})]})]}),j.jsx(k,{variant:"outline",children:"New Request"})]}),j.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),j.jsx("span",{children:O(new Date(e.event_date),"PPP")})]}),j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),j.jsx("span",{className:"truncate",children:e.event_location||"Location TBD"})]}),j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(L,{className:"h-4 w-4 text-muted-foreground"}),j.jsx("span",{children:e.budget_min&&e.budget_max?`$${e.budget_min} - $${e.budget_max}`:"Budget TBD"})]})]}),j.jsx("div",{className:"space-y-2",children:j.jsx("p",{className:"text-sm text-muted-foreground",children:e.event_description})}),j.jsx(q,{}),j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs(D,{children:[j.jsx(E,{asChild:!0,children:j.jsx(p,{variant:"outline",size:"sm",children:"View Details"})}),j.jsxs(P,{children:[j.jsxs(S,{children:[j.jsx(B,{children:"Booking Request Details"}),j.jsx(R,{children:"Full information about this booking request"})]}),j.jsxs("div",{className:"space-y-4",children:[j.jsxs("div",{children:[j.jsx("h4",{className:"font-medium mb-2",children:"Client Information"}),j.jsxs("p",{children:["Name: ",e.client_name]}),e.contact_info&&j.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:e.contact_info})]}),j.jsxs("div",{children:[j.jsx("h4",{className:"font-medium mb-2",children:"Event Details"}),j.jsxs("div",{className:"space-y-1 text-sm",children:[j.jsxs("p",{children:[j.jsx("strong",{children:"Date:"})," ",O(new Date(e.event_date),"PPP")]}),j.jsxs("p",{children:[j.jsx("strong",{children:"Location:"})," ",e.event_location]}),j.jsxs("p",{children:[j.jsx("strong",{children:"Description:"})," ",e.event_description]}),j.jsxs("p",{children:[j.jsx("strong",{children:"Budget:"}),e.budget_min&&e.budget_max?` $${e.budget_min} - $${e.budget_max}`:" Not specified"]})]})]})]})]})]}),j.jsxs("div",{className:"flex gap-2",children:[j.jsxs(p,{size:"sm",variant:"destructive",onClick:()=>v(e.id,"reject"),disabled:a===e.id,children:[j.jsx(f,{className:"h-4 w-4 mr-1"}),"Reject"]}),j.jsxs(p,{size:"sm",onClick:()=>v(e.id,"accept"),disabled:a===e.id,children:[j.jsx(z,{className:"h-4 w-4 mr-1"}),"Accept & Chat"]})]})]})]},e.id))})})})]}):null},ae=()=>{const{user:e}=m(),{toast:s}=x(),[t,i]=u.useState([]),[r,n]=u.useState(!0),a=g();u.useEffect(()=>{if(e){c();const e=h.channel("chat-conversations").on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_conversations"},()=>{c()}).subscribe();return()=>{h.removeChannel(e)}}},[e]);const c=()=>o(void 0,null,function*(){if(e)try{const{data:s,error:t}=yield h.from("chat_conversations").select("*").eq("artist_id",e.id).eq("status","active").order("updated_at",{ascending:!1});if(t)throw t;const r=yield Promise.all((s||[]).map(e=>o(void 0,null,function*(){const{data:s}=yield h.from("profiles").select("display_name, avatar_url").eq("user_id",e.client_id).single(),{data:t}=yield h.from("artist_bookings").select("event_date, event_location").eq("id",e.booking_id).single();return d(l({},e),{client_name:(null==s?void 0:s.display_name)||"Unknown User",client_avatar:(null==s?void 0:s.avatar_url)||"",event_date:(null==t?void 0:t.event_date)||"",event_location:(null==t?void 0:t.event_location)||"",unread_count:0})})));i(r)}catch(t){s({title:"Error",description:"Failed to load conversations",variant:"destructive"})}finally{n(!1)}});return e?r?j.jsxs(N,{children:[j.jsx(_,{children:j.jsx(y,{children:"Active Conversations"})}),j.jsx(b,{children:j.jsx("div",{className:"flex items-center justify-center py-8",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):j.jsxs(N,{children:[j.jsxs(_,{children:[j.jsxs(y,{className:"flex items-center gap-2",children:[j.jsx(H,{className:"h-5 w-5"}),"Active Conversations"]}),j.jsx(w,{children:"Chat with clients about accepted bookings"})]}),j.jsx(b,{children:0===t.length?j.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[j.jsx(H,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),j.jsx("p",{children:"No active conversations"}),j.jsx("p",{className:"text-sm",children:"Conversations will appear here when you accept booking requests"})]}):j.jsx(C,{className:"h-96",children:j.jsx("div",{className:"space-y-4",children:t.map(e=>j.jsxs("div",{className:"border rounded-lg p-4 hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>(e=>{a(`/chat/${e}`)})(e.id),children:[j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs(U,{className:"h-10 w-10",children:[j.jsx(V,{src:e.client_avatar}),j.jsx(I,{children:e.client_name.charAt(0)})]}),j.jsxs("div",{children:[j.jsx("h4",{className:"font-medium",children:e.client_name}),j.jsxs("p",{className:"text-sm text-muted-foreground",children:["Started ",O(new Date(e.created_at),"PPp")]})]})]}),e.unread_count>0&&j.jsx(k,{variant:"destructive",className:"ml-2",children:e.unread_count})]}),j.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4 text-sm",children:[j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),j.jsx("span",{children:e.event_date?O(new Date(e.event_date),"PPP"):"Date TBD"})]}),j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),j.jsx("span",{className:"truncate",children:e.event_location||"Location TBD"})]})]}),j.jsx("div",{className:"mt-3 flex justify-end",children:j.jsx(p,{variant:"outline",size:"sm",children:"Open Chat"})})]},e.id))})})})]}):null},le=()=>{const{user:e}=m(),{toast:s}=x(),[t,i]=u.useState([]),[r,n]=u.useState({totalEarnings:0,thisMonthEarnings:0,completedBookings:0,averageBookingValue:0}),[a,l]=u.useState(!0);u.useEffect(()=>{e&&d()},[e]);const d=()=>o(void 0,null,function*(){if(e)try{const{data:s,error:t}=yield h.from("artists").select("id").eq("user_id",e.id).single();if(t)return;const{data:r,error:a}=yield h.from("artist_bookings").select("*").eq("artist_id",s.id).eq("status","completed").order("updated_at",{ascending:!1});if(a)throw a;const l=[];let d=0,o=0;const c=(new Date).getMonth(),m=(new Date).getFullYear();for(let e=0;e<5;e++){const s=Math.floor(500*Math.random())+100,t=new Date;t.setDate(t.getDate()-Math.floor(30*Math.random())),d+=s,t.getMonth()===c&&t.getFullYear()===m&&(o+=s),l.push({id:`earning_${e}`,booking_id:`booking_${e}`,amount:s,status:"paid",completed_at:t.toISOString(),client_name:`Client ${e+1}`,event_location:`Event Location ${e+1}`})}i(l),n({totalEarnings:d,thisMonthEarnings:o,completedBookings:l.length,averageBookingValue:d>0?d/l.length:0})}catch(t){s({title:"Error",description:"Failed to load earnings data",variant:"destructive"})}finally{l(!1)}});return e?a?j.jsxs(N,{children:[j.jsx(_,{children:j.jsx(y,{children:"Earnings Overview"})}),j.jsx(b,{children:j.jsx("div",{className:"flex items-center justify-center py-8",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):j.jsxs("div",{className:"space-y-6",children:[j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[j.jsxs(N,{children:[j.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(y,{className:"text-sm font-medium",children:"Total Earnings"}),j.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(b,{children:[j.jsxs("div",{className:"text-2xl font-bold",children:["$",r.totalEarnings.toLocaleString()]}),j.jsxs("p",{className:"text-xs text-muted-foreground",children:["From ",r.completedBookings," completed bookings"]})]})]}),j.jsxs(N,{children:[j.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(y,{className:"text-sm font-medium",children:"This Month"}),j.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(b,{children:[j.jsxs("div",{className:"text-2xl font-bold",children:["$",r.thisMonthEarnings.toLocaleString()]}),j.jsxs("p",{className:"text-xs text-muted-foreground",children:[j.jsx("span",{className:"text-green-600",children:"+12%"})," from last month"]})]})]}),j.jsxs(N,{children:[j.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(y,{className:"text-sm font-medium",children:"Completed Bookings"}),j.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(b,{children:[j.jsx("div",{className:"text-2xl font-bold",children:r.completedBookings}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"Successful projects delivered"})]})]}),j.jsxs(N,{children:[j.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(y,{className:"text-sm font-medium",children:"Average Booking"}),j.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(b,{children:[j.jsxs("div",{className:"text-2xl font-bold",children:["$",Math.round(r.averageBookingValue).toLocaleString()]}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"Per completed project"})]})]})]}),j.jsxs(N,{children:[j.jsxs(_,{children:[j.jsxs(y,{className:"flex items-center gap-2",children:[j.jsx(L,{className:"h-5 w-5"}),"Recent Earnings"]}),j.jsx(w,{children:"Your latest completed bookings and payments"})]}),j.jsx(b,{children:0===t.length?j.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[j.jsx(L,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),j.jsx("p",{children:"No earnings yet"}),j.jsx("p",{className:"text-sm",children:"Complete bookings to start earning and tracking your income"})]}):j.jsx(C,{className:"h-96",children:j.jsx("div",{className:"space-y-4",children:t.map(e=>j.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:j.jsx(L,{className:"h-5 w-5 text-green-600"})}),j.jsxs("div",{children:[j.jsx("h4",{className:"font-medium",children:e.client_name}),j.jsx("p",{className:"text-sm text-muted-foreground",children:e.event_location}),j.jsxs("p",{className:"text-xs text-muted-foreground",children:[j.jsx(M,{className:"h-3 w-3 inline mr-1"}),O(new Date(e.completed_at),"PPP")]})]})]}),j.jsxs("div",{className:"text-right",children:[j.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["+$",e.amount]}),j.jsx(k,{variant:"paid"===e.status?"default":"secondary",className:"text-xs",children:e.status})]})]},e.id))})})})]})]}):null},de=()=>{const{user:e}=m(),{toast:s}=x(),[t,i]=u.useState([]),[r,n]=u.useState([]),[a,c]=u.useState(!0),[f,g]=u.useState("pending");u.useEffect(()=>{e&&v()},[e]);const v=()=>o(void 0,null,function*(){if(e)try{const{data:s,error:t}=yield h.from("artists").select("id").eq("user_id",e.id).single();if(t)return i([]),void n([]);const{data:r,error:a}=yield h.from("artist_discussions").select("*").eq("artist_id",s.id).eq("status","pending").order("created_at",{ascending:!1});if(a)throw a;const{data:o,error:c}=yield h.from("artist_discussions").select("*").eq("artist_id",s.id).eq("status","approved").order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1});if(c)throw c;const m=[...(null==r?void 0:r.map(e=>e.user_id))||[],...(null==o?void 0:o.map(e=>e.user_id))||[]];let x={};if(m.length>0){const{data:e}=yield h.from("profiles").select("user_id, display_name, avatar_url").in("user_id",m);x=Object.fromEntries((e||[]).map(e=>[e.user_id,e]))}i((r||[]).map(e=>{var s,t;return d(l({},e),{user_display_name:(null==(s=x[e.user_id])?void 0:s.display_name)||"Anonymous",user_avatar_url:(null==(t=x[e.user_id])?void 0:t.avatar_url)||""})})),n((o||[]).map(e=>{var s,t;return d(l({},e),{user_display_name:(null==(s=x[e.user_id])?void 0:s.display_name)||"Anonymous",user_avatar_url:(null==(t=x[e.user_id])?void 0:t.avatar_url)||""})}))}catch(t){s({title:"Error",description:"Failed to load moderation data",variant:"destructive"})}finally{c(!1)}});return a?j.jsx("div",{className:"flex items-center justify-center py-8",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):j.jsxs("div",{className:"space-y-6",children:[j.jsxs("div",{className:"flex space-x-1 bg-muted p-1 rounded-lg",children:[j.jsxs("button",{onClick:()=>g("pending"),className:"flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors "+("pending"===f?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:["Pending Requests",t.length>0&&j.jsx(k,{variant:"destructive",className:"ml-2 h-5 w-5 rounded-full p-0 text-xs",children:t.length})]}),j.jsxs("button",{onClick:()=>g("approved"),className:"flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors "+("approved"===f?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:["Approved Discussions (",r.length,")"]})]}),"pending"===f&&j.jsx("div",{className:"space-y-4",children:t.length>0?t.map(t=>j.jsxs(N,{children:[j.jsx(_,{children:j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs(U,{className:"h-10 w-10",children:[j.jsx(V,{src:t.user_avatar_url}),j.jsx(I,{children:t.user_display_name.charAt(0)})]}),j.jsxs("div",{children:[j.jsx(y,{className:"text-lg",children:t.title}),j.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",t.user_display_name," • ",new Date(t.created_at).toLocaleDateString()]})]})]}),j.jsx(k,{variant:"outline",children:"Pending"})]})}),j.jsxs(b,{children:[j.jsx("p",{className:"text-muted-foreground mb-4",children:t.content}),j.jsxs("div",{className:"flex gap-2",children:[j.jsxs(p,{size:"sm",onClick:()=>(t=>o(void 0,null,function*(){try{const{data:i,error:r}=yield h.from("artists").select("id").eq("user_id",null==e?void 0:e.id).single();if(r)throw new Error("Artist profile not found");const{error:n}=yield h.from("artist_discussions").update({status:"approved"}).eq("id",t);if(n)throw n;const{error:a}=yield h.from("artist_discussion_moderation_notifications").insert({artist_id:i.id,discussion_id:t,type:"discussion_approved"});s({title:"Discussion approved",description:"The discussion is now visible to your followers"}),v()}catch(i){s({title:"Error",description:"Failed to approve discussion",variant:"destructive"})}}))(t.id),children:[j.jsx(J,{className:"h-4 w-4 mr-2"}),"Approve"]}),j.jsxs(p,{size:"sm",variant:"outline",onClick:()=>(t=>o(void 0,null,function*(){try{const{data:i,error:r}=yield h.from("artists").select("id").eq("user_id",null==e?void 0:e.id).single();if(r)throw new Error("Artist profile not found");const{error:n}=yield h.from("artist_discussions").update({status:"rejected"}).eq("id",t);if(n)throw n;const{error:a}=yield h.from("artist_discussion_moderation_notifications").insert({artist_id:i.id,discussion_id:t,type:"discussion_rejected"});s({title:"Discussion rejected",description:"The discussion request has been rejected"}),v()}catch(i){s({title:"Error",description:"Failed to reject discussion",variant:"destructive"})}}))(t.id),children:[j.jsx(K,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})]},t.id)):j.jsx(N,{children:j.jsx(b,{className:"text-center py-8",children:j.jsx("p",{className:"text-muted-foreground",children:"No pending discussion requests"})})})}),"approved"===f&&j.jsx("div",{className:"space-y-4",children:r.length>0?r.map(e=>j.jsxs(N,{children:[j.jsx(_,{children:j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs(U,{className:"h-10 w-10",children:[j.jsx(V,{src:e.user_avatar_url}),j.jsx(I,{children:e.user_display_name.charAt(0)})]}),j.jsxs("div",{children:[j.jsx(y,{className:"text-lg",children:e.title}),j.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",e.user_display_name," • ",new Date(e.created_at).toLocaleDateString()]})]})]}),j.jsxs("div",{className:"flex items-center gap-2",children:[e.is_pinned&&j.jsx(k,{variant:"secondary",children:"Pinned"}),j.jsx(k,{variant:"outline",className:"text-green-600 border-green-600",children:"Approved"})]})]})}),j.jsxs(b,{children:[j.jsx("p",{className:"text-muted-foreground mb-4",children:e.content}),j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[j.jsxs("div",{className:"flex items-center gap-1",children:[j.jsx(H,{className:"h-4 w-4"}),j.jsxs("span",{children:[e.likes_count," likes"]})]}),j.jsxs("div",{className:"flex items-center gap-1",children:[j.jsx(H,{className:"h-4 w-4"}),j.jsxs("span",{children:[e.replies_count," replies"]})]})]}),j.jsx(p,{size:"sm",variant:"outline",onClick:()=>((e,t)=>o(void 0,null,function*(){try{const{error:i}=yield h.from("artist_discussions").update({is_pinned:!t}).eq("id",e);if(i)throw i;s({title:t?"Discussion unpinned":"Discussion pinned",description:t?"The discussion is no longer pinned":"The discussion is now pinned to the top"}),v()}catch(i){s({title:"Error",description:"Failed to update pin status",variant:"destructive"})}}))(e.id,e.is_pinned),children:e.is_pinned?j.jsxs(j.Fragment,{children:[j.jsx(re,{className:"h-4 w-4 mr-2"}),"Unpin"]}):j.jsxs(j.Fragment,{children:[j.jsx(Q,{className:"h-4 w-4 mr-2"}),"Pin"]})})]})]})]},e.id)):j.jsx(N,{children:j.jsx(b,{className:"text-center py-8",children:j.jsx("p",{className:"text-muted-foreground",children:"No approved discussions yet"})})})})]})},oe=()=>{var e,s,t;const{user:i}=m(),r=g(),[n,a]=u.useState({totalBookings:0,pendingRequests:0,totalEarnings:0,averageRating:0}),[l,d]=u.useState(null),[c,x]=u.useState(!0),[f,w]=u.useState("bookings");u.useEffect(()=>{i&&q()},[i]);const q=()=>o(void 0,null,function*(){var e,s,t;if(i)try{const{data:r,error:n}=yield h.from("profiles").select("*").eq("user_id",i.id).single();if(n)throw n;d(r);const{data:l,error:o}=yield h.from("artists").select("id").eq("user_id",i.id).single();if(o)return void a({totalBookings:0,pendingRequests:0,totalEarnings:0,averageRating:0});const[c,m,x]=yield Promise.all([h.from("artist_bookings").select("id, budget_min, budget_max, status").eq("artist_id",l.id).in("status",["accepted","completed"]),h.from("artist_bookings").select("id").eq("artist_id",l.id).eq("status","pending"),h.from("chat_conversations").select("id").eq("artist_id",i.id).eq("status","active")]),u=(null==(e=c.data)?void 0:e.length)||0,j=(null==(s=m.data)?void 0:s.length)||0,p=((null==(t=c.data)?void 0:t.filter(e=>"completed"===e.status))||[]).reduce((e,s)=>e+(s.budget_max||s.budget_min||0),0),f=u>0?4.2+.8*Math.random():0;a({totalBookings:u,pendingRequests:j,totalEarnings:p,averageRating:f})}catch(r){}finally{x(!1)}});return i?c?j.jsx(v,{children:j.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):j.jsx(v,{children:j.jsxs("div",{className:"space-y-8",children:[j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx("h1",{className:"text-3xl font-bold",children:"Artist Dashboard"}),j.jsx("p",{className:"text-muted-foreground",children:"Manage your bookings, track earnings, and grow your business"})]}),j.jsx("div",{className:"flex items-center gap-4",children:j.jsxs(p,{variant:"outline",onClick:()=>r("/settings"),children:[j.jsx(te,{className:"h-4 w-4 mr-2"}),"Settings"]})})]}),j.jsx(N,{children:j.jsx(_,{children:j.jsxs("div",{className:"flex items-center gap-4",children:[j.jsxs(U,{className:"h-16 w-16",children:[j.jsx(V,{src:null==l?void 0:l.avatar_url}),j.jsx(I,{children:(null==(e=null==l?void 0:l.display_name)?void 0:e.charAt(0))||(null==(s=i.email)?void 0:s.charAt(0).toUpperCase())})]}),j.jsxs("div",{className:"flex-1",children:[j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx("h2",{className:"text-2xl font-semibold",children:null==l?void 0:l.display_name}),(null==l?void 0:l.is_verified)&&j.jsx(k,{variant:"secondary",children:"Verified"})]}),j.jsx("p",{className:"text-muted-foreground",children:null==l?void 0:l.bio}),j.jsx("div",{className:"flex items-center gap-4 mt-2",children:(null==(t=null==l?void 0:l.artist_skills)?void 0:t.length)>0&&j.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.artist_skills.slice(0,3).map(e=>j.jsx(k,{variant:"outline",className:"text-xs",children:e},e)),l.artist_skills.length>3&&j.jsxs(k,{variant:"outline",className:"text-xs",children:["+",l.artist_skills.length-3," more"]})]})})]})]})})}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[j.jsxs(N,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>w("bookings"),children:[j.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(y,{className:"text-sm font-medium",children:"Total Bookings"}),j.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(b,{children:[j.jsx("div",{className:"text-2xl font-bold",children:n.totalBookings}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"Click to view all bookings"})]})]}),j.jsxs(N,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>w("bookings"),children:[j.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(y,{className:"text-sm font-medium",children:"Pending Requests"}),j.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(b,{children:[j.jsx("div",{className:"text-2xl font-bold",children:n.pendingRequests}),j.jsx("p",{className:"text-xs text-muted-foreground",children:n.pendingRequests>0?"Awaiting your response":"No pending requests"})]})]}),j.jsxs(N,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>w("earnings"),children:[j.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(y,{className:"text-sm font-medium",children:"Total Earnings"}),j.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(b,{children:[j.jsxs("div",{className:"text-2xl font-bold",children:["$",n.totalEarnings.toLocaleString()]}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"Click for earnings details"})]})]}),j.jsxs(N,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>w("chats"),children:[j.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[j.jsx(y,{className:"text-sm font-medium",children:"Average Rating"}),j.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),j.jsxs(b,{children:[j.jsx("div",{className:"text-2xl font-bold",children:n.averageRating>0?n.averageRating.toFixed(1):"N/A"}),j.jsx("p",{className:"text-xs text-muted-foreground",children:n.totalBookings>0?`From ${n.totalBookings} bookings`:"Complete bookings to get rated"})]})]})]}),j.jsxs(Z,{value:f,onValueChange:w,className:"space-y-6",children:[j.jsxs(G,{children:[j.jsxs(ee,{value:"bookings",children:["Booking Requests",n.pendingRequests>0&&j.jsx(k,{variant:"destructive",className:"ml-2 h-5 w-5 rounded-full p-0 text-xs",children:n.pendingRequests})]}),j.jsx(ee,{value:"chats",children:"Active Chats"}),j.jsx(ee,{value:"earnings",children:"Earnings"}),j.jsx(ee,{value:"moderation",children:"Discussion Moderation"})]}),j.jsx(se,{value:"bookings",children:j.jsx(ne,{})}),j.jsx(se,{value:"chats",children:j.jsx(ae,{})}),j.jsx(se,{value:"earnings",children:j.jsx(le,{})}),j.jsx(se,{value:"moderation",children:j.jsx(de,{})})]})]})}):(r("/signin"),null)};export{oe as default};
